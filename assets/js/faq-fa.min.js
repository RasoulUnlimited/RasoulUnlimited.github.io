document.addEventListener("DOMContentLoaded",()=>{"use strict";const e=Array.from(document.querySelectorAll(".faq-item")),t=document.querySelector(".faq-navigation"),n=document.getElementById("faq-search"),a=document.getElementById("clear-search"),o=Array.from(document.querySelectorAll(".faq-section")),r=document.querySelector(".main-content"),c=document.querySelector(".page-header");if(!e.length&&!r&&!c)return;function s(e,t){let n;return function(){const a=this,o=arguments;clearTimeout(n),n=setTimeout(()=>e.apply(a,o),t)}}if(t&&t.addEventListener("click",e=>{const t=e.target.closest("a");if(!t)return;const n=t.dataset.category||"unknown";"function"==typeof gtag&&gtag("event","faq_nav_click",{event_category:"FAQ Navigation",event_label:`Clicked category: ${n}`,value:1}),"function"==typeof hj&&hj("event",`faq_nav_clicked_category_${n.replace(/\s/g,"_").toLowerCase()}`)}),document.querySelectorAll(".button-link").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.ctaType||"generic";"function"==typeof gtag&&gtag("event","faq_cta_click",{event_category:"FAQ Call to Action",event_label:`CTA Clicked: ${t}`,value:1}),"function"==typeof hj&&hj("event",`faq_cta_clicked_${t}`)})}),document.querySelectorAll(".faq-answer .text-link").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.linkType||"generic";"function"==typeof gtag&&gtag("event","faq_text_link_click",{event_category:"FAQ Internal Link",event_label:`Text link clicked: ${t}`,value:1}),"function"==typeof hj&&hj("event",`faq_text_link_clicked_${t}`)})}),n&&a&&o.length){let t=document.getElementById("faq-search-status");t||(t=document.createElement("div"),t.id="faq-search-status",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="faq-search-status sr-only",(n.closest("form")||n.parentNode).appendChild(t)),a.getAttribute("aria-label")||a.setAttribute("aria-label","پاک کردن جستجوی پرسش‌ها");const r=(n,a)=>{const o=e.length,r=n.trim();t.textContent=r?a?`${a} نتیجه برای «${r}» یافت شد.`:`هیچ نتیجه‌ای برای «${r}» پیدا نشد.`:`نمایش ${o} پرسش موجود.`},c=()=>{const e=(n.value||"").trim().toLowerCase();a.style.display=e?"block":"none";let t=0;o.forEach(n=>{let a=!1;n.querySelectorAll(".faq-item").forEach(n=>{const o=n.querySelector("summary"),r=o?o.textContent.toLowerCase():"",c=n.querySelector(".faq-answer"),s=c?c.textContent.toLowerCase():"",l=(n.dataset.keywords||"").toLowerCase();!e||r.includes(e)||s.includes(e)||l.includes(e)?(n.hidden=!1,a=!0,t++,!e||n.open||n.dataset.openedByUser||(n.open=!0,n.dataset.openedBySearch="true")):(n.hidden=!0,n.open&&n.dataset.openedBySearch&&(n.open=!1,delete n.dataset.openedBySearch))}),n.hidden=!a}),"function"==typeof gtag&&gtag("event","faq_search",{event_category:"FAQ Search",search_term:e,results_count:t}),"function"==typeof hj&&e&&hj("event",`faq_searched_${e.replace(/\s/g,"_").toLowerCase()}`),r(e,t)},l=s(c,200);n.addEventListener("input",l),n.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),n.value="",a.style.display="none",c())}),a.addEventListener("click",()=>{n.value="",a.style.display="none",e.forEach(e=>{e.hidden=!1,e.open&&e.dataset.openedBySearch&&(e.open=!1,delete e.dataset.openedBySearch)}),o.forEach(e=>{e.hidden=!1}),r("",e.length),"function"==typeof gtag&&gtag("event","faq_search_cleared",{event_category:"FAQ Search",event_label:"Search input cleared"}),"function"==typeof hj&&hj("event","faq_search_cleared"),n.focus()}),a.style.display="none",r("",e.length)}r&&e.length&&r.addEventListener("click",t=>{const n=t.target.closest(".faq-item summary");if(!n)return;const a=t.target.closest("a");if(a&&n.contains(a))return t.preventDefault(),void(window.location.href=a.href);t.preventDefault();const o=n.parentElement,r=o.dataset.questionId||"unknown",c=o.open;e.forEach(e=>{if(e!==o){e.open=!1,delete e.dataset.openedByUser,delete e.dataset.openedBySearch;const t=e.querySelector("summary");t&&t.setAttribute("aria-expanded","false")}}),c?(o.open=!1,n.setAttribute("aria-expanded","false"),"function"==typeof gtag&&gtag("event","faq_collapse",{event_category:"FAQ Interaction",event_label:`Question collapsed: ${r}`,question_text:n.textContent.trim()}),"function"==typeof hj&&hj("event",`faq_collapsed_${r}`),delete o.dataset.openedBySearch,delete o.dataset.openedByUser):(o.open=!0,n.setAttribute("aria-expanded","true"),o.dataset.openedByUser="true",delete o.dataset.openedBySearch,setTimeout(()=>{const e=o.getBoundingClientRect();(e.top<0||e.bottom>window.innerHeight)&&o.scrollIntoView({behavior:"smooth",block:"nearest"})},450),"function"==typeof gtag&&gtag("event","faq_expand",{event_category:"FAQ Interaction",event_label:`Question expanded: ${r}`,question_text:n.textContent.trim()}),"function"==typeof hj&&hj("event",`faq_expanded_${r}`))}),e.forEach(e=>{const t=e.querySelector("summary");t&&(t.addEventListener("focus",()=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--primary-blue")||"#007bff";t.style.outline=`3px solid ${e.trim()}66`,t.style.outlineOffset="5px"}),t.addEventListener("blur",()=>{t.style.outline="none",t.style.outlineOffset="0"}),t.setAttribute("aria-expanded",e.open?"true":"false"))});!!window.matchMedia&&window.matchMedia("(prefers-reduced-motion: reduce)").matches||(c&&(c.style.opacity="0",c.style.transform="translateY(-20px)",setTimeout(()=>{c.style.transition="opacity 1s ease-out, transform 1s ease-out",c.style.opacity="1",c.style.transform="translateY(0)"},100)),r&&(r.style.opacity="0",r.style.transform="translateY(20px)",setTimeout(()=>{r.style.transition="opacity 1s ease-out, transform 1s ease-out",r.style.opacity="1",r.style.transform="translateY(0)"},300)))});