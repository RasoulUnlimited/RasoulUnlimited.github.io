{"version":3,"file":"featured-feedback.min.js","names":["window","document","CACHE_PREFIX","ROOTS","rootStates","WeakMap","inflightByUrl","Map","connectivityBindingsAttached","STRINGS","fa","empty","errorPrefix","sourceCta","authorFallback","roleFallback","staleNotice","en","sleep","ms","Promise","resolve","setTimeout","storage","key","localStorage","setItem","removeItem","getSafeStorage","getCacheKey","url","parsed","URL","location","href","pathname","String","writeCachedItems","items","Array","isArray","length","value","JSON","stringify","t","Date","now","entries","i","startsWith","timestamp","payload","parse","getItem","Number","push","sort","a","b","slice","Math","ceil","forEach","entry","evictOldCacheEntries","isHttpUrl","trim","protocol","normalizeText","max","normalized","replace","dispatch","root","eventName","detail","dispatchEvent","CustomEvent","bubbles","renderStaleNotice","copy","note","createElement","className","textContent","appendChild","buildCard","item","lang","fallbackUrl","article","setAttribute","id","quote","meta","identity","author","role","safeFallbackLink","rootSafeFallbackLink","link","target","rel","source_url","source_label","formattedDate","isNaN","getTime","locale","Intl","DateTimeFormat","year","month","day","format","formatDate","date","dateEl","dateTime","async","fetchWithTimeout","timeoutMs","controller","AbortController","timer","abort","fetch","cache","credentials","signal","clearTimeout","fetchSource","fallbackLang","forceRefresh","Error","has","get","delete","pending","rawItems","lastError","attempt","response","ok","status","json","error","delay","floor","random","fetchItemsFromNetwork","sanitized","map","raw","langRaw","toLowerCase","sourceLabel","sourceUrl","dateText","sanitizeItem","filter","Boolean","stale","networkError","cached","readCachedItems","set","clearRetryTimer","state","retryTimer","renderRoot","options","dataset","featuredFeedbackLang","documentElement","resolveLang","source","featuredFeedbackSource","fallback","featuredFeedbackFallback","featuredFeedbackStatus","featuredFeedbackErrorReason","featuredFeedbackStale","firstChild","removeChild","clearRoot","filtered","renderEmpty","retryCount","reason","message","wrap","renderError","navigator","onLine","FETCH_RETRY_BASE_MS","scheduleAutoRetry","boot","roots","from","querySelectorAll","featuredFeedbackBooted","initRoot","onOnline","addEventListener","removeEventListener","once","attachConnectivityBindings","readyState","__featuredFeedback","reloadAll","getStatus"],"sources":["featured-feedback.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Resilient renderer for featured feedback cards in home testimonials.\n(function () {\n  \"use strict\";\n\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\n    return;\n  }\n\n  const ROOT_SELECTOR = \"[data-featured-feedback-root]\";\n  const CACHE_PREFIX = \"ru-featured-feedback-v3::\";\n  const CACHE_TTL_MS = 6 * 60 * 60 * 1000;\n  const FETCH_TIMEOUT_MS = 6500;\n  const FETCH_ATTEMPTS = 3;\n  const FETCH_RETRY_BASE_MS = 320;\n  const MAX_RENDER_RETRIES = 2;\n  const ROOTS = [];\n  const rootStates = new WeakMap();\n  const inflightByUrl = new Map();\n  let connectivityBindingsAttached = false;\n\n  const STRINGS = {\n    fa: {\n      empty: \"\\u0647\\u0646\\u0648\\u0632 \\u0628\\u0627\\u0632\\u062e\\u0648\\u0631\\u062f \\u0645\\u0646\\u062a\\u062e\\u0628 \\u0645\\u0646\\u062a\\u0634\\u0631 \\u0646\\u0634\\u062f\\u0647 \\u0627\\u0633\\u062a.\",\n      errorPrefix: \"\\u0646\\u0645\\u0627\\u06cc\\u0634 \\u0628\\u0627\\u0632\\u062e\\u0648\\u0631\\u062f\\u0647\\u0627\\u06cc \\u0645\\u0646\\u062a\\u062e\\u0628 \\u0645\\u0645\\u06a9\\u0646 \\u0646\\u0628\\u0648\\u062f.\",\n      sourceCta: \"\\u0645\\u0634\\u0627\\u0647\\u062f\\u0647 \\u0647\\u0645\\u0647 \\u06af\\u0641\\u062a\\u06af\\u0648\\u0647\\u0627\",\n      authorFallback: \"\\u06a9\\u0627\\u0631\\u0628\\u0631 GitHub\",\n      roleFallback: \"\\u0628\\u0627\\u0632\\u062f\\u06cc\\u062f\\u06a9\\u0646\\u0646\\u062f\\u0647\",\n      staleNotice:\n        \"\\u0628\\u0647 \\u062f\\u0644\\u06cc\\u0644 \\u0646\\u0627\\u067e\\u0627\\u06cc\\u062f\\u0627\\u0631\\u06cc \\u0627\\u062a\\u0635\\u0627\\u0644\\u060c \\u0646\\u0633\\u062e\\u0647 \\u0630\\u062e\\u06cc\\u0631\\u0647\\u200c\\u0634\\u062f\\u0647 \\u0646\\u0645\\u0627\\u06cc\\u0634 \\u062f\\u0627\\u062f\\u0647 \\u0634\\u062f.\",\n    },\n    en: {\n      empty: \"No featured feedback has been published yet.\",\n      errorPrefix: \"Featured feedback could not be loaded.\",\n      sourceCta: \"View all discussions\",\n      authorFallback: \"GitHub user\",\n      roleFallback: \"Visitor\",\n      staleNotice: \"Showing a cached snapshot because the connection is unstable.\",\n    },\n  };\n\n  function sleep(ms) {\n    return new Promise((resolve) => {\n      window.setTimeout(resolve, ms);\n    });\n  }\n\n  function getSafeStorage() {\n    try {\n      const key = \"__ru_featured_feedback_probe__\";\n      localStorage.setItem(key, \"1\");\n      localStorage.removeItem(key);\n      return localStorage;\n    } catch {\n      return null;\n    }\n  }\n\n  const storage = getSafeStorage();\n\n  function resolveLang(root) {\n    const lang = root.dataset.featuredFeedbackLang || document.documentElement.lang || \"en\";\n    return lang.toLowerCase().startsWith(\"fa\") ? \"fa\" : \"en\";\n  }\n\n  function getCacheKey(url) {\n    try {\n      const parsed = new URL(url, window.location.href);\n      return CACHE_PREFIX + parsed.pathname;\n    } catch {\n      return CACHE_PREFIX + String(url || \"\");\n    }\n  }\n\n  function evictOldCacheEntries() {\n    if (!storage) {\n      return;\n    }\n\n    const entries = [];\n    for (let i = 0; i < storage.length; i++) {\n      const key = storage.key(i);\n      if (!key || !key.startsWith(CACHE_PREFIX)) {\n        continue;\n      }\n\n      let timestamp = 0;\n      try {\n        const payload = JSON.parse(storage.getItem(key) || \"{}\");\n        timestamp = Number(payload.t) || 0;\n      } catch {\n        timestamp = 0;\n      }\n\n      entries.push({ key, timestamp });\n    }\n\n    entries\n      .sort((a, b) => a.timestamp - b.timestamp)\n      .slice(0, Math.ceil(entries.length / 2))\n      .forEach((entry) => {\n        try {\n          storage.removeItem(entry.key);\n        } catch {}\n      });\n  }\n\n  function readCachedItems(url) {\n    if (!storage) {\n      return null;\n    }\n\n    const key = getCacheKey(url);\n    const raw = storage.getItem(key);\n    if (!raw) {\n      return null;\n    }\n\n    try {\n      const payload = JSON.parse(raw);\n      const timestamp = Number(payload.t) || 0;\n      const items = Array.isArray(payload.items) ? payload.items : null;\n      if (!items || !items.length) {\n        storage.removeItem(key);\n        return null;\n      }\n\n      if (Date.now() - timestamp > CACHE_TTL_MS) {\n        storage.removeItem(key);\n        return null;\n      }\n\n      return items;\n    } catch {\n      storage.removeItem(key);\n      return null;\n    }\n  }\n\n  function writeCachedItems(url, items) {\n    if (!storage || !Array.isArray(items) || !items.length) {\n      return;\n    }\n\n    const key = getCacheKey(url);\n    const value = JSON.stringify({\n      t: Date.now(),\n      items,\n    });\n\n    try {\n      storage.setItem(key, value);\n    } catch {\n      evictOldCacheEntries();\n      try {\n        storage.setItem(key, value);\n      } catch {}\n    }\n  }\n\n  function isHttpUrl(value) {\n    if (typeof value !== \"string\" || !value.trim()) {\n      return false;\n    }\n\n    try {\n      const parsed = new URL(value, window.location.href);\n      return parsed.protocol === \"http:\" || parsed.protocol === \"https:\";\n    } catch {\n      return false;\n    }\n  }\n\n  function normalizeText(value, max = 800) {\n    if (typeof value !== \"string\") {\n      return \"\";\n    }\n    const normalized = value.replace(/\\s+/g, \" \").trim();\n    if (!normalized) {\n      return \"\";\n    }\n    return normalized.slice(0, max);\n  }\n\n  function sanitizeItem(raw, fallbackLang) {\n    if (!raw || typeof raw !== \"object\") {\n      return null;\n    }\n\n    const langRaw = String(raw.lang || \"\").toLowerCase();\n    const lang = langRaw.startsWith(\"fa\")\n      ? \"fa\"\n      : langRaw.startsWith(\"en\")\n        ? \"en\"\n        : fallbackLang;\n\n    const id = normalizeText(String(raw.id || \"\"), 120);\n    const quote = normalizeText(String(raw.quote || \"\"), 1200);\n    if (!quote) {\n      return null;\n    }\n\n    const author = normalizeText(String(raw.author || \"\"), 160);\n    const role = normalizeText(String(raw.role || \"\"), 160);\n    const sourceLabel = normalizeText(String(raw.source_label || \"\"), 160);\n    const sourceUrl = isHttpUrl(String(raw.source_url || \"\")) ? String(raw.source_url) : \"\";\n    const dateText = normalizeText(String(raw.date || \"\"), 64);\n    const date = dateText && !Number.isNaN(Date.parse(dateText)) ? dateText : \"\";\n\n    return {\n      id,\n      lang,\n      quote,\n      author,\n      role,\n      source_url: sourceUrl,\n      source_label: sourceLabel,\n      date,\n    };\n  }\n\n  function formatDate(value, lang) {\n    if (!value) {\n      return \"\";\n    }\n\n    const parsed = new Date(value);\n    if (Number.isNaN(parsed.getTime())) {\n      return \"\";\n    }\n\n    const locale = lang === \"fa\" ? \"fa-IR\" : \"en-US\";\n    try {\n      return new Intl.DateTimeFormat(locale, {\n        year: \"numeric\",\n        month: \"short\",\n        day: \"numeric\",\n      }).format(parsed);\n    } catch {\n      return \"\";\n    }\n  }\n\n  function dispatch(root, eventName, detail) {\n    try {\n      root.dispatchEvent(\n        new CustomEvent(eventName, {\n          bubbles: true,\n          detail: detail || {},\n        })\n      );\n    } catch {}\n  }\n\n  function clearRoot(root) {\n    while (root.firstChild) {\n      root.removeChild(root.firstChild);\n    }\n  }\n\n  function renderStaleNotice(root, copy) {\n    const note = document.createElement(\"p\");\n    note.className = \"featured-feedback-stale-note\";\n    note.textContent = copy.staleNotice;\n    root.appendChild(note);\n  }\n\n  function buildCard(item, lang, copy, fallbackUrl) {\n    const article = document.createElement(\"article\");\n    article.className = \"featured-feedback-card\";\n    article.setAttribute(\"data-featured-feedback-item\", item.id || \"\");\n    article.setAttribute(\"data-feedback-lang\", lang);\n\n    const quote = document.createElement(\"p\");\n    quote.className = \"featured-feedback-quote\";\n    quote.textContent = item.quote;\n    article.appendChild(quote);\n\n    const meta = document.createElement(\"div\");\n    meta.className = \"featured-feedback-meta\";\n\n    const identity = document.createElement(\"div\");\n    const author = document.createElement(\"div\");\n    author.className = \"featured-feedback-author\";\n    author.textContent = item.author || copy.authorFallback;\n    const role = document.createElement(\"div\");\n    role.className = \"featured-feedback-role\";\n    role.textContent = item.role || copy.roleFallback;\n    identity.appendChild(author);\n    identity.appendChild(role);\n    meta.appendChild(identity);\n\n    const safeFallbackLink = rootSafeFallbackLink(fallbackUrl);\n    const link = document.createElement(\"a\");\n    link.className = \"featured-feedback-link\";\n    link.target = \"_blank\";\n    link.rel = \"noopener noreferrer\";\n    link.href = item.source_url || safeFallbackLink;\n    link.textContent = item.source_label || copy.sourceCta;\n    meta.appendChild(link);\n\n    article.appendChild(meta);\n\n    const formattedDate = formatDate(item.date, lang);\n    if (formattedDate && item.date) {\n      const dateEl = document.createElement(\"time\");\n      dateEl.className = \"featured-feedback-date\";\n      dateEl.dateTime = item.date;\n      dateEl.textContent = formattedDate;\n      article.appendChild(dateEl);\n    }\n\n    return article;\n  }\n\n  function rootSafeFallbackLink(fallbackUrl) {\n    if (isHttpUrl(fallbackUrl || \"\")) {\n      return fallbackUrl;\n    }\n    return \"https://github.com/RasoulUnlimited/comments/discussions\";\n  }\n\n  function renderEmpty(root, copy) {\n    const empty = document.createElement(\"p\");\n    empty.className = \"featured-feedback-empty\";\n    empty.textContent = copy.empty;\n    root.appendChild(empty);\n    root.dataset.featuredFeedbackStatus = \"empty\";\n  }\n\n  function renderError(root, copy, fallbackUrl, reason) {\n    const wrap = document.createElement(\"p\");\n    wrap.className = \"featured-feedback-error\";\n    wrap.textContent = `${copy.errorPrefix} `;\n\n    if (isHttpUrl(fallbackUrl || \"\")) {\n      const link = document.createElement(\"a\");\n      link.className = \"featured-feedback-link\";\n      link.href = fallbackUrl;\n      link.target = \"_blank\";\n      link.rel = \"noopener noreferrer\";\n      link.textContent = copy.sourceCta;\n      wrap.appendChild(link);\n    }\n\n    root.appendChild(wrap);\n    root.dataset.featuredFeedbackStatus = \"error\";\n    root.dataset.featuredFeedbackErrorReason = reason || \"unknown-error\";\n    delete root.dataset.featuredFeedbackStale;\n  }\n\n  async function fetchWithTimeout(url, timeoutMs) {\n    const hasAbortController = typeof AbortController === \"function\";\n    const controller = hasAbortController ? new AbortController() : null;\n    let timer = null;\n\n    if (controller) {\n      timer = window.setTimeout(() => {\n        controller.abort();\n      }, timeoutMs);\n    }\n\n    try {\n      return await fetch(url, {\n        cache: \"no-store\",\n        credentials: \"same-origin\",\n        ...(controller ? { signal: controller.signal } : {}),\n      });\n    } finally {\n      if (timer) {\n        window.clearTimeout(timer);\n      }\n    }\n  }\n\n  async function fetchItemsFromNetwork(url) {\n    let lastError = null;\n\n    for (let attempt = 1; attempt <= FETCH_ATTEMPTS; attempt++) {\n      try {\n        const response = await fetchWithTimeout(url, FETCH_TIMEOUT_MS);\n        if (!response.ok) {\n          throw new Error(`http-${response.status}`);\n        }\n\n        const payload = await response.json();\n        if (!payload || !Array.isArray(payload.items)) {\n          throw new Error(\"invalid-shape\");\n        }\n\n        return payload.items;\n      } catch (error) {\n        lastError = error;\n        if (attempt < FETCH_ATTEMPTS) {\n          const delay =\n            FETCH_RETRY_BASE_MS * 2 ** (attempt - 1) + Math.floor(Math.random() * 120);\n          await sleep(delay);\n        }\n      }\n    }\n\n    throw lastError || new Error(\"fetch-failed\");\n  }\n\n  async function fetchSource(url, fallbackLang, forceRefresh) {\n    if (!url) {\n      throw new Error(\"missing-source\");\n    }\n\n    if (!forceRefresh && inflightByUrl.has(url)) {\n      return inflightByUrl.get(url);\n    }\n\n    if (forceRefresh) {\n      inflightByUrl.delete(url);\n    }\n\n    const pending = (async () => {\n      try {\n        const rawItems = await fetchItemsFromNetwork(url);\n        const sanitized = rawItems\n          .map((item) => sanitizeItem(item, fallbackLang))\n          .filter(Boolean);\n\n        if (!sanitized.length) {\n          throw new Error(\"no-usable-items\");\n        }\n\n        writeCachedItems(url, sanitized);\n        return { items: sanitized, stale: false };\n      } catch (networkError) {\n        const cached = readCachedItems(url);\n        if (cached && cached.length) {\n          return { items: cached, stale: true };\n        }\n        throw networkError;\n      }\n    })();\n\n    inflightByUrl.set(url, pending);\n\n    try {\n      return await pending;\n    } catch (error) {\n      inflightByUrl.delete(url);\n      throw error;\n    }\n  }\n\n  function clearRetryTimer(state) {\n    if (!state || !state.retryTimer) {\n      return;\n    }\n\n    window.clearTimeout(state.retryTimer);\n    state.retryTimer = null;\n  }\n\n  function scheduleAutoRetry(root, state, reason) {\n    if (!state) {\n      return;\n    }\n\n    if (navigator.onLine === false) {\n      return;\n    }\n\n    if (state.retryCount >= MAX_RENDER_RETRIES) {\n      return;\n    }\n\n    state.retryCount += 1;\n    const delay = FETCH_RETRY_BASE_MS * 3 * state.retryCount;\n    clearRetryTimer(state);\n    state.retryTimer = window.setTimeout(() => {\n      renderRoot(root, {\n        forceRefresh: true,\n        source: \"auto-retry\",\n      });\n    }, delay);\n\n    dispatch(root, \"featured-feedback:retry\", {\n      reason,\n      source: \"auto\",\n      attempt: state.retryCount,\n    });\n  }\n\n  async function renderRoot(root, options = {}) {\n    if (!root) {\n      return;\n    }\n\n    const state = rootStates.get(root);\n    if (!state) {\n      return;\n    }\n\n    if (state.status === \"loading\") {\n      return;\n    }\n\n    const lang = resolveLang(root);\n    const copy = STRINGS[lang];\n    const source = root.dataset.featuredFeedbackSource || \"\";\n    const fallback = root.dataset.featuredFeedbackFallback || \"\";\n    const forceRefresh = !!options.forceRefresh;\n\n    root.dataset.featuredFeedbackStatus = \"loading\";\n    root.dataset.featuredFeedbackErrorReason = \"\";\n    delete root.dataset.featuredFeedbackStale;\n    state.status = \"loading\";\n\n    clearRetryTimer(state);\n    clearRoot(root);\n\n    try {\n      const { items, stale } = await fetchSource(source, lang, forceRefresh);\n      const filtered = items.filter((item) => item && item.lang === lang).slice(0, 3);\n\n      if (!filtered.length) {\n        if (stale) {\n          root.dataset.featuredFeedbackStale = \"true\";\n          renderStaleNotice(root, copy);\n        }\n        renderEmpty(root, copy);\n        state.status = \"empty\";\n        dispatch(root, \"featured-feedback:ready\", { stale, empty: true });\n        return;\n      }\n\n      if (stale) {\n        root.dataset.featuredFeedbackStale = \"true\";\n        renderStaleNotice(root, copy);\n      } else {\n        delete root.dataset.featuredFeedbackStale;\n      }\n\n      filtered.forEach((item) => {\n        root.appendChild(buildCard(item, lang, copy, fallback));\n      });\n\n      root.dataset.featuredFeedbackStatus = \"ready\";\n      state.status = stale ? \"stale\" : \"ready\";\n      state.retryCount = 0;\n\n      dispatch(root, \"featured-feedback:ready\", { stale: !!stale, empty: false });\n      if (stale) {\n        dispatch(root, \"featured-feedback:stale\", { source });\n      }\n    } catch (error) {\n      const reason = String(error && error.message ? error.message : \"unknown-error\");\n      renderError(root, copy, fallback, reason);\n      state.status = \"error\";\n      dispatch(root, \"featured-feedback:error\", { reason });\n      scheduleAutoRetry(root, state, reason);\n    }\n  }\n\n  function attachConnectivityBindings() {\n    if (connectivityBindingsAttached) {\n      return;\n    }\n\n    connectivityBindingsAttached = true;\n    const onOnline = () => {\n      ROOTS.forEach((root) => {\n        const state = rootStates.get(root);\n        if (!state) {\n          return;\n        }\n\n        const shouldRefresh =\n          state.status === \"error\" || state.status === \"stale\" || root.dataset.featuredFeedbackStale === \"true\";\n        if (!shouldRefresh) {\n          return;\n        }\n\n        renderRoot(root, {\n          forceRefresh: true,\n          source: \"online\",\n        });\n      });\n    };\n\n    window.addEventListener(\"online\", onOnline);\n    window.addEventListener(\n      \"beforeunload\",\n      () => {\n        window.removeEventListener(\"online\", onOnline);\n      },\n      { once: true }\n    );\n  }\n\n  function initRoot(root) {\n    if (!root || root.dataset.featuredFeedbackBooted === \"true\") {\n      return;\n    }\n\n    root.dataset.featuredFeedbackBooted = \"true\";\n\n    rootStates.set(root, {\n      status: \"idle\",\n      retryCount: 0,\n      retryTimer: null,\n    });\n    ROOTS.push(root);\n  }\n\n  function boot() {\n    const roots = Array.from(document.querySelectorAll(ROOT_SELECTOR));\n    if (!roots.length) {\n      return;\n    }\n\n    roots.forEach((root) => {\n      initRoot(root);\n      renderRoot(root, { forceRefresh: false, source: \"init\" });\n    });\n\n    attachConnectivityBindings();\n  }\n\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\n  } else {\n    boot();\n  }\n\n  window.__featuredFeedback = {\n    reloadAll(forceRefresh = true) {\n      ROOTS.forEach((root) => {\n        renderRoot(root, {\n          forceRefresh: !!forceRefresh,\n          source: \"manual\",\n        });\n      });\n    },\n    getStatus(root) {\n      const state = rootStates.get(root);\n      return state ? state.status : \"unknown\";\n    },\n  };\n})();\n"]}