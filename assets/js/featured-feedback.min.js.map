{"version":3,"file":"featured-feedback.min.js","names":["window","document","dataCache","Map","STRINGS","fa","empty","errorPrefix","sourceCta","authorFallback","roleFallback","en","buildCard","item","lang","copy","article","createElement","className","setAttribute","id","quote","textContent","appendChild","meta","identity","author","role","link","target","rel","href","source_url","source_label","date","value","parsed","Date","Number","isNaN","getTime","locale","Intl","DateTimeFormat","year","month","day","format","formatDate","dateEl","dateTime","async","renderRoot","root","dataset","featuredFeedbackLang","documentElement","toLowerCase","startsWith","resolveLang","source","featuredFeedbackSource","fallback","featuredFeedbackFallback","featuredFeedbackStatus","firstChild","removeChild","clearRoot","filtered","url","Error","has","get","promise","fetch","cache","then","res","ok","status","json","payload","Array","isArray","items","set","fetchSource","filter","slice","length","renderEmpty","forEach","dispatchEvent","CustomEvent","bubbles","fallbackUrl","wrap","renderError","boot","roots","from","querySelectorAll","readyState","addEventListener","once"],"sources":["featured-feedback.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Lightweight renderer for featured feedback cards in home testimonials.\r\n(function () {\r\n  \"use strict\";\r\n\r\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  const ROOT_SELECTOR = \"[data-featured-feedback-root]\";\r\n  const dataCache = new Map();\r\n\r\n  const STRINGS = {\r\n    fa: {\r\n      empty: \"هنوز بازخورد منتخب منتشر نشده است.\",\r\n      errorPrefix: \"نمایش بازخوردهای منتخب ممکن نبود.\",\r\n      sourceCta: \"مشاهده همه گفتگوها\",\r\n      authorFallback: \"کاربر GitHub\",\r\n      roleFallback: \"بازدیدکننده\",\r\n    },\r\n    en: {\r\n      empty: \"No featured feedback has been published yet.\",\r\n      errorPrefix: \"Featured feedback could not be loaded.\",\r\n      sourceCta: \"View all discussions\",\r\n      authorFallback: \"GitHub user\",\r\n      roleFallback: \"Visitor\",\r\n    },\r\n  };\r\n\r\n  function resolveLang(root) {\r\n    const lang = root.dataset.featuredFeedbackLang || document.documentElement.lang || \"en\";\r\n    return lang.toLowerCase().startsWith(\"fa\") ? \"fa\" : \"en\";\r\n  }\r\n\r\n  function formatDate(value, lang) {\r\n    if (!value) {return \"\";}\r\n    const parsed = new Date(value);\r\n    if (Number.isNaN(parsed.getTime())) {return \"\";}\r\n    const locale = lang === \"fa\" ? \"fa-IR\" : \"en-US\";\r\n\r\n    try {\r\n      return new Intl.DateTimeFormat(locale, {\r\n        year: \"numeric\",\r\n        month: \"short\",\r\n        day: \"numeric\",\r\n      }).format(parsed);\r\n    } catch {\r\n      return value;\r\n    }\r\n  }\r\n\r\n  async function fetchSource(url) {\r\n    if (!url) {\r\n      throw new Error(\"missing-source\");\r\n    }\r\n\r\n    if (dataCache.has(url)) {\r\n      return dataCache.get(url);\r\n    }\r\n\r\n    const promise = fetch(url, { cache: \"no-store\" })\r\n      .then((res) => {\r\n        if (!res.ok) {\r\n          throw new Error(`http-${res.status}`);\r\n        }\r\n        return res.json();\r\n      })\r\n      .then((payload) => {\r\n        if (!payload || !Array.isArray(payload.items)) {\r\n          throw new Error(\"invalid-shape\");\r\n        }\r\n        return payload.items;\r\n      });\r\n\r\n    dataCache.set(url, promise);\r\n    return promise;\r\n  }\r\n\r\n  function clearRoot(root) {\r\n    while (root.firstChild) {\r\n      root.removeChild(root.firstChild);\r\n    }\r\n  }\r\n\r\n  function buildCard(item, lang, copy) {\r\n    const article = document.createElement(\"article\");\r\n    article.className = \"featured-feedback-card\";\r\n    article.setAttribute(\"data-featured-feedback-item\", item.id || \"\");\r\n    article.setAttribute(\"data-feedback-lang\", lang);\r\n\r\n    const quote = document.createElement(\"p\");\r\n    quote.className = \"featured-feedback-quote\";\r\n    quote.textContent = item.quote || \"\";\r\n    article.appendChild(quote);\r\n\r\n    const meta = document.createElement(\"div\");\r\n    meta.className = \"featured-feedback-meta\";\r\n\r\n    const identity = document.createElement(\"div\");\r\n    const author = document.createElement(\"div\");\r\n    author.className = \"featured-feedback-author\";\r\n    author.textContent = item.author || copy.authorFallback;\r\n    const role = document.createElement(\"div\");\r\n    role.className = \"featured-feedback-role\";\r\n    role.textContent = item.role || copy.roleFallback;\r\n    identity.appendChild(author);\r\n    identity.appendChild(role);\r\n    meta.appendChild(identity);\r\n\r\n    const link = document.createElement(\"a\");\r\n    link.className = \"featured-feedback-link\";\r\n    link.target = \"_blank\";\r\n    link.rel = \"noopener noreferrer\";\r\n    link.href = item.source_url || \"#\";\r\n    link.textContent = item.source_label || copy.sourceCta;\r\n    meta.appendChild(link);\r\n\r\n    article.appendChild(meta);\r\n\r\n    const date = formatDate(item.date, lang);\r\n    if (date) {\r\n      const dateEl = document.createElement(\"time\");\r\n      dateEl.className = \"featured-feedback-date\";\r\n      dateEl.dateTime = item.date;\r\n      dateEl.textContent = date;\r\n      article.appendChild(dateEl);\r\n    }\r\n\r\n    return article;\r\n  }\r\n\r\n  function renderEmpty(root, copy) {\r\n    const empty = document.createElement(\"p\");\r\n    empty.className = \"featured-feedback-empty\";\r\n    empty.textContent = copy.empty;\r\n    root.appendChild(empty);\r\n    root.dataset.featuredFeedbackStatus = \"empty\";\r\n  }\r\n\r\n  function renderError(root, copy, fallbackUrl) {\r\n    const wrap = document.createElement(\"p\");\r\n    wrap.className = \"featured-feedback-error\";\r\n    wrap.textContent = `${copy.errorPrefix} `;\r\n\r\n    if (fallbackUrl) {\r\n      const link = document.createElement(\"a\");\r\n      link.className = \"featured-feedback-link\";\r\n      link.href = fallbackUrl;\r\n      link.target = \"_blank\";\r\n      link.rel = \"noopener noreferrer\";\r\n      link.textContent = copy.sourceCta;\r\n      wrap.appendChild(link);\r\n    }\r\n\r\n    root.appendChild(wrap);\r\n    root.dataset.featuredFeedbackStatus = \"error\";\r\n  }\r\n\r\n  async function renderRoot(root) {\r\n    if (!root) {return;}\r\n\r\n    const lang = resolveLang(root);\r\n    const copy = STRINGS[lang];\r\n    const source = root.dataset.featuredFeedbackSource || \"\";\r\n    const fallback = root.dataset.featuredFeedbackFallback || \"\";\r\n\r\n    root.dataset.featuredFeedbackStatus = \"loading\";\r\n    clearRoot(root);\r\n\r\n    try {\r\n      const items = await fetchSource(source);\r\n      const filtered = items\r\n        .filter((item) => item && item.lang === lang)\r\n        .slice(0, 3);\r\n\r\n      if (!filtered.length) {\r\n        renderEmpty(root, copy);\r\n        return;\r\n      }\r\n\r\n      filtered.forEach((item) => {\r\n        root.appendChild(buildCard(item, lang, copy));\r\n      });\r\n      root.dataset.featuredFeedbackStatus = \"ready\";\r\n      root.dispatchEvent(new CustomEvent(\"featured-feedback:ready\", { bubbles: true }));\r\n    } catch {\r\n      renderError(root, copy, fallback);\r\n      root.dispatchEvent(new CustomEvent(\"featured-feedback:error\", { bubbles: true }));\r\n    }\r\n  }\r\n\r\n  function boot() {\r\n    const roots = Array.from(document.querySelectorAll(ROOT_SELECTOR));\r\n    if (!roots.length) {return;}\r\n    roots.forEach((root) => {\r\n      renderRoot(root);\r\n    });\r\n  }\r\n\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n  } else {\r\n    boot();\r\n  }\r\n})();\r\n"]}