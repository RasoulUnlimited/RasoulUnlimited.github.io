{"version":3,"file":"featured-feedback.min.js","names":["window","document","dataCache","Map","STRINGS","fa","empty","errorPrefix","sourceCta","authorFallback","roleFallback","en","buildCard","item","lang","copy","article","createElement","className","setAttribute","id","quote","textContent","appendChild","meta","identity","author","role","link","target","rel","href","source_url","source_label","date","value","parsed","Date","Number","isNaN","getTime","locale","Intl","DateTimeFormat","year","month","day","format","formatDate","dateEl","dateTime","async","renderRoot","root","dataset","featuredFeedbackLang","documentElement","toLowerCase","startsWith","resolveLang","source","featuredFeedbackSource","fallback","featuredFeedbackFallback","featuredFeedbackStatus","firstChild","removeChild","clearRoot","filtered","url","Error","has","get","promise","fetch","cache","then","res","ok","status","json","payload","Array","isArray","items","set","fetchSource","filter","slice","length","renderEmpty","forEach","dispatchEvent","CustomEvent","bubbles","fallbackUrl","wrap","renderError","boot","roots","from","querySelectorAll","readyState","addEventListener","once"],"sources":["featured-feedback.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Lightweight renderer for featured feedback cards in home testimonials.\n(function () {\n  \"use strict\";\n\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\n    return;\n  }\n\n  const ROOT_SELECTOR = \"[data-featured-feedback-root]\";\n  const dataCache = new Map();\n\n  const STRINGS = {\n    fa: {\n      empty: \"هنوز بازخورد منتخب منتشر نشده است.\",\n      errorPrefix: \"نمایش بازخوردهای منتخب ممکن نبود.\",\n      sourceCta: \"مشاهده همه گفتگوها\",\n      authorFallback: \"کاربر GitHub\",\n      roleFallback: \"بازدیدکننده\",\n    },\n    en: {\n      empty: \"No featured feedback has been published yet.\",\n      errorPrefix: \"Featured feedback could not be loaded.\",\n      sourceCta: \"View all discussions\",\n      authorFallback: \"GitHub user\",\n      roleFallback: \"Visitor\",\n    },\n  };\n\n  function resolveLang(root) {\n    const lang = root.dataset.featuredFeedbackLang || document.documentElement.lang || \"en\";\n    return lang.toLowerCase().startsWith(\"fa\") ? \"fa\" : \"en\";\n  }\n\n  function formatDate(value, lang) {\n    if (!value) {return \"\";}\n    const parsed = new Date(value);\n    if (Number.isNaN(parsed.getTime())) {return \"\";}\n    const locale = lang === \"fa\" ? \"fa-IR\" : \"en-US\";\n\n    try {\n      return new Intl.DateTimeFormat(locale, {\n        year: \"numeric\",\n        month: \"short\",\n        day: \"numeric\",\n      }).format(parsed);\n    } catch {\n      return value;\n    }\n  }\n\n  async function fetchSource(url) {\n    if (!url) {\n      throw new Error(\"missing-source\");\n    }\n\n    if (dataCache.has(url)) {\n      return dataCache.get(url);\n    }\n\n    const promise = fetch(url, { cache: \"no-store\" })\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`http-${res.status}`);\n        }\n        return res.json();\n      })\n      .then((payload) => {\n        if (!payload || !Array.isArray(payload.items)) {\n          throw new Error(\"invalid-shape\");\n        }\n        return payload.items;\n      });\n\n    dataCache.set(url, promise);\n    return promise;\n  }\n\n  function clearRoot(root) {\n    while (root.firstChild) {\n      root.removeChild(root.firstChild);\n    }\n  }\n\n  function buildCard(item, lang, copy) {\n    const article = document.createElement(\"article\");\n    article.className = \"featured-feedback-card\";\n    article.setAttribute(\"data-featured-feedback-item\", item.id || \"\");\n    article.setAttribute(\"data-feedback-lang\", lang);\n\n    const quote = document.createElement(\"p\");\n    quote.className = \"featured-feedback-quote\";\n    quote.textContent = item.quote || \"\";\n    article.appendChild(quote);\n\n    const meta = document.createElement(\"div\");\n    meta.className = \"featured-feedback-meta\";\n\n    const identity = document.createElement(\"div\");\n    const author = document.createElement(\"div\");\n    author.className = \"featured-feedback-author\";\n    author.textContent = item.author || copy.authorFallback;\n    const role = document.createElement(\"div\");\n    role.className = \"featured-feedback-role\";\n    role.textContent = item.role || copy.roleFallback;\n    identity.appendChild(author);\n    identity.appendChild(role);\n    meta.appendChild(identity);\n\n    const link = document.createElement(\"a\");\n    link.className = \"featured-feedback-link\";\n    link.target = \"_blank\";\n    link.rel = \"noopener noreferrer\";\n    link.href = item.source_url || \"#\";\n    link.textContent = item.source_label || copy.sourceCta;\n    meta.appendChild(link);\n\n    article.appendChild(meta);\n\n    const date = formatDate(item.date, lang);\n    if (date) {\n      const dateEl = document.createElement(\"time\");\n      dateEl.className = \"featured-feedback-date\";\n      dateEl.dateTime = item.date;\n      dateEl.textContent = date;\n      article.appendChild(dateEl);\n    }\n\n    return article;\n  }\n\n  function renderEmpty(root, copy) {\n    const empty = document.createElement(\"p\");\n    empty.className = \"featured-feedback-empty\";\n    empty.textContent = copy.empty;\n    root.appendChild(empty);\n    root.dataset.featuredFeedbackStatus = \"empty\";\n  }\n\n  function renderError(root, copy, fallbackUrl) {\n    const wrap = document.createElement(\"p\");\n    wrap.className = \"featured-feedback-error\";\n    wrap.textContent = `${copy.errorPrefix} `;\n\n    if (fallbackUrl) {\n      const link = document.createElement(\"a\");\n      link.className = \"featured-feedback-link\";\n      link.href = fallbackUrl;\n      link.target = \"_blank\";\n      link.rel = \"noopener noreferrer\";\n      link.textContent = copy.sourceCta;\n      wrap.appendChild(link);\n    }\n\n    root.appendChild(wrap);\n    root.dataset.featuredFeedbackStatus = \"error\";\n  }\n\n  async function renderRoot(root) {\n    if (!root) {return;}\n\n    const lang = resolveLang(root);\n    const copy = STRINGS[lang];\n    const source = root.dataset.featuredFeedbackSource || \"\";\n    const fallback = root.dataset.featuredFeedbackFallback || \"\";\n\n    root.dataset.featuredFeedbackStatus = \"loading\";\n    clearRoot(root);\n\n    try {\n      const items = await fetchSource(source);\n      const filtered = items\n        .filter((item) => item && item.lang === lang)\n        .slice(0, 3);\n\n      if (!filtered.length) {\n        renderEmpty(root, copy);\n        return;\n      }\n\n      filtered.forEach((item) => {\n        root.appendChild(buildCard(item, lang, copy));\n      });\n      root.dataset.featuredFeedbackStatus = \"ready\";\n      root.dispatchEvent(new CustomEvent(\"featured-feedback:ready\", { bubbles: true }));\n    } catch {\n      renderError(root, copy, fallback);\n      root.dispatchEvent(new CustomEvent(\"featured-feedback:error\", { bubbles: true }));\n    }\n  }\n\n  function boot() {\n    const roots = Array.from(document.querySelectorAll(ROOT_SELECTOR));\n    if (!roots.length) {return;}\n    roots.forEach((root) => {\n      renderRoot(root);\n    });\n  }\n\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\n  } else {\n    boot();\n  }\n})();\n"]}