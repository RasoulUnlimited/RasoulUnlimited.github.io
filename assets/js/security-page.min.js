document.addEventListener("DOMContentLoaded",function(){let m=document.documentElement.lang||"en",f={success:m.startsWith("fa")?"کپی شد! ✅":"Copied! ✅",fail:m.startsWith("fa")?"عملیات کپی ناموفق بود.":"Failed to copy.",unsupported:m.startsWith("fa")?"مرورگر از کپی پشتیبانی نمی‌کند.":"Your browser does not support copying.",offline:m.startsWith("fa")?"شما آفلاین هستید.":"You are offline.",online:m.startsWith("fa")?"اتصال برقرار شد.":"Back online.",refreshed:m.startsWith("fa")?"بروزرسانی شد! ✅":"Updated! ✅",fetchFail:m.startsWith("fa")?"خطا در بارگیری داده.":"Failed to load data.",rateLimit:m.startsWith("fa")?"محدودیت نرخ GitHub فعال شده است.":"GitHub rate limit exceeded."},h=864e5;function p(e){if(e&&window.Intl&&Intl.RelativeTimeFormat){var t,a,i=Date.now()-e.getTime();for([t,a]of[["year",31536e6],["month",2592e6],["week",6048e5],["day",864e5],["hour",36e5],["minute",6e4],["second",1e3]])if(Math.abs(i)>=a||"second"===t)return new Intl.RelativeTimeFormat(m.startsWith("fa")?"fa":"en",{numeric:"auto"}).format(-Math.round(i/a),t)}return""}var e=window.matchMedia("(prefers-reduced-motion: reduce)");function t(){document.querySelectorAll("[data-aos]").forEach(e=>{e.removeAttribute("data-aos")}),document.querySelectorAll(".skeleton").forEach(e=>{e.classList.remove("skeleton")})}e.matches&&t(),e.addEventListener("change",e=>{e.matches&&t()});e=window.matchMedia("(max-width: 600px)");function s(e){if(!e)return"";return e.replace(/[۰-۹]/g,e=>"۰۱۲۳۴۵۶۷۸۹".indexOf(e)).replace(/[\u064B-\u065F\u0670]/g,"").toLowerCase()}e.matches&&t(),e.addEventListener("change",e=>{e.matches&&t()});let y=(()=>{var t="__test";try{return localStorage.setItem(t,t),localStorage.removeItem(t),localStorage}catch(e){try{return sessionStorage.setItem(t,t),sessionStorage.removeItem(t),sessionStorage}catch(e){return null}}})(),o="timeline-search-term",v,g;async function E(e,t,a,i,n=5e3){let r=null;if(y)try{r=JSON.parse(y.getItem(t)||"null")}catch(e){}if(r&&(Date.now()-r.t<a||!navigator.onLine))return r.d;if(!navigator.onLine)throw new Error("offline");let s=new AbortController;a=setTimeout(()=>s.abort(),n),n=await fetch(e,{signal:s.signal,cache:"no-store"});if(clearTimeout(a),!n.ok){if(403===n.status&&"0"===n.headers.get("X-RateLimit-Remaining"))throw new Error("rate-limit");if(r)return r.d;throw new Error(n.statusText||"fetch error")}e=await i(n);if(y)try{y.setItem(t,JSON.stringify({t:Date.now(),d:e}))}catch(e){}return e}function b(e){if(e)if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(()=>{"function"==typeof createToast&&createToast(f.success)}).catch(e=>{console.error("Copy failed:",e),"function"==typeof createToast&&createToast(f.fail)});else{var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select();try{var a=document.execCommand("copy");"function"==typeof createToast&&createToast(a?f.success:f.fail)}catch(e){console.error("execCommand copy failed:",e),"function"==typeof createToast&&createToast(f.fail)}document.body.removeChild(t)}}function a(e){var e=e.currentTarget;let t=e.dataset.copyText||"";b(t=!t&&(e=e.dataset.copyTarget,e=document.getElementById(e))?e.textContent.trim():t)}document.querySelectorAll(".copy-button").forEach(e=>{e.addEventListener("click",a)}),document.querySelectorAll(".copyable").forEach(e=>{let t=()=>b(e.dataset.copyText||e.textContent.trim());e.addEventListener("click",t),e.addEventListener("keypress",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())})});let i=document.getElementById("connection-status");function n(){if(i){let t=navigator.onLine;i.textContent=t?m.startsWith("fa")?"اتصال اینترنت برقرار است.":"You are online.":m.startsWith("fa")?"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.":"You are offline. Some features may be unavailable.",document.body.classList.toggle("offline",!t),[v,g].forEach(e=>{e&&(e.disabled=!t)})}}window.addEventListener("online",()=>{n(),"function"==typeof createToast&&createToast(f.online)}),window.addEventListener("offline",()=>{n(),"function"==typeof createToast&&createToast(f.offline)}),n();let r=[{date:"2025-05-16",icon:"fa-rocket",title_fa:"شروع وب‌سایت",title_en:"Website launched",desc_fa:"انتشار اولیه سایت با نگاه به امنیت و عملکرد.",desc_en:"Initial release with a focus on performance and safety."},{date:"2025-05-25",icon:"fa-cloud",title_fa:"ادغام با Cloudflare",title_en:"Integrated with Cloudflare",desc_fa:"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.",desc_en:"Enhanced speed and security via Cloudflare CDN."},{date:"2025-06-01",icon:"fa-shield-alt",title_fa:"اعمال CSP سخت‌گیرانه",title_en:"Strict CSP enforced",desc_fa:"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.",desc_en:"Implemented tighter policies to prevent web attacks."},{date:"2025-07-10",icon:"fa-key",title_fa:"انتشار کلید عمومی PGP",title_en:"PGP key published",desc_fa:"امکان ارتباط رمزنگاری‌شده فراهم شد.",desc_en:"Secure encrypted communication enabled."},{date:"2025-07-20",icon:"fa-bell",title_fa:"راه‌اندازی اعلان‌های امنیتی",title_en:"Security advisories live",desc_fa:"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.",desc_en:"Security updates now published via GitHub advisories."},{date:"2025-10-01",icon:"fa-wifi",title_fa:"افزودن پشتیبانی آفلاین",title_en:"Offline support added",desc_fa:"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.",desc_en:"Improved user experience with local caching and connection status alerts."}];function L(e){l.innerHTML="",e.slice().sort((e,t)=>I?new Date(e.date)-new Date(t.date):new Date(t.date)-new Date(e.date)).forEach(e=>{var t=document.createElement("li"),a=(t.dataset.aos="fade-up",t.tabIndex=0,t.setAttribute("role","listitem"),document.createElement("div")),i=(a.className="timeline-content",document.createElement("div")),i=(i.className="timeline-icon",i.innerHTML=`<i class="fas ${e.icon}" aria-hidden="true"></i>`,a.appendChild(i),document.createElement("h3")),n=(i.className="date",i.innerHTML=`<time datetime="${e.date}">${e.date}</time>`,p(new Date(e.date))),n=(n&&((r=document.createElement("span")).className="relative-time",r.textContent=n,i.appendChild(document.createTextNode(" ")),i.appendChild(r)),a.appendChild(i),document.createElement("h3")),r=(n.textContent=m.startsWith("fa")?e.title_fa:e.title_en,a.appendChild(n),document.createElement("p"));r.textContent=m.startsWith("fa")?e.desc_fa:e.desc_en,a.appendChild(r),t.appendChild(a),l.appendChild(t)})}let l=document.getElementById("security-timeline-list"),w=document.getElementById("timeline-search"),c=document.getElementById("clear-timeline-search"),x=(v=document.getElementById("refresh-timeline"),document.getElementById("sort-timeline")),d=document.getElementById("timeline-no-results"),u=document.getElementById("timeline-results-count"),C=[],T=!1,I=!!y&&"asc"===y.getItem("timeline-sort");function _(){x&&(x.textContent=m.startsWith("fa")?I?"قدیمی‌ترین":"جدیدترین":I?"Oldest first":"Newest first")}function k(t=!1,e=null){if(l){l.innerHTML="",e&&(e.classList.add("loading"),e.setAttribute("aria-busy","true"));var a="security-timeline";if(t&&y)try{y.removeItem(a)}catch(e){}E("/assets/data/security-timeline.json",a,h,e=>e.json()).then(e=>{L(C=e),l.setAttribute("aria-busy","false"),A(),S(),t&&"function"==typeof createToast&&createToast(f.refreshed)}).catch(t=>{if("function"==typeof createToast){let e=f.fetchFail;t&&"offline"===t.message?e=f.offline:t&&"rate-limit"===t.message&&(e=f.rateLimit),createToast(e)}L(C=r),l.setAttribute("aria-busy","false"),A(),S()}).finally(()=>{e&&(e.classList.remove("loading"),e.removeAttribute("aria-busy"))})}}function S(){if(w&&!T){let t;w.addEventListener("input",()=>{let e=w.value;clearTimeout(t),t=setTimeout(()=>a(e),200)}),w.addEventListener("keydown",e=>{"Escape"===e.key&&(w.value="",c&&c.classList.add("visually-hidden"),a(""))}),c&&c.addEventListener("click",()=>{w.value="",c.classList.add("visually-hidden"),a("")});var e=y&&y.getItem(o)||"";function a(e){let i=s(e.trim());if(y)try{y.setItem(o,e)}catch(e){}let n=new RegExp(`(${i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"),r=0;l.querySelectorAll("li").forEach(e=>{var t,a=e.querySelector(".timeline-content");a&&(e.dataset.orig||(e.dataset.orig=a.innerHTML),t=s(e.textContent),t=i&&t.includes(i),e.style.display=t||!i?"":"none",t?(r++,a.innerHTML=e.dataset.orig.replace(n,'<span class="search-highlight">$1</span>')):a.innerHTML=e.dataset.orig)}),c&&c.classList.toggle("visually-hidden",!i),d&&(d.classList.toggle("hidden",0!==r),d.classList.toggle("visible",0===r)),u&&(i?(u.textContent=m.startsWith("fa")?r+" مورد یافت شد":`${r} result${1===r?"":"s"} found`,u.classList.remove("hidden"),u.classList.add("visible")):(u.classList.add("hidden"),u.classList.remove("visible")))}e&&(w.value=e),a(e),T=!0}}function A(){var e=document.querySelectorAll(".timeline li");if("IntersectionObserver"in window){let t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("timeline-item-visible"),t.unobserve(e.target))})},{threshold:.3});e.forEach(e=>t.observe(e))}else e.forEach(e=>e.classList.add("timeline-item-visible"));let i=document.getElementById("policy-expiration"),n=document.getElementById("policy-expiration-progress"),r=document.getElementById("expiration-days"),s=null;function a(){if(s){var t,a=new Date,a=(s-a)/h;let e="";n&&(t=Math.min(100,Math.max(0,(365-a)/365*100)),n.value=t,n.removeAttribute("aria-hidden"),n.setAttribute("aria-valuenow",t.toFixed(0)),e=m.startsWith("fa")?Math.ceil(a)+" روز باقیمانده":Math.ceil(a)+" days remaining",n.setAttribute("aria-valuetext",e)),r&&(r.textContent=e,r.classList.remove("hidden"),r.setAttribute("aria-hidden","false")),i.classList.remove("expired","expiring"),n&&n.classList.remove("expired","expiring"),a<=0?(i.classList.add("expired"),n&&n.classList.add("expired")):a<=30&&(i.classList.add("expiring"),n)&&n.classList.add("expiring")}}i&&E("/.well-known/security.txt","security-txt",h,e=>e.text()).then(e=>{var t,e=e.match(/^Expires:\s*(.+)$/m);e?(s=new Date(e[1].trim()),e=m.startsWith("fa")?"fa-IR":"en-US",t={year:"numeric",month:"long",day:"numeric"},e=m.startsWith("fa")?"اعتبار سیاست تا "+s.toLocaleDateString(e,t):"Policy valid until "+s.toLocaleDateString(e,t),i.textContent=e,a(),setInterval(a,36e5)):i.textContent=m.startsWith("fa")?"تاریخ اعتبار در دسترس نیست.":"Expiration date unavailable."}).catch(()=>{i.textContent=m.startsWith("fa")?"خطا در دریافت تاریخ اعتبار.":"Failed to load expiration date.",r&&(r.classList.add("hidden"),r.setAttribute("aria-hidden","true"))});var e=document.getElementById("scope-domain");e&&(e.innerHTML=`<code>${location.hostname}</code>`);let o=document.getElementById("last-updated-date"),l=(o&&E("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1","security-last",h,e=>e.json()).then(e=>{var t;Array.isArray(e)&&0<e.length&&(e=new Date(e[0].commit.committer.date),t=m.startsWith("fa")?"fa-IR":"en-US",t=e.toLocaleDateString(t,{year:"numeric",month:"long",day:"numeric"}),e=p(e),o.textContent=e?t+` (${e})`:t)}).catch(t=>{if("function"==typeof createToast){let e=f.fetchFail;t&&"offline"===t.message?e=f.offline:t&&"rate-limit"===t.message&&(e=f.rateLimit),createToast(e)}}),document.getElementById("advisories-list"));function c(e=!1,t=null){if(l){l.innerHTML="",t&&(t.classList.add("loading"),t.setAttribute("aria-busy","true"));var a="security-advisories";if(e&&y)try{y.removeItem(a)}catch(e){}E("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/security-advisories?per_page=3",a,h,e=>e.json()).then(e=>{Array.isArray(e)&&0<e.length?e.forEach(e=>{var t=document.createElement("li"),a=document.createElement("a"),a=(a.href=e.html_url,a.target="_blank",a.rel="noopener",a.textContent=e.summary||e.ghsa_id||e.id,t.appendChild(a),e.published_at||e.created_at);a&&((e=document.createElement("span")).className="adv-time",e.textContent=p(new Date(a)),t.appendChild(document.createTextNode(" ")),t.appendChild(e)),l.appendChild(t)}):l.textContent=m.startsWith("fa")?"موردی یافت نشد.":"No advisories found."}).catch(t=>{if(l.textContent=m.startsWith("fa")?"خطا در دریافت اعلان‌ها.":"Failed to load advisories.","function"==typeof createToast){let e=f.fetchFail;t&&"offline"===t.message?e=f.offline:t&&"rate-limit"===t.message&&(e=f.rateLimit),createToast(e)}}).finally(()=>{t&&(t.classList.remove("loading"),t.removeAttribute("aria-busy"))})}}(g=document.getElementById("refresh-advisories"))&&g.addEventListener("click",()=>c(!0,g)),v&&v.addEventListener("click",()=>k(!0,v)),x&&(x.addEventListener("click",()=>{if(I=!I,y)try{y.setItem("timeline-sort",I?"asc":"desc")}catch(e){}_(),L(C),A(),w&&w.value&&w.dispatchEvent(new Event("input"))}),_()),l&&(e=()=>c(),"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(e,1e3)),w&&(document.addEventListener("keydown",e=>{var t=document.activeElement.tagName.toLowerCase();"/"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),w.focus())}),document.addEventListener("keydown",e=>{var t=document.activeElement.tagName.toLowerCase();"r"!==e.key&&"R"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),k(!0),c(!0))})),document.querySelectorAll("#share-page, #share-page-button").forEach(e=>{e.addEventListener("click",()=>{navigator.share?navigator.share({title:document.title,url:location.href}).catch(()=>b(location.href)):b(location.href)})});let t=document.getElementById("scroll-to-top"),d=document.getElementById("share-page-button");function u(){var e=200<window.scrollY;t&&t.classList.toggle("visible",e),d&&d.classList.toggle("visible",e)}window.addEventListener("scroll",u),u(),t&&t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}_(),(l?k:A)()});