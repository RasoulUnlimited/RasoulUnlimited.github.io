document.addEventListener("DOMContentLoaded",function(){let s=document.documentElement.lang||"en",e={success:s.startsWith("fa")?"کپی شد! ✅":"Copied! ✅",fail:s.startsWith("fa")?"عملیات کپی ناموفق بود.":"Failed to copy.",unsupported:s.startsWith("fa")?"مرورگر از کپی پشتیبانی نمی‌کند.":"Your browser does not support copying."},a=864e5;function c(t,e,a,n){try{var i=JSON.parse(localStorage.getItem(e)||"null");if(i&&Date.now()-i.t<a)return Promise.resolve(i.d)}catch(t){}return fetch(t).then(t=>n(t)).then(t=>{try{localStorage.setItem(e,JSON.stringify({t:Date.now(),d:t}))}catch(t){}return t})}function n(t){t&&(navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>{"function"==typeof createToast&&createToast(e.success)}).catch(t=>{console.error("Copy failed:",t),"function"==typeof createToast&&createToast(e.fail)}):"function"==typeof createToast&&createToast(e.unsupported))}function i(t){var t=t.currentTarget;let e=t.dataset.copyText||"";n(e=!e&&(t=t.dataset.copyTarget,t=document.getElementById(t))?t.textContent.trim():e)}document.querySelectorAll(".copy-button").forEach(t=>{t.addEventListener("click",i)}),document.querySelectorAll(".copyable").forEach(t=>{let e=()=>n(t.dataset.copyText||t.textContent.trim());t.addEventListener("click",e),t.addEventListener("keypress",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e())})});let o=document.getElementById("security-timeline-list");function r(){var t=document.querySelectorAll(".timeline li");if("IntersectionObserver"in window){let e=new IntersectionObserver((t,e)=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("timeline-item-visible"),e.unobserve(t.target))})},{threshold:.3});t.forEach(t=>e.observe(t))}else t.forEach(t=>t.classList.add("timeline-item-visible"));let n=document.getElementById("policy-expiration"),i=document.getElementById("policy-expiration-progress");n&&c("/.well-known/security.txt","security-txt",a,t=>t.text()).then(t=>{var e,a,t=t.match(/^Expires:\s*(.+)$/m);t?(t=new Date(t[1].trim()),a=s.startsWith("fa")?"fa-IR":"en-US",e={year:"numeric",month:"long",day:"numeric"},a=s.startsWith("fa")?"اعتبار سیاست تا "+t.toLocaleDateString(a,e):"Policy valid until "+t.toLocaleDateString(a,e),n.textContent=a,e=(t-new Date)/864e5,i&&(a=Math.min(100,Math.max(0,(365-e)/365*100)),i.value=a,i.setAttribute("aria-valuenow",a.toFixed(0))),e<=0?(n.classList.add("expired"),i&&i.classList.add("expired")):e<=30&&(n.classList.add("expiring"),i)&&i.classList.add("expiring")):n.textContent=s.startsWith("fa")?"تاریخ اعتبار در دسترس نیست.":"Expiration date unavailable."}).catch(()=>{n.textContent=s.startsWith("fa")?"خطا در دریافت تاریخ اعتبار.":"Failed to load expiration date."});t=document.getElementById("scope-domain");t&&(t.innerHTML=`<code>${location.hostname}</code>`);let o=document.getElementById("last-updated-date"),r=(o&&c("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1","security-last",a,t=>t.json()).then(t=>{var e,a;Array.isArray(t)&&0<t.length&&(t=new Date(t[0].commit.committer.date),e=s.startsWith("fa")?"fa-IR":"en-US",a={year:"numeric",month:"long",day:"numeric"},o.textContent=t.toLocaleDateString(e,a))}).catch(()=>{}),document.getElementById("advisories-list"));r&&c("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/security-advisories?per_page=3","security-advisories",a,t=>t.json()).then(t=>{Array.isArray(t)&&0<t.length?t.forEach(t=>{var e=document.createElement("li"),a=document.createElement("a");a.href=t.html_url,a.target="_blank",a.rel="noopener",a.textContent=t.summary||t.ghsa_id||t.id,e.appendChild(a),r.appendChild(e)}):r.textContent=s.startsWith("fa")?"موردی یافت نشد.":"No advisories found."}).catch(()=>{r.textContent=s.startsWith("fa")?"خطا در دریافت اعلان‌ها.":"Failed to load advisories."})}o?c("/assets/data/security-timeline.json","security-timeline",a,t=>t.json()).then(t=>{t.forEach(t=>{var e=document.createElement("li"),a=(e.dataset.aos="fade-up",document.createElement("div")),n=(a.className="timeline-content",document.createElement("div")),n=(n.className="timeline-icon",n.innerHTML=`<i class="fas ${t.icon}" aria-hidden="true"></i>`,a.appendChild(n),document.createElement("h3")),n=(n.className="date",n.innerHTML=`<time datetime="${t.date}">${t.date}</time>`,a.appendChild(n),document.createElement("h3")),n=(n.textContent=s.startsWith("fa")?t.title_fa:t.title_en,a.appendChild(n),document.createElement("p"));n.textContent=s.startsWith("fa")?t.desc_fa:t.desc_en,a.appendChild(n),e.appendChild(a),o.appendChild(e)}),r()}).catch(()=>r()):r()});