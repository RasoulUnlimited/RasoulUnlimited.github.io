!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){const e=document.documentElement.lang||"en",t={success:e.startsWith("fa")?"کپی شد! ✅":"Copied! ✅",fail:e.startsWith("fa")?"عملیات کپی ناموفق بود.":"Failed to copy.",unsupported:e.startsWith("fa")?"مرورگر از کپی پشتیبانی نمی‌کند.":"Your browser does not support copying.",offline:e.startsWith("fa")?"شما آفلاین هستید.":"You are offline.",online:e.startsWith("fa")?"اتصال برقرار شد.":"Back online.",refreshed:e.startsWith("fa")?"بروزرسانی شد! ✅":"Updated! ✅",fetchFail:e.startsWith("fa")?"خطا در بارگیری داده.":"Failed to load data.",rateLimit:e.startsWith("fa")?"محدودیت نرخ GitHub فعال شده است.":"GitHub rate limit exceeded."},a=864e5;function n(t){if(!t||!window.Intl||!Intl.RelativeTimeFormat)return"";const a=Date.now()-t.getTime(),n=[["year",31536e6],["month",2592e6],["week",6048e5],["day",864e5],["hour",36e5],["minute",6e4],["second",1e3]];for(const[t,i]of n)if(Math.abs(a)>=i||"second"===t){return new Intl.RelativeTimeFormat(e.startsWith("fa")?"fa":"en",{numeric:"auto"}).format(-Math.round(a/i),t)}return""}const i=window.matchMedia("(prefers-reduced-motion: reduce)");function s(){document.querySelectorAll("[data-aos]").forEach(e=>{e.removeAttribute("data-aos")}),document.querySelectorAll(".skeleton").forEach(e=>{e.classList.remove("skeleton")})}i.matches&&s(),i.addEventListener("change",e=>{e.matches&&s()});const o=window.matchMedia("(max-width: 600px)");function r(e){if(!e)return"";const t="۰۱۲۳۴۵۶۷۸۹";return e.normalize("NFKD").replace(/[۰-۹]/g,e=>t.indexOf(e)).replace(/[\u064B-\u065F\u0670]/g,"").toLowerCase()}function c(){const e="__test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),localStorage}catch(t){try{return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),sessionStorage}catch(e){return null}}}o.matches&&s(),o.addEventListener("change",e=>{e.matches&&s()});const l=c(),d="timeline-search-term",u="timeline-year";let m,f;async function h(e,t,a,n,i=5e3){let s=null;if(l)try{s=JSON.parse(l.getItem(t)||"null")}catch(e){}if(s&&(Date.now()-s.t<a||!navigator.onLine))return s.d;if(!navigator.onLine)throw new Error("offline");const o=new AbortController,r=setTimeout(()=>o.abort(),i),c=await fetch(e,{signal:o.signal,cache:"no-store"});if(clearTimeout(r),!c.ok){if(403===c.status&&"0"===c.headers.get("X-RateLimit-Remaining"))throw new Error("rate-limit");if(s)return s.d;throw new Error(c.statusText||"fetch error")}const d=await n(c);if(l)try{l.setItem(t,JSON.stringify({t:Date.now(),d}))}catch(e){}return d}function p(e){if(e)if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(()=>{"function"==typeof createToast&&createToast(t.success)}).catch(e=>{console.error("Copy failed:",e),"function"==typeof createToast&&createToast(t.fail)});else{const a=document.createElement("textarea");a.value=e,a.setAttribute("readonly",""),a.style.position="absolute",a.style.left="-9999px",document.body.appendChild(a),a.select();try{const e=document.execCommand("copy");"function"==typeof createToast&&createToast(e?t.success:t.fail)}catch(e){console.error("execCommand copy failed:",e),"function"==typeof createToast&&createToast(t.fail)}document.body.removeChild(a)}}function y(e){const t=e.currentTarget;let a=t.dataset.copyText||"";if(!a){const e=t.dataset.copyTarget,n=document.getElementById(e);n&&(a=n.textContent.trim())}p(a)}document.querySelectorAll(".copy-button").forEach(e=>{e.addEventListener("click",y)}),document.querySelectorAll(".copyable").forEach(e=>{const t=()=>p(e.dataset.copyText||e.textContent.trim());e.addEventListener("click",t),e.addEventListener("keypress",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())})});const g=document.getElementById("connection-status");function v(){if(!g)return;const t=navigator.onLine;g.textContent=t?e.startsWith("fa")?"اتصال اینترنت برقرار است.":"You are online.":e.startsWith("fa")?"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.":"You are offline. Some features may be unavailable.",document.body.classList.toggle("offline",!t),[m,f].forEach(e=>{e&&(e.disabled=!t)})}window.addEventListener("online",()=>{v(),"function"==typeof createToast&&createToast(t.online),D(!0),loadAdvisories(!0),loadPolicyExpiration(!0),loadLastUpdated(!0)}),window.addEventListener("offline",()=>{v(),"function"==typeof createToast&&createToast(t.offline)}),v();const E=[{date:"2025-05-16",icon:"fa-rocket",title_fa:"شروع وب‌سایت",title_en:"Website launched",desc_fa:"انتشار اولیه سایت با نگاه به امنیت و عملکرد.",desc_en:"Initial release with a focus on performance and safety."},{date:"2025-05-25",icon:"fa-cloud",title_fa:"ادغام با Cloudflare",title_en:"Integrated with Cloudflare",desc_fa:"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.",desc_en:"Enhanced speed and security via Cloudflare CDN."},{date:"2025-06-01",icon:"fa-shield-alt",title_fa:"اعمال CSP سخت‌گیرانه",title_en:"Strict CSP enforced",desc_fa:"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.",desc_en:"Implemented tighter policies to prevent web attacks."},{date:"2025-07-10",icon:"fa-key",title_fa:"انتشار کلید عمومی PGP",title_en:"PGP key published",desc_fa:"امکان ارتباط رمزنگاری‌شده فراهم شد.",desc_en:"Secure encrypted communication enabled."},{date:"2025-07-20",icon:"fa-bell",title_fa:"راه‌اندازی اعلان‌های امنیتی",title_en:"Security advisories live",desc_fa:"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.",desc_en:"Security updates now published via GitHub advisories."},{date:"2025-10-01",icon:"fa-wifi",title_fa:"افزودن پشتیبانی آفلاین",title_en:"Offline support added",desc_fa:"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.",desc_en:"Improved user experience with local caching and connection status alerts."}];function L(t){w.innerHTML="",t.slice().sort((e,t)=>S?new Date(e.date)-new Date(t.date):new Date(t.date)-new Date(e.date)).forEach(t=>{const a=document.createElement("li");a.dataset.aos="fade-up",a.dataset.date=t.date,a.tabIndex=0,a.setAttribute("role","listitem");const i=document.createElement("div");i.className="timeline-content";const s=document.createElement("div");s.className="timeline-icon",s.innerHTML=`<i class="fas ${t.icon}" aria-hidden="true"></i>`,i.appendChild(s);const o=document.createElement("h3");o.className="date",o.innerHTML=`<time datetime="${t.date}">${t.date}</time>`;const r=n(new Date(t.date));if(r){const e=document.createElement("span");e.className="relative-time",e.textContent=r,o.appendChild(document.createTextNode(" ")),o.appendChild(e)}i.appendChild(o);const c=document.createElement("h3");c.textContent=e.startsWith("fa")?t.title_fa:t.title_en,i.appendChild(c);const l=document.createElement("p");l.textContent=e.startsWith("fa")?t.desc_fa:t.desc_en,i.appendChild(l),a.appendChild(i),w.appendChild(a)})}const w=document.getElementById("security-timeline-list"),b=document.getElementById("timeline-search"),x=document.getElementById("timeline-year"),I=document.getElementById("clear-timeline-search");m=document.getElementById("refresh-timeline");const C=document.getElementById("sort-timeline"),T=document.getElementById("timeline-no-results"),_=document.getElementById("timeline-results-count");let k=[],A=!1,S=!!l&&"asc"===l.getItem("timeline-sort");function W(){C&&(C.textContent=e.startsWith("fa")?S?"قدیمی‌ترین":"جدیدترین":S?"Oldest first":"Newest first")}function D(n=!1,i=null){if(!w)return;w.innerHTML="",i&&(i.classList.add("loading"),i.setAttribute("aria-busy","true"));const s="security-timeline";if(n&&l)try{l.removeItem(s)}catch(e){}h("/assets/data/security-timeline.json",s,a,e=>e.json()).then(a=>{if(k=a,x){const t=Array.from(new Set(a.map(e=>new Date(e.date).getFullYear()))).sort((e,t)=>t-e);x.innerHTML='<option value="">'+(e.startsWith("fa")?"همه سال‌ها":"All years")+"</option>"+t.map(e=>`<option value="${e}">${e}</option>`).join("");const n=l&&l.getItem(u)||"";x.value=n}L(a),w.setAttribute("aria-busy","false"),$(),B(),n&&"function"==typeof createToast&&createToast(t.refreshed)}).catch(e=>{if("function"==typeof createToast){let a=t.fetchFail;e&&"offline"===e.message?a=t.offline:e&&"rate-limit"===e.message&&(a=t.rateLimit),createToast(a)}k=E,L(k),w.setAttribute("aria-busy","false"),$(),B()}).finally(()=>{i&&(i.classList.remove("loading"),i.removeAttribute("aria-busy"))})}function B(){if(!b||A)return;function t(t){const a=r(t.trim());if(l)try{l.setItem(d,t)}catch(e){}const n=x?x.value:"";if(l&&x)try{l.setItem(u,n)}catch(e){}const i=new RegExp(`(${a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");let s=0;w.querySelectorAll("li").forEach(e=>{const t=e.querySelector(".timeline-content");if(!t)return;e.dataset.orig||(e.dataset.orig=t.innerHTML);const o=r(e.textContent),c=a&&o.includes(a),l=!n||(e.dataset.date||"").startsWith(n);e.style.display=!c&&a||!l?"none":"",c&&l?(s++,t.innerHTML=e.dataset.orig.replace(i,'<span class="search-highlight">$1</span>')):t.innerHTML=e.dataset.orig}),I&&I.classList.toggle("visually-hidden",!a),T&&(T.classList.toggle("hidden",0!==s),T.classList.toggle("visible",0===s)),_&&(a?(_.textContent=e.startsWith("fa")?`${s} مورد یافت شد`:`${s} result${1===s?"":"s"} found`,_.classList.remove("hidden"),_.classList.add("visible")):(_.classList.add("hidden"),_.classList.remove("visible")))}let a;b.addEventListener("input",()=>{const e=b.value;clearTimeout(a),a=setTimeout(()=>t(e),200)}),b.addEventListener("keydown",e=>{"Escape"===e.key&&(b.value="",I&&I.classList.add("visually-hidden"),t(""))}),I&&I.addEventListener("click",()=>{b.value="",I.classList.add("visually-hidden"),t("")});const n=l&&l.getItem(d)||"";if(n&&(b.value=n),x){const e=l&&l.getItem(u)||"";e&&(x.value=e),x.addEventListener("change",()=>t(b.value))}t(n),A=!0}function $(){const i=document.querySelectorAll(".timeline li");if("IntersectionObserver"in window){const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("timeline-item-visible"),t.unobserve(e.target))})},{threshold:.3});i.forEach(t=>e.observe(t))}else i.forEach(e=>e.classList.add("timeline-item-visible"));const s=document.getElementById("policy-expiration"),o=document.getElementById("policy-expiration-progress"),r=document.getElementById("expiration-days");let c=null,d=null;function u(){if(!c)return;const t=new Date,n=(c-t)/a;let i="";if(o){const t=365,a=Math.min(100,Math.max(0,(t-n)/t*100));o.value=a,o.removeAttribute("aria-hidden"),o.setAttribute("aria-valuenow",a.toFixed(0)),i=e.startsWith("fa")?`${Math.ceil(n)} روز باقیمانده`:`${Math.ceil(n)} days remaining`,o.setAttribute("aria-valuetext",i)}r&&(r.textContent=i,r.classList.remove("hidden"),r.setAttribute("aria-hidden","false")),s.classList.remove("expired","expiring","warning"),o&&o.classList.remove("expired","expiring","warning"),n<=0?(s.classList.add("expired"),o&&o.classList.add("expired")):n<=30?(s.classList.add("expiring"),o&&o.classList.add("expiring")):n<=90&&(s.classList.add("warning"),o&&o.classList.add("warning"))}function y(t=!1){if(s){if(t&&l)try{l.removeItem("security-txt")}catch(e){}h("/.well-known/security.txt","security-txt",a,e=>e.text()).then(t=>{const a=t.match(/^Expires:\s*(.+)$/m);if(a){c=new Date(a[1].trim());const t=e.startsWith("fa")?"fa-IR":"en-US",n={year:"numeric",month:"long",day:"numeric"},i=e.startsWith("fa")?`اعتبار سیاست تا ${c.toLocaleDateString(t,n)}`:`Policy valid until ${c.toLocaleDateString(t,n)}`;s.textContent=i,u(),d&&clearInterval(d),d=setInterval(u,36e5)}else s.textContent=e.startsWith("fa")?"تاریخ اعتبار در دسترس نیست.":"Expiration date unavailable."}).catch(()=>{s.textContent=e.startsWith("fa")?"خطا در دریافت تاریخ اعتبار.":"Failed to load expiration date.",r&&(r.classList.add("hidden"),r.setAttribute("aria-hidden","true"))})}}s&&y();const g=document.getElementById("scope-domain");g&&(g.innerHTML=`<code>${location.hostname}</code>`);const v=document.getElementById("last-updated-date");function E(i=!1){if(!v)return;if(i&&l)try{l.removeItem("security-last")}catch(e){}h("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1","security-last",a,e=>e.json()).then(t=>{if(Array.isArray(t)&&t.length>0){const a=new Date(t[0].commit.committer.date),i=e.startsWith("fa")?"fa-IR":"en-US",s={year:"numeric",month:"long",day:"numeric"},o=a.toLocaleDateString(i,s),r=n(a);v.textContent=r?`${o} (${r})`:o}}).catch(e=>{if("function"==typeof createToast){let a=t.fetchFail;e&&"offline"===e.message?a=t.offline:e&&"rate-limit"===e.message&&(a=t.rateLimit),createToast(a)}})}v&&E();const w=document.getElementById("advisories-list");function x(i=!1,s=null){if(!w)return;w.innerHTML="",s&&(s.classList.add("loading"),s.setAttribute("aria-busy","true"));const o="/assets/data/security-advisories.json",r="security-advisories";if(i&&l)try{l.removeItem(r)}catch(e){}h(o,r,a,e=>e.json()).then(t=>{Array.isArray(t)&&t.length>0?t.forEach(e=>{const t=document.createElement("li"),a=document.createElement("a");a.href=e.html_url,a.target="_blank",a.rel="noopener",a.textContent=e.summary||e.ghsa_id||e.id,t.appendChild(a);const i=e.published_at||e.created_at;if(i){const e=document.createElement("span");e.className="adv-time",e.textContent=n(new Date(i)),t.appendChild(document.createTextNode(" ")),t.appendChild(e)}w.appendChild(t)}):w.textContent=e.startsWith("fa")?"موردی یافت نشد.":"No advisories found."}).catch(a=>{if(w.textContent=e.startsWith("fa")?"خطا در دریافت اعلان‌ها.":"Failed to load advisories.","function"==typeof createToast){let e=t.fetchFail;a&&"offline"===a.message?e=t.offline:a&&"rate-limit"===a.message&&(e=t.rateLimit),createToast(e)}}).finally(()=>{s&&(s.classList.remove("loading"),s.removeAttribute("aria-busy"))})}if(f=document.getElementById("refresh-advisories"),f&&f.addEventListener("click",()=>x(!0,f)),m&&m.addEventListener("click",()=>D(!0,m)),C&&(C.addEventListener("click",()=>{if(S=!S,l)try{l.setItem("timeline-sort",S?"asc":"desc")}catch(e){}W(),L(k),$(),b&&b.dispatchEvent(new Event("input"))}),W()),w){const e=()=>x();"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(e,1e3)}b&&(document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();"/"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),b.focus())}),document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();"r"!==e.key&&"R"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),D(!0),x(!0))})),document.querySelectorAll("#share-page, #share-page-button").forEach(e=>{e.addEventListener("click",()=>{navigator.share?navigator.share({title:document.title,url:location.href}).catch(()=>p(location.href)):p(location.href)})});const I=document.getElementById("scroll-to-top"),T=document.getElementById("share-page-button");function _(){const e=window.scrollY>200;I&&I.classList.toggle("visible",e),T&&T.classList.toggle("visible",e)}window.addEventListener("scroll",_),_(),I&&I.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}W(),w?D():$()})}();