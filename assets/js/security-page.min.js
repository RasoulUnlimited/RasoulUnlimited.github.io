!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){const e=(document.documentElement.lang||"en").toLowerCase().startsWith("fa"),t={success:e?"کپی شد! ✅":"Copied! ✅",fail:e?"عملیات کپی ناموفق بود.":"Failed to copy.",unsupported:e?"مرورگر از کپی پشتیبانی نمی‌کند.":"Your browser does not support copying.",offline:e?"شما آفلاین هستید.":"You are offline.",online:e?"اتصال برقرار شد.":"Back online.",refreshed:e?"بروزرسانی شد! ✅":"Updated! ✅",fetchFail:e?"خطا در بارگیری داده.":"Failed to load data.",rateLimit:e?"محدودیت نرخ GitHub فعال شده است.":"GitHub rate limit exceeded."},n=864e5,i=new Map;function a(e,t={}){if(!e||"function"!=typeof window.createToast)return;const{id:n="",kind:a="info",duration:o=2600,cooldownMs:s=0}=t;if(n&&s>0){const e=Date.now();if(e-(i.get(n)||0)<s)return;i.set(n,e)}window.createToast(e,{id:n,kind:a,duration:o})}const o={};const s=[["year",31536e6],["month",2592e6],["week",6048e5],["day",864e5],["hour",36e5],["minute",6e4],["second",1e3]];function r(t){if(!t)return"";const n=function(e){return window.Intl&&Intl.RelativeTimeFormat?(o[e]||(o[e]=new Intl.RelativeTimeFormat(e,{numeric:"auto"})),o[e]):null}(e?"fa":"en");if(!n)return"";const i=Date.now()-t.getTime();for(const[e,t]of s)if(Math.abs(i)>=t||"second"===e)return n.format(-Math.round(i/t),e);return""}const c="function"==typeof window.matchMedia,l=c?window.matchMedia("(prefers-reduced-motion: reduce)"):null,d=c?window.matchMedia("(max-width: 600px)"):null;function u(e,t){e&&"function"==typeof t&&("function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t))}function m(){document.querySelectorAll("[data-aos]").forEach(e=>{e.removeAttribute("data-aos")}),document.querySelectorAll(".skeleton").forEach(e=>{e.classList.remove("skeleton")})}function f(e){if(!e)return"";let t=String(e);try{"function"==typeof t.normalize&&(t=t.normalize("NFKD"))}catch{}return t.replace(/[۰-۹]/g,e=>String("۰۱۲۳۴۵۶۷۸۹".indexOf(e))).replace(/[\u064B-\u065F\u0670]/g,"").toLowerCase()}l&&l.matches&&m(),u(l,e=>{e.matches&&m()}),d&&d.matches&&m(),u(d,e=>{e.matches&&m()});const h=function(){const e="__test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),localStorage}catch(t){try{return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),sessionStorage}catch{return null}}}(),y="timeline-search-term",p="timeline-year";let g,v;async function w(e,t,n,i,a=5e3){let o=null;if(h)try{o=JSON.parse(h.getItem(t)||"null")}catch{o=null}if(o&&Date.now()-o.t<n)return o.d;if(!navigator.onLine){if(o&&o.d){const e=new Error("stale-data");throw e.data=o.d,e}throw new Error("offline")}const s="undefined"!=typeof AbortController?new AbortController:null,r=s&&setTimeout(()=>{s.abort()},a);try{const n=await fetch(e,{signal:s?s.signal:void 0,cache:"no-store"});if(!n.ok){if(403===n.status&&"0"===n.headers.get("X-RateLimit-Remaining"))throw new Error("rate-limit");if(o&&o.d){const e=new Error("stale-data");throw e.data=o.d,e}throw new Error(n.statusText||"fetch error")}let a;try{a=await i(n)}catch(e){throw console.error(`Parser error for ${t}:`,e),new Error("parse-error")}if(null!==a&&h)try{h.setItem(t,JSON.stringify({t:Date.now(),d:a}))}catch(e){if("QuotaExceededError"===e.name){console.warn(`localStorage quota exceeded for ${t}, attempting cleanup...`);try{const e=["security-timeline-cache","security-advisories-cache"];for(const n of e)n!==t&&h.removeItem(n);h.setItem(t,JSON.stringify({t:Date.now(),d:a}))}catch(e){console.error(`Failed to cache ${t} even after cleanup:`,e)}}else console.warn(`Failed to cache ${t}, but returning fresh data:`,e)}return a}finally{r&&clearTimeout(r)}}function E(e){if(e)if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(()=>{a(t.success,{id:"security-copy-success-toast",kind:"success",duration:1800,cooldownMs:300})}).catch(e=>{console.error("Copy failed:",e),a(t.fail,{id:"security-copy-fail-toast",kind:"error",duration:2600,cooldownMs:300})});else{const n=document.createElement("textarea");n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n),n.select();try{const e=document.execCommand("copy");a(e?t.success:t.fail,{id:e?"security-copy-success-toast":"security-copy-fail-toast",kind:e?"success":"error",duration:e?1800:2600,cooldownMs:300})}catch(e){console.error("execCommand copy failed:",e),a(t.fail,{id:"security-copy-fail-toast",kind:"error",duration:2600,cooldownMs:300})}document.body.removeChild(n)}}function b(e){const t=e.currentTarget;let n=t.dataset.copyText||"";if(!n){const e=t.dataset.copyTarget,i=document.getElementById(e);i&&(n=(i.textContent||"").trim())}E(n)}document.querySelectorAll(".copy-button").forEach(e=>{e.addEventListener("click",b)}),document.querySelectorAll(".copyable").forEach(e=>{const t=()=>E(e.dataset.copyText||(e.textContent||"").trim());e.addEventListener("click",t),e.addEventListener("keypress",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())})});const C=document.getElementById("connection-status");function L(){if(!C)return;const t=navigator.onLine;C.textContent=t?e?"اتصال اینترنت برقرار است.":"You are online.":e?"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.":"You are offline. Some features may be unavailable.",document.body.classList.toggle("offline",!t),[g,v].forEach(e=>{e&&(e.disabled=!t)})}const x=[{date:"2025-05-16",icon:"fa-rocket",title_fa:"شروع وب‌سایت",title_en:"Website launched",desc_fa:"انتشار اولیه سایت با نگاه به امنیت و عملکرد.",desc_en:"Initial release with a focus on performance and safety."},{date:"2025-05-25",icon:"fa-cloud",title_fa:"ادغام با Cloudflare",title_en:"Integrated with Cloudflare",desc_fa:"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.",desc_en:"Enhanced speed and security via Cloudflare CDN."},{date:"2025-06-01",icon:"fa-shield-alt",title_fa:"اعمال CSP سخت‌گیرانه",title_en:"Strict CSP enforced",desc_fa:"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.",desc_en:"Implemented tighter policies to prevent web attacks."},{date:"2025-07-10",icon:"fa-key",title_fa:"انتشار کلید عمومی PGP",title_en:"PGP key published",desc_fa:"امکان ارتباط رمزنگاری‌شده فراهم شد.",desc_en:"Secure encrypted communication enabled."},{date:"2025-07-20",icon:"fa-bell",title_fa:"راه‌اندازی اعلان‌های امنیتی",title_en:"Security advisories live",desc_fa:"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.",desc_en:"Security updates now published via GitHub advisories."},{date:"2025-10-01",icon:"fa-wifi",title_fa:"افزودن پشتیبانی آفلاین",title_en:"Offline support added",desc_fa:"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.",desc_en:"Improved user experience with local caching and connection status alerts."}],I=document.getElementById("security-timeline-list"),k=document.getElementById("timeline-search"),_=document.getElementById("timeline-year"),A=document.getElementById("clear-timeline-search");g=document.getElementById("refresh-timeline");const S=document.getElementById("sort-timeline"),D=document.getElementById("timeline-no-results"),T=document.getElementById("timeline-results-count");let M=[],N=!1,B=!!h&&"asc"===h.getItem("timeline-sort");const F=new Set(["fa-rocket","fa-cloud","fa-shield-alt","fa-key","fa-bell","fa-wifi","fa-lock","fa-shield","fa-check","fa-star","fa-bookmark","fa-award"]);function $(t){if(!I)return;for(;I.firstChild;)I.removeChild(I.firstChild);t.slice().sort((e,t)=>B?new Date(e.date)-new Date(t.date):new Date(t.date)-new Date(e.date)).forEach(t=>{const n=document.createElement("li");n.dataset.aos="fade-up",n.dataset.date=t.date,n.tabIndex=0,n.setAttribute("role","listitem");const i=document.createElement("div");i.className="timeline-content";const a=document.createElement("div");a.className="timeline-icon";const o=document.createElement("i");o.classList.add("fas");const s="string"==typeof t.icon&&F.has(t.icon)?t.icon:"fa-shield-alt";o.classList.add(s),o.setAttribute("aria-hidden","true"),a.appendChild(o),i.appendChild(a);const c=document.createElement("h3");c.className="date";const l=document.createElement("time");l.setAttribute("datetime",t.date),l.textContent=t.date,c.appendChild(l);const d=r(new Date(t.date));if(d){const e=document.createElement("span");e.className="relative-time",e.textContent=d,c.appendChild(document.createTextNode(" ")),c.appendChild(e)}i.appendChild(c);const u=document.createElement("h3");u.textContent=e?t.title_fa:t.title_en,i.appendChild(u);const m=document.createElement("p");m.textContent=e?t.desc_fa:t.desc_en,i.appendChild(m),n.appendChild(i),I.appendChild(n)})}function q(){S&&(S.textContent=e?B?"قدیمی‌ترین":"جدیدترین":B?"Oldest first":"Newest first")}function O(){const e=document.querySelectorAll(".timeline li");if(e.length)if("IntersectionObserver"in window){const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("timeline-item-visible"),t.unobserve(e.target))})},{threshold:.3});e.forEach(e=>t.observe(e))}else e.forEach(e=>e.classList.add("timeline-item-visible"))}q();let R=null;function P(){if(!I||!k||N)return;function t(t){const n=f(t.trim()),i=n.length>0;if(h)try{h.setItem(y,t)}catch{}const a=_?_.value:"";if(h&&_)try{h.setItem(p,a)}catch{}let o=0;if(I.querySelectorAll("li").forEach(e=>{const t=f(e.textContent||""),s=!i||t.includes(n),r=!a||(e.dataset.date||"").startsWith(a),c=s&&r;e.style.display=c?"":"none",c&&i&&o++}),A&&A.classList.toggle("visually-hidden",!i),D){const e=i&&0===o;D.classList.toggle("hidden",!e),D.classList.toggle("visible",e)}T&&(i?(T.textContent=e?`${o} مورد یافت شد`:`${o} result${1===o?"":"s"} found`,T.classList.remove("hidden"),T.classList.add("visible")):(T.classList.add("hidden"),T.classList.remove("visible")))}k.addEventListener("input",()=>{const e=k.value;clearTimeout(R),R=setTimeout(()=>{t(e)},200)}),k.addEventListener("keydown",e=>{"Escape"===e.key&&(k.value="",A&&A.classList.add("visually-hidden"),t(""))}),A&&A.addEventListener("click",()=>{k.value="",A.classList.add("visually-hidden"),t("")});const n=h&&h.getItem(y)||"";if(n&&(k.value=n),_){const e=h&&h.getItem(p)||"";e&&(_.value=e),_.addEventListener("change",()=>t(k.value))}t(n),N=!0,window.addEventListener("beforeunload",()=>{R&&(clearTimeout(R),R=null)})}function K(i=!1,o=null){if(!I)return;for(;I.firstChild;)I.removeChild(I.firstChild);I.setAttribute("aria-busy","true"),o&&(o.classList.add("loading"),o.setAttribute("aria-busy","true"));const s="security-timeline";if(i&&h)try{h.removeItem(s)}catch{}w("/assets/data/security-timeline.json",s,n,e=>e.json()).then(n=>{if(M=n,_){const t=Array.from(new Set(n.map(e=>new Date(e.date).getFullYear()))).sort((e,t)=>t-e);for(;_.firstChild;)_.removeChild(_.firstChild);const i=document.createElement("option");i.value="",i.textContent=e?"همه سال‌ها":"All years",_.appendChild(i),t.forEach(e=>{const t=document.createElement("option");t.value=String(e),t.textContent=String(e),_.appendChild(t)});const a=h&&h.getItem(p)||"";a&&Array.from(_.options).some(e=>e.value===a)&&(_.value=a)}$(n),I.setAttribute("aria-busy","false"),O(),P(),i&&a(t.refreshed,{id:"security-timeline-refresh-toast",kind:"success",duration:2200,cooldownMs:600})}).catch(e=>{let n=t.fetchFail;e&&"offline"===e.message?n=t.offline:e&&"rate-limit"===e.message?n=t.rateLimit:e&&"stale-data"===e.message&&(n=""),n&&a(n,{id:"security-timeline-fetch-toast",kind:n===t.offline?"info":"error",duration:3e3,cooldownMs:1200}),M=e&&"stale-data"===e.message&&e.data&&Array.isArray(e.data)?e.data:x,$(M),I.setAttribute("aria-busy","false"),O(),P()}).finally(()=>{o&&(o.classList.remove("loading"),o.removeAttribute("aria-busy"))})}I?K():O();const G=document.getElementById("policy-expiration"),Y=document.getElementById("policy-expiration-progress"),j=document.getElementById("expiration-days");let U=null,H=null;function J(){if(!U||!G)return;const t=new Date,i=(U-t)/n;let a="";if(Y){const t=365,n=Math.min(100,Math.max(0,(t-i)/t*100));Y.value=n,Y.removeAttribute("aria-hidden"),a=i>0?e?`${Math.ceil(i)} روز باقیمانده`:`${Math.ceil(i)} days remaining`:e?"منقضی شده":"Expired",Y.setAttribute("aria-valuenow",n.toFixed(0)),Y.setAttribute("aria-valuetext",a)}j&&(j.textContent=a,j.classList.remove("hidden"),j.setAttribute("aria-hidden","false")),G.classList.remove("expired","expiring","warning"),Y&&Y.classList.remove("expired","expiring","warning"),i<=0?(G.classList.add("expired"),Y&&Y.classList.add("expired")):i<=30?(G.classList.add("expiring"),Y&&Y.classList.add("expiring")):i<=90&&(G.classList.add("warning"),Y&&Y.classList.add("warning"))}function W(t){const n=t.match(/^Expires:\s*(.+)$/m);if(n){const t=new Date(n[1].trim());if(Number.isNaN(t.getTime()))return void(G.textContent=e?"تاریخ اعتبار معتبر نیست.":"Expiration date is invalid.");U=t;const i=e?"fa-IR":"en-US",a={year:"numeric",month:"long",day:"numeric"},o=e?`اعتبار سیاست تا ${U.toLocaleDateString(i,a)}`:`Policy valid until ${U.toLocaleDateString(i,a)}`;G.textContent=o,J(),H&&clearInterval(H),H=setInterval(J,36e5)}else G.textContent=e?"تاریخ اعتبار در دسترس نیست.":"Expiration date unavailable."}function z(t=!1){if(G){if(t&&h)try{h.removeItem("security-txt")}catch{}w("/.well-known/security.txt","security-txt",n,e=>e.text()).then(e=>{W(e)}).catch(t=>{t&&"stale-data"===t.message&&"string"==typeof t.data?W(t.data):(G.textContent=e?"خطا در دریافت تاریخ اعتبار.":"Failed to load expiration date.",j&&(j.classList.add("hidden"),j.setAttribute("aria-hidden","true")))})}}G&&z();const Q=document.getElementById("scope-domain");if(Q){const e=document.createElement("code");e.textContent=location.hostname,Q.textContent="",Q.appendChild(e)}const X=document.getElementById("last-updated-date");function V(t){if(Array.isArray(t)&&t.length>0){const n=new Date(t[0].commit.committer.date);if(Number.isNaN(n.getTime()))return;const i=e?"fa-IR":"en-US",a={year:"numeric",month:"long",day:"numeric"},o=n.toLocaleDateString(i,a),s=r(n);X.textContent=s?`${o} (${s})`:o}}function Z(e=!1){if(!X)return;if(e&&h)try{h.removeItem("security-last")}catch{}w("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1","security-last",n,e=>e.json()).then(e=>{V(e)}).catch(e=>{if(e&&"stale-data"===e.message&&e.data)return void V(e.data);let n=t.fetchFail;e&&"offline"===e.message?n=t.offline:e&&"rate-limit"===e.message&&(n=t.rateLimit),a(n,{id:"security-last-updated-fetch-toast",kind:n===t.offline?"info":"error",duration:3e3,cooldownMs:1200})})}X&&Z();const ee=document.getElementById("advisories-list");function te(t){if(ee){for(;ee.firstChild;)ee.removeChild(ee.firstChild);Array.isArray(t)&&t.length>0?t.forEach(e=>{const t=document.createElement("li"),n=document.createElement("a");n.href=e.html_url,n.target="_blank",n.rel="noopener noreferrer",n.textContent=e.summary||e.ghsa_id||e.id,t.appendChild(n);const i=e.published_at||e.created_at;if(i){const e=document.createElement("span");e.className="adv-time",e.textContent=r(new Date(i)),t.appendChild(document.createTextNode(" ")),t.appendChild(e)}ee.appendChild(t)}):ee.textContent=e?"موردی یافت نشد.":"No advisories found."}}function ne(i=!1,o=null){if(!ee)return;for(;ee.firstChild;)ee.removeChild(ee.firstChild);o&&(o.classList.add("loading"),o.setAttribute("aria-busy","true"));const s="security-advisories";if(i&&h)try{h.removeItem(s)}catch{}w("/assets/data/security-advisories.json",s,n,e=>e.json()).then(e=>{te(e)}).catch(n=>{n&&"stale-data"===n.message&&n.data?te(n.data):ee.textContent=e?"خطا در دریافت اعلان‌ها.":"Failed to load advisories.";let i=t.fetchFail;n&&"offline"===n.message?i=t.offline:n&&"rate-limit"===n.message&&(i=t.rateLimit),a(i,{id:"security-advisories-fetch-toast",kind:i===t.offline?"info":"error",duration:3e3,cooldownMs:1200})}).finally(()=>{o&&(o.classList.remove("loading"),o.removeAttribute("aria-busy"))})}if(v=document.getElementById("refresh-advisories"),v&&v.addEventListener("click",()=>ne(!0,v)),ee){const e=()=>ne();"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(e,1e3)}g&&g.addEventListener("click",()=>K(!0,g)),S&&(S.addEventListener("click",()=>{if(B=!B,h)try{h.setItem("timeline-sort",B?"asc":"desc")}catch{}q(),$(M),O(),k&&k.dispatchEvent(new Event("input"))}),q()),k&&(document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();"/"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),k.focus())}),document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();"r"!==e.key&&"R"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),K(!0),ne(!0))})),document.querySelectorAll("#share-page, #share-page-button").forEach(e=>{e.addEventListener("click",()=>{navigator.share?navigator.share({title:document.title,url:location.href}).catch(()=>E(location.href)):E(location.href)})});const ie=document.getElementById("scroll-to-top"),ae=document.getElementById("share-page-button");function oe(){const e=window.scrollY>200;ie&&ie.classList.toggle("visible",e),ae&&ae.classList.toggle("visible",e)}window.addEventListener("scroll",oe,{passive:!0}),oe(),ie&&ie.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("online",()=>{L(),a(t.online,{id:"security-network-online-toast",kind:"success",duration:2200,cooldownMs:800}),K(!0),ne(!0),z(!0),Z(!0)}),window.addEventListener("offline",()=>{L(),a(t.offline,{id:"security-network-offline-toast",kind:"info",duration:2600,cooldownMs:800})}),window.addEventListener("beforeunload",()=>{H&&(clearInterval(H),H=null),R&&(clearTimeout(R),R=null)}),L()})}();
//# sourceMappingURL=security-page.min.js.map
