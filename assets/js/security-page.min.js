document.addEventListener("DOMContentLoaded",function(){let r=document.documentElement.lang||"en",a={success:r.startsWith("fa")?"کپی شد! ✅":"Copied! ✅",fail:r.startsWith("fa")?"عملیات کپی ناموفق بود.":"Failed to copy.",unsupported:r.startsWith("fa")?"مرورگر از کپی پشتیبانی نمی‌کند.":"Your browser does not support copying."},e=864e5;function s(t,e,a,n){try{var i=JSON.parse(localStorage.getItem(e)||"null");if(i&&Date.now()-i.t<a)return Promise.resolve(i.d)}catch(t){}return fetch(t).then(t=>n(t)).then(t=>{try{localStorage.setItem(e,JSON.stringify({t:Date.now(),d:t}))}catch(t){}return t})}function n(t){var t=t.currentTarget;let e=t.dataset.copyText||"";(e=!e&&(t=t.dataset.copyTarget,t=document.getElementById(t))?t.textContent.trim():e)&&(navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{"function"==typeof createToast&&createToast(a.success)}).catch(t=>{console.error("Copy failed:",t),"function"==typeof createToast&&createToast(a.fail)}):"function"==typeof createToast&&createToast(a.unsupported))}document.querySelectorAll(".copy-button").forEach(t=>{t.addEventListener("click",n)});let i=document.getElementById("security-timeline-list");function o(){var t=document.querySelectorAll(".timeline li");if("IntersectionObserver"in window){let e=new IntersectionObserver((t,e)=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("timeline-item-visible"),e.unobserve(t.target))})},{threshold:.3});t.forEach(t=>e.observe(t))}else t.forEach(t=>t.classList.add("timeline-item-visible"));let n=document.getElementById("policy-expiration"),i=document.getElementById("policy-expiration-progress");n&&s("/.well-known/security.txt","security-txt",e,t=>t.text()).then(t=>{var e,a,t=t.match(/^Expires:\s*(.+)$/m);t?(t=new Date(t[1].trim()),a=r.startsWith("fa")?"fa-IR":"en-US",e={year:"numeric",month:"long",day:"numeric"},a=r.startsWith("fa")?"اعتبار سیاست تا "+t.toLocaleDateString(a,e):"Policy valid until "+t.toLocaleDateString(a,e),n.textContent=a,e=(t-new Date)/864e5,i&&(a=Math.min(100,Math.max(0,(365-e)/365*100)),i.value=a,i.setAttribute("aria-valuenow",a.toFixed(0))),e<=0?(n.classList.add("expired"),i&&i.classList.add("expired")):e<=30&&(n.classList.add("expiring"),i)&&i.classList.add("expiring")):n.textContent=r.startsWith("fa")?"تاریخ اعتبار در دسترس نیست.":"Expiration date unavailable."}).catch(()=>{n.textContent=r.startsWith("fa")?"خطا در دریافت تاریخ اعتبار.":"Failed to load expiration date."});t=document.getElementById("scope-domain");t&&(t.innerHTML=`<code>${location.hostname}</code>`);let o=document.getElementById("last-updated-date");o&&s("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1","security-last",e,t=>t.json()).then(t=>{var e,a;Array.isArray(t)&&0<t.length&&(t=new Date(t[0].commit.committer.date),e=r.startsWith("fa")?"fa-IR":"en-US",a={year:"numeric",month:"long",day:"numeric"},o.textContent=t.toLocaleDateString(e,a))}).catch(()=>{})}i?s("/assets/data/security-timeline.json","security-timeline",e,t=>t.json()).then(t=>{t.forEach(t=>{var e=document.createElement("li"),a=(e.dataset.aos="fade-up",document.createElement("div")),n=(a.className="timeline-content",document.createElement("div")),n=(n.className="timeline-icon",n.innerHTML=`<i class="fas ${t.icon}" aria-hidden="true"></i>`,a.appendChild(n),document.createElement("h3")),n=(n.className="date",n.innerHTML=`<time datetime="${t.date}">${t.date}</time>`,a.appendChild(n),document.createElement("h3")),n=(n.textContent=r.startsWith("fa")?t.title_fa:t.title_en,a.appendChild(n),document.createElement("p"));n.textContent=r.startsWith("fa")?t.desc_fa:t.desc_en,a.appendChild(n),e.appendChild(a),i.appendChild(e)}),o()}).catch(()=>o()):o()});