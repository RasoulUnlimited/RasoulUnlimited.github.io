document.addEventListener("DOMContentLoaded",function(){let s=document.documentElement.lang||"en",i={success:s.startsWith("fa")?"کپی شد! ✅":"Copied! ✅",fail:s.startsWith("fa")?"عملیات کپی ناموفق بود.":"Failed to copy.",unsupported:s.startsWith("fa")?"مرورگر از کپی پشتیبانی نمی‌کند.":"Your browser does not support copying."},t=864e5;function c(){try{var e="__test";return localStorage.setItem(e,e),localStorage.removeItem(e),1}catch(e){}}async function a(e,t,a,i,n=5e3){if(c())try{var o=JSON.parse(localStorage.getItem(t)||"null");if(o&&Date.now()-o.t<a)return o.d}catch(e){}let r=new AbortController;a=setTimeout(()=>r.abort(),n),o=await fetch(e,{signal:r.signal,cache:"no-store"}),clearTimeout(a),n=await i(o);if(c())try{localStorage.setItem(t,JSON.stringify({t:Date.now(),d:n}))}catch(e){}return n}function n(e){if(e)if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(()=>{"function"==typeof createToast&&createToast(i.success)}).catch(e=>{console.error("Copy failed:",e),"function"==typeof createToast&&createToast(i.fail)});else{var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select();try{var a=document.execCommand("copy");"function"==typeof createToast&&createToast(a?i.success:i.fail)}catch(e){console.error("execCommand copy failed:",e),"function"==typeof createToast&&createToast(i.fail)}document.body.removeChild(t)}}function o(e){var e=e.currentTarget;let t=e.dataset.copyText||"";n(t=!t&&(e=e.dataset.copyTarget,e=document.getElementById(e))?e.textContent.trim():t)}document.querySelectorAll(".copy-button").forEach(e=>{e.addEventListener("click",o)}),document.querySelectorAll(".copyable").forEach(e=>{let t=()=>n(e.dataset.copyText||e.textContent.trim());e.addEventListener("click",t),e.addEventListener("keypress",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())})});let e=[{date:"2025-05-16",icon:"fa-rocket",title_fa:"شروع وب‌سایت",title_en:"Website launched",desc_fa:"انتشار اولیه سایت با نگاه به امنیت و عملکرد.",desc_en:"Initial release with a focus on performance and safety."},{date:"2025-05-25",icon:"fa-cloud",title_fa:"ادغام با Cloudflare",title_en:"Integrated with Cloudflare",desc_fa:"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.",desc_en:"Enhanced speed and security via Cloudflare CDN."},{date:"2025-06-01",icon:"fa-shield-alt",title_fa:"اعمال CSP سخت‌گیرانه",title_en:"Strict CSP enforced",desc_fa:"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.",desc_en:"Implemented tighter policies to prevent web attacks."},{date:"2025-07-10",icon:"fa-key",title_fa:"انتشار کلید عمومی PGP",title_en:"PGP key published",desc_fa:"امکان ارتباط رمزنگاری‌شده فراهم شد.",desc_en:"Secure encrypted communication enabled."},{date:"2025-07-20",icon:"fa-bell",title_fa:"راه‌اندازی اعلان‌های امنیتی",title_en:"Security advisories live",desc_fa:"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.",desc_en:"Security updates now published via GitHub advisories."}];function r(e){l.innerHTML="",e.forEach(e=>{var t=document.createElement("li"),a=(t.dataset.aos="fade-up",t.tabIndex=0,t.setAttribute("role","listitem"),document.createElement("div")),i=(a.className="timeline-content",document.createElement("div")),i=(i.className="timeline-icon",i.innerHTML=`<i class="fas ${e.icon}" aria-hidden="true"></i>`,a.appendChild(i),document.createElement("h3")),i=(i.className="date",i.innerHTML=`<time datetime="${e.date}">${e.date}</time>`,a.appendChild(i),document.createElement("h3")),i=(i.textContent=s.startsWith("fa")?e.title_fa:e.title_en,a.appendChild(i),document.createElement("p"));i.textContent=s.startsWith("fa")?e.desc_fa:e.desc_en,a.appendChild(i),t.appendChild(a),l.appendChild(t)})}let l=document.getElementById("security-timeline-list");function d(){var e=document.querySelectorAll(".timeline li");if("IntersectionObserver"in window){let t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("timeline-item-visible"),t.unobserve(e.target))})},{threshold:.3});e.forEach(e=>t.observe(e))}else e.forEach(e=>e.classList.add("timeline-item-visible"));let i=document.getElementById("policy-expiration"),n=document.getElementById("policy-expiration-progress");i&&a("/.well-known/security.txt","security-txt",t,e=>e.text()).then(e=>{var t,a,e=e.match(/^Expires:\s*(.+)$/m);e?(e=new Date(e[1].trim()),a=s.startsWith("fa")?"fa-IR":"en-US",t={year:"numeric",month:"long",day:"numeric"},a=s.startsWith("fa")?"اعتبار سیاست تا "+e.toLocaleDateString(a,t):"Policy valid until "+e.toLocaleDateString(a,t),i.textContent=a,t=(e-new Date)/864e5,n&&(a=Math.min(100,Math.max(0,(365-t)/365*100)),n.value=a,n.removeAttribute("aria-hidden"),n.setAttribute("aria-valuenow",a.toFixed(0)),e=s.startsWith("fa")?Math.ceil(t)+" روز باقیمانده":Math.ceil(t)+" days remaining",n.setAttribute("aria-valuetext",e)),t<=0?(i.classList.add("expired"),n&&n.classList.add("expired")):t<=30&&(i.classList.add("expiring"),n)&&n.classList.add("expiring")):i.textContent=s.startsWith("fa")?"تاریخ اعتبار در دسترس نیست.":"Expiration date unavailable."}).catch(()=>{i.textContent=s.startsWith("fa")?"خطا در دریافت تاریخ اعتبار.":"Failed to load expiration date."});e=document.getElementById("scope-domain");e&&(e.innerHTML=`<code>${location.hostname}</code>`);let o=document.getElementById("last-updated-date"),r=(o&&a("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1","security-last",t,e=>e.json()).then(e=>{var t,a;Array.isArray(e)&&0<e.length&&(e=new Date(e[0].commit.committer.date),t=s.startsWith("fa")?"fa-IR":"en-US",a={year:"numeric",month:"long",day:"numeric"},o.textContent=e.toLocaleDateString(t,a))}).catch(()=>{}),document.getElementById("advisories-list"));r&&(r.innerHTML="",a("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/security-advisories?per_page=3","security-advisories",t,e=>e.json()).then(e=>{Array.isArray(e)&&0<e.length?e.forEach(e=>{var t=document.createElement("li"),a=document.createElement("a");a.href=e.html_url,a.target="_blank",a.rel="noopener",a.textContent=e.summary||e.ghsa_id||e.id,t.appendChild(a),r.appendChild(t)}):r.textContent=s.startsWith("fa")?"موردی یافت نشد.":"No advisories found."}).catch(()=>{r.textContent=s.startsWith("fa")?"خطا در دریافت اعلان‌ها.":"Failed to load advisories."}))}l?a("/assets/data/security-timeline.json","security-timeline",t,e=>e.json()).then(e=>{r(e),l.setAttribute("aria-busy","false"),d()}).catch(()=>{r(e),l.setAttribute("aria-busy","false"),d()}):d()});