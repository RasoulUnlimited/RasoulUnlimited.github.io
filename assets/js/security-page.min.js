!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){const e=(document.documentElement.lang||"en").toLowerCase().startsWith("fa"),t={success:e?"کپی شد! ✅":"Copied! ✅",fail:e?"عملیات کپی ناموفق بود.":"Failed to copy.",unsupported:e?"مرورگر از کپی پشتیبانی نمی‌کند.":"Your browser does not support copying.",offline:e?"شما آفلاین هستید.":"You are offline.",online:e?"اتصال برقرار شد.":"Back online.",refreshed:e?"بروزرسانی شد! ✅":"Updated! ✅",fetchFail:e?"خطا در بارگیری داده.":"Failed to load data.",rateLimit:e?"محدودیت نرخ GitHub فعال شده است.":"GitHub rate limit exceeded."},n=864e5;function a(t){if(!t||!window.Intl||!Intl.RelativeTimeFormat)return"";const n=Date.now()-t.getTime(),a=[["year",31536e6],["month",2592e6],["week",6048e5],["day",864e5],["hour",36e5],["minute",6e4],["second",1e3]],i=e?"fa":"en";for(const[e,t]of a)if(Math.abs(n)>=t||"second"===e){return new Intl.RelativeTimeFormat(i,{numeric:"auto"}).format(-Math.round(n/t),e)}return""}const i=window.matchMedia("(prefers-reduced-motion: reduce)");function o(e,t){e&&"function"==typeof t&&("function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t))}function s(){document.querySelectorAll("[data-aos]").forEach(e=>{e.removeAttribute("data-aos")}),document.querySelectorAll(".skeleton").forEach(e=>{e.classList.remove("skeleton")})}i.matches&&s(),o(i,e=>{e.matches&&s()});const r=window.matchMedia("(max-width: 600px)");function c(e){if(!e)return"";const t="۰۱۲۳۴۵۶۷۸۹";return e.normalize("NFKD").replace(/[۰-۹]/g,e=>String(t.indexOf(e))).replace(/[\u064B-\u065F\u0670]/g,"").toLowerCase()}function l(){const e="__test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),localStorage}catch(t){try{return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),sessionStorage}catch{return null}}}r.matches&&s(),o(r,e=>{e.matches&&s()});const d=l(),u="timeline-search-term",m="timeline-year";let f,h;async function p(e,t,n,a,i=5e3){let o=null;if(d)try{o=JSON.parse(d.getItem(t)||"null")}catch{o=null}if(o&&(Date.now()-o.t<n||!navigator.onLine))return o.d;if(!navigator.onLine&&!o)throw new Error("offline");if(!navigator.onLine&&o)return o.d;const s="undefined"!=typeof AbortController?new AbortController:null,r=s&&setTimeout(()=>{s.abort()},i);try{const n=await fetch(e,{signal:s?s.signal:void 0,cache:"no-store"});if(!n.ok){if(403===n.status&&"0"===n.headers.get("X-RateLimit-Remaining"))throw new Error("rate-limit");if(o)return o.d;throw new Error(n.statusText||"fetch error")}const i=await a(n);if(d)try{d.setItem(t,JSON.stringify({t:Date.now(),d:i}))}catch{}return i}finally{r&&clearTimeout(r)}}function y(e){if(e)if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(()=>{"function"==typeof createToast&&createToast(t.success)}).catch(e=>{console.error("Copy failed:",e),"function"==typeof createToast&&createToast(t.fail)});else{const n=document.createElement("textarea");n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n),n.select();try{const e=document.execCommand("copy");"function"==typeof createToast&&createToast(e?t.success:t.fail)}catch(e){console.error("execCommand copy failed:",e),"function"==typeof createToast&&createToast(t.fail)}document.body.removeChild(n)}}function g(e){const t=e.currentTarget;let n=t.dataset.copyText||"";if(!n){const e=t.dataset.copyTarget,a=document.getElementById(e);a&&(n=a.textContent.trim())}y(n)}document.querySelectorAll(".copy-button").forEach(e=>{e.addEventListener("click",g)}),document.querySelectorAll(".copyable").forEach(e=>{const t=()=>y(e.dataset.copyText||e.textContent.trim());e.addEventListener("click",t),e.addEventListener("keypress",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())})});const v=document.getElementById("connection-status");function E(){if(!v)return;const t=navigator.onLine;v.textContent=t?e?"اتصال اینترنت برقرار است.":"You are online.":e?"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.":"You are offline. Some features may be unavailable.",document.body.classList.toggle("offline",!t),[f,h].forEach(e=>{e&&(e.disabled=!t)})}const L=[{date:"2025-05-16",icon:"fa-rocket",title_fa:"شروع وب‌سایت",title_en:"Website launched",desc_fa:"انتشار اولیه سایت با نگاه به امنیت و عملکرد.",desc_en:"Initial release with a focus on performance and safety."},{date:"2025-05-25",icon:"fa-cloud",title_fa:"ادغام با Cloudflare",title_en:"Integrated with Cloudflare",desc_fa:"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.",desc_en:"Enhanced speed and security via Cloudflare CDN."},{date:"2025-06-01",icon:"fa-shield-alt",title_fa:"اعمال CSP سخت‌گیرانه",title_en:"Strict CSP enforced",desc_fa:"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.",desc_en:"Implemented tighter policies to prevent web attacks."},{date:"2025-07-10",icon:"fa-key",title_fa:"انتشار کلید عمومی PGP",title_en:"PGP key published",desc_fa:"امکان ارتباط رمزنگاری‌شده فراهم شد.",desc_en:"Secure encrypted communication enabled."},{date:"2025-07-20",icon:"fa-bell",title_fa:"راه‌اندازی اعلان‌های امنیتی",title_en:"Security advisories live",desc_fa:"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.",desc_en:"Security updates now published via GitHub advisories."},{date:"2025-10-01",icon:"fa-wifi",title_fa:"افزودن پشتیبانی آفلاین",title_en:"Offline support added",desc_fa:"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.",desc_en:"Improved user experience with local caching and connection status alerts."}],w=document.getElementById("security-timeline-list"),b=document.getElementById("timeline-search"),x=document.getElementById("timeline-year"),C=document.getElementById("clear-timeline-search");f=document.getElementById("refresh-timeline");const I=document.getElementById("sort-timeline"),T=document.getElementById("timeline-no-results"),_=document.getElementById("timeline-results-count");let A=[],S=!1,k=!!d&&"asc"===d.getItem("timeline-sort");function D(t){if(!w)return;w.innerHTML="";t.slice().sort((e,t)=>k?new Date(e.date)-new Date(t.date):new Date(t.date)-new Date(e.date)).forEach(t=>{const n=document.createElement("li");n.dataset.aos="fade-up",n.dataset.date=t.date,n.tabIndex=0,n.setAttribute("role","listitem");const i=document.createElement("div");i.className="timeline-content";const o=document.createElement("div");o.className="timeline-icon";const s=document.createElement("i");s.classList.add("fas");const r="string"==typeof t.icon&&/^(fa-[a-z0-9-]+)$/i.test(t.icon)?t.icon:"fa-shield-alt";s.classList.add(r),s.setAttribute("aria-hidden","true"),o.appendChild(s),i.appendChild(o);const c=document.createElement("h3");c.className="date";const l=document.createElement("time");l.setAttribute("datetime",t.date),l.textContent=t.date,c.appendChild(l);const d=a(new Date(t.date));if(d){const e=document.createElement("span");e.className="relative-time",e.textContent=d,c.appendChild(document.createTextNode(" ")),c.appendChild(e)}i.appendChild(c);const u=document.createElement("h3");u.textContent=e?t.title_fa:t.title_en,i.appendChild(u);const m=document.createElement("p");m.textContent=e?t.desc_fa:t.desc_en,i.appendChild(m),n.appendChild(i),w.appendChild(n)})}function B(){I&&(I.textContent=e?k?"قدیمی‌ترین":"جدیدترین":k?"Oldest first":"Newest first")}function M(){const e=document.querySelectorAll(".timeline li");if("IntersectionObserver"in window){const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("timeline-item-visible"),t.unobserve(e.target))})},{threshold:.3});e.forEach(e=>t.observe(e))}else e.forEach(e=>e.classList.add("timeline-item-visible"))}function N(){if(!w||!b||S)return;function t(t){const n=c(t.trim()),a=n.length>0;if(d)try{d.setItem(u,t)}catch{}const i=x?x.value:"";if(d&&x)try{d.setItem(m,i)}catch{}const o=a?new RegExp(`(${n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi"):null;let s=0;w.querySelectorAll("li").forEach(e=>{const t=e.querySelector(".timeline-content");if(!t)return;e.dataset.orig||(e.dataset.orig=t.innerHTML);const r=c(e.textContent),l=a&&r.includes(n),d=!i||(e.dataset.date||"").startsWith(i),u=(l||!a)&&d;if(e.style.display=u?"":"none",u&&l&&o){s++;const n=e.dataset.orig.split(o);t.innerHTML="",n.forEach((e,n)=>{if(n%2==1){const n=document.createElement("span");n.className="search-highlight",n.textContent=e,t.appendChild(n)}else e&&t.appendChild(document.createTextNode(e))})}else t.innerHTML=e.dataset.orig}),C&&C.classList.toggle("visually-hidden",!a),T&&(T.classList.toggle("hidden",0!==s),T.classList.toggle("visible",0===s)),_&&(a?(_.textContent=e?`${s} مورد یافت شد`:`${s} result${1===s?"":"s"} found`,_.classList.remove("hidden"),_.classList.add("visible")):(_.classList.add("hidden"),_.classList.remove("visible")))}let n;b.addEventListener("input",()=>{const e=b.value;clearTimeout(n),n=setTimeout(()=>t(e),200)}),b.addEventListener("keydown",e=>{"Escape"===e.key&&(b.value="",C&&C.classList.add("visually-hidden"),t(""))}),C&&C.addEventListener("click",()=>{b.value="",C.classList.add("visually-hidden"),t("")});const a=d&&d.getItem(u)||"";if(a&&(b.value=a),x){const e=d&&d.getItem(m)||"";e&&(x.value=e),x.addEventListener("change",()=>t(b.value))}t(a),S=!0,window.addEventListener("beforeunload",()=>{clearTimeout(n)})}function $(a=!1,i=null){if(!w)return;w.innerHTML="",w.setAttribute("aria-busy","true"),i&&(i.classList.add("loading"),i.setAttribute("aria-busy","true"));const o="security-timeline";if(a&&d)try{d.removeItem(o)}catch{}p("/assets/data/security-timeline.json",o,n,e=>e.json()).then(n=>{if(A=n,x){const t=Array.from(new Set(n.map(e=>new Date(e.date).getFullYear()))).sort((e,t)=>t-e);x.innerHTML="";const a=document.createElement("option");a.value="",a.textContent=e?"همه سال‌ها":"All years",x.appendChild(a),t.forEach(e=>{const t=document.createElement("option");t.value=String(e),t.textContent=String(e),x.appendChild(t)});const i=d&&d.getItem(m)||"";i&&Array.from(x.options).some(e=>e.value===i)&&(x.value=i)}D(n),w.setAttribute("aria-busy","false"),M(),N(),a&&"function"==typeof createToast&&createToast(t.refreshed)}).catch(e=>{if("function"==typeof createToast){let n=t.fetchFail;e&&"offline"===e.message?n=t.offline:e&&"rate-limit"===e.message&&(n=t.rateLimit),createToast(n)}A=L,D(A),w.setAttribute("aria-busy","false"),M(),N()}).finally(()=>{i&&(i.classList.remove("loading"),i.removeAttribute("aria-busy"))})}B(),w?$():M();const F=document.getElementById("policy-expiration"),H=document.getElementById("policy-expiration-progress"),q=document.getElementById("expiration-days");let R=null,O=null;function K(){if(!R||!F)return;const t=new Date,a=(R-t)/n;let i="";if(H){const t=365,n=Math.min(100,Math.max(0,(t-a)/t*100));H.value=n,H.removeAttribute("aria-hidden"),H.setAttribute("aria-valuenow",n.toFixed(0)),i=e?`${Math.ceil(a)} روز باقیمانده`:`${Math.ceil(a)} days remaining`,H.setAttribute("aria-valuetext",i)}q&&(q.textContent=i,q.classList.remove("hidden"),q.setAttribute("aria-hidden","false")),F.classList.remove("expired","expiring","warning"),H&&H.classList.remove("expired","expiring","warning"),a<=0?(F.classList.add("expired"),H&&H.classList.add("expired")):a<=30?(F.classList.add("expiring"),H&&H.classList.add("expiring")):a<=90&&(F.classList.add("warning"),H&&H.classList.add("warning"))}function P(t=!1){if(F){if(t&&d)try{d.removeItem("security-txt")}catch{}p("/.well-known/security.txt","security-txt",n,e=>e.text()).then(t=>{const n=t.match(/^Expires:\s*(.+)$/m);if(n){R=new Date(n[1].trim());const t=e?"fa-IR":"en-US",a={year:"numeric",month:"long",day:"numeric"},i=e?`اعتبار سیاست تا ${R.toLocaleDateString(t,a)}`:`Policy valid until ${R.toLocaleDateString(t,a)}`;F.textContent=i,K(),O&&clearInterval(O),O=setInterval(K,36e5)}else F.textContent=e?"تاریخ اعتبار در دسترس نیست.":"Expiration date unavailable."}).catch(()=>{F.textContent=e?"خطا در دریافت تاریخ اعتبار.":"Failed to load expiration date.",q&&(q.classList.add("hidden"),q.setAttribute("aria-hidden","true"))})}}F&&P();const G=document.getElementById("scope-domain");G&&(G.innerHTML=`<code>${location.hostname}</code>`);const Y=document.getElementById("last-updated-date");function j(i=!1){if(!Y)return;if(i&&d)try{d.removeItem("security-last")}catch{}p("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1","security-last",n,e=>e.json()).then(t=>{if(Array.isArray(t)&&t.length>0){const n=new Date(t[0].commit.committer.date),i=e?"fa-IR":"en-US",o={year:"numeric",month:"long",day:"numeric"},s=n.toLocaleDateString(i,o),r=a(n);Y.textContent=r?`${s} (${r})`:s}}).catch(e=>{if("function"==typeof createToast){let n=t.fetchFail;e&&"offline"===e.message?n=t.offline:e&&"rate-limit"===e.message&&(n=t.rateLimit),createToast(n)}})}Y&&j();const U=document.getElementById("advisories-list");function W(i=!1,o=null){if(!U)return;U.innerHTML="",o&&(o.classList.add("loading"),o.setAttribute("aria-busy","true"));const s="/assets/data/security-advisories.json",r="security-advisories";if(i&&d)try{d.removeItem(r)}catch{}p(s,r,n,e=>e.json()).then(t=>{Array.isArray(t)&&t.length>0?t.forEach(e=>{const t=document.createElement("li"),n=document.createElement("a");n.href=e.html_url,n.target="_blank",n.rel="noopener",n.textContent=e.summary||e.ghsa_id||e.id,t.appendChild(n);const i=e.published_at||e.created_at;if(i){const e=document.createElement("span");e.className="adv-time",e.textContent=a(new Date(i)),t.appendChild(document.createTextNode(" ")),t.appendChild(e)}U.appendChild(t)}):U.textContent=e?"موردی یافت نشد.":"No advisories found."}).catch(n=>{if(U.textContent=e?"خطا در دریافت اعلان‌ها.":"Failed to load advisories.","function"==typeof createToast){let e=t.fetchFail;n&&"offline"===n.message?e=t.offline:n&&"rate-limit"===n.message&&(e=t.rateLimit),createToast(e)}}).finally(()=>{o&&(o.classList.remove("loading"),o.removeAttribute("aria-busy"))})}if(h=document.getElementById("refresh-advisories"),h&&h.addEventListener("click",()=>W(!0,h)),U){const e=()=>W();"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(e,1e3)}f&&f.addEventListener("click",()=>$(!0,f)),I&&(I.addEventListener("click",()=>{if(k=!k,d)try{d.setItem("timeline-sort",k?"asc":"desc")}catch{}B(),D(A),M(),b&&b.dispatchEvent(new Event("input"))}),B()),b&&(document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();"/"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),b.focus())}),document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();"r"!==e.key&&"R"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),$(!0),W(!0))})),document.querySelectorAll("#share-page, #share-page-button").forEach(e=>{e.addEventListener("click",()=>{navigator.share?navigator.share({title:document.title,url:location.href}).catch(()=>y(location.href)):y(location.href)})});const z=document.getElementById("scroll-to-top"),J=document.getElementById("share-page-button");function X(){const e=window.scrollY>200;z&&z.classList.toggle("visible",e),J&&J.classList.toggle("visible",e)}window.addEventListener("scroll",X,{passive:!0}),X(),z&&z.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("online",()=>{E(),"function"==typeof createToast&&createToast(t.online),$(!0),W(!0),P(!0),j(!0)}),window.addEventListener("offline",()=>{E(),"function"==typeof createToast&&createToast(t.offline)}),E()})}();