!function(){"use strict";document.addEventListener("DOMContentLoaded",function(){const e=(document.documentElement.lang||"en").toLowerCase().startsWith("fa"),t={success:e?"کپی شد! ✅":"Copied! ✅",fail:e?"عملیات کپی ناموفق بود.":"Failed to copy.",unsupported:e?"مرورگر از کپی پشتیبانی نمی‌کند.":"Your browser does not support copying.",offline:e?"شما آفلاین هستید.":"You are offline.",online:e?"اتصال برقرار شد.":"Back online.",refreshed:e?"بروزرسانی شد! ✅":"Updated! ✅",fetchFail:e?"خطا در بارگیری داده.":"Failed to load data.",rateLimit:e?"محدودیت نرخ GitHub فعال شده است.":"GitHub rate limit exceeded."},n=864e5,a={};const i=[["year",31536e6],["month",2592e6],["week",6048e5],["day",864e5],["hour",36e5],["minute",6e4],["second",1e3]];function o(t){if(!t)return"";const n=function(e){return window.Intl&&Intl.RelativeTimeFormat?(a[e]||(a[e]=new Intl.RelativeTimeFormat(e,{numeric:"auto"})),a[e]):null}(e?"fa":"en");if(!n)return"";const o=Date.now()-t.getTime();for(const[e,t]of i)if(Math.abs(o)>=t||"second"===e)return n.format(-Math.round(o/t),e);return""}const r="function"==typeof window.matchMedia,s=r?window.matchMedia("(prefers-reduced-motion: reduce)"):null,c=r?window.matchMedia("(max-width: 600px)"):null;function l(e,t){e&&"function"==typeof t&&("function"==typeof e.addEventListener?e.addEventListener("change",t):"function"==typeof e.addListener&&e.addListener(t))}function d(){document.querySelectorAll("[data-aos]").forEach(e=>{e.removeAttribute("data-aos")}),document.querySelectorAll(".skeleton").forEach(e=>{e.classList.remove("skeleton")})}function u(e){if(!e)return"";let t=String(e);try{"function"==typeof t.normalize&&(t=t.normalize("NFKD"))}catch{}return t.replace(/[۰-۹]/g,e=>String("۰۱۲۳۴۵۶۷۸۹".indexOf(e))).replace(/[\u064B-\u065F\u0670]/g,"").toLowerCase()}s&&s.matches&&d(),l(s,e=>{e.matches&&d()}),c&&c.matches&&d(),l(c,e=>{e.matches&&d()});const m=function(){const e="__test";try{return localStorage.setItem(e,e),localStorage.removeItem(e),localStorage}catch(t){try{return sessionStorage.setItem(e,e),sessionStorage.removeItem(e),sessionStorage}catch{return null}}}(),f="timeline-search-term",h="timeline-year";let y,p;async function w(e,t,n,a,i=5e3){let o=null;if(m)try{o=JSON.parse(m.getItem(t)||"null")}catch{o=null}if(o&&Date.now()-o.t<n)return o.d;if(!navigator.onLine){if(o&&o.d){const e=new Error("stale-data");throw e.data=o.d,e}throw new Error("offline")}const r="undefined"!=typeof AbortController?new AbortController:null,s=r&&setTimeout(()=>{r.abort()},i);try{const n=await fetch(e,{signal:r?r.signal:void 0,cache:"no-store"});if(!n.ok){if(403===n.status&&"0"===n.headers.get("X-RateLimit-Remaining"))throw new Error("rate-limit");if(o&&o.d){const e=new Error("stale-data");throw e.data=o.d,e}throw new Error(n.statusText||"fetch error")}let i;try{i=await a(n)}catch(e){throw console.error(`Parser error for ${t}:`,e),new Error("parse-error")}if(null!==i&&m)try{m.setItem(t,JSON.stringify({t:Date.now(),d:i}))}catch(e){if("QuotaExceededError"===e.name){console.warn(`localStorage quota exceeded for ${t}, attempting cleanup...`);try{const e=["security-timeline-cache","security-advisories-cache"];for(const n of e)n!==t&&m.removeItem(n);m.setItem(t,JSON.stringify({t:Date.now(),d:i}))}catch(e){console.error(`Failed to cache ${t} even after cleanup:`,e)}}else console.warn(`Failed to cache ${t}, but returning fresh data:`,e)}return i}finally{s&&clearTimeout(s)}}function g(e){if(e)if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e).then(()=>{"function"==typeof window.createToast&&window.createToast(t.success)}).catch(e=>{console.error("Copy failed:",e),"function"==typeof window.createToast&&window.createToast(t.fail)});else{const n=document.createElement("textarea");n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n),n.select();try{const e=document.execCommand("copy");"function"==typeof window.createToast&&window.createToast(e?t.success:t.fail)}catch(e){console.error("execCommand copy failed:",e),"function"==typeof window.createToast&&window.createToast(t.fail)}document.body.removeChild(n)}}function v(e){const t=e.currentTarget;let n=t.dataset.copyText||"";if(!n){const e=t.dataset.copyTarget,a=document.getElementById(e);a&&(n=(a.textContent||"").trim())}g(n)}document.querySelectorAll(".copy-button").forEach(e=>{e.addEventListener("click",v)}),document.querySelectorAll(".copyable").forEach(e=>{const t=()=>g(e.dataset.copyText||(e.textContent||"").trim());e.addEventListener("click",t),e.addEventListener("keypress",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t())})});const E=document.getElementById("connection-status");function b(){if(!E)return;const t=navigator.onLine;E.textContent=t?e?"اتصال اینترنت برقرار است.":"You are online.":e?"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.":"You are offline. Some features may be unavailable.",document.body.classList.toggle("offline",!t),[y,p].forEach(e=>{e&&(e.disabled=!t)})}const C=[{date:"2025-05-16",icon:"fa-rocket",title_fa:"شروع وب‌سایت",title_en:"Website launched",desc_fa:"انتشار اولیه سایت با نگاه به امنیت و عملکرد.",desc_en:"Initial release with a focus on performance and safety."},{date:"2025-05-25",icon:"fa-cloud",title_fa:"ادغام با Cloudflare",title_en:"Integrated with Cloudflare",desc_fa:"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.",desc_en:"Enhanced speed and security via Cloudflare CDN."},{date:"2025-06-01",icon:"fa-shield-alt",title_fa:"اعمال CSP سخت‌گیرانه",title_en:"Strict CSP enforced",desc_fa:"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.",desc_en:"Implemented tighter policies to prevent web attacks."},{date:"2025-07-10",icon:"fa-key",title_fa:"انتشار کلید عمومی PGP",title_en:"PGP key published",desc_fa:"امکان ارتباط رمزنگاری‌شده فراهم شد.",desc_en:"Secure encrypted communication enabled."},{date:"2025-07-20",icon:"fa-bell",title_fa:"راه‌اندازی اعلان‌های امنیتی",title_en:"Security advisories live",desc_fa:"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.",desc_en:"Security updates now published via GitHub advisories."},{date:"2025-10-01",icon:"fa-wifi",title_fa:"افزودن پشتیبانی آفلاین",title_en:"Offline support added",desc_fa:"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.",desc_en:"Improved user experience with local caching and connection status alerts."}],L=document.getElementById("security-timeline-list"),x=document.getElementById("timeline-search"),I=document.getElementById("timeline-year"),T=document.getElementById("clear-timeline-search");y=document.getElementById("refresh-timeline");const k=document.getElementById("sort-timeline"),_=document.getElementById("timeline-no-results"),A=document.getElementById("timeline-results-count");let S=[],D=!1,N=!!m&&"asc"===m.getItem("timeline-sort");const B=new Set(["fa-rocket","fa-cloud","fa-shield-alt","fa-key","fa-bell","fa-wifi","fa-lock","fa-shield","fa-check","fa-star","fa-bookmark","fa-award"]);function F(t){if(!L)return;for(;L.firstChild;)L.removeChild(L.firstChild);t.slice().sort((e,t)=>N?new Date(e.date)-new Date(t.date):new Date(t.date)-new Date(e.date)).forEach(t=>{const n=document.createElement("li");n.dataset.aos="fade-up",n.dataset.date=t.date,n.tabIndex=0,n.setAttribute("role","listitem");const a=document.createElement("div");a.className="timeline-content";const i=document.createElement("div");i.className="timeline-icon";const r=document.createElement("i");r.classList.add("fas");const s="string"==typeof t.icon&&B.has(t.icon)?t.icon:"fa-shield-alt";r.classList.add(s),r.setAttribute("aria-hidden","true"),i.appendChild(r),a.appendChild(i);const c=document.createElement("h3");c.className="date";const l=document.createElement("time");l.setAttribute("datetime",t.date),l.textContent=t.date,c.appendChild(l);const d=o(new Date(t.date));if(d){const e=document.createElement("span");e.className="relative-time",e.textContent=d,c.appendChild(document.createTextNode(" ")),c.appendChild(e)}a.appendChild(c);const u=document.createElement("h3");u.textContent=e?t.title_fa:t.title_en,a.appendChild(u);const m=document.createElement("p");m.textContent=e?t.desc_fa:t.desc_en,a.appendChild(m),n.appendChild(a),L.appendChild(n)})}function $(){k&&(k.textContent=e?N?"قدیمی‌ترین":"جدیدترین":N?"Oldest first":"Newest first")}function q(){const e=document.querySelectorAll(".timeline li");if(e.length)if("IntersectionObserver"in window){const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("timeline-item-visible"),t.unobserve(e.target))})},{threshold:.3});e.forEach(e=>t.observe(e))}else e.forEach(e=>e.classList.add("timeline-item-visible"))}$();let M=null;function O(){if(!L||!x||D)return;function t(t){const n=u(t.trim()),a=n.length>0;if(m)try{m.setItem(f,t)}catch{}const i=I?I.value:"";if(m&&I)try{m.setItem(h,i)}catch{}let o=0;if(L.querySelectorAll("li").forEach(e=>{const t=u(e.textContent||""),r=!a||t.includes(n),s=!i||(e.dataset.date||"").startsWith(i),c=r&&s;e.style.display=c?"":"none",c&&a&&o++}),T&&T.classList.toggle("visually-hidden",!a),_){const e=a&&0===o;_.classList.toggle("hidden",!e),_.classList.toggle("visible",e)}A&&(a?(A.textContent=e?`${o} مورد یافت شد`:`${o} result${1===o?"":"s"} found`,A.classList.remove("hidden"),A.classList.add("visible")):(A.classList.add("hidden"),A.classList.remove("visible")))}x.addEventListener("input",()=>{const e=x.value;clearTimeout(M),M=setTimeout(()=>{t(e)},200)}),x.addEventListener("keydown",e=>{"Escape"===e.key&&(x.value="",T&&T.classList.add("visually-hidden"),t(""))}),T&&T.addEventListener("click",()=>{x.value="",T.classList.add("visually-hidden"),t("")});const n=m&&m.getItem(f)||"";if(n&&(x.value=n),I){const e=m&&m.getItem(h)||"";e&&(I.value=e),I.addEventListener("change",()=>t(x.value))}t(n),D=!0,window.addEventListener("beforeunload",()=>{M&&(clearTimeout(M),M=null)})}function R(a=!1,i=null){if(!L)return;for(;L.firstChild;)L.removeChild(L.firstChild);L.setAttribute("aria-busy","true"),i&&(i.classList.add("loading"),i.setAttribute("aria-busy","true"));const o="security-timeline";if(a&&m)try{m.removeItem(o)}catch{}w("/assets/data/security-timeline.json",o,n,e=>e.json()).then(n=>{if(S=n,I){const t=Array.from(new Set(n.map(e=>new Date(e.date).getFullYear()))).sort((e,t)=>t-e);for(;I.firstChild;)I.removeChild(I.firstChild);const a=document.createElement("option");a.value="",a.textContent=e?"همه سال‌ها":"All years",I.appendChild(a),t.forEach(e=>{const t=document.createElement("option");t.value=String(e),t.textContent=String(e),I.appendChild(t)});const i=m&&m.getItem(h)||"";i&&Array.from(I.options).some(e=>e.value===i)&&(I.value=i)}F(n),L.setAttribute("aria-busy","false"),q(),O(),a&&"function"==typeof window.createToast&&window.createToast(t.refreshed)}).catch(e=>{if("function"==typeof window.createToast){let n=t.fetchFail;e&&"offline"===e.message?n=t.offline:e&&"rate-limit"===e.message?n=t.rateLimit:e&&"stale-data"===e.message&&(n=""),n&&window.createToast(n)}S=e&&"stale-data"===e.message&&e.data&&Array.isArray(e.data)?e.data:C,F(S),L.setAttribute("aria-busy","false"),q(),O()}).finally(()=>{i&&(i.classList.remove("loading"),i.removeAttribute("aria-busy"))})}L?R():q();const P=document.getElementById("policy-expiration"),K=document.getElementById("policy-expiration-progress"),G=document.getElementById("expiration-days");let Y=null,j=null;function U(){if(!Y||!P)return;const t=new Date,a=(Y-t)/n;let i="";if(K){const t=365,n=Math.min(100,Math.max(0,(t-a)/t*100));K.value=n,K.removeAttribute("aria-hidden"),i=a>0?e?`${Math.ceil(a)} روز باقیمانده`:`${Math.ceil(a)} days remaining`:e?"منقضی شده":"Expired",K.setAttribute("aria-valuenow",n.toFixed(0)),K.setAttribute("aria-valuetext",i)}G&&(G.textContent=i,G.classList.remove("hidden"),G.setAttribute("aria-hidden","false")),P.classList.remove("expired","expiring","warning"),K&&K.classList.remove("expired","expiring","warning"),a<=0?(P.classList.add("expired"),K&&K.classList.add("expired")):a<=30?(P.classList.add("expiring"),K&&K.classList.add("expiring")):a<=90&&(P.classList.add("warning"),K&&K.classList.add("warning"))}function H(t){const n=t.match(/^Expires:\s*(.+)$/m);if(n){const t=new Date(n[1].trim());if(Number.isNaN(t.getTime()))return void(P.textContent=e?"تاریخ اعتبار معتبر نیست.":"Expiration date is invalid.");Y=t;const a=e?"fa-IR":"en-US",i={year:"numeric",month:"long",day:"numeric"},o=e?`اعتبار سیاست تا ${Y.toLocaleDateString(a,i)}`:`Policy valid until ${Y.toLocaleDateString(a,i)}`;P.textContent=o,U(),j&&clearInterval(j),j=setInterval(U,36e5)}else P.textContent=e?"تاریخ اعتبار در دسترس نیست.":"Expiration date unavailable."}function J(t=!1){if(P){if(t&&m)try{m.removeItem("security-txt")}catch{}w("/.well-known/security.txt","security-txt",n,e=>e.text()).then(e=>{H(e)}).catch(t=>{t&&"stale-data"===t.message&&"string"==typeof t.data?H(t.data):(P.textContent=e?"خطا در دریافت تاریخ اعتبار.":"Failed to load expiration date.",G&&(G.classList.add("hidden"),G.setAttribute("aria-hidden","true")))})}}P&&J();const W=document.getElementById("scope-domain");if(W){const e=document.createElement("code");e.textContent=location.hostname,W.textContent="",W.appendChild(e)}const z=document.getElementById("last-updated-date");function Q(t){if(Array.isArray(t)&&t.length>0){const n=new Date(t[0].commit.committer.date);if(Number.isNaN(n.getTime()))return;const a=e?"fa-IR":"en-US",i={year:"numeric",month:"long",day:"numeric"},r=n.toLocaleDateString(a,i),s=o(n);z.textContent=s?`${r} (${s})`:r}}function X(e=!1){if(!z)return;if(e&&m)try{m.removeItem("security-last")}catch{}w("https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1","security-last",n,e=>e.json()).then(e=>{Q(e)}).catch(e=>{if(e&&"stale-data"===e.message&&e.data)Q(e.data);else if("function"==typeof window.createToast){let n=t.fetchFail;e&&"offline"===e.message?n=t.offline:e&&"rate-limit"===e.message&&(n=t.rateLimit),window.createToast(n)}})}z&&X();const V=document.getElementById("advisories-list");function Z(t){if(V){for(;V.firstChild;)V.removeChild(V.firstChild);Array.isArray(t)&&t.length>0?t.forEach(e=>{const t=document.createElement("li"),n=document.createElement("a");n.href=e.html_url,n.target="_blank",n.rel="noopener noreferrer",n.textContent=e.summary||e.ghsa_id||e.id,t.appendChild(n);const a=e.published_at||e.created_at;if(a){const e=document.createElement("span");e.className="adv-time",e.textContent=o(new Date(a)),t.appendChild(document.createTextNode(" ")),t.appendChild(e)}V.appendChild(t)}):V.textContent=e?"موردی یافت نشد.":"No advisories found."}}function ee(a=!1,i=null){if(!V)return;for(;V.firstChild;)V.removeChild(V.firstChild);i&&(i.classList.add("loading"),i.setAttribute("aria-busy","true"));const o="security-advisories";if(a&&m)try{m.removeItem(o)}catch{}w("/assets/data/security-advisories.json",o,n,e=>e.json()).then(e=>{Z(e)}).catch(n=>{if(n&&"stale-data"===n.message&&n.data?Z(n.data):V.textContent=e?"خطا در دریافت اعلان‌ها.":"Failed to load advisories.","function"==typeof window.createToast){let e=t.fetchFail;n&&"offline"===n.message?e=t.offline:n&&"rate-limit"===n.message&&(e=t.rateLimit),window.createToast(e)}}).finally(()=>{i&&(i.classList.remove("loading"),i.removeAttribute("aria-busy"))})}if(p=document.getElementById("refresh-advisories"),p&&p.addEventListener("click",()=>ee(!0,p)),V){const e=()=>ee();"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(e,1e3)}y&&y.addEventListener("click",()=>R(!0,y)),k&&(k.addEventListener("click",()=>{if(N=!N,m)try{m.setItem("timeline-sort",N?"asc":"desc")}catch{}$(),F(S),q(),x&&x.dispatchEvent(new Event("input"))}),$()),x&&(document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();"/"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),x.focus())}),document.addEventListener("keydown",e=>{const t=document.activeElement.tagName.toLowerCase();"r"!==e.key&&"R"!==e.key||"input"===t||"textarea"===t||e.ctrlKey||e.metaKey||e.altKey||(e.preventDefault(),R(!0),ee(!0))})),document.querySelectorAll("#share-page, #share-page-button").forEach(e=>{e.addEventListener("click",()=>{navigator.share?navigator.share({title:document.title,url:location.href}).catch(()=>g(location.href)):g(location.href)})});const te=document.getElementById("scroll-to-top"),ne=document.getElementById("share-page-button");function ae(){const e=window.scrollY>200;te&&te.classList.toggle("visible",e),ne&&ne.classList.toggle("visible",e)}window.addEventListener("scroll",ae,{passive:!0}),ae(),te&&te.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("online",()=>{b(),"function"==typeof window.createToast&&window.createToast(t.online),R(!0),ee(!0),J(!0),X(!0)}),window.addEventListener("offline",()=>{b(),"function"==typeof window.createToast&&window.createToast(t.offline)}),window.addEventListener("beforeunload",()=>{j&&(clearInterval(j),j=null),M&&(clearTimeout(M),M=null)}),b()})}();
//# sourceMappingURL=security-page.min.js.map
