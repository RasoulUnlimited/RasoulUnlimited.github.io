{"version":3,"file":"theme-toggle.min.js","names":["document","addEventListener","toggle","getElementById","THEME_KEY","DARK","LIGHT","root","documentElement","body","isValidTheme","value","storage","window","testKey","localStorage","setItem","removeItem","getSafeStorage","mediaQuery","matchMedia","getStoredTheme","getItem","getCurrentTheme","attr","getAttribute","stored","matches","isCheckable","el","HTMLInputElement","type","dispatchThemeEvent","theme","isDark","event","detail","CustomEvent","bubbles","cancelable","createEvent","initCustomEvent","createThemeChangeEvent","dispatchEvent","applyTheme","persist","setAttribute","classList","checked","String","syncToggleState","persistTheme","toggleTheme","hasAttribute","input","key","preventDefault","handleSystemChange","addListener","storageArea","newValue","__themeToggle","constants"],"sources":["theme-toggle.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// js/theme-toggle.js\r\n// Accessible, robust, and framework-agnostic theme toggle\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const toggle = document.getElementById(\"theme-toggle\");\r\n  if (!toggle) {return;}\r\n\r\n  // Namespaced key برای کاهش احتمال تداخل با اسکریپت‌های دیگر\r\n  const THEME_KEY = \"app:theme\";\r\n  const DARK = \"dark\";\r\n  const LIGHT = \"light\";\r\n\r\n  const root = document.documentElement;\r\n  const body = document.body;\r\n\r\n  // --- Helpers ---\r\n\r\n  /**\r\n   * فقط مقادیر مجاز تم\r\n   * @param {string | null} value\r\n   * @returns {value is \"dark\" | \"light\"}\r\n   */\r\n  function isValidTheme(value) {\r\n    return value === DARK || value === LIGHT;\r\n  }\r\n\r\n  /**\r\n   * بررسی امن بودن localStorage\r\n   * - هم وجود window/localStorage\r\n   * - هم قابلیت write/read (برای private mode و ... )\r\n   */\r\n  function getSafeStorage() {\r\n    if (typeof window === \"undefined\" || !(\"localStorage\" in window)) {\r\n      return null;\r\n    }\r\n\r\n    const testKey = \"__theme_toggle__\";\r\n    try {\r\n      window.localStorage.setItem(testKey, testKey);\r\n      window.localStorage.removeItem(testKey);\r\n      return window.localStorage;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\r\n\r\n  // --- System preference ---\r\n\r\n  const mediaQuery =\r\n    typeof window !== \"undefined\" && \"matchMedia\" in window\r\n      ? window.matchMedia(\"(prefers-color-scheme: dark)\")\r\n      : null;\r\n\r\n  function getStoredTheme() {\r\n    if (!storage) {return null;}\r\n    const value = storage.getItem(THEME_KEY);\r\n    return isValidTheme(value) ? value : null;\r\n  }\r\n\r\n  function getSystemTheme() {\r\n    if (!mediaQuery) {return LIGHT;}\r\n    return mediaQuery.matches ? DARK : LIGHT;\r\n  }\r\n\r\n  function getCurrentTheme() {\r\n    // احترام به چیزی که سرور روی data-theme ست کرده\r\n    const attr = root.getAttribute(\"data-theme\");\r\n    if (isValidTheme(attr)) {return /** @type {\"dark\" | \"light\"} */ (attr);}\r\n\r\n    const stored = getStoredTheme();\r\n    if (stored) {return stored;}\r\n\r\n    return getSystemTheme();\r\n  }\r\n\r\n  function isCheckableInput(el) {\r\n    return (\r\n      el instanceof HTMLInputElement &&\r\n      (el.type === \"checkbox\" || el.type === \"radio\")\r\n    );\r\n  }\r\n\r\n  const isCheckable = isCheckableInput(toggle);\r\n\r\n  function syncToggleState(isDark) {\r\n    if (isCheckable) {\r\n      /** @type {HTMLInputElement} */ (toggle).checked = isDark;\r\n      toggle.setAttribute(\"aria-checked\", String(isDark));\r\n    } else {\r\n      toggle.setAttribute(\"aria-pressed\", String(isDark));\r\n    }\r\n  }\r\n\r\n  function persistTheme(theme) {\r\n    if (!storage) {return;}\r\n    if (!isValidTheme(theme)) {return;}\r\n\r\n    try {\r\n      storage.setItem(THEME_KEY, theme);\r\n    } catch {\r\n      // ignore storage errors (e.g. private mode)\r\n    }\r\n  }\r\n\r\n  // CustomEvent fallback برای مرورگرهای قدیمی‌تر\r\n  function createThemeChangeEvent(theme, isDark) {\r\n    const detail = { theme, isDark };\r\n    try {\r\n      return new CustomEvent(\"themechange\", {\r\n        detail,\r\n        bubbles: true,\r\n        cancelable: false,\r\n      });\r\n    } catch {\r\n      // Fallback برای مرورگرهایی که سازنده‌ی CustomEvent را ندارند\r\n      const event = document.createEvent(\"CustomEvent\");\r\n      event.initCustomEvent(\"themechange\", true, false, detail);\r\n      return event;\r\n    }\r\n  }\r\n\r\n  function dispatchThemeEvent(theme, isDark) {\r\n    try {\r\n      const event = createThemeChangeEvent(theme, isDark);\r\n      window.dispatchEvent(event);\r\n      // در صورت نیاز، می‌تونی روی document هم dispatch کنی:\r\n      // document.dispatchEvent(event);\r\n    } catch {\r\n      // اگر حتی این هم ساپورت نشه، نادیده می‌گیریم\r\n    }\r\n  }\r\n\r\n  /**\r\n   * تم را اعمال می‌کند و:\r\n   * - data-theme را ست می‌کند\r\n   * - کلاس‌ها روی html/body\r\n   * - color-scheme\r\n   * - وضعیت سوییچ\r\n   * - ارسال event\r\n   */\r\n  function applyTheme(theme, { persist = true } = {}) {\r\n    if (!isValidTheme(theme)) {return;}\r\n\r\n    const isDark = theme === DARK;\r\n\r\n    // data-theme برای CSSهای تم‌محور\r\n    root.setAttribute(\"data-theme\", theme);\r\n\r\n    // کلاس‌های عمومی تم روی html و body\r\n    root.classList.toggle(\"dark-mode\", isDark);\r\n    root.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    if (body) {\r\n      body.classList.toggle(\"dark-mode\", isDark);\r\n      body.classList.toggle(\"light-mode\", !isDark);\r\n    }\r\n\r\n    // ساپورت سبک Tailwind: .dark\r\n    root.classList.toggle(\"dark\", isDark);\r\n\r\n    // color-scheme (CSP-safe): از data attribute استفاده می‌کنیم و CSS مقدار رو اعمال می‌کنه\r\n    // (نوشتن root.style.colorScheme یک style attribute ایجاد می‌کنه و با CSP style-src-attr بلاک می‌شه)\r\n    root.setAttribute(\"data-color-scheme\", isDark ? \"dark\" : \"light\");\r\n\r\n    // همگام‌سازی وضعیت خود سوییچ (ARIA + visual)\r\n    syncToggleState(isDark);\r\n\r\n    if (persist) {\r\n      persistTheme(theme);\r\n    }\r\n\r\n    // اطلاع دادن به بقیه‌ی اسکریپت‌ها\r\n    dispatchThemeEvent(theme, isDark);\r\n  }\r\n\r\n  function toggleTheme() {\r\n    const current = getCurrentTheme();\r\n    const next = current === DARK ? LIGHT : DARK;\r\n    applyTheme(next);\r\n  }\r\n\r\n  // --- Accessibility defaults ---\r\n\r\n  if (!toggle.hasAttribute(\"role\")) {\r\n    // برای inputهای checkable، switch؛ برای بقیه، button\r\n    toggle.setAttribute(\"role\", isCheckable ? \"switch\" : \"button\");\r\n  }\r\n\r\n  if (!toggle.hasAttribute(\"tabindex\") && !(toggle instanceof HTMLInputElement)) {\r\n    // برای المنت‌های غیر-focussable مثل <div>\r\n    toggle.setAttribute(\"tabindex\", \"0\");\r\n  }\r\n\r\n  if (\r\n    !toggle.hasAttribute(\"aria-label\") &&\r\n    !toggle.hasAttribute(\"aria-labelledby\")\r\n  ) {\r\n    toggle.setAttribute(\"aria-label\", \"Toggle dark mode\");\r\n  }\r\n\r\n  // برای screen reader ها، ARIA state اولیه\r\n  if (isCheckable && !toggle.hasAttribute(\"aria-checked\")) {\r\n    toggle.setAttribute(\"aria-checked\", \"false\");\r\n  } else if (!isCheckable && !toggle.hasAttribute(\"aria-pressed\")) {\r\n    toggle.setAttribute(\"aria-pressed\", \"false\");\r\n  }\r\n\r\n  // --- Init theme ---\r\n  // از تم فعلی (data-theme)، یا ذخیره‌شده، یا سیستم استفاده می‌کنیم\r\n  const initialTheme = getCurrentTheme();\r\n  applyTheme(initialTheme, { persist: false });\r\n\r\n  // --- Event listeners ---\r\n\r\n  if (isCheckable) {\r\n    const input = /** @type {HTMLInputElement} */ (toggle);\r\n\r\n    // Mouse / touch change برای input[type=checkbox]/radio\r\n    input.addEventListener(\"change\", () => {\r\n      const next = input.checked ? DARK : LIGHT;\r\n      applyTheme(next);\r\n    });\r\n\r\n    // Keyboard accessibility: Enter (Space خودش به‌صورت native چک‌باکس را هندل می‌کند)\r\n    input.addEventListener(\"keydown\", (event) => {\r\n      if (event.key === \"Enter\") {\r\n        event.preventDefault();\r\n        input.checked = !input.checked;\r\n        const next = input.checked ? DARK : LIGHT;\r\n        applyTheme(next);\r\n      }\r\n    });\r\n  } else {\r\n    // برای المنت‌های غیر-checkbox (مثلاً دکمه سفارشی)\r\n    toggle.addEventListener(\"click\", (event) => {\r\n      event.preventDefault();\r\n      toggleTheme();\r\n    });\r\n\r\n    // Keyboard accessibility: Enter & Space برای دکمه سفارشی\r\n    toggle.addEventListener(\"keydown\", (event) => {\r\n      if (\r\n        event.key === \"Enter\" ||\r\n        event.key === \" \" ||\r\n        event.key === \"Spacebar\"\r\n      ) {\r\n        event.preventDefault();\r\n        toggleTheme();\r\n      }\r\n    });\r\n  }\r\n\r\n  // --- واکنش به تغییر تم سیستم، فقط وقتی کاربر چیزی تو localStorage نذاشته ---\r\n\r\n  function handleSystemChange(event) {\r\n    // اگر کاربر ترجیح خودش رو ذخیره کرده، به سیستم گوش نده\r\n    const hasUserPreference = !!getStoredTheme();\r\n    if (hasUserPreference) {return;}\r\n\r\n    const isDark = event.matches;\r\n    applyTheme(isDark ? DARK : LIGHT, { persist: false });\r\n  }\r\n\r\n  if (mediaQuery) {\r\n    if (typeof mediaQuery.addEventListener === \"function\") {\r\n      mediaQuery.addEventListener(\"change\", handleSystemChange);\r\n    } else if (typeof mediaQuery.addListener === \"function\") {\r\n      // برای مرورگرهای قدیمی‌تر\r\n      mediaQuery.addListener(handleSystemChange);\r\n    }\r\n  }\r\n\r\n  // --- همگام‌سازی بین تب‌ها از طریق localStorage ---\r\n\r\n  if (storage && typeof window !== \"undefined\") {\r\n    window.addEventListener(\"storage\", (event) => {\r\n      if (event.key !== THEME_KEY) {return;}\r\n      if (event.storageArea && event.storageArea !== window.localStorage) {return;}\r\n\r\n      const value = event.newValue;\r\n      // اگر key حذف شده، کاری نکنیم و بذاریم منطق فعلی بمونه\r\n      if (value === null) {return;}\r\n\r\n      if (isValidTheme(value)) {\r\n        // اینجا persist:false چون خود storage event یعنی از یه تب دیگه ذخیره شده\r\n        applyTheme(value, { persist: false });\r\n      }\r\n    });\r\n  }\r\n\r\n  // --- API عمومی برای اسکریپت‌های دیگر (بهبود توسعه‌پذیری) ---\r\n\r\n  if (typeof window !== \"undefined\") {\r\n    window.__themeToggle = {\r\n      getCurrentTheme,\r\n      applyTheme,\r\n      toggleTheme,\r\n      isDark: () => getCurrentTheme() === DARK,\r\n      constants: { DARK, LIGHT, THEME_KEY },\r\n    };\r\n  }\r\n});\r\n"]}