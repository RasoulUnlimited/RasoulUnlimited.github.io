{"version":3,"file":"theme-toggle.min.js","names":["document","addEventListener","toggle","getElementById","THEME_KEY","DARK","LIGHT","storage","testKey","localStorage","setItem","removeItem","err","getSafeStorage","mediaQuery","window","matchMedia","getStoredTheme","value","getItem","getSystemTheme","matches","applyTheme","theme","persist","isDark","documentElement","setAttribute","classList","body","checked","String","hasAttribute","isCheckbox","tagName","type","toggleTheme","attr","getAttribute","getCurrentTheme","event","preventDefault","key","handleSystemChange","addListener"],"sources":["theme-toggle.js"],"mappings":"AAGAA,SAASC,iBAAiB,mBAAoB,KAC5C,MAAMC,EAASF,SAASG,eAAe,gBACvC,IAAKD,EAAS,OAEd,MAAME,EAAY,QACZC,EAAO,OACPC,EAAQ,QAcRC,EAXN,WACE,MAAMC,EAAU,mBAChB,IAGE,OAFAC,aAAaC,QAAQF,EAASA,GAC9BC,aAAaE,WAAWH,GACjBC,YACT,CAAE,MAAOG,GACP,OAAO,IACT,CACF,CAEgBC,GACVC,EAAaC,OAAOC,WAAW,gCAErC,SAASC,IACP,IAAKV,EAAU,OAAO,KACtB,MAAMW,EAAQX,EAAQY,QAAQf,GAC9B,OAAOc,IAAUb,GAAQa,IAAUZ,EAAQY,EAAQ,IACrD,CAEA,SAASE,IACP,OAAON,EAAWO,QAAUhB,EAAOC,CACrC,CAUA,SAASgB,EAAWC,GAAOC,QAAEA,GAAU,GAAS,CAAC,GAC/C,MAAMC,EAASF,IAAUlB,EAqBzB,GAlBAL,SAAS0B,gBAAgBC,aAAa,aAAcJ,GAGpDvB,SAAS0B,gBAAgBE,UAAU1B,OAAO,YAAauB,GACvDzB,SAAS0B,gBAAgBE,UAAU1B,OAAO,cAAeuB,GACzDzB,SAAS6B,KAAKD,UAAU1B,OAAO,YAAauB,GAC5CzB,SAAS6B,KAAKD,UAAU1B,OAAO,cAAeuB,GAG9CzB,SAAS0B,gBAAgBE,UAAU1B,OAAO,OAAQuB,GAG9C,YAAavB,EACfA,EAAO4B,QAAUL,EAEjBvB,EAAOyB,aAAa,eAAgBI,OAAON,IAGzCD,GAAWjB,EACb,IACEA,EAAQG,QAAQN,EAAWmB,EAC7B,CAAE,MAEF,CAEJ,CAGA,IAAKrB,EAAO8B,aAAa,QAAS,CAEhC,MAAMC,EACe,UAAnB/B,EAAOgC,UACU,aAAhBhC,EAAOiC,MAAuC,UAAhBjC,EAAOiC,MACxCjC,EAAOyB,aAAa,OAAQM,EAAa,SAAW,SACtD,CAUA,SAASG,IAGPd,EA3DF,WACE,MAAMe,EAAOrC,SAAS0B,gBAAgBY,aAAa,cACnD,OAAID,IAAShC,GAAQgC,IAAS/B,EAAe+B,EAC9BpB,KAERG,GACT,CAmDkBmB,KACSlC,EAAOC,EAAQD,EAE1C,CAZKH,EAAO8B,aAAa,eAAkB9B,EAAO8B,aAAa,oBAC7D9B,EAAOyB,aAAa,aAAc,oBAKpCL,EADqBL,KAAoBG,IAChB,CAAEI,SAAS,IASpCtB,EAAOD,iBAAiB,SAAU,KAC5B,YAAaC,EAEfoB,EADapB,EAAO4B,QAAUzB,EAAOC,GAGrC8B,MAKJlC,EAAOD,iBAAiB,QAAUuC,IAC1B,YAAatC,IACjBsC,EAAMC,iBACNL,OAKJlC,EAAOD,iBAAiB,UAAYuC,IAChB,UAAdA,EAAME,KAAiC,MAAdF,EAAME,MACjCF,EAAMC,iBAEF,YAAavC,IACfA,EAAO4B,SAAW5B,EAAO4B,SAE3BM,OAKJ,MAAMO,EAAsBH,IACEvB,KAE5BK,EAAWkB,EAAMnB,QAAUhB,EAAOC,EAAO,CAAEkB,SAAS,KAGX,mBAAhCV,EAAWb,iBACpBa,EAAWb,iBAAiB,SAAU0C,GACK,mBAA3B7B,EAAW8B,aAE3B9B,EAAW8B,YAAYD","ignoreList":[],"sourcesContent":["// js/theme-toggle.js\r\n// Shared, accessible, and robust theme toggle script\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const toggle = document.getElementById(\"theme-toggle\");\r\n  if (!toggle) {return;}\r\n\r\n  const THEME_KEY = \"theme\";\r\n  const DARK = \"dark\";\r\n  const LIGHT = \"light\";\r\n\r\n  // Safe localStorage wrapper\r\n  function getSafeStorage() {\r\n    const testKey = \"__theme_toggle__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch (err) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\r\n  const mediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\");\r\n\r\n  function getStoredTheme() {\r\n    if (!storage) {return null;}\r\n    const value = storage.getItem(THEME_KEY);\r\n    return value === DARK || value === LIGHT ? value : null;\r\n  }\r\n\r\n  function getSystemTheme() {\r\n    return mediaQuery.matches ? DARK : LIGHT;\r\n  }\r\n\r\n  function getCurrentTheme() {\r\n    const attr = document.documentElement.getAttribute(\"data-theme\");\r\n    if (attr === DARK || attr === LIGHT) {return attr;}\r\n    const stored = getStoredTheme();\r\n    if (stored) {return stored;}\r\n    return getSystemTheme();\r\n  }\r\n\r\n  function applyTheme(theme, { persist = true } = {}) {\r\n    const isDark = theme === DARK;\r\n\r\n    // data-theme برای CSSهای تم‌محور\r\n    document.documentElement.setAttribute(\"data-theme\", theme);\r\n\r\n    // کلاس‌های عمومی تم روی html و body\r\n    document.documentElement.classList.toggle(\"dark-mode\", isDark);\r\n    document.documentElement.classList.toggle(\"light-mode\", !isDark);\r\n    document.body.classList.toggle(\"dark-mode\", isDark);\r\n    document.body.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    // ساپورت سبک Tailwind: .dark\r\n    document.documentElement.classList.toggle(\"dark\", isDark);\r\n\r\n    // همگام‌سازی وضعیت خود سوییچ\r\n    if (\"checked\" in toggle) {\r\n      toggle.checked = isDark;\r\n    } else {\r\n      toggle.setAttribute(\"aria-pressed\", String(isDark));\r\n    }\r\n\r\n    if (persist && storage) {\r\n      try {\r\n        storage.setItem(THEME_KEY, theme);\r\n      } catch {\r\n        // ignore storage errors (e.g. private mode)\r\n      }\r\n    }\r\n  }\r\n\r\n  // Accessibility defaults (درصورتی که از HTML ست نشده باشن)\r\n  if (!toggle.hasAttribute(\"role\")) {\r\n    // اگر input[type=checkbox] است، نقش switch براش منطقی‌تره\r\n    const isCheckbox =\r\n      toggle.tagName === \"INPUT\" &&\r\n      (toggle.type === \"checkbox\" || toggle.type === \"radio\");\r\n    toggle.setAttribute(\"role\", isCheckbox ? \"switch\" : \"button\");\r\n  }\r\n\r\n  if (!toggle.hasAttribute(\"aria-label\") && !toggle.hasAttribute(\"aria-labelledby\")) {\r\n    toggle.setAttribute(\"aria-label\", \"Toggle dark mode\");\r\n  }\r\n\r\n  // Init theme (بدون persist، فقط sync اولیه)\r\n  const initialTheme = getStoredTheme() ?? getSystemTheme();\r\n  applyTheme(initialTheme, { persist: false });\r\n\r\n  function toggleTheme() {\r\n    const current = getCurrentTheme();\r\n    const next = current === DARK ? LIGHT : DARK;\r\n    applyTheme(next);\r\n  }\r\n\r\n  // Mouse / touch change برای checkboxها\r\n  toggle.addEventListener(\"change\", () => {\r\n    if (\"checked\" in toggle) {\r\n      const next = toggle.checked ? DARK : LIGHT;\r\n      applyTheme(next);\r\n    } else {\r\n      toggleTheme();\r\n    }\r\n  });\r\n\r\n  // برای المنت‌هایی که checkbox نیستند (مثلاً دکمه سفارشی)\r\n  toggle.addEventListener(\"click\", (event) => {\r\n    if (!(\"checked\" in toggle)) {\r\n      event.preventDefault();\r\n      toggleTheme();\r\n    }\r\n  });\r\n\r\n  // Keyboard accessibility: Enter & Space\r\n  toggle.addEventListener(\"keydown\", (event) => {\r\n    if (event.key === \"Enter\" || event.key === \" \") {\r\n      event.preventDefault();\r\n\r\n      if (\"checked\" in toggle) {\r\n        toggle.checked = !toggle.checked;\r\n      }\r\n      toggleTheme();\r\n    }\r\n  });\r\n\r\n  // واکنش به تغییر تم سیستم، فقط وقتی کاربر چیزی تو localStorage نذاشته\r\n  const handleSystemChange = (event) => {\r\n    const hasUserPreference = !!getStoredTheme();\r\n    if (hasUserPreference) {return;}\r\n    applyTheme(event.matches ? DARK : LIGHT, { persist: false });\r\n  };\r\n\r\n  if (typeof mediaQuery.addEventListener === \"function\") {\r\n    mediaQuery.addEventListener(\"change\", handleSystemChange);\r\n  } else if (typeof mediaQuery.addListener === \"function\") {\r\n    // برای مرورگرهای قدیمی‌تر\r\n    mediaQuery.addListener(handleSystemChange);\r\n  }\r\n});\r\n"]}