{"version":3,"file":"theme-toggle.min.js","names":["document","addEventListener","toggle","getElementById","THEME_KEY","DARK","LIGHT","getSafeStorage","testKey","localStorage","setItem","removeItem","err","storage","mediaQuery","window","matchMedia","getStoredTheme","value","getItem","getSystemTheme","matches","getCurrentTheme","attr","documentElement","getAttribute","stored","applyTheme","theme","persist","isDark","setAttribute","classList","body","checked","String","hasAttribute","isCheckbox","tagName","type","toggleTheme","event","preventDefault","key","handleSystemChange","addListener"],"sources":["theme-toggle.js"],"mappings":"AAGAA,SAASC,iBAAiB,mBAAoB,KAC5C,MAAMC,EAASF,SAASG,eAAe,gBACvC,IAAKD,EAAS,OAEd,MAAME,EAAY,QACZC,EAAO,OACPC,EAAQ,QAGd,SAASC,IACP,MAAMC,EAAU,mBAChB,IAGE,OAFAC,aAAaC,QAAQF,EAASA,GAC9BC,aAAaE,WAAWH,GACjBC,YACT,CAAE,MAAOG,GACP,OAAO,IACT,CACF,CAEA,MAAMC,EAAUN,IACVO,EAAaC,OAAOC,WAAW,gCAErC,SAASC,IACP,IAAKJ,EAAU,OAAO,KACtB,MAAMK,EAAQL,EAAQM,QAAQf,GAC9B,OAAOc,IAAUb,GAAQa,IAAUZ,EAAQY,EAAQ,IACrD,CAEA,SAASE,IACP,OAAON,EAAWO,QAAUhB,EAAOC,CACrC,CAEA,SAASgB,IACP,MAAMC,EAAOvB,SAASwB,gBAAgBC,aAAa,cACnD,GAAIF,IAASlB,GAAQkB,IAASjB,EAAQ,OAAOiB,EAC7C,MAAMG,EAAST,IACf,OAAIS,GACGN,GACT,CAEA,SAASO,EAAWC,GAAOC,QAAEA,GAAU,GAAS,CAAC,GAC/C,MAAMC,EAASF,IAAUvB,EAqBzB,GAlBAL,SAASwB,gBAAgBO,aAAa,aAAcH,GAGpD5B,SAASwB,gBAAgBQ,UAAU9B,OAAO,YAAa4B,GACvD9B,SAASwB,gBAAgBQ,UAAU9B,OAAO,cAAe4B,GACzD9B,SAASiC,KAAKD,UAAU9B,OAAO,YAAa4B,GAC5C9B,SAASiC,KAAKD,UAAU9B,OAAO,cAAe4B,GAG9C9B,SAASwB,gBAAgBQ,UAAU9B,OAAO,OAAQ4B,GAG9C,YAAa5B,EACfA,EAAOgC,QAAUJ,EAEjB5B,EAAO6B,aAAa,eAAgBI,OAAOL,IAGzCD,GAAWhB,EACb,IACEA,EAAQH,QAAQN,EAAWwB,EAC7B,CAAE,MAEF,CAEJ,CAGA,IAAK1B,EAAOkC,aAAa,QAAS,CAEhC,MAAMC,EACe,UAAnBnC,EAAOoC,UACU,aAAhBpC,EAAOqC,MAAuC,UAAhBrC,EAAOqC,MACxCrC,EAAO6B,aAAa,OAAQM,EAAa,SAAW,SACtD,CAEKnC,EAAOkC,aAAa,eAAkBlC,EAAOkC,aAAa,oBAC7DlC,EAAO6B,aAAa,aAAc,oBAOpC,SAASS,IAGPb,EAFgBL,MACSjB,EAAOC,EAAQD,EAE1C,CANAsB,EADqBV,KAAoBG,IAChB,CAAES,SAAS,IASpC3B,EAAOD,iBAAiB,SAAU,KAChC,GAAI,YAAaC,EAAQ,CAEvByB,EADazB,EAAOgC,QAAU7B,EAAOC,EAEvC,MACEkC,MAKJtC,EAAOD,iBAAiB,QAAUwC,IAC1B,YAAavC,IACjBuC,EAAMC,iBACNF,OAKJtC,EAAOD,iBAAiB,UAAYwC,IAChB,UAAdA,EAAME,KAAiC,MAAdF,EAAME,MACjCF,EAAMC,iBAEF,YAAaxC,IACfA,EAAOgC,SAAWhC,EAAOgC,SAE3BM,OAKJ,MAAMI,EAAsBH,MACExB,KAE5BU,EAAWc,EAAMpB,QAAUhB,EAAOC,EAAO,CAAEuB,SAAS,KAGX,mBAAhCf,EAAWb,iBACpBa,EAAWb,iBAAiB,SAAU2C,GACK,mBAA3B9B,EAAW+B,aAE3B/B,EAAW+B,YAAYD","ignoreList":[],"sourcesContent":["// js/theme-toggle.js\r\n// Shared, accessible, and robust theme toggle script\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const toggle = document.getElementById(\"theme-toggle\");\r\n  if (!toggle) {return;}\r\n\r\n  const THEME_KEY = \"theme\";\r\n  const DARK = \"dark\";\r\n  const LIGHT = \"light\";\r\n\r\n  // Safe localStorage wrapper\r\n  function getSafeStorage() {\r\n    const testKey = \"__theme_toggle__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch (err) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\r\n  const mediaQuery = window.matchMedia(\"(prefers-color-scheme: dark)\");\r\n\r\n  function getStoredTheme() {\r\n    if (!storage) {return null;}\r\n    const value = storage.getItem(THEME_KEY);\r\n    return value === DARK || value === LIGHT ? value : null;\r\n  }\r\n\r\n  function getSystemTheme() {\r\n    return mediaQuery.matches ? DARK : LIGHT;\r\n  }\r\n\r\n  function getCurrentTheme() {\r\n    const attr = document.documentElement.getAttribute(\"data-theme\");\r\n    if (attr === DARK || attr === LIGHT) {return attr;}\r\n    const stored = getStoredTheme();\r\n    if (stored) {return stored;}\r\n    return getSystemTheme();\r\n  }\r\n\r\n  function applyTheme(theme, { persist = true } = {}) {\r\n    const isDark = theme === DARK;\r\n\r\n    // data-theme برای CSSهای تم‌محور\r\n    document.documentElement.setAttribute(\"data-theme\", theme);\r\n\r\n    // کلاس‌های عمومی تم روی html و body\r\n    document.documentElement.classList.toggle(\"dark-mode\", isDark);\r\n    document.documentElement.classList.toggle(\"light-mode\", !isDark);\r\n    document.body.classList.toggle(\"dark-mode\", isDark);\r\n    document.body.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    // ساپورت سبک Tailwind: .dark\r\n    document.documentElement.classList.toggle(\"dark\", isDark);\r\n\r\n    // همگام‌سازی وضعیت خود سوییچ\r\n    if (\"checked\" in toggle) {\r\n      toggle.checked = isDark;\r\n    } else {\r\n      toggle.setAttribute(\"aria-pressed\", String(isDark));\r\n    }\r\n\r\n    if (persist && storage) {\r\n      try {\r\n        storage.setItem(THEME_KEY, theme);\r\n      } catch {\r\n        // ignore storage errors (e.g. private mode)\r\n      }\r\n    }\r\n  }\r\n\r\n  // Accessibility defaults (درصورتی که از HTML ست نشده باشن)\r\n  if (!toggle.hasAttribute(\"role\")) {\r\n    // اگر input[type=checkbox] است، نقش switch براش منطقی‌تره\r\n    const isCheckbox =\r\n      toggle.tagName === \"INPUT\" &&\r\n      (toggle.type === \"checkbox\" || toggle.type === \"radio\");\r\n    toggle.setAttribute(\"role\", isCheckbox ? \"switch\" : \"button\");\r\n  }\r\n\r\n  if (!toggle.hasAttribute(\"aria-label\") && !toggle.hasAttribute(\"aria-labelledby\")) {\r\n    toggle.setAttribute(\"aria-label\", \"Toggle dark mode\");\r\n  }\r\n\r\n  // Init theme (بدون persist، فقط sync اولیه)\r\n  const initialTheme = getStoredTheme() ?? getSystemTheme();\r\n  applyTheme(initialTheme, { persist: false });\r\n\r\n  function toggleTheme() {\r\n    const current = getCurrentTheme();\r\n    const next = current === DARK ? LIGHT : DARK;\r\n    applyTheme(next);\r\n  }\r\n\r\n  // Mouse / touch change برای checkboxها\r\n  toggle.addEventListener(\"change\", () => {\r\n    if (\"checked\" in toggle) {\r\n      const next = toggle.checked ? DARK : LIGHT;\r\n      applyTheme(next);\r\n    } else {\r\n      toggleTheme();\r\n    }\r\n  });\r\n\r\n  // برای المنت‌هایی که checkbox نیستند (مثلاً دکمه سفارشی)\r\n  toggle.addEventListener(\"click\", (event) => {\r\n    if (!(\"checked\" in toggle)) {\r\n      event.preventDefault();\r\n      toggleTheme();\r\n    }\r\n  });\r\n\r\n  // Keyboard accessibility: Enter & Space\r\n  toggle.addEventListener(\"keydown\", (event) => {\r\n    if (event.key === \"Enter\" || event.key === \" \") {\r\n      event.preventDefault();\r\n\r\n      if (\"checked\" in toggle) {\r\n        toggle.checked = !toggle.checked;\r\n      }\r\n      toggleTheme();\r\n    }\r\n  });\r\n\r\n  // واکنش به تغییر تم سیستم، فقط وقتی کاربر چیزی تو localStorage نذاشته\r\n  const handleSystemChange = (event) => {\r\n    const hasUserPreference = !!getStoredTheme();\r\n    if (hasUserPreference) {return;}\r\n    applyTheme(event.matches ? DARK : LIGHT, { persist: false });\r\n  };\r\n\r\n  if (typeof mediaQuery.addEventListener === \"function\") {\r\n    mediaQuery.addEventListener(\"change\", handleSystemChange);\r\n  } else if (typeof mediaQuery.addListener === \"function\") {\r\n    // برای مرورگرهای قدیمی‌تر\r\n    mediaQuery.addListener(handleSystemChange);\r\n  }\r\n});\r\n"]}