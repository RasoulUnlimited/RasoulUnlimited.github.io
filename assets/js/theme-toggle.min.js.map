{"version":3,"file":"theme-toggle.min.js","names":["document","addEventListener","toggle","getElementById","THEME_KEY","DARK","LIGHT","root","documentElement","body","storage","testKey","localStorage","setItem","removeItem","getSafeStorage","mediaQuery","window","matchMedia","getStoredTheme","value","getItem","getCurrentTheme","attr","getAttribute","stored","matches","isCheckable","el","HTMLInputElement","type","dispatchThemeEvent","theme","isDark","event","CustomEvent","detail","createEvent","initCustomEvent","createThemeChangeEvent","dispatchEvent","applyTheme","persist","setAttribute","classList","style","colorScheme","checked","String","syncToggleState","persistTheme","toggleTheme","hasAttribute","input","key","preventDefault","handleSystemChange","addListener","storageArea","newValue"],"sources":["theme-toggle.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// js/theme-toggle.js\r\n// Accessible, robust, and framework-agnostic theme toggle\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n  const toggle = document.getElementById(\"theme-toggle\");\r\n  if (!toggle) return;\r\n\r\n  const THEME_KEY = \"theme\";\r\n  const DARK = \"dark\";\r\n  const LIGHT = \"light\";\r\n\r\n  const root = document.documentElement;\r\n  const body = document.body;\r\n\r\n  // --- Safe localStorage wrapper ---\r\n\r\n  function getSafeStorage() {\r\n    const testKey = \"__theme_toggle__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\r\n\r\n  // --- System preference ---\r\n\r\n  const mediaQuery =\r\n    typeof window !== \"undefined\" && \"matchMedia\" in window\r\n      ? window.matchMedia(\"(prefers-color-scheme: dark)\")\r\n      : null;\r\n\r\n  function getStoredTheme() {\r\n    if (!storage) return null;\r\n    const value = storage.getItem(THEME_KEY);\r\n    return value === DARK || value === LIGHT ? value : null;\r\n  }\r\n\r\n  function getSystemTheme() {\r\n    if (!mediaQuery) return LIGHT;\r\n    return mediaQuery.matches ? DARK : LIGHT;\r\n  }\r\n\r\n  function getCurrentTheme() {\r\n    // احترام به چیزی که سرور روی data-theme ست کرده\r\n    const attr = root.getAttribute(\"data-theme\");\r\n    if (attr === DARK || attr === LIGHT) return attr;\r\n\r\n    const stored = getStoredTheme();\r\n    if (stored) return stored;\r\n\r\n    return getSystemTheme();\r\n  }\r\n\r\n  // --- Helpers ---\r\n\r\n  function isCheckableInput(el) {\r\n    return (\r\n      el instanceof HTMLInputElement &&\r\n      (el.type === \"checkbox\" || el.type === \"radio\")\r\n    );\r\n  }\r\n\r\n  const isCheckable = isCheckableInput(toggle);\r\n\r\n  function syncToggleState(isDark) {\r\n    if (isCheckable) {\r\n      // برای inputهای checkable\r\n      /** @type {HTMLInputElement} */ (toggle).checked = isDark;\r\n\r\n      // برای screen readerها\r\n      toggle.setAttribute(\"aria-checked\", String(isDark));\r\n    } else {\r\n      // برای المنت‌های غیر-input (مثلاً button سفارشی)\r\n      toggle.setAttribute(\"aria-pressed\", String(isDark));\r\n    }\r\n  }\r\n\r\n  function persistTheme(theme) {\r\n    if (!storage) return;\r\n    try {\r\n      storage.setItem(THEME_KEY, theme);\r\n    } catch {\r\n      // ignore storage errors (e.g. private mode)\r\n    }\r\n  }\r\n\r\n  // CustomEvent fallback برای مرورگرهای قدیمی‌تر\r\n  function createThemeChangeEvent(theme, isDark) {\r\n    try {\r\n      return new CustomEvent(\"themechange\", {\r\n        detail: { theme, isDark },\r\n      });\r\n    } catch {\r\n      // Fallback برای مرورگرهایی که سازنده‌ی CustomEvent را ندارند\r\n      const event = document.createEvent(\"CustomEvent\");\r\n      event.initCustomEvent(\r\n        \"themechange\",\r\n        false, // bubbles\r\n        false, // cancelable\r\n        { theme, isDark }\r\n      );\r\n      return event;\r\n    }\r\n  }\r\n\r\n  function dispatchThemeEvent(theme, isDark) {\r\n    try {\r\n      const event = createThemeChangeEvent(theme, isDark);\r\n      window.dispatchEvent(event);\r\n    } catch {\r\n      // اگر حتی این هم ساپورت نشه، نادیده می‌گیریم\r\n    }\r\n  }\r\n\r\n  function applyTheme(theme, { persist = true } = {}) {\r\n    if (theme !== DARK && theme !== LIGHT) return;\r\n\r\n    const isDark = theme === DARK;\r\n\r\n    // data-theme برای CSSهای تم‌محور\r\n    root.setAttribute(\"data-theme\", theme);\r\n\r\n    // کلاس‌های عمومی تم روی html و body\r\n    root.classList.toggle(\"dark-mode\", isDark);\r\n    root.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    if (body) {\r\n      body.classList.toggle(\"dark-mode\", isDark);\r\n      body.classList.toggle(\"light-mode\", !isDark);\r\n    }\r\n\r\n    // ساپورت سبک Tailwind: .dark\r\n    root.classList.toggle(\"dark\", isDark);\r\n\r\n    // color-scheme برای اسکرول‌بار و کنترل‌های سیستم\r\n    try {\r\n      root.style.colorScheme = isDark ? \"dark\" : \"light\";\r\n    } catch {\r\n      // اگر ساپورت نشه، نادیده بگیر\r\n    }\r\n\r\n    // همگام‌سازی وضعیت خود سوییچ\r\n    syncToggleState(isDark);\r\n\r\n    if (persist) {\r\n      persistTheme(theme);\r\n    }\r\n\r\n    // اطلاع دادن به بقیه‌ی اسکریپت‌ها\r\n    dispatchThemeEvent(theme, isDark);\r\n  }\r\n\r\n  function toggleTheme() {\r\n    const current = getCurrentTheme();\r\n    const next = current === DARK ? LIGHT : DARK;\r\n    applyTheme(next);\r\n  }\r\n\r\n  // --- Accessibility defaults ---\r\n\r\n  if (!toggle.hasAttribute(\"role\")) {\r\n    // برای inputهای checkable، switch؛ برای بقیه، button\r\n    toggle.setAttribute(\"role\", isCheckable ? \"switch\" : \"button\");\r\n  }\r\n\r\n  if (!toggle.hasAttribute(\"tabindex\") && !(toggle instanceof HTMLInputElement)) {\r\n    // برای المنت‌های غیر-focussable مثل <div>\r\n    toggle.setAttribute(\"tabindex\", \"0\");\r\n  }\r\n\r\n  if (\r\n    !toggle.hasAttribute(\"aria-label\") &&\r\n    !toggle.hasAttribute(\"aria-labelledby\")\r\n  ) {\r\n    toggle.setAttribute(\"aria-label\", \"Toggle dark mode\");\r\n  }\r\n\r\n  // برای screen reader ها، اگر checkable باشد\r\n  if (isCheckable && !toggle.hasAttribute(\"aria-checked\")) {\r\n    toggle.setAttribute(\"aria-checked\", \"false\");\r\n  }\r\n\r\n  // --- Init theme ---\r\n  // از تم فعلی (data-theme)، یا ذخیره‌شده، یا سیستم استفاده می‌کنیم\r\n  const initialTheme = getCurrentTheme();\r\n  applyTheme(initialTheme, { persist: false });\r\n\r\n  // --- Event listeners ---\r\n\r\n  if (isCheckable) {\r\n    const input = /** @type {HTMLInputElement} */ (toggle);\r\n\r\n    // Mouse / touch change برای input[type=checkbox]/radio\r\n    input.addEventListener(\"change\", () => {\r\n      const next = input.checked ? DARK : LIGHT;\r\n      applyTheme(next);\r\n    });\r\n\r\n    // Keyboard accessibility: Enter (Space خودش به‌صورت native چک‌باکس را هندل می‌کند)\r\n    input.addEventListener(\"keydown\", (event) => {\r\n      if (event.key === \"Enter\") {\r\n        event.preventDefault();\r\n        input.checked = !input.checked;\r\n        const next = input.checked ? DARK : LIGHT;\r\n        applyTheme(next);\r\n      }\r\n    });\r\n  } else {\r\n    // برای المنت‌های غیر-checkbox (مثلاً دکمه سفارشی)\r\n    toggle.addEventListener(\"click\", (event) => {\r\n      event.preventDefault();\r\n      toggleTheme();\r\n    });\r\n\r\n    // Keyboard accessibility: Enter & Space برای دکمه سفارشی\r\n    toggle.addEventListener(\"keydown\", (event) => {\r\n      if (\r\n        event.key === \"Enter\" ||\r\n        event.key === \" \" ||\r\n        event.key === \"Spacebar\"\r\n      ) {\r\n        event.preventDefault();\r\n        toggleTheme();\r\n      }\r\n    });\r\n  }\r\n\r\n  // --- واکنش به تغییر تم سیستم، فقط وقتی کاربر چیزی تو localStorage نذاشته ---\r\n\r\n  function handleSystemChange(event) {\r\n    const hasUserPreference = !!getStoredTheme();\r\n    if (hasUserPreference) return;\r\n\r\n    const isDark = event.matches;\r\n    applyTheme(isDark ? DARK : LIGHT, { persist: false });\r\n  }\r\n\r\n  if (mediaQuery) {\r\n    if (typeof mediaQuery.addEventListener === \"function\") {\r\n      mediaQuery.addEventListener(\"change\", handleSystemChange);\r\n    } else if (typeof mediaQuery.addListener === \"function\") {\r\n      // برای مرورگرهای قدیمی‌تر\r\n      mediaQuery.addListener(handleSystemChange);\r\n    }\r\n  }\r\n\r\n  // --- همگام‌سازی بین تب‌ها از طریق localStorage ---\r\n\r\n  if (storage && typeof window !== \"undefined\") {\r\n    window.addEventListener(\"storage\", (event) => {\r\n      if (event.key !== THEME_KEY) return;\r\n      if (event.storageArea && event.storageArea !== localStorage) return;\r\n\r\n      const value = event.newValue;\r\n      if (value === DARK || value === LIGHT) {\r\n        // اینجا persist:false چون خود storage event یعنی از یه تب دیگه ذخیره شده\r\n        applyTheme(value, { persist: false });\r\n      }\r\n    });\r\n  }\r\n});\r\n"]}