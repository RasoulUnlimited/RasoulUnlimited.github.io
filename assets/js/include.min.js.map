{"version":3,"file":"include.min.js","names":["ORIGIN","window","location","origin","INCLUDE_CACHE_PREFIX","TRUSTED_SCRIPT_PATH_PREFIXES","document","documentElement","getAttribute","navigator","language","toLowerCase","indexOf","sleep","ms","Promise","resolve","setTimeout","includeStorage","key","localStorage","setItem","removeItem","getStorage","getCacheKey","file","url","URL","pathname","writeCachedInclude","html","value","JSON","stringify","t","Date","now","entries","i","length","startsWith","timestamp","payload","parse","getItem","Number","push","sort","a","b","slice","Math","ceil","forEach","entry","evictOldestIncludeCacheEntries","sanitizeNode","node","nodeType","Node","ELEMENT_NODE","Array","from","attributes","attr","name","removeAttribute","tagName","includes","remove","attrName","getAttributeNS","trim","removeAttributeNS","childNodes","COMMENT_NODE","PROCESSING_INSTRUCTION_NODE","applyIncludedHtml","el","stale","doc","DOMParser","parseFromString","querySelector","Error","body","parseAndSanitizeHtml","cspSourceScript","globalNonce","nonce","innerHTML","firstChild","appendChild","test","yearSpan","textContent","String","getFullYear","querySelectorAll","oldScript","src","some","prefix","isScriptTrusted","newScript","createElement","safeAttributes","setAttribute","parentNode","replaceChild","renderIncludeFallback","fallback","className","async","fetchWithTimeout","controller","AbortController","timer","abort","fetch","credentials","cache","signal","clearTimeout","loadIncludeHtml","lastError","attempt","resp","ok","status","text","err","delay","floor","random","fetchIncludeHtml","networkErr","cachedHtml","raw","readCachedInclude","console","warn","includeHTML","callback","elements","error","fetches","dataset","includeLoaded","includePending","fetchPromise","all","addEventListener","normalize","path","replace","current","link","href","classList","parentElement","linkPath","isActive","toggle","setActiveNavLink","dispatchEvent","Event"],"sources":["include.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\n  \"use strict\";\n\n  const ORIGIN = window.location.origin;\n  const INCLUDE_CACHE_PREFIX = \"ru-include-v2::\";\n  const INCLUDE_CACHE_TTL_MS = 7 * 24 * 60 * 60 * 1000;\n  const INCLUDE_FETCH_TIMEOUT_MS = 7000;\n  const INCLUDE_FETCH_ATTEMPTS = 3;\n  const INCLUDE_RETRY_BASE_MS = 350;\n\n  const docLang = (\n    document.documentElement.getAttribute(\"lang\") ||\n    navigator.language ||\n    \"\"\n  ).toLowerCase();\n  const isFa = docLang.indexOf(\"fa\") === 0;\n\n  const TRUSTED_SCRIPT_PATH_PREFIXES = [\"/assets/js/\", \"/includes/\"];\n\n  function sleep(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  function getStorage() {\n    try {\n      const key = \"__ru_include_storage_probe__\";\n      localStorage.setItem(key, \"1\");\n      localStorage.removeItem(key);\n      return localStorage;\n    } catch {\n      return null;\n    }\n  }\n\n  const includeStorage = getStorage();\n\n  function getCacheKey(file) {\n    try {\n      const url = new URL(file, ORIGIN);\n      return INCLUDE_CACHE_PREFIX + url.pathname;\n    } catch {\n      return INCLUDE_CACHE_PREFIX + file;\n    }\n  }\n\n  function evictOldestIncludeCacheEntries() {\n    if (!includeStorage) {\n      return;\n    }\n\n    const entries = [];\n\n    for (let i = 0; i < includeStorage.length; i++) {\n      const key = includeStorage.key(i);\n      if (!key || !key.startsWith(INCLUDE_CACHE_PREFIX)) {\n        continue;\n      }\n\n      let timestamp = 0;\n      try {\n        const payload = JSON.parse(includeStorage.getItem(key) || \"{}\");\n        timestamp = Number(payload.t) || 0;\n      } catch {\n        timestamp = 0;\n      }\n\n      entries.push({ key, timestamp });\n    }\n\n    if (!entries.length) {\n      return;\n    }\n\n    entries\n      .sort((a, b) => a.timestamp - b.timestamp)\n      .slice(0, Math.ceil(entries.length / 2))\n      .forEach((entry) => {\n        try {\n          includeStorage.removeItem(entry.key);\n        } catch {\n          // Ignore cleanup failures.\n        }\n      });\n  }\n\n  function writeCachedInclude(file, html) {\n    if (!includeStorage || !html) {\n      return;\n    }\n\n    const key = getCacheKey(file);\n    const value = JSON.stringify({ t: Date.now(), html });\n\n    try {\n      includeStorage.setItem(key, value);\n    } catch {\n      evictOldestIncludeCacheEntries();\n\n      try {\n        includeStorage.setItem(key, value);\n      } catch {\n        // Ignore quota failures.\n      }\n    }\n  }\n\n  function readCachedInclude(file) {\n    if (!includeStorage) {\n      return null;\n    }\n\n    const key = getCacheKey(file);\n    const raw = includeStorage.getItem(key);\n\n    if (!raw) {\n      return null;\n    }\n\n    try {\n      const payload = JSON.parse(raw);\n      const timestamp = Number(payload.t) || 0;\n      const html = typeof payload.html === \"string\" ? payload.html : \"\";\n\n      if (!html) {\n        includeStorage.removeItem(key);\n        return null;\n      }\n\n      if (Date.now() - timestamp > INCLUDE_CACHE_TTL_MS) {\n        includeStorage.removeItem(key);\n        return null;\n      }\n\n      return html;\n    } catch {\n      includeStorage.removeItem(key);\n      return null;\n    }\n  }\n\n  function isScriptTrusted(src) {\n    if (!src) {\n      return true;\n    }\n\n    try {\n      const url = new URL(src, ORIGIN);\n      if (url.origin !== ORIGIN) {\n        return false;\n      }\n      return TRUSTED_SCRIPT_PATH_PREFIXES.some((prefix) =>\n        url.pathname.startsWith(prefix)\n      );\n    } catch {\n      return false;\n    }\n  }\n\n  function sanitizeNode(node) {\n    if (!node) {\n      return;\n    }\n\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      const attrs = Array.from(node.attributes);\n      attrs.forEach((attr) => {\n        if (attr.name.toLowerCase().startsWith(\"on\")) {\n          node.removeAttribute(attr.name);\n        }\n      });\n\n      const tagName = node.tagName.toLowerCase();\n\n      if ([\"object\", \"embed\", \"iframe\"].includes(tagName)) {\n        node.remove();\n        return;\n      }\n\n      const attributesToCheck = [\"href\", \"xlink:href\", \"action\", \"formaction\"];\n      attributesToCheck.forEach((attrName) => {\n        let value = node.getAttribute(attrName);\n\n        if (!value && attrName === \"xlink:href\") {\n          value = node.getAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\");\n        }\n\n        // eslint-disable-next-line no-script-url\n        if (value && value.toLowerCase().trim().startsWith(\"javascript:\")) {\n          node.removeAttribute(attrName);\n          if (attrName === \"xlink:href\") {\n            node.removeAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\");\n          }\n        }\n      });\n\n      Array.from(node.childNodes).forEach(sanitizeNode);\n      return;\n    }\n\n    if (\n      node.nodeType === Node.COMMENT_NODE ||\n      node.nodeType === Node.PROCESSING_INSTRUCTION_NODE\n    ) {\n      node.remove();\n    }\n  }\n\n  function parseAndSanitizeHtml(file, html) {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, \"text/html\");\n\n    if (doc.querySelector(\"parsererror\")) {\n      throw new Error(\"Failed to parse HTML for \" + file);\n    }\n\n    Array.from(doc.body.childNodes).forEach(sanitizeNode);\n    return doc;\n  }\n\n  function applyIncludedHtml(el, file, html, stale) {\n    const doc = parseAndSanitizeHtml(file, html);\n    const cspSourceScript = document.querySelector(\"script[data-csp-nonce]\");\n    const globalNonce = cspSourceScript?.nonce || null;\n\n    el.innerHTML = \"\";\n\n    while (doc.body && doc.body.firstChild) {\n      el.appendChild(doc.body.firstChild);\n    }\n\n    if (/footer\\.html$/i.test(file)) {\n      const yearSpan =\n        el.querySelector(\"#footer-year\") || el.querySelector(\"#current-year\");\n      if (yearSpan) {\n        yearSpan.textContent = String(new Date().getFullYear());\n      }\n    }\n\n    const scripts = el.querySelectorAll(\"script\");\n    scripts.forEach((oldScript) => {\n      if (oldScript.src && !isScriptTrusted(oldScript.src)) {\n        oldScript.remove();\n        return;\n      }\n\n      const newScript = document.createElement(\"script\");\n      const safeAttributes = [\"type\", \"async\", \"defer\", \"charset\", \"id\", \"class\"];\n\n      for (const attr of oldScript.attributes) {\n        if (safeAttributes.includes(attr.name) || attr.name.startsWith(\"data-\")) {\n          newScript.setAttribute(attr.name, attr.value);\n        }\n      }\n\n      if (globalNonce) {\n        newScript.nonce = globalNonce;\n      }\n\n      if (oldScript.src) {\n        newScript.src = oldScript.src;\n      } else {\n        newScript.textContent = oldScript.textContent;\n      }\n\n      oldScript.parentNode.replaceChild(newScript, oldScript);\n    });\n\n    if (stale) {\n      el.setAttribute(\"data-include-stale\", \"true\");\n    } else {\n      el.removeAttribute(\"data-include-stale\");\n    }\n\n    el.removeAttribute(\"data-include-failed\");\n  }\n\n  function renderIncludeFallback(el) {\n    const fallback = document.createElement(\"div\");\n    fallback.className = \"include-fallback\";\n    fallback.setAttribute(\"role\", \"status\");\n    fallback.setAttribute(\"aria-live\", \"polite\");\n    fallback.textContent = isFa\n      ? \"This section is temporarily unavailable. Please refresh when your connection is stable.\"\n      : \"This section is temporarily unavailable. Please refresh when your connection is stable.\";\n\n    el.innerHTML = \"\";\n    el.appendChild(fallback);\n    el.setAttribute(\"data-include-failed\", \"true\");\n    el.removeAttribute(\"data-include-stale\");\n  }\n\n  async function fetchWithTimeout(file) {\n    const hasAbortController = typeof AbortController === \"function\";\n    const controller = hasAbortController ? new AbortController() : null;\n    let timer = null;\n    if (controller) {\n      timer = setTimeout(() => {\n        controller.abort();\n      }, INCLUDE_FETCH_TIMEOUT_MS);\n    }\n\n    try {\n      return await fetch(file, {\n        credentials: \"same-origin\",\n        cache: \"no-cache\",\n        ...(controller ? { signal: controller.signal } : {}),\n      });\n    } finally {\n      if (timer) {\n        clearTimeout(timer);\n      }\n    }\n  }\n\n  async function fetchIncludeHtml(file) {\n    let lastError = null;\n\n    for (let attempt = 1; attempt <= INCLUDE_FETCH_ATTEMPTS; attempt++) {\n      try {\n        const resp = await fetchWithTimeout(file);\n\n        if (!resp.ok) {\n          throw new Error(\"HTTP \" + resp.status + \" for \" + file);\n        }\n\n        return await resp.text();\n      } catch (err) {\n        lastError = err;\n\n        if (attempt < INCLUDE_FETCH_ATTEMPTS) {\n          const delay = INCLUDE_RETRY_BASE_MS * 2 ** (attempt - 1) + Math.floor(Math.random() * 120);\n          await sleep(delay);\n        }\n      }\n    }\n\n    throw lastError || new Error(\"Unknown include fetch error for \" + file);\n  }\n\n  async function loadIncludeHtml(file) {\n    try {\n      const html = await fetchIncludeHtml(file);\n      writeCachedInclude(file, html);\n      return { html, stale: false };\n    } catch (networkErr) {\n      const cachedHtml = readCachedInclude(file);\n      if (cachedHtml) {\n        console.warn(\"Using stale include cache for\", file, networkErr);\n        return { html: cachedHtml, stale: true };\n      }\n      throw networkErr;\n    }\n  }\n\n  /**\n   * Inject external HTML fragments into elements with [data-include-html].\n   * @param {Function} [callback]\n   * @returns {Promise<void>}\n   */\n  async function includeHTML(callback) {\n    const elements = document.querySelectorAll(\"[data-include-html]\");\n\n    if (!elements.length) {\n      if (typeof callback === \"function\") {\n        try {\n          callback();\n        } catch (err) {\n          console.error(\"includeHTML callback error:\", err);\n        }\n      }\n      return;\n    }\n\n    const fetches = [];\n\n    for (const el of elements) {\n      if (el.dataset.includeLoaded === \"true\" || el.dataset.includePending === \"true\") {\n        continue;\n      }\n\n      const file = el.getAttribute(\"data-include-html\");\n      if (!file) {\n        continue;\n      }\n\n      try {\n        const fileUrl = new URL(file, ORIGIN);\n        if (fileUrl.origin !== ORIGIN) {\n          console.error(\"Blocked cross-origin include:\", file);\n          continue;\n        }\n      } catch {\n        console.error(\"Invalid include URL:\", file);\n        continue;\n      }\n\n      el.dataset.includePending = \"true\";\n\n      const fetchPromise = (async () => {\n        try {\n          const { html, stale } = await loadIncludeHtml(file);\n          applyIncludedHtml(el, file, html, stale);\n          el.dataset.includeLoaded = \"true\";\n          el.removeAttribute(\"data-include-html\");\n        } catch (err) {\n          console.error(\"Include error for\", file, err);\n          renderIncludeFallback(el);\n        } finally {\n          delete el.dataset.includePending;\n        }\n      })();\n\n      fetches.push(fetchPromise);\n    }\n\n    await Promise.all(fetches);\n\n    if (typeof callback === \"function\") {\n      try {\n        callback();\n      } catch (err) {\n        console.error(\"includeHTML callback error:\", err);\n      }\n    }\n  }\n\n  /**\n   * Marks current page link as active in navbar.\n   */\n  function setActiveNavLink() {\n    const normalize = (path) =>\n      (path || \"/\")\n        .replace(/\\/index\\.html$/i, \"/\")\n        .replace(/\\/+$/, \"/\") || \"/\";\n\n    const current = normalize(window.location.pathname);\n\n    document.querySelectorAll(\".navbar nav a\").forEach((link) => {\n      const href = link.getAttribute(\"href\") || \"\";\n\n      if (\n        href.startsWith(\"#\") ||\n        href.startsWith(\"mailto:\") ||\n        // eslint-disable-next-line no-script-url\n        href.startsWith(\"javascript:\")\n      ) {\n        link.classList.remove(\"active\");\n        link.removeAttribute(\"aria-current\");\n        if (link.parentElement && link.parentElement.tagName === \"LI\") {\n          link.parentElement.classList.remove(\"active\");\n        }\n        return;\n      }\n\n      let linkPath = \"\";\n      try {\n        const url = new URL(href, ORIGIN);\n        linkPath = normalize(url.pathname);\n      } catch {\n        linkPath = \"\";\n      }\n\n      const isActive = linkPath === current;\n      link.classList.toggle(\"active\", isActive);\n\n      if (isActive) {\n        link.setAttribute(\"aria-current\", \"page\");\n      } else {\n        link.removeAttribute(\"aria-current\");\n      }\n\n      if (link.parentElement && link.parentElement.tagName === \"LI\") {\n        link.parentElement.classList.toggle(\"active\", isActive);\n      }\n    });\n  }\n\n  function bootIncludes() {\n    includeHTML(() => {\n      setActiveNavLink();\n      document.dispatchEvent(new Event(\"includesLoaded\"));\n    });\n  }\n\n  document.addEventListener(\"DOMContentLoaded\", bootIncludes);\n\n  window.addEventListener(\"online\", () => {\n    if (document.querySelector(\"[data-include-html]\")) {\n      includeHTML();\n    }\n  });\n\n  window.includeHTML = includeHTML;\n})();\n"]}