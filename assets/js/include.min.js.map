{"version":3,"file":"include.min.js","names":["ORIGIN","window","location","origin","INCLUDE_CACHE_PREFIX","TRUSTED_SCRIPT_PATH_PREFIXES","includeInflightRequests","Map","includeRetryState","WeakMap","sleep","ms","Promise","resolve","setTimeout","dispatchIncludeEvent","name","detail","dispatchEvent","CustomEvent","includeStorage","key","localStorage","setItem","removeItem","getStorage","getCacheKey","file","url","URL","pathname","writeCachedInclude","html","value","JSON","stringify","t","Date","now","entries","i","length","startsWith","timestamp","payload","parse","getItem","Number","push","sort","a","b","slice","Math","ceil","forEach","entry","evictOldestIncludeCacheEntries","readCachedInclude","raw","sanitizeNode","node","nodeType","Node","ELEMENT_NODE","Array","from","attributes","attr","toLowerCase","removeAttribute","tagName","includes","remove","attrName","getAttribute","getAttributeNS","trim","removeAttributeNS","childNodes","COMMENT_NODE","PROCESSING_INSTRUCTION_NODE","clearScheduledIncludeRetry","el","state","get","timerId","clearTimeout","delete","dataset","includeRetryAttempt","scheduleIncludeRetry","navigator","onLine","attempts","String","delay","floor","random","document","documentElement","contains","includeLoaded","includePending","source","setAttribute","includeHTML","set","applyIncludedHtml","stale","doc","DOMParser","parseFromString","querySelector","Error","body","parseAndSanitizeHtml","cspSourceScript","globalNonce","nonce","innerHTML","firstChild","appendChild","test","yearSpan","textContent","getFullYear","querySelectorAll","oldScript","src","some","prefix","isScriptTrusted","newScript","createElement","safeAttributes","parentNode","replaceChild","renderIncludeFallback","retryable","canRetry","fallback","className","retryWrap","retryButton","type","addEventListener","async","fetchWithTimeout","controller","AbortController","timer","abort","fetch","credentials","cache","signal","loadIncludeHtml","has","pending","lastError","attempt","resp","ok","status","text","err","fetchIncludeHtml","networkErr","cachedHtml","console","warn","callback","elements","error","fetches","fileUrl","reason","fetchPromise","applyErr","message","all","normalize","path","replace","current","link","href","classList","parentElement","linkPath","isActive","toggle","setActiveNavLink","Event"],"sources":["include.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\n  \"use strict\";\n\n  const ORIGIN = window.location.origin;\n  const INCLUDE_CACHE_PREFIX = \"ru-include-v2::\";\n  const INCLUDE_CACHE_TTL_MS = 7 * 24 * 60 * 60 * 1000;\n  const INCLUDE_FETCH_TIMEOUT_MS = 7000;\n  const INCLUDE_FETCH_ATTEMPTS = 3;\n  const INCLUDE_RETRY_BASE_MS = 350;\n  const INCLUDE_AUTORETRY_BASE_MS = 1200;\n  const INCLUDE_AUTORETRY_MAX_ATTEMPTS = 4;\n  const INCLUDE_RETRY_JITTER_MS = 220;\n\n  const TRUSTED_SCRIPT_PATH_PREFIXES = [\"/assets/js/\", \"/includes/\"];\n  const includeInflightRequests = new Map();\n  const includeRetryState = new WeakMap();\n\n  function sleep(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n  }\n\n  function dispatchIncludeEvent(name, detail) {\n    try {\n      window.dispatchEvent(\n        new CustomEvent(name, {\n          detail: detail || {},\n        })\n      );\n    } catch {\n      // Ignore event dispatch failures in old environments.\n    }\n  }\n\n  function getStorage() {\n    try {\n      const key = \"__ru_include_storage_probe__\";\n      localStorage.setItem(key, \"1\");\n      localStorage.removeItem(key);\n      return localStorage;\n    } catch {\n      return null;\n    }\n  }\n\n  const includeStorage = getStorage();\n\n  function getCacheKey(file) {\n    try {\n      const url = new URL(file, ORIGIN);\n      return INCLUDE_CACHE_PREFIX + url.pathname;\n    } catch {\n      return INCLUDE_CACHE_PREFIX + file;\n    }\n  }\n\n  function evictOldestIncludeCacheEntries() {\n    if (!includeStorage) {\n      return;\n    }\n\n    const entries = [];\n\n    for (let i = 0; i < includeStorage.length; i++) {\n      const key = includeStorage.key(i);\n      if (!key || !key.startsWith(INCLUDE_CACHE_PREFIX)) {\n        continue;\n      }\n\n      let timestamp = 0;\n      try {\n        const payload = JSON.parse(includeStorage.getItem(key) || \"{}\");\n        timestamp = Number(payload.t) || 0;\n      } catch {\n        timestamp = 0;\n      }\n\n      entries.push({ key, timestamp });\n    }\n\n    if (!entries.length) {\n      return;\n    }\n\n    entries\n      .sort((a, b) => a.timestamp - b.timestamp)\n      .slice(0, Math.ceil(entries.length / 2))\n      .forEach((entry) => {\n        try {\n          includeStorage.removeItem(entry.key);\n        } catch {\n          // Ignore cleanup failures.\n        }\n      });\n  }\n\n  function writeCachedInclude(file, html) {\n    if (!includeStorage || !html) {\n      return;\n    }\n\n    const key = getCacheKey(file);\n    const value = JSON.stringify({ t: Date.now(), html });\n\n    try {\n      includeStorage.setItem(key, value);\n    } catch {\n      evictOldestIncludeCacheEntries();\n\n      try {\n        includeStorage.setItem(key, value);\n      } catch {\n        // Ignore quota failures.\n      }\n    }\n  }\n\n  function readCachedInclude(file) {\n    if (!includeStorage) {\n      return null;\n    }\n\n    const key = getCacheKey(file);\n    const raw = includeStorage.getItem(key);\n\n    if (!raw) {\n      return null;\n    }\n\n    try {\n      const payload = JSON.parse(raw);\n      const timestamp = Number(payload.t) || 0;\n      const html = typeof payload.html === \"string\" ? payload.html : \"\";\n\n      if (!html) {\n        includeStorage.removeItem(key);\n        return null;\n      }\n\n      if (Date.now() - timestamp > INCLUDE_CACHE_TTL_MS) {\n        includeStorage.removeItem(key);\n        return null;\n      }\n\n      return html;\n    } catch {\n      includeStorage.removeItem(key);\n      return null;\n    }\n  }\n\n  function isScriptTrusted(src) {\n    if (!src) {\n      return true;\n    }\n\n    try {\n      const url = new URL(src, ORIGIN);\n      if (url.origin !== ORIGIN) {\n        return false;\n      }\n      return TRUSTED_SCRIPT_PATH_PREFIXES.some((prefix) =>\n        url.pathname.startsWith(prefix)\n      );\n    } catch {\n      return false;\n    }\n  }\n\n  function sanitizeNode(node) {\n    if (!node) {\n      return;\n    }\n\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      const attrs = Array.from(node.attributes);\n      attrs.forEach((attr) => {\n        if (attr.name.toLowerCase().startsWith(\"on\")) {\n          node.removeAttribute(attr.name);\n        }\n      });\n\n      const tagName = node.tagName.toLowerCase();\n\n      if ([\"object\", \"embed\", \"iframe\"].includes(tagName)) {\n        node.remove();\n        return;\n      }\n\n      const attributesToCheck = [\"href\", \"xlink:href\", \"action\", \"formaction\"];\n      attributesToCheck.forEach((attrName) => {\n        let value = node.getAttribute(attrName);\n\n        if (!value && attrName === \"xlink:href\") {\n          value = node.getAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\");\n        }\n\n        // eslint-disable-next-line no-script-url\n        if (value && value.toLowerCase().trim().startsWith(\"javascript:\")) {\n          node.removeAttribute(attrName);\n          if (attrName === \"xlink:href\") {\n            node.removeAttributeNS(\"http://www.w3.org/1999/xlink\", \"href\");\n          }\n        }\n      });\n\n      Array.from(node.childNodes).forEach(sanitizeNode);\n      return;\n    }\n\n    if (\n      node.nodeType === Node.COMMENT_NODE ||\n      node.nodeType === Node.PROCESSING_INSTRUCTION_NODE\n    ) {\n      node.remove();\n    }\n  }\n\n  function parseAndSanitizeHtml(file, html) {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, \"text/html\");\n\n    if (doc.querySelector(\"parsererror\")) {\n      throw new Error(\"Failed to parse HTML for \" + file);\n    }\n\n    Array.from(doc.body.childNodes).forEach(sanitizeNode);\n    return doc;\n  }\n\n  function isOnline() {\n    return navigator.onLine !== false;\n  }\n\n  function clearScheduledIncludeRetry(el) {\n    const state = includeRetryState.get(el);\n    if (!state) {\n      return;\n    }\n\n    if (state.timerId) {\n      clearTimeout(state.timerId);\n    }\n\n    includeRetryState.delete(el);\n    delete el.dataset.includeRetryAttempt;\n  }\n\n  function scheduleIncludeRetry(el, file) {\n    if (!isOnline()) {\n      return;\n    }\n\n    const state = includeRetryState.get(el) || { attempts: 0, timerId: null };\n    if (state.timerId) {\n      return;\n    }\n\n    if (state.attempts >= INCLUDE_AUTORETRY_MAX_ATTEMPTS) {\n      return;\n    }\n\n    state.attempts += 1;\n    el.dataset.includeRetryAttempt = String(state.attempts);\n\n    const delay =\n      INCLUDE_AUTORETRY_BASE_MS * 2 ** (state.attempts - 1) +\n      Math.floor(Math.random() * INCLUDE_RETRY_JITTER_MS);\n\n    state.timerId = setTimeout(() => {\n      state.timerId = null;\n\n      if (!document.documentElement.contains(el)) {\n        clearScheduledIncludeRetry(el);\n        return;\n      }\n\n      if (el.dataset.includeLoaded === \"true\" || el.dataset.includePending === \"true\") {\n        clearScheduledIncludeRetry(el);\n        return;\n      }\n\n      const source = el.getAttribute(\"data-include-html\") || file;\n      if (!source) {\n        clearScheduledIncludeRetry(el);\n        return;\n      }\n\n      el.setAttribute(\"data-include-html\", source);\n      includeHTML();\n    }, delay);\n\n    includeRetryState.set(el, state);\n  }\n\n  function applyIncludedHtml(el, file, html, stale) {\n    const doc = parseAndSanitizeHtml(file, html);\n    const cspSourceScript = document.querySelector(\"script[data-csp-nonce]\");\n    const globalNonce = cspSourceScript?.nonce || null;\n\n    el.innerHTML = \"\";\n\n    while (doc.body && doc.body.firstChild) {\n      el.appendChild(doc.body.firstChild);\n    }\n\n    if (/footer\\.html$/i.test(file)) {\n      const yearSpan =\n        el.querySelector(\"#footer-year\") || el.querySelector(\"#current-year\");\n      if (yearSpan) {\n        yearSpan.textContent = String(new Date().getFullYear());\n      }\n    }\n\n    const scripts = el.querySelectorAll(\"script\");\n    scripts.forEach((oldScript) => {\n      if (oldScript.src && !isScriptTrusted(oldScript.src)) {\n        oldScript.remove();\n        return;\n      }\n\n      const newScript = document.createElement(\"script\");\n      const safeAttributes = [\"type\", \"async\", \"defer\", \"charset\", \"id\", \"class\"];\n\n      for (const attr of oldScript.attributes) {\n        if (safeAttributes.includes(attr.name) || attr.name.startsWith(\"data-\")) {\n          newScript.setAttribute(attr.name, attr.value);\n        }\n      }\n\n      if (globalNonce) {\n        newScript.nonce = globalNonce;\n      }\n\n      if (oldScript.src) {\n        newScript.src = oldScript.src;\n      } else {\n        newScript.textContent = oldScript.textContent;\n      }\n\n      oldScript.parentNode.replaceChild(newScript, oldScript);\n    });\n\n    if (stale) {\n      el.setAttribute(\"data-include-stale\", \"true\");\n    } else {\n      el.removeAttribute(\"data-include-stale\");\n    }\n\n    el.removeAttribute(\"data-include-failed\");\n    el.removeAttribute(\"data-include-retryable\");\n    el.setAttribute(\"data-include-source\", file);\n  }\n\n  function renderIncludeFallback(el, file, retryable) {\n    const canRetry = retryable !== false;\n    const fallback = document.createElement(\"div\");\n    fallback.className = \"include-fallback\";\n    fallback.setAttribute(\"role\", \"status\");\n    fallback.setAttribute(\"aria-live\", \"polite\");\n    fallback.textContent =\n      \"This section is temporarily unavailable. Please refresh when your connection is stable.\";\n\n    if (canRetry) {\n      const retryWrap = document.createElement(\"div\");\n      retryWrap.className = \"include-fallback-actions\";\n\n      const retryButton = document.createElement(\"button\");\n      retryButton.type = \"button\";\n      retryButton.className = \"include-retry\";\n      retryButton.textContent = \"Retry now\";\n      retryButton.addEventListener(\"click\", () => {\n        clearScheduledIncludeRetry(el);\n        if (el.dataset.includePending === \"true\") {\n          return;\n        }\n\n        if (file) {\n          el.setAttribute(\"data-include-html\", file);\n        }\n\n        includeHTML();\n      });\n\n      retryWrap.appendChild(retryButton);\n      fallback.appendChild(retryWrap);\n    }\n\n    el.innerHTML = \"\";\n    el.appendChild(fallback);\n    el.setAttribute(\"data-include-failed\", \"true\");\n    if (canRetry) {\n      el.setAttribute(\"data-include-retryable\", \"true\");\n    } else {\n      el.removeAttribute(\"data-include-retryable\");\n    }\n    el.removeAttribute(\"data-include-stale\");\n    if (file) {\n      el.setAttribute(\"data-include-source\", file);\n    }\n  }\n\n  async function fetchWithTimeout(file) {\n    const hasAbortController = typeof AbortController === \"function\";\n    const controller = hasAbortController ? new AbortController() : null;\n    let timer = null;\n    if (controller) {\n      timer = setTimeout(() => {\n        controller.abort();\n      }, INCLUDE_FETCH_TIMEOUT_MS);\n    }\n\n    try {\n      return await fetch(file, {\n        credentials: \"same-origin\",\n        cache: \"no-cache\",\n        ...(controller ? { signal: controller.signal } : {}),\n      });\n    } finally {\n      if (timer) {\n        clearTimeout(timer);\n      }\n    }\n  }\n\n  async function fetchIncludeHtml(file) {\n    let lastError = null;\n\n    for (let attempt = 1; attempt <= INCLUDE_FETCH_ATTEMPTS; attempt++) {\n      try {\n        const resp = await fetchWithTimeout(file);\n\n        if (!resp.ok) {\n          throw new Error(\"HTTP \" + resp.status + \" for \" + file);\n        }\n\n        return await resp.text();\n      } catch (err) {\n        lastError = err;\n\n        if (attempt < INCLUDE_FETCH_ATTEMPTS) {\n          const delay = INCLUDE_RETRY_BASE_MS * 2 ** (attempt - 1) + Math.floor(Math.random() * 120);\n          await sleep(delay);\n        }\n      }\n    }\n\n    throw lastError || new Error(\"Unknown include fetch error for \" + file);\n  }\n\n  async function loadIncludeHtml(file) {\n    if (includeInflightRequests.has(file)) {\n      return includeInflightRequests.get(file);\n    }\n\n    const pending = (async () => {\n      try {\n        const html = await fetchIncludeHtml(file);\n        return { html, stale: false };\n      } catch (networkErr) {\n        const cachedHtml = readCachedInclude(file);\n        if (cachedHtml) {\n          console.warn(\"Using stale include cache for\", file, networkErr);\n          return { html: cachedHtml, stale: true };\n        }\n        throw networkErr;\n      }\n    })();\n\n    includeInflightRequests.set(file, pending);\n\n    try {\n      return await pending;\n    } finally {\n      includeInflightRequests.delete(file);\n    }\n  }\n\n  /**\n   * Inject external HTML fragments into elements with [data-include-html].\n   * @param {Function} [callback]\n   * @returns {Promise<void>}\n   */\n  async function includeHTML(callback) {\n    const elements = document.querySelectorAll(\"[data-include-html]\");\n\n    if (!elements.length) {\n      if (typeof callback === \"function\") {\n        try {\n          callback();\n        } catch (err) {\n          console.error(\"includeHTML callback error:\", err);\n        }\n      }\n      return;\n    }\n\n    const fetches = [];\n\n    for (const el of elements) {\n      if (el.dataset.includeLoaded === \"true\" || el.dataset.includePending === \"true\") {\n        continue;\n      }\n\n      const file = el.getAttribute(\"data-include-html\");\n      if (!file) {\n        continue;\n      }\n\n      let fileUrl = null;\n      try {\n        fileUrl = new URL(file, ORIGIN);\n        if (fileUrl.origin !== ORIGIN) {\n          console.error(\"Blocked cross-origin include:\", file);\n          renderIncludeFallback(el, file, false);\n          el.removeAttribute(\"data-include-html\");\n          dispatchIncludeEvent(\"include:failed\", {\n            file,\n            reason: \"cross-origin-blocked\",\n          });\n          continue;\n        }\n      } catch {\n        console.error(\"Invalid include URL:\", file);\n        renderIncludeFallback(el, file, false);\n        el.removeAttribute(\"data-include-html\");\n        dispatchIncludeEvent(\"include:failed\", {\n          file,\n          reason: \"invalid-url\",\n        });\n        continue;\n      }\n\n      el.dataset.includePending = \"true\";\n\n      const fetchPromise = (async () => {\n        try {\n          const { html, stale } = await loadIncludeHtml(file);\n          try {\n            applyIncludedHtml(el, file, html, stale);\n          } catch (applyErr) {\n            if (!stale) {\n              const cachedHtml = readCachedInclude(file);\n              if (cachedHtml && cachedHtml !== html) {\n                applyIncludedHtml(el, file, cachedHtml, true);\n              } else {\n                throw applyErr;\n              }\n            } else {\n              throw applyErr;\n            }\n          }\n\n          if (!stale) {\n            writeCachedInclude(file, html);\n          }\n\n          el.dataset.includeLoaded = \"true\";\n          el.removeAttribute(\"data-include-html\");\n          clearScheduledIncludeRetry(el);\n          dispatchIncludeEvent(\"include:loaded\", {\n            file: fileUrl ? fileUrl.pathname : file,\n            stale,\n          });\n        } catch (err) {\n          console.error(\"Include error for\", file, err);\n          renderIncludeFallback(el, file, true);\n          scheduleIncludeRetry(el, file);\n          dispatchIncludeEvent(\"include:failed\", {\n            file: fileUrl ? fileUrl.pathname : file,\n            reason: String(err && err.message ? err.message : err),\n          });\n        } finally {\n          delete el.dataset.includePending;\n        }\n      })();\n\n      fetches.push(fetchPromise);\n    }\n\n    await Promise.all(fetches);\n\n    if (typeof callback === \"function\") {\n      try {\n        callback();\n      } catch (err) {\n        console.error(\"includeHTML callback error:\", err);\n      }\n    }\n  }\n\n  /**\n   * Marks current page link as active in navbar.\n   */\n  function setActiveNavLink() {\n    const normalize = (path) =>\n      (path || \"/\")\n        .replace(/\\/index\\.html$/i, \"/\")\n        .replace(/\\/+$/, \"/\") || \"/\";\n\n    const current = normalize(window.location.pathname);\n\n    document.querySelectorAll(\".navbar nav a\").forEach((link) => {\n      const href = link.getAttribute(\"href\") || \"\";\n\n      if (\n        href.startsWith(\"#\") ||\n        href.startsWith(\"mailto:\") ||\n        // eslint-disable-next-line no-script-url\n        href.startsWith(\"javascript:\")\n      ) {\n        link.classList.remove(\"active\");\n        link.removeAttribute(\"aria-current\");\n        if (link.parentElement && link.parentElement.tagName === \"LI\") {\n          link.parentElement.classList.remove(\"active\");\n        }\n        return;\n      }\n\n      let linkPath = \"\";\n      try {\n        const url = new URL(href, ORIGIN);\n        linkPath = normalize(url.pathname);\n      } catch {\n        linkPath = \"\";\n      }\n\n      const isActive = linkPath === current;\n      link.classList.toggle(\"active\", isActive);\n\n      if (isActive) {\n        link.setAttribute(\"aria-current\", \"page\");\n      } else {\n        link.removeAttribute(\"aria-current\");\n      }\n\n      if (link.parentElement && link.parentElement.tagName === \"LI\") {\n        link.parentElement.classList.toggle(\"active\", isActive);\n      }\n    });\n  }\n\n  function bootIncludes() {\n    includeHTML(() => {\n      setActiveNavLink();\n      document.dispatchEvent(new Event(\"includesLoaded\"));\n    });\n  }\n\n  document.addEventListener(\"DOMContentLoaded\", bootIncludes);\n\n  window.addEventListener(\"online\", () => {\n    document\n      .querySelectorAll('[data-include-stale=\"true\"][data-include-source]')\n      .forEach((el) => {\n        if (el.dataset.includePending === \"true\") {\n          return;\n        }\n\n        const source = el.getAttribute(\"data-include-source\");\n        if (!source) {\n          return;\n        }\n\n        el.setAttribute(\"data-include-html\", source);\n        delete el.dataset.includeLoaded;\n      });\n\n    if (document.querySelector(\"[data-include-html]\")) {\n      includeHTML();\n    }\n  });\n\n  window.includeHTML = includeHTML;\n})();\n"]}