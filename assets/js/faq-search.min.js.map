{"version":3,"file":"faq-search.min.js","names":["document","addEventListener","faqRoot","getElementById","lang","body","getAttribute","documentElement","STRINGS","String","toLowerCase","startsWith","clearSearch","showAll","total","noResult","term","matchCount","count","copyUnsupported","copySuccess","copyFailed","feedbackSaved","safeStorage","key","localStorage","setItem","removeItem","getSafeStorage","emitToast","message","options","window","createToast","toast","createElement","className","textContent","style","cssText","join","appendChild","requestAnimationFrame","opacity","setTimeout","remove","showLocalToast","normalizeText","input","normalize","replace","searchInput","querySelector","clearButton","faqItems","Array","from","querySelectorAll","expandAllBtn","collapseAllBtn","noResults","accordionRoot","length","hasAttribute","setAttribute","status","id","closest","parentNode","isVisible","item","hidden","display","getHeader","getPanel","openItem","Accordion","open","classList","add","header","panel","closeItem","close","async","copyText","text","hasClipboardApi","navigator","clipboard","writeText","ok","mode","legacySuccess","probe","value","position","left","top","select","execCommand","copyWithExecCommand","highlightText","root","forEach","node","parent","replaceChild","createTextNode","clearHighlights","normalizedTerm","pattern","split","map","ch","escaped","regex","RegExp","walker","createTreeWalker","NodeFilter","SHOW_TEXT","matches","nextNode","currentNode","nodeValue","contains","test","push","fragment","createDocumentFragment","part","index","span","filterFaq","inputValue","rawTerm","undefined","searchTerm","hasTerm","visibleCount","questionEl","answerEl","questionText","answerText","keywords","dataset","includes","state","isOpen","openedBySearch","trimmed","trim","updateStatus","timer","clearTimeout","event","preventDefault","focus","button","stopPropagation","hash","link","location","origin","pathname","then","result","kind","duration","original","innerHTML","catch","stored","getItem","readStoredValue","btn","wrapper","writeStoredValue","label","originalText","targetId","slice","CSS","escape","target","scrollIntoView","behavior","block"],"sources":["faq-search.js"],"mappings":"CAEA,WACE,aAEAA,SAASC,iBAAiB,mBAAoB,WAC5C,MAAMC,EAAUF,SAASG,eAAe,OACxC,IAAKD,EAAU,OAEf,MAAME,EACJJ,SAASK,KAAKC,aAAa,cAC3BN,SAASO,gBAAgBH,MACzB,GAGII,EAFOC,OAAOL,GAAMM,cAAcC,WAAW,MAG/C,CACAC,YAAa,iBACbC,QAAUC,GAAU,aAAaA,UACjCC,SAAWC,GAAS,kBAAkBA,eACtCC,WAAY,CAACC,EAAOF,IAAS,GAAGE,iBAAqBF,cACrDG,gBAAiB,sCACjBC,YAAa,eACbC,WAAY,sBACZC,cAAe,8BAEf,CACAV,YAAa,eACbC,QAAUC,GAAU,eAAeA,eACnCC,SAAWC,GAAS,yBAA0BA,MAC9CC,WAAY,CAACC,EAAOF,IAAS,GAAGE,0BAA+BF,MAC/DG,gBAAiB,gDACjBC,YAAa,eACbC,WAAY,2BACZC,cAAe,uCAcnB,MAAMC,EAXN,WACE,IACE,MAAMC,EAAM,wBAGZ,OAFAC,aAAaC,QAAQF,EAAK,KAC1BC,aAAaE,WAAWH,GACjBC,YACT,CAAE,MACA,OAAO,IACT,CACF,CAEoBG,GAmDpB,SAASC,EAAUC,EAASC,GAC1B,GAAKD,EAAL,CAGA,GAAkC,mBAAvBE,OAAOC,YAChB,IAEE,YADAD,OAAOC,YAAYH,EAASC,EAE9B,CAAE,MAAO,EAtCb,SAAwBD,GACtB,MAAMI,EAAQlC,SAASmC,cAAc,OACrCD,EAAME,UAAY,qBAClBF,EAAMG,YAAcP,EACpBI,EAAMI,MAAMC,QAAU,CACpB,iBACA,cACA,WACA,6BACA,6BACA,aACA,oBACA,qBACA,gBACA,YACA,0BACA,sBACA,oBACAC,KAAK,KAEPxC,SAASK,KAAKoC,YAAYP,GAC1BQ,sBAAsB,KACpBR,EAAMI,MAAMK,QAAU,MAExBC,WAAW,KACTV,EAAMI,MAAMK,QAAU,IACtBC,WAAW,IAAMV,EAAMW,SAAU,MAChC,KACL,CAYEC,CAAehB,EAPf,CAQF,CAEA,MAAMiB,EAAiBC,GACrBvC,OAAOuC,GAAS,IACbC,UAAU,OACVC,QAAQ,OAAQ,KAChBA,QAAQ,OAAQ,KAChBA,QAAQ,yBAA0B,IAClCA,QAAQ,kBAAmB,IAC3BxC,cAKCyC,EAAcjD,EAAQkD,cAAc,eACpCC,EAAcnD,EAAQkD,cAAc,iBACpCE,EAAWC,MAAMC,KAAKtD,EAAQuD,iBAAiB,cAC/CC,EAAexD,EAAQkD,cAAc,mBACrCO,EAAiBzD,EAAQkD,cAAc,qBACvCQ,EAAY1D,EAAQkD,cAAc,mBAClCS,EACJ3D,EAAQkD,cAAc,6BACtBlD,EAAQkD,cAAc,4BAExB,IAAKD,IAAgBE,IAAgBC,EAASQ,OAAS,OAEnDD,IAAkBA,EAAcE,aAAa,wBAC/CF,EAAcG,aAAa,sBAAuB,QAGpD,IAAIC,EAAS/D,EAAQkD,cAAc,sBAC9Ba,IACHA,EAASjE,SAASmC,cAAc,OAChC8B,EAAOC,GAAK,oBACZD,EAAO7B,UAAY,kBACnB6B,EAAOD,aAAa,YAAa,UACjCC,EAAOD,aAAa,cAAe,SAClCb,EAAYgB,QAAQ,SAAWhB,EAAYiB,YAAY3B,YAAYwB,IAGjEZ,EAAY/C,aAAa,eAC5B+C,EAAYW,aAAa,aAAcxD,EAAQI,aAGjD,MAAMyD,EAAaC,IAAUA,EAAKC,QAAiC,SAAvBD,EAAKhC,MAAMkC,QAEjDC,EAAaH,GAASA,EAAKlB,cAAc,qBACzCsB,EACHJ,GACCA,EAAKlB,cAAc,uBACnBkB,EAAKlB,cAAc,eAcjBuB,EAAYL,IAChB,GAAItC,OAAO4C,WAAaf,GAAiBS,EAAKJ,GAAI,CAEhD,GADWlC,OAAO4C,UAAUC,KAAKhB,EAAeS,EAAKJ,IAC5C,MACX,CACAI,EAAKQ,UAAUC,IAAI,WACnB,MAAMC,EAASP,EAAUH,GACnBW,EAAQP,EAASJ,GACnBU,GACFA,EAAOhB,aAAa,gBAAiB,QAEnCiB,GACFA,EAAMjB,aAAa,cAAe,UAIhCkB,EAAaZ,IACjB,GAAItC,OAAO4C,WAAaf,GAAiBS,EAAKJ,GAAI,CAEhD,GADWlC,OAAO4C,UAAUO,MAAMtB,EAAeS,EAAKJ,IAC7C,MACX,CACAI,EAAKQ,UAAUjC,OAAO,WACtB,MAAMmC,EAASP,EAAUH,GACnBW,EAAQP,EAASJ,GACnBU,GACFA,EAAOhB,aAAa,gBAAiB,SAEnCiB,GACFA,EAAMjB,aAAa,cAAe,SAiDtCoB,eAAeC,EAASC,GACtB,MAAMC,KAAqBC,UAAUC,YAAaD,UAAUC,UAAUC,WACtE,GAAIH,EACF,IAEE,aADMC,UAAUC,UAAUC,UAAUJ,GAC7B,CAAEK,IAAI,EAAMC,KAAM,YAC3B,CAAE,MAEF,CAGF,MAAMC,EAjCR,SAA6BP,GAC3B,IAAKtF,SAASK,KAAO,OAAO,EAE5B,MAAMyF,EAAQ9F,SAASmC,cAAc,YACrC2D,EAAMC,MAAQT,EACdQ,EAAM9B,aAAa,WAAY,IAC/B8B,EAAM9B,aAAa,cAAe,QAClC8B,EAAMxD,MAAM0D,SAAW,WACvBF,EAAMxD,MAAM2D,KAAO,UACnBH,EAAMxD,MAAM4D,IAAM,IAClBlG,SAASK,KAAKoC,YAAYqD,GAC1BA,EAAMK,SAEN,IACE,QAASnG,SAASoG,YAAY,OAChC,CAAE,MACA,OAAO,CACT,CAAE,QACAN,EAAMjD,QACR,CACF,CAawBwD,CAAoBf,GAC1C,OAAIO,EACK,CAAEF,IAAI,EAAMC,KAAM,eAGpB,CACLD,IAAI,EACJC,KAAML,EAAkB,mBAAqB,cAEjD,CAEA,MAAMe,EAAgB,CAACC,EAAMvF,KAC3B,IAAKuF,EAAO,OAEZ,GAzDsB,CAACA,IAClBA,GACLA,EAAK9C,iBAAiB,mBAAmB+C,QAASC,IAChD,MAAMC,EAASD,EAAKrC,WACfsC,IACLA,EAAOC,aAAa3G,SAAS4G,eAAeH,EAAKpE,aAAe,IAAKoE,GACrEC,EAAOzD,gBAkDT4D,CAAgBN,IACXvF,EAAO,OAEZ,MAAM8F,EAAiB/D,EAAc/B,GACrC,IAAK8F,EAAiB,OAEtB,MAAMC,EAAUD,EACbE,MAAM,IACNC,IAAKC,IACJ,MAAMC,EAlKV1G,OAkKiCyG,GAlKjB,IAAIhE,QAAQ,sBAAuB,QAmK/C,MAAW,MAAPgE,EAAoB,OACb,MAAPA,EAAoB,OACjBC,IAER3E,KAAK,2CACF4E,EAAQ,IAAIC,OAAO,IAAIN,KAAY,KAEnCO,EAAStH,SAASuH,iBACtBhB,EACAiB,WAAWC,UACX,MACA,GAEIC,EAAU,GAEhB,KAAOJ,EAAOK,YAAY,CACxB,MAAMlB,EAAOa,EAAOM,YACdlB,EAASD,EAAKrC,WACfsC,GAAWD,EAAKoB,YACjBnB,EAAO5B,WAAa4B,EAAO5B,UAAUgD,SAAS,mBAC9CV,EAAMW,KAAKtB,EAAKoB,YAClBH,EAAQM,KAAKvB,GAEjB,CAEAiB,EAAQlB,QAASC,IACf,MAAMwB,EAAWjI,SAASkI,yBAC1BzB,EAAKoB,UAAUb,MAAMI,GAAOZ,QAAQ,CAAC2B,EAAMC,KACzC,GAAKD,EACL,GAAIC,EAAQ,GAAM,EAAG,CACnB,MAAMC,EAAOrI,SAASmC,cAAc,QACpCkG,EAAKjG,UAAY,iBACjBiG,EAAKhG,YAAc8F,EACnBF,EAASxF,YAAY4F,EACvB,MACEJ,EAASxF,YAAYzC,SAAS4G,eAAeuB,MAG7C1B,EAAKrC,YACPqC,EAAKrC,WAAWuC,aAAasB,EAAUxB,MAKvC6B,EAAaC,IACjB,MAAMC,OAAyBC,IAAfF,EAA2BA,EAAapF,EAAY4C,MAC9D2C,EAAa3F,EAAcyF,GAC3BG,EAAUD,EAAW5E,OAAS,EACpC,IAAI8E,EAAe,EAEnBtF,EAASkD,QAASlC,IAChB,MAAMuE,EACJvE,EAAKlB,cAAc,oCACnBkB,EAAKlB,cAAc,iBACf0F,EAAWpE,EAASJ,GACpByE,EAAehG,EAAc8F,GAAYxG,aAAe,IACxD2G,EAAajG,EAAc+F,GAAUzG,aAAe,IACpD4G,EAAWlG,EAAcuB,EAAK4E,QAAQD,UAAY,IAQxD,MALGN,GACDI,EAAaI,SAAST,IACtBM,EAAWG,SAAST,IACpBO,EAASE,SAAST,IAKlB,OAFApE,EAAKC,QAAS,OACdD,EAAKhC,MAAMkC,QAAU,QAIvBoE,GAAgB,EAChBtE,EAAKC,QAAS,EACdD,EAAKhC,MAAMkC,QAAU,GACrB8B,EAAcuC,EAAYF,EAAUD,EAAa,IACjDpC,EAAcwC,EAAUH,EAAUD,EAAa,IAE3CC,IAxMO,CAACrE,IACd,GAAItC,OAAO4C,WAAaf,GAAiBS,EAAKJ,GAAI,CAChD,MAAMkF,EAAQpH,OAAO4C,UAAUyE,OAAOxF,EAAeS,EAAKJ,IAC1D,GAAqB,kBAAVkF,EAAsB,OAAOA,CAC1C,CACA,MAAMpE,EAASP,EAAUH,GACzB,OACEA,EAAKQ,UAAUgD,SAAS,YACvB9C,GAAmD,SAAzCA,EAAO1E,aAAa,kBAgMf+I,CAAO/E,KACrBK,EAASL,GACTA,EAAK4E,QAAQI,eAAiB,SAE3BX,GAAWrE,EAAK4E,QAAQI,iBAC3BpE,EAAUZ,UACHA,EAAK4E,QAAQI,kBAIpB1F,IACFA,EAAUW,OAA0B,IAAjBqE,EACnBhF,EAAUtB,MAAMkC,QAA2B,IAAjBoE,EAAqB,QAAU,QAG3DvF,EAAYf,MAAMkC,QAAUmE,EAAU,QAAU,OA3K7B,EAAC3H,EAAM4H,KAC1B,MAAM9H,EAAQwC,EAASQ,OACjByF,EAAU9I,OAAOO,GAAQ,IAAIwI,OAKnCvF,EAAO5B,YAJFkH,EAKc,IAAjBX,EACIpI,EAAQO,SAASwI,GACjB/I,EAAQS,WAAW2H,EAAcW,GANhB/I,EAAQK,QAAQC,IAwKvC2I,CAAajB,EAASI,IAGxB,IAAIc,EAAQ,KAiJZ,GAhJAvG,EAAYlD,iBAAiB,QAAS,KACpC0J,aAAaD,GACbA,EAAQ9G,WAAW,IAAM0F,IAAa,OAGxCnF,EAAYlD,iBAAiB,UAAY2J,IACrB,WAAdA,EAAMpI,MACVoI,EAAMC,iBACN1G,EAAY4C,MAAQ,GACpBuC,EAAU,IACVnF,EAAY2G,WAGdzG,EAAYpD,iBAAiB,QAAS,KACpCkD,EAAY4C,MAAQ,GACpBuC,EAAU,IACVnF,EAAY2G,UAGVpG,GACFA,EAAazD,iBAAiB,QAAS,KACrCqD,EAASkD,QAASlC,IACXD,EAAUC,KACfK,EAASL,UACFA,EAAK4E,QAAQI,kBAEtB5F,EAAaM,aAAa,eAAgB,QACtCL,GACFA,EAAeK,aAAa,eAAgB,WAK9CL,GACFA,EAAe1D,iBAAiB,QAAS,KACvCqD,EAASkD,QAASlC,IACXD,EAAUC,KACfY,EAAUZ,UACHA,EAAK4E,QAAQI,kBAEtB3F,EAAeK,aAAa,eAAgB,QACxCN,GACFA,EAAaM,aAAa,eAAgB,WAKhD9D,EAAQuD,iBAAiB,kBAAkB+C,QAASuD,IAClDA,EAAO9J,iBAAiB,QAAU2J,IAChCA,EAAMC,iBACND,EAAMI,kBAEN,MAAMC,EAAOF,EAAOb,QAAQgB,KAC5B,IAAKD,EAAO,OAGZ5E,EAFYrD,OAAOmI,SAASC,OAASpI,OAAOmI,SAASE,SAAWJ,GAG7DK,KAAMC,IACL,IAAKA,EAAO5E,GAcV,YAboB,gBAAhB4E,EAAO3E,KACT/D,EAAUrB,EAAQW,gBAAiB,CACjC+C,GAAI,6BACJsG,KAAM,OACNC,SAAU,MAGZ5I,EAAUrB,EAAQa,WAAY,CAC5B6C,GAAI,wBACJsG,KAAM,QACNC,SAAU,QAMhB,MAAMC,EAAWX,EAAOY,UACxBZ,EAAOY,UAAY,kDACnBZ,EAAOjF,UAAUC,IAAI,UACrBlD,EAAUrB,EAAQY,YAAa,CAC7B8C,GAAI,yBACJsG,KAAM,UACNC,SAAU,OAEZ7H,WAAW,KACTmH,EAAOY,UAAYD,EACnBX,EAAOjF,UAAUjC,OAAO,WACvB,QAEJ+H,MAAM,IACL/I,EAAUrB,EAAQa,WAAY,CAC5B6C,GAAI,wBACJsG,KAAM,QACNC,SAAU,YAMpBvK,EAAQuD,iBAAiB,aAAa+C,QAASlC,IAC7C,MACMuG,EAhbR,SAAyBrJ,GACvB,IAAKD,EAAc,OAAO,KAC1B,IACE,OAAOA,EAAYuJ,QAAQtJ,EAC7B,CAAE,MACA,OAAO,IACT,CACF,CAyaiBuJ,CADH,gBAAgBzG,EAAKJ,MAEjC,IAAK2G,EAAS,OACd,MAAMG,EAAM1G,EAAKlB,cAAc,iBAAiByH,KAC5CG,GACFA,EAAIlG,UAAUC,IAAI,YAItB7E,EAAQuD,iBAAiB,iBAAiB+C,QAASuD,IACjDA,EAAO9J,iBAAiB,QAAU2J,IAChCA,EAAMC,iBACND,EAAMI,kBAEN,MAAMiB,EAAUlB,EAAO5F,QAAQ,iBACzBG,EAAOyF,EAAO5F,QAAQ,aAC5B,IAAK8G,IAAY3G,EAAO,OAExB2G,EAAQxH,iBAAiB,iBAAiB+C,QAASC,IACjDA,EAAK3B,UAAUjC,OAAO,YAExBkH,EAAOjF,UAAUC,IAAI,UAErB,MAAMgB,EAAQgE,EAAOjF,UAAUgD,SAAS,MAAQ,KAAO,QA7b3D,SAA0BtG,EAAKuE,GAC7B,IAAKxE,EAAc,OAAO,EAC1B,IAEE,OADAA,EAAYG,QAAQF,EAAKuE,IAClB,CACT,CAAE,MACA,OAAO,CACT,CACF,CAsbImF,CAAiB,gBAAgB5G,EAAKJ,KAAM6B,GAE5C,MAAMoF,EAAQF,EAAQ7H,cAAc,mBACpC,GAAI+H,EAAO,CACT,MAAMT,EAAWS,EAAMjC,QAAQkC,cAAgBD,EAAM9I,aAAe,GACpE8I,EAAMjC,QAAQkC,aAAeV,EAC7BS,EAAM9I,YAAc7B,EAAQc,cAC5BsB,WAAW,KACTuI,EAAM9I,YAAcqI,EACpBX,EAAOjF,UAAUjC,OAAO,WACvB,IACL,CAEAhB,EAAUrB,EAAQc,cAAe,CAC/B4C,GAAI,2BACJsG,KAAM,UACNC,SAAU,WAKZzI,OAAOmI,SAASF,KAAM,CACxB,MAAMoB,EAAWrJ,OAAOmI,SAASF,KAAKqB,MAAM,GACtCnE,EACJnF,OAAOuJ,KAAoC,mBAAtBvJ,OAAOuJ,IAAIC,OAC5BxJ,OAAOuJ,IAAIC,OAAOH,GAClBA,EAASnI,QAAQ,mCAAoC,QACrDuI,EAASvL,EAAQkD,cAAc,IAAI+D,KACrCsE,GAAUA,EAAO3G,UAAUgD,SAAS,aACtClF,WAAW,KACT+B,EAAS8G,GACTA,EAAOC,eAAe,CAAEC,SAAU,SAAUC,MAAO,YAClD,IAEP,CAEAtD,EAAU,GACZ,EACD,CA7hBD","ignoreList":[],"sourcesContent":["// FAQ search and interaction logic for homepage FAQ section.\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    const faqRoot = document.getElementById(\"faq\");\r\n    if (!faqRoot) {return;}\r\n\r\n    const lang =\r\n      document.body.getAttribute(\"data-lang\") ||\r\n      document.documentElement.lang ||\r\n      \"\";\r\n    const isFa = String(lang).toLowerCase().startsWith(\"fa\");\r\n\r\n    const STRINGS = isFa\n      ? {\n        clearSearch: \"پاک کردن جستجو\",\r\n        showAll: (total) => `نمایش همه ${total} سوال.`,\r\n        noResult: (term) => `نتیجه‌ای برای «${term}» یافت نشد.`,\r\n        matchCount: (count, term) => `${count} نتیجه برای «${term}» پیدا شد.`,\r\n        copyUnsupported: \"مرورگر شما از کپی پشتیبانی نمی‌کند.\",\r\n        copySuccess: \"لینک کپی شد.\",\r\n        copyFailed: \"کپی لینک انجام نشد.\",\r\n        feedbackSaved: \"بازخورد شما ثبت شد. ممنون!\",\r\n      }\r\n      : {\r\n        clearSearch: \"Clear search\",\r\n        showAll: (total) => `Showing all ${total} questions.`,\r\n        noResult: (term) => `No results found for \\\"${term}\\\".`,\r\n        matchCount: (count, term) => `${count} result(s) found for \\\"${term}\\\".`,\r\n        copyUnsupported: \"Your browser does not support clipboard copy.\",\r\n        copySuccess: \"Link copied.\",\r\n        copyFailed: \"Could not copy the link.\",\r\n        feedbackSaved: \"Your feedback was saved. Thank you!\",\n      };\n\n    function getSafeStorage() {\n      try {\n        const key = \"__faq_storage_probe__\";\n        localStorage.setItem(key, \"1\");\n        localStorage.removeItem(key);\n        return localStorage;\n      } catch {\n        return null;\n      }\n    }\n\n    const safeStorage = getSafeStorage();\n\n    function readStoredValue(key) {\n      if (!safeStorage) {return null;}\n      try {\n        return safeStorage.getItem(key);\n      } catch {\n        return null;\n      }\n    }\n\n    function writeStoredValue(key, value) {\n      if (!safeStorage) {return false;}\n      try {\n        safeStorage.setItem(key, value);\n        return true;\n      } catch {\n        return false;\n      }\n    }\n\r\n    function showLocalToast(message) {\n      const toast = document.createElement(\"div\");\n      toast.className = \"toast-notification\";\n      toast.textContent = message;\n      toast.style.cssText = [\n        \"position:fixed\",\n        \"bottom:20px\",\n        \"left:50%\",\n        \"transform:translateX(-50%)\",\n        \"background:rgba(0,0,0,0.8)\",\n        \"color:#fff\",\n        \"padding:10px 20px\",\n        \"border-radius:20px\",\n        \"z-index:10000\",\n        \"opacity:0\",\n        \"transition:opacity 0.3s\",\n        \"font-family:inherit\",\n        \"font-size:0.9rem\",\n      ].join(\";\");\n\n      document.body.appendChild(toast);\n      requestAnimationFrame(() => {\n        toast.style.opacity = \"1\";\n      });\n      setTimeout(() => {\n        toast.style.opacity = \"0\";\n        setTimeout(() => toast.remove(), 300);\n      }, 2200);\n    }\n\n    function emitToast(message, options) {\n      if (!message) {\n        return;\n      }\n      if (typeof window.createToast === \"function\") {\n        try {\n          window.createToast(message, options);\n          return;\n        } catch {}\n      }\n      showLocalToast(message);\n    }\n\r\n    const normalizeText = (input) =>\r\n      String(input || \"\")\r\n        .normalize(\"NFC\")\r\n        .replace(/[ي]/g, \"ی\")\r\n        .replace(/[ك]/g, \"ک\")\r\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\r\n        .replace(/[\\u200c\\u200d]/g, \"\")\r\n        .toLowerCase();\r\n\r\n    const escapeRegExp = (input) =>\r\n      String(input || \"\").replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n\r\n    const searchInput = faqRoot.querySelector(\"#faq-search\");\r\n    const clearButton = faqRoot.querySelector(\"#clear-search\");\r\n    const faqItems = Array.from(faqRoot.querySelectorAll(\".faq-item\"));\r\n    const expandAllBtn = faqRoot.querySelector(\"#expand-all-faq\");\r\n    const collapseAllBtn = faqRoot.querySelector(\"#collapse-all-faq\");\r\n    const noResults = faqRoot.querySelector(\"#faq-no-results\");\r\n    const accordionRoot =\r\n      faqRoot.querySelector(\"#faq-container.accordion\") ||\r\n      faqRoot.querySelector(\".faq-container.accordion\");\r\n\r\n    if (!searchInput || !clearButton || !faqItems.length) {return;}\r\n\r\n    if (accordionRoot && !accordionRoot.hasAttribute(\"data-allow-multiple\")) {\r\n      accordionRoot.setAttribute(\"data-allow-multiple\", \"true\");\r\n    }\r\n\r\n    let status = faqRoot.querySelector(\"#faq-search-status\");\r\n    if (!status) {\r\n      status = document.createElement(\"div\");\r\n      status.id = \"faq-search-status\";\r\n      status.className = \"visually-hidden\";\r\n      status.setAttribute(\"aria-live\", \"polite\");\r\n      status.setAttribute(\"aria-atomic\", \"true\");\r\n      (searchInput.closest(\"form\") || searchInput.parentNode).appendChild(status);\r\n    }\r\n\r\n    if (!clearButton.getAttribute(\"aria-label\")) {\r\n      clearButton.setAttribute(\"aria-label\", STRINGS.clearSearch);\r\n    }\r\n\r\n    const isVisible = (item) => !item.hidden && item.style.display !== \"none\";\r\n\r\n    const getHeader = (item) => item.querySelector(\".accordion-header\");\r\n    const getPanel =\r\n      (item) =>\r\n        item.querySelector(\".accordion-content\") ||\r\n        item.querySelector(\".faq-answer\");\r\n\r\n    const isOpen = (item) => {\r\n      if (window.Accordion && accordionRoot && item.id) {\r\n        const state = window.Accordion.isOpen(accordionRoot, item.id);\r\n        if (typeof state === \"boolean\") {return state;}\r\n      }\r\n      const header = getHeader(item);\r\n      return (\r\n        item.classList.contains(\"is-open\") ||\r\n        (header && header.getAttribute(\"aria-expanded\") === \"true\")\r\n      );\r\n    };\r\n\r\n    const openItem = (item) => {\r\n      if (window.Accordion && accordionRoot && item.id) {\r\n        const ok = window.Accordion.open(accordionRoot, item.id);\r\n        if (ok) {return;}\r\n      }\r\n      item.classList.add(\"is-open\");\r\n      const header = getHeader(item);\r\n      const panel = getPanel(item);\r\n      if (header) {\r\n        header.setAttribute(\"aria-expanded\", \"true\");\r\n      }\r\n      if (panel) {\r\n        panel.setAttribute(\"aria-hidden\", \"false\");\r\n      }\r\n    };\r\n\r\n    const closeItem = (item) => {\r\n      if (window.Accordion && accordionRoot && item.id) {\r\n        const ok = window.Accordion.close(accordionRoot, item.id);\r\n        if (ok) {return;}\r\n      }\r\n      item.classList.remove(\"is-open\");\r\n      const header = getHeader(item);\r\n      const panel = getPanel(item);\r\n      if (header) {\r\n        header.setAttribute(\"aria-expanded\", \"false\");\r\n      }\r\n      if (panel) {\r\n        panel.setAttribute(\"aria-hidden\", \"true\");\r\n      }\r\n    };\r\n\r\n    const updateStatus = (term, visibleCount) => {\r\n      const total = faqItems.length;\r\n      const trimmed = String(term || \"\").trim();\r\n      if (!trimmed) {\r\n        status.textContent = STRINGS.showAll(total);\r\n        return;\r\n      }\r\n      status.textContent =\r\n        visibleCount === 0\r\n          ? STRINGS.noResult(trimmed)\r\n          : STRINGS.matchCount(visibleCount, trimmed);\r\n    };\r\n\r\n    const clearHighlights = (root) => {\n      if (!root) {return;}\r\n      root.querySelectorAll(\".highlight-term\").forEach((node) => {\r\n        const parent = node.parentNode;\r\n        if (!parent) {return;}\r\n        parent.replaceChild(document.createTextNode(node.textContent || \"\"), node);\r\n        parent.normalize();\r\n      });\n    };\n\n    function copyWithExecCommand(text) {\n      if (!document.body) {return false;}\n\n      const probe = document.createElement(\"textarea\");\n      probe.value = text;\n      probe.setAttribute(\"readonly\", \"\");\n      probe.setAttribute(\"aria-hidden\", \"true\");\n      probe.style.position = \"absolute\";\n      probe.style.left = \"-9999px\";\n      probe.style.top = \"0\";\n      document.body.appendChild(probe);\n      probe.select();\n\n      try {\n        return !!document.execCommand(\"copy\");\n      } catch {\n        return false;\n      } finally {\n        probe.remove();\n      }\n    }\n\n    async function copyText(text) {\n      const hasClipboardApi = !!(navigator.clipboard && navigator.clipboard.writeText);\n      if (hasClipboardApi) {\n        try {\n          await navigator.clipboard.writeText(text);\n          return { ok: true, mode: \"clipboard\" };\n        } catch {\n          // Fallback to legacy copy path below.\n        }\n      }\n\n      const legacySuccess = copyWithExecCommand(text);\n      if (legacySuccess) {\n        return { ok: true, mode: \"execCommand\" };\n      }\n\n      return {\n        ok: false,\n        mode: hasClipboardApi ? \"clipboard-failed\" : \"unsupported\",\n      };\n    }\n\r\n    const highlightText = (root, term) => {\r\n      if (!root) {return;}\r\n      clearHighlights(root);\r\n      if (!term) {return;}\r\n\r\n      const normalizedTerm = normalizeText(term);\r\n      if (!normalizedTerm) {return;}\r\n\r\n      const pattern = normalizedTerm\r\n        .split(\"\")\r\n        .map((ch) => {\r\n          const escaped = escapeRegExp(ch);\r\n          if (ch === \"ی\") {return \"[یي]\";}\r\n          if (ch === \"ک\") {return \"[کك]\";}\r\n          return escaped;\r\n        })\r\n        .join(\"[\\\\u064B-\\\\u065F\\\\u0670\\\\u200c\\\\u200d]*\");\r\n      const regex = new RegExp(`(${pattern})`, \"i\");\r\n\r\n      const walker = document.createTreeWalker(\r\n        root,\r\n        NodeFilter.SHOW_TEXT,\r\n        null,\r\n        false\r\n      );\r\n      const matches = [];\r\n\r\n      while (walker.nextNode()) {\r\n        const node = walker.currentNode;\r\n        const parent = node.parentNode;\r\n        if (!parent || !node.nodeValue) {continue;}\r\n        if (parent.classList && parent.classList.contains(\"highlight-term\")) {continue;}\r\n        if (regex.test(node.nodeValue)) {\r\n          matches.push(node);\r\n        }\r\n      }\r\n\r\n      matches.forEach((node) => {\r\n        const fragment = document.createDocumentFragment();\r\n        node.nodeValue.split(regex).forEach((part, index) => {\r\n          if (!part) {return;}\r\n          if (index % 2 === 1) {\r\n            const span = document.createElement(\"span\");\r\n            span.className = \"highlight-term\";\r\n            span.textContent = part;\r\n            fragment.appendChild(span);\r\n          } else {\r\n            fragment.appendChild(document.createTextNode(part));\r\n          }\r\n        });\r\n        if (node.parentNode) {\r\n          node.parentNode.replaceChild(fragment, node);\r\n        }\r\n      });\r\n    };\r\n\r\n    const filterFaq = (inputValue) => {\r\n      const rawTerm = inputValue !== undefined ? inputValue : searchInput.value;\r\n      const searchTerm = normalizeText(rawTerm);\r\n      const hasTerm = searchTerm.length > 0;\r\n      let visibleCount = 0;\r\n\r\n      faqItems.forEach((item) => {\r\n        const questionEl =\r\n          item.querySelector(\".accordion-header .faq-question\") ||\r\n          item.querySelector(\".faq-question\");\r\n        const answerEl = getPanel(item);\r\n        const questionText = normalizeText(questionEl?.textContent || \"\");\r\n        const answerText = normalizeText(answerEl?.textContent || \"\");\r\n        const keywords = normalizeText(item.dataset.keywords || \"\");\r\n\r\n        const matched =\r\n          !hasTerm ||\r\n          questionText.includes(searchTerm) ||\r\n          answerText.includes(searchTerm) ||\r\n          keywords.includes(searchTerm);\r\n\r\n        if (!matched) {\r\n          item.hidden = true;\r\n          item.style.display = \"none\";\r\n          return;\r\n        }\r\n\r\n        visibleCount += 1;\r\n        item.hidden = false;\r\n        item.style.display = \"\";\r\n        highlightText(questionEl, hasTerm ? searchTerm : \"\");\r\n        highlightText(answerEl, hasTerm ? searchTerm : \"\");\r\n\r\n        if (hasTerm && !isOpen(item)) {\r\n          openItem(item);\r\n          item.dataset.openedBySearch = \"true\";\r\n        }\r\n        if (!hasTerm && item.dataset.openedBySearch) {\r\n          closeItem(item);\r\n          delete item.dataset.openedBySearch;\r\n        }\r\n      });\r\n\r\n      if (noResults) {\r\n        noResults.hidden = visibleCount !== 0;\r\n        noResults.style.display = visibleCount === 0 ? \"block\" : \"none\";\r\n      }\r\n\r\n      clearButton.style.display = hasTerm ? \"block\" : \"none\";\r\n      updateStatus(rawTerm, visibleCount);\r\n    };\r\n\r\n    let timer = null;\r\n    searchInput.addEventListener(\"input\", () => {\r\n      clearTimeout(timer);\r\n      timer = setTimeout(() => filterFaq(), 280);\r\n    });\r\n\r\n    searchInput.addEventListener(\"keydown\", (event) => {\r\n      if (event.key !== \"Escape\") {return;}\r\n      event.preventDefault();\r\n      searchInput.value = \"\";\r\n      filterFaq(\"\");\r\n      searchInput.focus();\r\n    });\r\n\r\n    clearButton.addEventListener(\"click\", () => {\r\n      searchInput.value = \"\";\r\n      filterFaq(\"\");\r\n      searchInput.focus();\r\n    });\r\n\r\n    if (expandAllBtn) {\r\n      expandAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach((item) => {\r\n          if (!isVisible(item)) {return;}\r\n          openItem(item);\r\n          delete item.dataset.openedBySearch;\r\n        });\r\n        expandAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (collapseAllBtn) {\r\n          collapseAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n        }\r\n      });\r\n    }\r\n\r\n    if (collapseAllBtn) {\r\n      collapseAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach((item) => {\r\n          if (!isVisible(item)) {return;}\r\n          closeItem(item);\r\n          delete item.dataset.openedBySearch;\r\n        });\r\n        collapseAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (expandAllBtn) {\r\n          expandAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n        }\r\n      });\r\n    }\r\n\r\n    faqRoot.querySelectorAll(\".copy-faq-link\").forEach((button) => {\n      button.addEventListener(\"click\", (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n\r\n        const hash = button.dataset.link;\n        if (!hash) {return;}\n        const url = window.location.origin + window.location.pathname + hash;\n\n        copyText(url)\n          .then((result) => {\n            if (!result.ok) {\n              if (result.mode === \"unsupported\") {\n                emitToast(STRINGS.copyUnsupported, {\n                  id: \"faq-copy-unsupported-toast\",\n                  kind: \"info\",\n                  duration: 3000,\n                });\n              } else {\n                emitToast(STRINGS.copyFailed, {\n                  id: \"faq-copy-failed-toast\",\n                  kind: \"error\",\n                  duration: 2600,\n                });\n              }\n              return;\n            }\n\n            const original = button.innerHTML;\n            button.innerHTML = '<i class=\"fas fa-check\" aria-hidden=\"true\"></i>';\n            button.classList.add(\"copied\");\n            emitToast(STRINGS.copySuccess, {\n              id: \"faq-copy-success-toast\",\n              kind: \"success\",\n              duration: 1800,\n            });\n            setTimeout(() => {\n              button.innerHTML = original;\n              button.classList.remove(\"copied\");\n            }, 1800);\n          })\n          .catch(() =>\n            emitToast(STRINGS.copyFailed, {\n              id: \"faq-copy-failed-toast\",\n              kind: \"error\",\n              duration: 2600,\n            })\n          );\n      });\n    });\n\n    faqRoot.querySelectorAll(\".faq-item\").forEach((item) => {\n      const key = `faq-feedback-${item.id}`;\n      const stored = readStoredValue(key);\n      if (!stored) {return;}\n      const btn = item.querySelector(`.btn-feedback.${stored}`);\n      if (btn) {\n        btn.classList.add(\"active\");\n      }\n    });\r\n\r\n    faqRoot.querySelectorAll(\".btn-feedback\").forEach((button) => {\r\n      button.addEventListener(\"click\", (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        const wrapper = button.closest(\".faq-feedback\");\r\n        const item = button.closest(\".faq-item\");\r\n        if (!wrapper || !item) {return;}\r\n\r\n        wrapper.querySelectorAll(\".btn-feedback\").forEach((node) => {\r\n          node.classList.remove(\"active\");\r\n        });\r\n        button.classList.add(\"active\");\n\n        const value = button.classList.contains(\"up\") ? \"up\" : \"down\";\n        writeStoredValue(`faq-feedback-${item.id}`, value);\n\r\n        const label = wrapper.querySelector(\".feedback-label\");\r\n        if (label) {\r\n          const original = label.dataset.originalText || label.textContent || \"\";\r\n          label.dataset.originalText = original;\r\n          label.textContent = STRINGS.feedbackSaved;\r\n          setTimeout(() => {\r\n            label.textContent = original;\r\n            button.classList.remove(\"active\");\r\n          }, 3000);\r\n        }\r\n\r\n        emitToast(STRINGS.feedbackSaved, {\n          id: \"faq-feedback-saved-toast\",\n          kind: \"success\",\n          duration: 2400,\n        });\n      });\n    });\n\r\n    if (window.location.hash) {\r\n      const targetId = window.location.hash.slice(1);\r\n      const escaped =\r\n        window.CSS && typeof window.CSS.escape === \"function\"\r\n          ? window.CSS.escape(targetId)\r\n          : targetId.replace(/([ #;?%&,.+*~':\"!^$[\\]()=>|/@])/g, \"\\\\$1\");\r\n      const target = faqRoot.querySelector(`#${escaped}`);\r\n      if (target && target.classList.contains(\"faq-item\")) {\r\n        setTimeout(() => {\r\n          openItem(target);\r\n          target.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\r\n        }, 360);\r\n      }\r\n    }\r\n\r\n    filterFaq(\"\");\r\n  });\r\n})();\r\n"]}