{"version":3,"file":"faq-search.min.js","names":["document","addEventListener","faqRoot","getElementById","lang","body","getAttribute","documentElement","STRINGS","String","toLowerCase","startsWith","clearSearch","showAll","total","noResult","term","matchCount","count","copyUnsupported","copySuccess","copyFailed","feedbackSaved","window","createToast","message","toast","createElement","className","textContent","style","cssText","join","appendChild","requestAnimationFrame","opacity","setTimeout","remove","normalizeText","input","normalize","replace","searchInput","querySelector","clearButton","faqItems","Array","from","querySelectorAll","expandAllBtn","collapseAllBtn","noResults","accordionRoot","length","hasAttribute","setAttribute","status","id","closest","parentNode","isVisible","item","hidden","display","getHeader","getPanel","openItem","Accordion","open","classList","add","header","panel","closeItem","close","highlightText","root","forEach","node","parent","replaceChild","createTextNode","clearHighlights","normalizedTerm","pattern","split","map","ch","escaped","regex","RegExp","walker","createTreeWalker","NodeFilter","SHOW_TEXT","matches","nextNode","currentNode","nodeValue","contains","test","push","fragment","createDocumentFragment","part","index","span","filterFaq","inputValue","rawTerm","undefined","value","searchTerm","hasTerm","visibleCount","questionEl","answerEl","questionText","answerText","keywords","dataset","includes","state","isOpen","openedBySearch","trimmed","trim","updateStatus","timer","clearTimeout","event","key","preventDefault","focus","button","stopPropagation","hash","link","url","location","origin","pathname","navigator","clipboard","writeText","then","original","innerHTML","catch","stored","localStorage","getItem","btn","wrapper","setItem","label","originalText","targetId","slice","CSS","escape","target","scrollIntoView","behavior","block"],"sources":["faq-search.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// FAQ search and interaction logic for homepage FAQ section.\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    const faqRoot = document.getElementById(\"faq\");\r\n    if (!faqRoot) {return;}\r\n\r\n    const lang =\r\n      document.body.getAttribute(\"data-lang\") ||\r\n      document.documentElement.lang ||\r\n      \"\";\r\n    const isFa = String(lang).toLowerCase().startsWith(\"fa\");\r\n\r\n    const STRINGS = isFa\r\n      ? {\r\n        clearSearch: \"پاک کردن جستجو\",\r\n        showAll: (total) => `نمایش همه ${total} سوال.`,\r\n        noResult: (term) => `نتیجه‌ای برای «${term}» یافت نشد.`,\r\n        matchCount: (count, term) => `${count} نتیجه برای «${term}» پیدا شد.`,\r\n        copyUnsupported: \"مرورگر شما از کپی پشتیبانی نمی‌کند.\",\r\n        copySuccess: \"لینک کپی شد.\",\r\n        copyFailed: \"کپی لینک انجام نشد.\",\r\n        feedbackSaved: \"بازخورد شما ثبت شد. ممنون!\",\r\n      }\r\n      : {\r\n        clearSearch: \"Clear search\",\r\n        showAll: (total) => `Showing all ${total} questions.`,\r\n        noResult: (term) => `No results found for \\\"${term}\\\".`,\r\n        matchCount: (count, term) => `${count} result(s) found for \\\"${term}\\\".`,\r\n        copyUnsupported: \"Your browser does not support clipboard copy.\",\r\n        copySuccess: \"Link copied.\",\r\n        copyFailed: \"Could not copy the link.\",\r\n        feedbackSaved: \"Your feedback was saved. Thank you!\",\r\n      };\r\n\r\n    if (typeof window.createToast !== \"function\") {\r\n      window.createToast = function (message) {\r\n        const toast = document.createElement(\"div\");\r\n        toast.className = \"toast-notification\";\r\n        toast.textContent = message;\r\n        toast.style.cssText = [\r\n          \"position:fixed\",\r\n          \"bottom:20px\",\r\n          \"left:50%\",\r\n          \"transform:translateX(-50%)\",\r\n          \"background:rgba(0,0,0,0.8)\",\r\n          \"color:#fff\",\r\n          \"padding:10px 20px\",\r\n          \"border-radius:20px\",\r\n          \"z-index:10000\",\r\n          \"opacity:0\",\r\n          \"transition:opacity 0.3s\",\r\n          \"font-family:inherit\",\r\n          \"font-size:0.9rem\",\r\n        ].join(\";\");\r\n\r\n        document.body.appendChild(toast);\r\n        requestAnimationFrame(() => {\r\n          toast.style.opacity = \"1\";\r\n        });\r\n        setTimeout(() => {\r\n          toast.style.opacity = \"0\";\r\n          setTimeout(() => toast.remove(), 300);\r\n        }, 2200);\r\n      };\r\n    }\r\n\r\n    const normalizeText = (input) =>\r\n      String(input || \"\")\r\n        .normalize(\"NFC\")\r\n        .replace(/[ي]/g, \"ی\")\r\n        .replace(/[ك]/g, \"ک\")\r\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\r\n        .replace(/[\\u200c\\u200d]/g, \"\")\r\n        .toLowerCase();\r\n\r\n    const escapeRegExp = (input) =>\r\n      String(input || \"\").replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n\r\n    const searchInput = faqRoot.querySelector(\"#faq-search\");\r\n    const clearButton = faqRoot.querySelector(\"#clear-search\");\r\n    const faqItems = Array.from(faqRoot.querySelectorAll(\".faq-item\"));\r\n    const expandAllBtn = faqRoot.querySelector(\"#expand-all-faq\");\r\n    const collapseAllBtn = faqRoot.querySelector(\"#collapse-all-faq\");\r\n    const noResults = faqRoot.querySelector(\"#faq-no-results\");\r\n    const accordionRoot =\r\n      faqRoot.querySelector(\"#faq-container.accordion\") ||\r\n      faqRoot.querySelector(\".faq-container.accordion\");\r\n\r\n    if (!searchInput || !clearButton || !faqItems.length) {return;}\r\n\r\n    if (accordionRoot && !accordionRoot.hasAttribute(\"data-allow-multiple\")) {\r\n      accordionRoot.setAttribute(\"data-allow-multiple\", \"true\");\r\n    }\r\n\r\n    let status = faqRoot.querySelector(\"#faq-search-status\");\r\n    if (!status) {\r\n      status = document.createElement(\"div\");\r\n      status.id = \"faq-search-status\";\r\n      status.className = \"visually-hidden\";\r\n      status.setAttribute(\"aria-live\", \"polite\");\r\n      status.setAttribute(\"aria-atomic\", \"true\");\r\n      (searchInput.closest(\"form\") || searchInput.parentNode).appendChild(status);\r\n    }\r\n\r\n    if (!clearButton.getAttribute(\"aria-label\")) {\r\n      clearButton.setAttribute(\"aria-label\", STRINGS.clearSearch);\r\n    }\r\n\r\n    const isVisible = (item) => !item.hidden && item.style.display !== \"none\";\r\n\r\n    const getHeader = (item) => item.querySelector(\".accordion-header\");\r\n    const getPanel =\r\n      (item) =>\r\n        item.querySelector(\".accordion-content\") ||\r\n        item.querySelector(\".faq-answer\");\r\n\r\n    const isOpen = (item) => {\r\n      if (window.Accordion && accordionRoot && item.id) {\r\n        const state = window.Accordion.isOpen(accordionRoot, item.id);\r\n        if (typeof state === \"boolean\") {return state;}\r\n      }\r\n      const header = getHeader(item);\r\n      return (\r\n        item.classList.contains(\"is-open\") ||\r\n        (header && header.getAttribute(\"aria-expanded\") === \"true\")\r\n      );\r\n    };\r\n\r\n    const openItem = (item) => {\r\n      if (window.Accordion && accordionRoot && item.id) {\r\n        const ok = window.Accordion.open(accordionRoot, item.id);\r\n        if (ok) {return;}\r\n      }\r\n      item.classList.add(\"is-open\");\r\n      const header = getHeader(item);\r\n      const panel = getPanel(item);\r\n      if (header) {\r\n        header.setAttribute(\"aria-expanded\", \"true\");\r\n      }\r\n      if (panel) {\r\n        panel.setAttribute(\"aria-hidden\", \"false\");\r\n      }\r\n    };\r\n\r\n    const closeItem = (item) => {\r\n      if (window.Accordion && accordionRoot && item.id) {\r\n        const ok = window.Accordion.close(accordionRoot, item.id);\r\n        if (ok) {return;}\r\n      }\r\n      item.classList.remove(\"is-open\");\r\n      const header = getHeader(item);\r\n      const panel = getPanel(item);\r\n      if (header) {\r\n        header.setAttribute(\"aria-expanded\", \"false\");\r\n      }\r\n      if (panel) {\r\n        panel.setAttribute(\"aria-hidden\", \"true\");\r\n      }\r\n    };\r\n\r\n    const updateStatus = (term, visibleCount) => {\r\n      const total = faqItems.length;\r\n      const trimmed = String(term || \"\").trim();\r\n      if (!trimmed) {\r\n        status.textContent = STRINGS.showAll(total);\r\n        return;\r\n      }\r\n      status.textContent =\r\n        visibleCount === 0\r\n          ? STRINGS.noResult(trimmed)\r\n          : STRINGS.matchCount(visibleCount, trimmed);\r\n    };\r\n\r\n    const clearHighlights = (root) => {\r\n      if (!root) {return;}\r\n      root.querySelectorAll(\".highlight-term\").forEach((node) => {\r\n        const parent = node.parentNode;\r\n        if (!parent) {return;}\r\n        parent.replaceChild(document.createTextNode(node.textContent || \"\"), node);\r\n        parent.normalize();\r\n      });\r\n    };\r\n\r\n    const highlightText = (root, term) => {\r\n      if (!root) {return;}\r\n      clearHighlights(root);\r\n      if (!term) {return;}\r\n\r\n      const normalizedTerm = normalizeText(term);\r\n      if (!normalizedTerm) {return;}\r\n\r\n      const pattern = normalizedTerm\r\n        .split(\"\")\r\n        .map((ch) => {\r\n          const escaped = escapeRegExp(ch);\r\n          if (ch === \"ی\") {return \"[یي]\";}\r\n          if (ch === \"ک\") {return \"[کك]\";}\r\n          return escaped;\r\n        })\r\n        .join(\"[\\\\u064B-\\\\u065F\\\\u0670\\\\u200c\\\\u200d]*\");\r\n      const regex = new RegExp(`(${pattern})`, \"i\");\r\n\r\n      const walker = document.createTreeWalker(\r\n        root,\r\n        NodeFilter.SHOW_TEXT,\r\n        null,\r\n        false\r\n      );\r\n      const matches = [];\r\n\r\n      while (walker.nextNode()) {\r\n        const node = walker.currentNode;\r\n        const parent = node.parentNode;\r\n        if (!parent || !node.nodeValue) {continue;}\r\n        if (parent.classList && parent.classList.contains(\"highlight-term\")) {continue;}\r\n        if (regex.test(node.nodeValue)) {\r\n          matches.push(node);\r\n        }\r\n      }\r\n\r\n      matches.forEach((node) => {\r\n        const fragment = document.createDocumentFragment();\r\n        node.nodeValue.split(regex).forEach((part, index) => {\r\n          if (!part) {return;}\r\n          if (index % 2 === 1) {\r\n            const span = document.createElement(\"span\");\r\n            span.className = \"highlight-term\";\r\n            span.textContent = part;\r\n            fragment.appendChild(span);\r\n          } else {\r\n            fragment.appendChild(document.createTextNode(part));\r\n          }\r\n        });\r\n        if (node.parentNode) {\r\n          node.parentNode.replaceChild(fragment, node);\r\n        }\r\n      });\r\n    };\r\n\r\n    const filterFaq = (inputValue) => {\r\n      const rawTerm = inputValue !== undefined ? inputValue : searchInput.value;\r\n      const searchTerm = normalizeText(rawTerm);\r\n      const hasTerm = searchTerm.length > 0;\r\n      let visibleCount = 0;\r\n\r\n      faqItems.forEach((item) => {\r\n        const questionEl =\r\n          item.querySelector(\".accordion-header .faq-question\") ||\r\n          item.querySelector(\".faq-question\");\r\n        const answerEl = getPanel(item);\r\n        const questionText = normalizeText(questionEl?.textContent || \"\");\r\n        const answerText = normalizeText(answerEl?.textContent || \"\");\r\n        const keywords = normalizeText(item.dataset.keywords || \"\");\r\n\r\n        const matched =\r\n          !hasTerm ||\r\n          questionText.includes(searchTerm) ||\r\n          answerText.includes(searchTerm) ||\r\n          keywords.includes(searchTerm);\r\n\r\n        if (!matched) {\r\n          item.hidden = true;\r\n          item.style.display = \"none\";\r\n          return;\r\n        }\r\n\r\n        visibleCount += 1;\r\n        item.hidden = false;\r\n        item.style.display = \"\";\r\n        highlightText(questionEl, hasTerm ? searchTerm : \"\");\r\n        highlightText(answerEl, hasTerm ? searchTerm : \"\");\r\n\r\n        if (hasTerm && !isOpen(item)) {\r\n          openItem(item);\r\n          item.dataset.openedBySearch = \"true\";\r\n        }\r\n        if (!hasTerm && item.dataset.openedBySearch) {\r\n          closeItem(item);\r\n          delete item.dataset.openedBySearch;\r\n        }\r\n      });\r\n\r\n      if (noResults) {\r\n        noResults.hidden = visibleCount !== 0;\r\n        noResults.style.display = visibleCount === 0 ? \"block\" : \"none\";\r\n      }\r\n\r\n      clearButton.style.display = hasTerm ? \"block\" : \"none\";\r\n      updateStatus(rawTerm, visibleCount);\r\n    };\r\n\r\n    let timer = null;\r\n    searchInput.addEventListener(\"input\", () => {\r\n      clearTimeout(timer);\r\n      timer = setTimeout(() => filterFaq(), 280);\r\n    });\r\n\r\n    searchInput.addEventListener(\"keydown\", (event) => {\r\n      if (event.key !== \"Escape\") {return;}\r\n      event.preventDefault();\r\n      searchInput.value = \"\";\r\n      filterFaq(\"\");\r\n      searchInput.focus();\r\n    });\r\n\r\n    clearButton.addEventListener(\"click\", () => {\r\n      searchInput.value = \"\";\r\n      filterFaq(\"\");\r\n      searchInput.focus();\r\n    });\r\n\r\n    if (expandAllBtn) {\r\n      expandAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach((item) => {\r\n          if (!isVisible(item)) {return;}\r\n          openItem(item);\r\n          delete item.dataset.openedBySearch;\r\n        });\r\n        expandAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (collapseAllBtn) {\r\n          collapseAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n        }\r\n      });\r\n    }\r\n\r\n    if (collapseAllBtn) {\r\n      collapseAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach((item) => {\r\n          if (!isVisible(item)) {return;}\r\n          closeItem(item);\r\n          delete item.dataset.openedBySearch;\r\n        });\r\n        collapseAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (expandAllBtn) {\r\n          expandAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n        }\r\n      });\r\n    }\r\n\r\n    faqRoot.querySelectorAll(\".copy-faq-link\").forEach((button) => {\r\n      button.addEventListener(\"click\", (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        const hash = button.dataset.link;\r\n        if (!hash) {return;}\r\n        const url = window.location.origin + window.location.pathname + hash;\r\n\r\n        if (!navigator.clipboard || !navigator.clipboard.writeText) {\r\n          window.createToast(STRINGS.copyUnsupported);\r\n          return;\r\n        }\r\n\r\n        navigator.clipboard\r\n          .writeText(url)\r\n          .then(() => {\r\n            const original = button.innerHTML;\r\n            button.innerHTML = '<i class=\"fas fa-check\" aria-hidden=\"true\"></i>';\r\n            button.classList.add(\"copied\");\r\n            window.createToast(STRINGS.copySuccess);\r\n            setTimeout(() => {\r\n              button.innerHTML = original;\r\n              button.classList.remove(\"copied\");\r\n            }, 1800);\r\n          })\r\n          .catch(() => window.createToast(STRINGS.copyFailed));\r\n      });\r\n    });\r\n\r\n    faqRoot.querySelectorAll(\".faq-item\").forEach((item) => {\r\n      const key = `faq-feedback-${item.id}`;\r\n      const stored = localStorage.getItem(key);\r\n      if (!stored) {return;}\r\n      const btn = item.querySelector(`.btn-feedback.${stored}`);\r\n      if (btn) {\r\n        btn.classList.add(\"active\");\r\n      }\r\n    });\r\n\r\n    faqRoot.querySelectorAll(\".btn-feedback\").forEach((button) => {\r\n      button.addEventListener(\"click\", (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n\r\n        const wrapper = button.closest(\".faq-feedback\");\r\n        const item = button.closest(\".faq-item\");\r\n        if (!wrapper || !item) {return;}\r\n\r\n        wrapper.querySelectorAll(\".btn-feedback\").forEach((node) => {\r\n          node.classList.remove(\"active\");\r\n        });\r\n        button.classList.add(\"active\");\r\n\r\n        const value = button.classList.contains(\"up\") ? \"up\" : \"down\";\r\n        localStorage.setItem(`faq-feedback-${item.id}`, value);\r\n\r\n        const label = wrapper.querySelector(\".feedback-label\");\r\n        if (label) {\r\n          const original = label.dataset.originalText || label.textContent || \"\";\r\n          label.dataset.originalText = original;\r\n          label.textContent = STRINGS.feedbackSaved;\r\n          setTimeout(() => {\r\n            label.textContent = original;\r\n            button.classList.remove(\"active\");\r\n          }, 3000);\r\n        }\r\n\r\n        window.createToast(STRINGS.feedbackSaved);\r\n      });\r\n    });\r\n\r\n    if (window.location.hash) {\r\n      const targetId = window.location.hash.slice(1);\r\n      const escaped =\r\n        window.CSS && typeof window.CSS.escape === \"function\"\r\n          ? window.CSS.escape(targetId)\r\n          : targetId.replace(/([ #;?%&,.+*~':\"!^$[\\]()=>|/@])/g, \"\\\\$1\");\r\n      const target = faqRoot.querySelector(`#${escaped}`);\r\n      if (target && target.classList.contains(\"faq-item\")) {\r\n        setTimeout(() => {\r\n          openItem(target);\r\n          target.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\r\n        }, 360);\r\n      }\r\n    }\r\n\r\n    filterFaq(\"\");\r\n  });\r\n})();\r\n"]}