{"version":3,"file":"faq-search.min.js","names":["document","addEventListener","searchInput","getElementById","clearButton","faqItems","Array","from","querySelectorAll","expandAllBtn","collapseAllBtn","length","debounceTimer","status","createElement","id","setAttribute","className","closest","parentNode","appendChild","getAttribute","originalContent","Map","highlightText","element","term","has","innerHTML","get","text","newHtml","RegExp","replace","filterFaq","searchTerm","undefined","value","trim","toLowerCase","hasTerm","visibleCount","forEach","item","summaryEl","querySelector","answerEl","isCustomAccordion","tagName","questionText","textContent","answerText","keywords","dataset","includes","hidden","style","display","classList","contains","add","header","openedBySearch","open","remove","noResults","total","trimmed","updateStatus","summary","answer","set","clearTimeout","setTimeout","e","key","preventDefault","focus","panel"],"sources":["faq-search.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Minimal FAQ search functionality for home pages\r\n// Derived from assets/js/faq-fa.js without analytics or extras\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    const searchInput = document.getElementById(\"faq-search\");\r\n    const clearButton = document.getElementById(\"clear-search\");\r\n    const faqItems = Array.from(document.querySelectorAll(\".faq-item\"));\r\n    const expandAllBtn = document.getElementById(\"expand-all-faq\");\r\n    const collapseAllBtn = document.getElementById(\"collapse-all-faq\");\r\n\r\n    if (!searchInput || !clearButton || !faqItems.length) {return;}\r\n\r\n    // Live region for announcing search results (a11y)\r\n    let status = document.getElementById(\"faq-search-status\");\r\n    if (!status) {\r\n      status = document.createElement(\"div\");\r\n      status.id = \"faq-search-status\";\r\n      status.setAttribute(\"aria-live\", \"polite\");\r\n      status.setAttribute(\"aria-atomic\", \"true\");\r\n      status.className = \"faq-search-status sr-only\";\r\n      (searchInput.closest(\"form\") || searchInput.parentNode).appendChild(status);\r\n    }\r\n\r\n    // Ensure clear button has accessible label\r\n    if (!clearButton.getAttribute(\"aria-label\")) {\r\n      clearButton.setAttribute(\"aria-label\", \"پاک کردن جستجو\");\r\n    }\r\n\r\n    let debounceTimer;\r\n    // Store original content to restore after search clears\r\n    const originalContent = new Map();\r\n\r\n    faqItems.forEach(item => {\r\n      const summary = item.querySelector(\".accordion-header h3\") || item.querySelector(\"summary\");\r\n      const answer = item.querySelector(\".accordion-content\") || item.querySelector(\".faq-answer\");\r\n      if (summary) originalContent.set(summary, summary.innerHTML);\r\n      if (answer) originalContent.set(answer, answer.innerHTML);\r\n    });\r\n\r\n    function updateStatus(term, visibleCount) {\r\n      const total = faqItems.length;\r\n      const trimmed = term.trim();\r\n\r\n      if (!trimmed) {\r\n        status.textContent = `نمایش همه ${total} سوال.`;\r\n        return;\r\n      }\r\n      status.textContent =\r\n        visibleCount === 0\r\n          ? `نتیجه‌ای برای «${trimmed}» یافت نشد.`\r\n          : `${visibleCount} نتیجه برای «${trimmed}» پیدا شد.`;\r\n    }\r\n\r\n    // Helper to highlight text safely\r\n    function highlightText(element, term) {\r\n      if (!element) return;\r\n      \r\n      // Always restore original first to avoid nested spans\r\n      if (originalContent.has(element)) {\r\n        element.innerHTML = originalContent.get(element);\r\n      }\r\n\r\n      if (!term) return;\r\n      \r\n      const text = element.innerHTML;\r\n      // Simple regex for text content - be careful with HTML tags\r\n      // This is a simple implementation. For robust highlighting in HTML, a tree walker is better.\r\n      // But for this specific use case (h3 and p), simple replacement is usually acceptable if no complex nested tags.\r\n      \r\n      const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')})`, 'gi');\r\n      \r\n      // Only replace text nodes ideally, but innerHTML replace is faster for simple content\r\n      // We use a negative lookahead to avoid replacing inside HTML tags (attributes)\r\n      const newHtml = text.replace(new RegExp(`(?![^<]+>)(${term.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')})`, 'gi'), '<span class=\"highlight-term\">$1</span>');\r\n      \r\n      element.innerHTML = newHtml;\r\n    }\r\n\r\n    function filterFaq(term) {\r\n      const rawTerm = term !== undefined ? term : searchInput.value;\r\n      const searchTerm = (rawTerm || \"\").trim().toLowerCase();\r\n      const hasTerm = searchTerm.length > 0;\r\n\r\n      let visibleCount = 0;\r\n\r\n      faqItems.forEach((item) => {\r\n        // Support both <details>/<summary> and custom .accordion-item structure\r\n        const summaryEl = item.querySelector(\".accordion-header h3\") || item.querySelector(\"summary\");\r\n        const answerEl = item.querySelector(\".accordion-content\") || item.querySelector(\".faq-answer\");\r\n        \r\n        // For custom accordion, the header button is the summary\r\n        const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n\r\n        const questionText = summaryEl ? summaryEl.textContent.toLowerCase() : \"\";\r\n        const answerText = answerEl ? answerEl.textContent.toLowerCase() : \"\";\r\n        const keywords = (item.dataset.keywords || \"\").toLowerCase();\r\n\r\n        const matches =\r\n          !hasTerm ||\r\n          questionText.includes(searchTerm) ||\r\n          answerText.includes(searchTerm) ||\r\n          keywords.includes(searchTerm);\r\n\r\n        if (matches) {\r\n          item.hidden = false;\r\n          item.style.display = \"\"; // Reset display property\r\n          visibleCount++;\r\n\r\n          // Highlight terms\r\n          if (summaryEl) highlightText(summaryEl, hasTerm ? searchTerm : null);\r\n          if (answerEl) highlightText(answerEl, hasTerm ? searchTerm : null);\r\n\r\n          // Open item if searching\r\n          if (hasTerm) {\r\n            if (isCustomAccordion) {\r\n                if (!item.classList.contains(\"is-open\")) {\r\n                    item.classList.add(\"is-open\");\r\n                    const header = item.querySelector(\".accordion-header\");\r\n                    if (header) header.setAttribute(\"aria-expanded\", \"true\");\r\n                    item.dataset.openedBySearch = \"true\";\r\n                    // Ensure content is visible (handled by CSS usually, but explicit doesn't hurt)\r\n                    if (answerEl) answerEl.hidden = false;\r\n                }\r\n            } else {\r\n                if (!item.open) {\r\n                    item.open = true;\r\n                    item.dataset.openedBySearch = \"true\";\r\n                }\r\n            }\r\n          }\r\n\r\n          // Close if search cleared and was opened by search\r\n          if (!hasTerm && item.dataset.openedBySearch) {\r\n            if (isCustomAccordion) {\r\n                item.classList.remove(\"is-open\");\r\n                const header = item.querySelector(\".accordion-header\");\r\n                if (header) header.setAttribute(\"aria-expanded\", \"false\");\r\n                if (answerEl) answerEl.hidden = true;\r\n            } else {\r\n                item.open = false;\r\n            }\r\n            delete item.dataset.openedBySearch;\r\n          }\r\n        } else {\r\n          item.hidden = true;\r\n          item.style.display = \"none\"; // Force hide\r\n        }\r\n      });\r\n\r\n      const noResults = document.getElementById(\"faq-no-results\");\r\n      if (noResults) {\r\n        noResults.style.display = visibleCount === 0 ? \"block\" : \"none\";\r\n      }\r\n\r\n      clearButton.style.display = hasTerm ? \"block\" : \"none\";\r\n      updateStatus(searchTerm, visibleCount);\r\n    }\r\n\r\n    searchInput.addEventListener(\"input\", function () {\r\n      clearTimeout(debounceTimer);\r\n      debounceTimer = setTimeout(() => filterFaq(), 300);\r\n    });\r\n\r\n    // ESC to clear\r\n    searchInput.addEventListener(\"keydown\", (e) => {\r\n      if (e.key === \"Escape\") {\r\n        e.preventDefault();\r\n        searchInput.value = \"\";\r\n        filterFaq();\r\n        searchInput.focus();\r\n      }\r\n    });\r\n\r\n    clearButton.addEventListener(\"click\", function () {\r\n      searchInput.value = \"\";\r\n      filterFaq();\r\n      searchInput.focus();\r\n    });\r\n\r\n    // Expand/Collapse All Logic\r\n    if (expandAllBtn) {\r\n      expandAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach(item => {\r\n          if (item.hidden || item.style.display === \"none\") return; // Skip hidden items\r\n          \r\n          const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n          if (isCustomAccordion) {\r\n            item.classList.add(\"is-open\");\r\n            const header = item.querySelector(\".accordion-header\");\r\n            const panel = item.querySelector(\".accordion-content\");\r\n            if (header) header.setAttribute(\"aria-expanded\", \"true\");\r\n            if (panel) panel.hidden = false;\r\n          } else {\r\n            item.open = true;\r\n          }\r\n        });\r\n        expandAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (collapseAllBtn) collapseAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n      });\r\n    }\r\n\r\n    if (collapseAllBtn) {\r\n      collapseAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach(item => {\r\n          if (item.hidden || item.style.display === \"none\") return;\r\n          \r\n          const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n          if (isCustomAccordion) {\r\n            item.classList.remove(\"is-open\");\r\n            const header = item.querySelector(\".accordion-header\");\r\n            const panel = item.querySelector(\".accordion-content\");\r\n            if (header) header.setAttribute(\"aria-expanded\", \"false\");\r\n            if (panel) panel.hidden = true;\r\n          } else {\r\n            item.open = false;\r\n          }\r\n        });\r\n        collapseAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (expandAllBtn) expandAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n      });\r\n    }\r\n  });\r\n})();\r\n"]}