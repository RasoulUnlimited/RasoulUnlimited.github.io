{"version":3,"file":"faq-search.min.js","names":["document","addEventListener","window","createToast","message","toast","createElement","className","textContent","style","cssText","body","appendChild","requestAnimationFrame","opacity","setTimeout","remove","searchInput","getElementById","clearButton","faqItems","Array","from","querySelectorAll","expandAllBtn","collapseAllBtn","length","debounceTimer","status","id","setAttribute","closest","parentNode","getAttribute","originalContent","Map","highlightText","element","term","has","innerHTML","get","walker","createTreeWalker","NodeFilter","SHOW_TEXT","nodesToReplace","escapedTerm","replace","regex","RegExp","nextNode","node","currentNode","nodeValue","test","push","forEach","fragment","createDocumentFragment","split","part","index","span","createTextNode","replaceChild","filterFaq","searchTerm","undefined","value","trim","toLowerCase","hasTerm","visibleCount","item","summaryEl","querySelector","answerEl","isCustomAccordion","tagName","questionText","answerText","keywords","dataset","includes","hidden","display","classList","contains","add","header","openedBySearch","maxHeight","scrollHeight","open","noResults","total","trimmed","updateStatus","summary","answer","set","clearTimeout","e","key","preventDefault","focus","panel","btn","stopPropagation","link","url","location","origin","pathname","navigator","clipboard","writeText","then","originalIcon","color","catch","err","console","error","storedFeedback","localStorage","getItem","parent","b","isUp","setItem","label","originalText","fontWeight","hash","targetId","substring","targetItem","scrollIntoView","behavior","block","transition","originalBg","backgroundColor"],"sources":["faq-search.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Minimal FAQ search functionality for home pages\r\n// Derived from assets/js/faq-fa.js without analytics or extras\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    // Toast fallback\r\n    if (typeof window.createToast !== 'function') {\r\n      window.createToast = function(message) {\r\n        const toast = document.createElement('div');\r\n        toast.className = 'toast-notification';\r\n        toast.textContent = message;\r\n        toast.style.cssText = `\r\n          position: fixed;\r\n          bottom: 20px;\r\n          left: 50%;\r\n          transform: translateX(-50%);\r\n          background: rgba(0,0,0,0.8);\r\n          color: white;\r\n          padding: 10px 20px;\r\n          border-radius: 20px;\r\n          z-index: 10000;\r\n          opacity: 0;\r\n          transition: opacity 0.3s;\r\n          font-family: inherit;\r\n          font-size: 0.9rem;\r\n        `;\r\n        document.body.appendChild(toast);\r\n        requestAnimationFrame(() => toast.style.opacity = '1');\r\n        setTimeout(() => {\r\n          toast.style.opacity = '0';\r\n          setTimeout(() => toast.remove(), 300);\r\n        }, 3000);\r\n      };\r\n    }\r\n\r\n    const searchInput = document.getElementById(\"faq-search\");\r\n    const clearButton = document.getElementById(\"clear-search\");\r\n    const faqItems = Array.from(document.querySelectorAll(\".faq-item\"));\r\n    const expandAllBtn = document.getElementById(\"expand-all-faq\");\r\n    const collapseAllBtn = document.getElementById(\"collapse-all-faq\");\r\n\r\n    if (!searchInput || !clearButton || !faqItems.length) {return;}\r\n\r\n    // Live region for announcing search results (a11y)\r\n    let status = document.getElementById(\"faq-search-status\");\r\n    if (!status) {\r\n      status = document.createElement(\"div\");\r\n      status.id = \"faq-search-status\";\r\n      status.setAttribute(\"aria-live\", \"polite\");\r\n      status.setAttribute(\"aria-atomic\", \"true\");\r\n      status.className = \"faq-search-status sr-only\";\r\n      (searchInput.closest(\"form\") || searchInput.parentNode).appendChild(status);\r\n    }\r\n\r\n    // Ensure clear button has accessible label\r\n    if (!clearButton.getAttribute(\"aria-label\")) {\r\n      clearButton.setAttribute(\"aria-label\", \"پاک کردن جستجو\");\r\n    }\r\n\r\n    let debounceTimer;\r\n    // Store original content to restore after search clears\r\n    const originalContent = new Map();\r\n\r\n    faqItems.forEach(item => {\r\n      const summary = item.querySelector(\".accordion-header h3\") || item.querySelector(\"summary\");\r\n      const answer = item.querySelector(\".accordion-content\") || item.querySelector(\".faq-answer\");\r\n      if (summary) originalContent.set(summary, summary.innerHTML);\r\n      if (answer) originalContent.set(answer, answer.innerHTML);\r\n    });\r\n\r\n    function updateStatus(term, visibleCount) {\r\n      const total = faqItems.length;\r\n      const trimmed = term.trim();\r\n\r\n      if (!trimmed) {\r\n        status.textContent = `نمایش همه ${total} سوال.`;\r\n        return;\r\n      }\r\n      status.textContent =\r\n        visibleCount === 0\r\n          ? `نتیجه‌ای برای «${trimmed}» یافت نشد.`\r\n          : `${visibleCount} نتیجه برای «${trimmed}» پیدا شد.`;\r\n    }\r\n\r\n    // Helper to highlight text safely\r\n    function highlightText(element, term) {\r\n      if (!element) return;\r\n      \r\n      // Always restore original first to avoid nested spans\r\n      if (originalContent.has(element)) {\r\n        element.innerHTML = originalContent.get(element);\r\n      }\r\n\r\n      if (!term) return;\r\n      \r\n      // Use TreeWalker for safe highlighting\r\n      const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);\r\n      const nodesToReplace = [];\r\n      // Escape regex special characters in term\r\n      const escapedTerm = term.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\r\n      // Remove 'g' flag to avoid stateful behavior with test() in loop\r\n      const regex = new RegExp(`(${escapedTerm})`, \"i\");\r\n\r\n      while (walker.nextNode()) {\r\n        const node = walker.currentNode;\r\n        if (node.nodeValue && regex.test(node.nodeValue)) {\r\n          nodesToReplace.push(node);\r\n        }\r\n      }\r\n\r\n      nodesToReplace.forEach(node => {\r\n        const fragment = document.createDocumentFragment();\r\n        const parts = node.nodeValue.split(regex);\r\n        \r\n        parts.forEach((part, index) => {\r\n          if (index % 2 === 1) { // Matched part\r\n            const span = document.createElement(\"span\");\r\n            span.className = \"highlight-term\";\r\n            span.textContent = part;\r\n            fragment.appendChild(span);\r\n          } else if (part) {\r\n            fragment.appendChild(document.createTextNode(part));\r\n          }\r\n        });\r\n        \r\n        node.parentNode.replaceChild(fragment, node);\r\n      });\r\n    }\r\n\r\n    function filterFaq(term) {\r\n      const rawTerm = term !== undefined ? term : searchInput.value;\r\n      const searchTerm = (rawTerm || \"\").trim().toLowerCase();\r\n      const hasTerm = searchTerm.length > 0;\r\n\r\n      let visibleCount = 0;\r\n\r\n      faqItems.forEach((item) => {\r\n        // Support both <details>/<summary> and custom .accordion-item structure\r\n        const summaryEl = item.querySelector(\".accordion-header h3\") || item.querySelector(\"summary\");\r\n        const answerEl = item.querySelector(\".accordion-content\") || item.querySelector(\".faq-answer\");\r\n        \r\n        // For custom accordion, the header button is the summary\r\n        const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n\r\n        const questionText = summaryEl ? summaryEl.textContent.toLowerCase() : \"\";\r\n        const answerText = answerEl ? answerEl.textContent.toLowerCase() : \"\";\r\n        const keywords = (item.dataset.keywords || \"\").toLowerCase();\r\n\r\n        const matches =\r\n          !hasTerm ||\r\n          questionText.includes(searchTerm) ||\r\n          answerText.includes(searchTerm) ||\r\n          keywords.includes(searchTerm);\r\n\r\n        if (matches) {\r\n          item.hidden = false;\r\n          item.style.display = \"\"; // Reset display property\r\n          visibleCount++;\r\n\r\n          // Highlight terms\r\n          if (summaryEl) highlightText(summaryEl, hasTerm ? searchTerm : null);\r\n          if (answerEl) highlightText(answerEl, hasTerm ? searchTerm : null);\r\n\r\n          // Open item if searching\r\n          if (hasTerm) {\r\n            if (isCustomAccordion) {\r\n                if (!item.classList.contains(\"is-open\")) {\r\n                    item.classList.add(\"is-open\");\r\n                    const header = item.querySelector(\".accordion-header\");\r\n                    if (header) header.setAttribute(\"aria-expanded\", \"true\");\r\n                    item.dataset.openedBySearch = \"true\";\r\n                    // Ensure content is visible\r\n                    if (answerEl) {\r\n                        answerEl.style.maxHeight = answerEl.scrollHeight + 50 + \"px\";\r\n                        answerEl.style.opacity = \"1\";\r\n                    }\r\n                }\r\n            } else {\r\n                if (!item.open) {\r\n                    item.open = true;\r\n                    item.dataset.openedBySearch = \"true\";\r\n                }\r\n            }\r\n          }\r\n\r\n          // Close if search cleared and was opened by search\r\n          if (!hasTerm && item.dataset.openedBySearch) {\r\n            if (isCustomAccordion) {\r\n                item.classList.remove(\"is-open\");\r\n                const header = item.querySelector(\".accordion-header\");\r\n                if (header) header.setAttribute(\"aria-expanded\", \"false\");\r\n                if (answerEl) {\r\n                    answerEl.style.maxHeight = null;\r\n                    answerEl.style.opacity = \"0\";\r\n                }\r\n            } else {\r\n                item.open = false;\r\n            }\r\n            delete item.dataset.openedBySearch;\r\n          }\r\n        } else {\r\n          item.hidden = true;\r\n          item.style.display = \"none\"; // Force hide\r\n        }\r\n      });\r\n\r\n      const noResults = document.getElementById(\"faq-no-results\");\r\n      if (noResults) {\r\n        noResults.style.display = visibleCount === 0 ? \"block\" : \"none\";\r\n      }\r\n\r\n      clearButton.style.display = hasTerm ? \"block\" : \"none\";\r\n      updateStatus(searchTerm, visibleCount);\r\n    }\r\n\r\n    searchInput.addEventListener(\"input\", function () {\r\n      clearTimeout(debounceTimer);\r\n      debounceTimer = setTimeout(() => filterFaq(), 300);\r\n    });\r\n\r\n    // ESC to clear\r\n    searchInput.addEventListener(\"keydown\", (e) => {\r\n      if (e.key === \"Escape\") {\r\n        e.preventDefault();\r\n        searchInput.value = \"\";\r\n        filterFaq();\r\n        searchInput.focus();\r\n      }\r\n    });\r\n\r\n    clearButton.addEventListener(\"click\", function () {\r\n      searchInput.value = \"\";\r\n      filterFaq();\r\n      searchInput.focus();\r\n    });\r\n\r\n    // Expand/Collapse All Logic\r\n    if (expandAllBtn) {\r\n      expandAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach(item => {\r\n          if (item.hidden || item.style.display === \"none\") return; // Skip hidden items\r\n          \r\n          const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n          if (isCustomAccordion) {\r\n            item.classList.add(\"is-open\");\r\n            const header = item.querySelector(\".accordion-header\");\r\n            const panel = item.querySelector(\".accordion-content\");\r\n            if (header) header.setAttribute(\"aria-expanded\", \"true\");\r\n            if (panel) {\r\n                panel.style.maxHeight = (panel.scrollHeight + 500) + \"px\";\r\n                panel.style.opacity = \"1\";\r\n            }\r\n          } else {\r\n            item.open = true;\r\n          }\r\n        });\r\n        expandAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (collapseAllBtn) collapseAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n      });\r\n    }\r\n\r\n    if (collapseAllBtn) {\r\n      collapseAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach(item => {\r\n          if (item.hidden || item.style.display === \"none\") return;\r\n          \r\n          const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n          if (isCustomAccordion) {\r\n            item.classList.remove(\"is-open\");\r\n            const header = item.querySelector(\".accordion-header\");\r\n            const panel = item.querySelector(\".accordion-content\");\r\n            if (header) header.setAttribute(\"aria-expanded\", \"false\");\r\n            if (panel) {\r\n                panel.style.maxHeight = null;\r\n                panel.style.opacity = \"0\";\r\n            }\r\n          } else {\r\n            item.open = false;\r\n          }\r\n        });\r\n        collapseAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (expandAllBtn) expandAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n      });\r\n    }\r\n\r\n    // --- New Features Logic ---\r\n\r\n    // 1. Copy Link Functionality\r\n    document.querySelectorAll('.copy-faq-link').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        e.stopPropagation(); // Prevent accordion toggle\r\n        const link = btn.dataset.link;\r\n        if (!link) return;\r\n\r\n        const url = window.location.origin + window.location.pathname + link;\r\n        \r\n        navigator.clipboard.writeText(url).then(() => {\r\n          // Visual feedback\r\n          const originalIcon = btn.innerHTML;\r\n          btn.innerHTML = '<i class=\"fas fa-check\"></i>';\r\n          btn.style.color = '#2ecc71';\r\n          \r\n          // Show toast if available\r\n          if (window.createToast) {\r\n            window.createToast('لینک کپی شد!');\r\n          }\r\n\r\n          setTimeout(() => {\r\n            btn.innerHTML = originalIcon;\r\n            btn.style.color = '';\r\n          }, 2000);\r\n        }).catch(err => {\r\n          console.error('Failed to copy: ', err);\r\n        });\r\n      });\r\n    });\r\n\r\n    // 2. Feedback Functionality\r\n    // Restore feedback state\r\n    document.querySelectorAll('.faq-item').forEach(item => {\r\n        const id = item.id;\r\n        const storedFeedback = localStorage.getItem(`faq-feedback-${id}`);\r\n        if (storedFeedback) {\r\n            const btn = item.querySelector(`.btn-feedback.${storedFeedback}`);\r\n            if (btn) btn.classList.add('active');\r\n        }\r\n    });\r\n\r\n    document.querySelectorAll('.btn-feedback').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const parent = btn.closest('.faq-feedback');\r\n        const item = btn.closest('.faq-item');\r\n        const id = item.id;\r\n        \r\n        // Remove active class from siblings\r\n        parent.querySelectorAll('.btn-feedback').forEach(b => b.classList.remove('active'));\r\n        \r\n        // Add active class to clicked button\r\n        btn.classList.add('active');\r\n        \r\n        const isUp = btn.classList.contains('up');\r\n        localStorage.setItem(`faq-feedback-${id}`, isUp ? 'up' : 'down');\r\n        \r\n        // Visual feedback\r\n        const label = parent.querySelector(\".feedback-label\");\r\n        if (label) {\r\n            const originalText = \"آیا این پاسخ مفید بود؟\";\r\n            label.textContent = \"بازخورد شما ثبت شد. ممنون!\";\r\n            label.style.color = \"#27ae60\";\r\n            label.style.fontWeight = \"bold\";\r\n            \r\n            setTimeout(() => {\r\n                label.textContent = originalText;\r\n                label.style.color = \"\";\r\n                label.style.fontWeight = \"\";\r\n                btn.classList.remove(\"active\");\r\n            }, 3000);\r\n        }\r\n        \r\n        // Optional: Send analytics event here\r\n        const questionId = btn.closest('.faq-item').id;\r\n        console.log(`Feedback for ${questionId}: ${isUp ? 'Positive' : 'Negative'}`);\r\n        \r\n        if (window.createToast) {\r\n          window.createToast('بازخورد شما ثبت شد. ممنون!');\r\n        }\r\n      });\r\n    });\r\n\r\n    // 3. Handle Hash Navigation\r\n    if (window.location.hash) {\r\n      const targetId = window.location.hash.substring(1);\r\n      const targetItem = document.getElementById(targetId);\r\n      if (targetItem && targetItem.classList.contains('faq-item')) {\r\n        setTimeout(() => {\r\n          // Open the item\r\n          const isCustomAccordion = !targetItem.tagName || targetItem.tagName.toLowerCase() !== 'details';\r\n          if (isCustomAccordion) {\r\n            targetItem.classList.add(\"is-open\");\r\n            const header = targetItem.querySelector(\".accordion-header\");\r\n            const panel = targetItem.querySelector(\".accordion-content\");\r\n            if (header) header.setAttribute(\"aria-expanded\", \"true\");\r\n            if (panel) {\r\n                panel.style.maxHeight = (panel.scrollHeight + 500) + \"px\";\r\n                panel.style.opacity = \"1\";\r\n            }\r\n          } else {\r\n            targetItem.open = true;\r\n          }\r\n          \r\n          // Scroll to it\r\n          targetItem.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n          \r\n          // Highlight effect\r\n          targetItem.style.transition = 'background-color 0.5s';\r\n          const originalBg = targetItem.style.backgroundColor;\r\n          targetItem.style.backgroundColor = 'rgba(52, 152, 219, 0.1)';\r\n          setTimeout(() => {\r\n            targetItem.style.backgroundColor = originalBg;\r\n          }, 1500);\r\n        }, 500); // Delay to ensure page load\r\n      }\r\n    }\r\n\r\n  });\r\n})();\r\n"]}