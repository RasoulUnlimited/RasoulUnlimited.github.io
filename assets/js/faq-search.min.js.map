{"version":3,"file":"faq-search.min.js","names":["document","addEventListener","window","createToast","message","toast","createElement","className","textContent","style","cssText","body","appendChild","requestAnimationFrame","opacity","setTimeout","remove","normalizeText","str","normalize","replace","toLowerCase","searchInput","getElementById","clearButton","faqItems","Array","from","querySelectorAll","expandAllBtn","collapseAllBtn","length","debounceTimer","status","highlightText","element","term","forEach","span","parent","parentNode","replaceChild","createTextNode","walker","createTreeWalker","NodeFilter","SHOW_TEXT","nodesToReplace","pattern","split","map","char","escaped","join","regex","RegExp","nextNode","node","currentNode","classList","contains","nodeValue","test","push","fragment","createDocumentFragment","part","index","filterFaq","rawTerm","undefined","value","searchTerm","hasTerm","visibleCount","item","summaryEl","querySelector","answerEl","isCustomAccordion","tagName","questionText","answerText","keywords","dataset","includes","hidden","display","add","header","setAttribute","openedBySearch","maxHeight","scrollHeight","open","noResults","total","trimmed","trim","updateStatus","id","closest","getAttribute","clearTimeout","e","key","preventDefault","focus","panel","btn","stopPropagation","link","url","location","origin","pathname","navigator","clipboard","writeText","then","originalHTML","innerHTML","originalClass","icon","color","catch","err","console","error","storedFeedback","localStorage","getItem","b","isUp","setItem","label","originalText","fontWeight","questionId","log","hash","targetId","substring","targetItem","scrollIntoView","behavior","block","transition","originalBg","backgroundColor"],"sources":["faq-search.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Minimal FAQ search functionality for home pages\r\n// Derived from assets/js/faq-fa.js without analytics or extras\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    // Toast fallback\r\n    if (typeof window.createToast !== 'function') {\r\n      window.createToast = function(message) {\r\n        const toast = document.createElement('div');\r\n        toast.className = 'toast-notification';\r\n        toast.textContent = message;\r\n        toast.style.cssText = `\r\n          position: fixed;\r\n          bottom: 20px;\r\n          left: 50%;\r\n          transform: translateX(-50%);\r\n          background: rgba(0,0,0,0.8);\r\n          color: white;\r\n          padding: 10px 20px;\r\n          border-radius: 20px;\r\n          z-index: 10000;\r\n          opacity: 0;\r\n          transition: opacity 0.3s;\r\n          font-family: inherit;\r\n          font-size: 0.9rem;\r\n        `;\r\n        document.body.appendChild(toast);\r\n        requestAnimationFrame(() => toast.style.opacity = '1');\r\n        setTimeout(() => {\r\n          toast.style.opacity = '0';\r\n          setTimeout(() => toast.remove(), 300);\r\n        }, 3000);\r\n      };\r\n    }\r\n\r\n    // Helper for Persian character normalization\r\n    const normalizeText = (str) =>\r\n      (str || \"\")\r\n        .normalize(\"NFC\")\r\n        .replace(/[ي]/g, \"ی\")\r\n        .replace(/[ك]/g, \"ک\")\r\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\") // Remove tashkeel\r\n        .replace(/‌/g, \"\") // Remove ZWNJ\r\n        .toLowerCase();\r\n\r\n    const escapeRegExp = (str) => str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n\r\n    const searchInput = document.getElementById(\"faq-search\");\r\n    const clearButton = document.getElementById(\"clear-search\");\r\n    const faqItems = Array.from(document.querySelectorAll(\".faq-item\"));\r\n    const expandAllBtn = document.getElementById(\"expand-all-faq\");\r\n    const collapseAllBtn = document.getElementById(\"collapse-all-faq\");\r\n\r\n    if (!searchInput || !clearButton || !faqItems.length) {return;}\r\n\r\n    // Live region for announcing search results (a11y)\r\n    let status = document.getElementById(\"faq-search-status\");\r\n    if (!status) {\r\n      status = document.createElement(\"div\");\r\n      status.id = \"faq-search-status\";\r\n      status.setAttribute(\"aria-live\", \"polite\");\r\n      status.setAttribute(\"aria-atomic\", \"true\");\r\n      status.className = \"faq-search-status sr-only\";\r\n      (searchInput.closest(\"form\") || searchInput.parentNode).appendChild(status);\r\n    }\r\n\r\n    // Ensure clear button has accessible label\r\n    if (!clearButton.getAttribute(\"aria-label\")) {\r\n      clearButton.setAttribute(\"aria-label\", \"پاک کردن جستجو\");\r\n    }\r\n\r\n    let debounceTimer;\r\n\r\n    function updateStatus(term, visibleCount) {\r\n      const total = faqItems.length;\r\n      const trimmed = term.trim();\r\n\r\n      if (!trimmed) {\r\n        status.textContent = `نمایش همه ${total} سوال.`;\r\n        return;\r\n      }\r\n      status.textContent =\r\n        visibleCount === 0\r\n          ? `نتیجه‌ای برای «${trimmed}» یافت نشد.`\r\n          : `${visibleCount} نتیجه برای «${trimmed}» پیدا شد.`;\r\n    }\r\n\r\n    // Helper to highlight text safely\r\n    function highlightText(element, term) {\r\n      if (!element) return;\r\n      \r\n      // Remove existing highlights first to preserve event listeners\r\n      const highlights = element.querySelectorAll(\".highlight-term\");\r\n      highlights.forEach(span => {\r\n        const parent = span.parentNode;\r\n        parent.replaceChild(document.createTextNode(span.textContent), span);\r\n        parent.normalize();\r\n      });\r\n\r\n      if (!term) return;\r\n      \r\n      // Use TreeWalker for safe highlighting\r\n      const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);\r\n      const nodesToReplace = [];\r\n      \r\n      // Build regex that allows for diacritics and ZWNJ between characters\r\n      // This matches the logic in credential-search.js\r\n      const normalizedTerm = normalizeText(term);\r\n      const noise = \"[\\\\u064B-\\\\u065F\\\\u0670\\\\u200c\\\\u200d]*\";\r\n      const pattern = normalizedTerm.split(\"\").map(char => {\r\n        const escaped = escapeRegExp(char);\r\n        if (char === \"ی\") return \"[یي]\";\r\n        if (char === \"ک\") return \"[کك]\";\r\n        return escaped;\r\n      }).join(noise);\r\n\r\n      // Remove 'g' flag to avoid stateful behavior with test() in loop\r\n      const regex = new RegExp(`(${pattern})`, \"i\");\r\n\r\n      while (walker.nextNode()) {\r\n        const node = walker.currentNode;\r\n        // Skip if parent is already a highlight span\r\n        if (node.parentNode.classList.contains(\"highlight-term\")) continue;\r\n\r\n        if (node.nodeValue && regex.test(node.nodeValue)) {\r\n          nodesToReplace.push(node);\r\n        }\r\n      }\r\n\r\n      nodesToReplace.forEach(node => {\r\n        const fragment = document.createDocumentFragment();\r\n        const parts = node.nodeValue.split(regex);\r\n        \r\n        parts.forEach((part, index) => {\r\n          if (index % 2 === 1) { // Matched part\r\n            const span = document.createElement(\"span\");\r\n            span.className = \"highlight-term\";\r\n            span.textContent = part;\r\n            fragment.appendChild(span);\r\n          } else if (part) {\r\n            fragment.appendChild(document.createTextNode(part));\r\n          }\r\n        });\r\n        \r\n        node.parentNode.replaceChild(fragment, node);\r\n      });\r\n    }\r\n\r\n    function filterFaq(term) {\r\n      const rawTerm = term !== undefined ? term : searchInput.value;\r\n      const searchTerm = normalizeText(rawTerm);\r\n      const hasTerm = searchTerm.length > 0;\r\n\r\n      let visibleCount = 0;\r\n\r\n      faqItems.forEach((item) => {\r\n        // Support both <details>/<summary> and custom .accordion-item structure\r\n        const summaryEl = item.querySelector(\".accordion-header h3\") || item.querySelector(\"summary\");\r\n        const answerEl = item.querySelector(\".accordion-content\") || item.querySelector(\".faq-answer\");\r\n        \r\n        // For custom accordion, the header button is the summary\r\n        const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n\r\n        const questionText = summaryEl ? normalizeText(summaryEl.textContent) : \"\";\r\n        const answerText = answerEl ? normalizeText(answerEl.textContent) : \"\";\r\n        const keywords = normalizeText(item.dataset.keywords || \"\");\r\n\r\n        const matches =\r\n          !hasTerm ||\r\n          questionText.includes(searchTerm) ||\r\n          answerText.includes(searchTerm) ||\r\n          keywords.includes(searchTerm);\r\n\r\n        if (matches) {\r\n          item.hidden = false;\r\n          item.style.display = \"\"; // Reset display property\r\n          visibleCount++;\r\n\r\n          // Highlight terms\r\n          if (summaryEl) highlightText(summaryEl, hasTerm ? searchTerm : null);\r\n          if (answerEl) highlightText(answerEl, hasTerm ? searchTerm : null);\r\n\r\n          // Open item if searching\r\n          if (hasTerm) {\r\n            if (isCustomAccordion) {\r\n                if (!item.classList.contains(\"is-open\")) {\r\n                    item.classList.add(\"is-open\");\r\n                    const header = item.querySelector(\".accordion-header\");\r\n                    if (header) header.setAttribute(\"aria-expanded\", \"true\");\r\n                    item.dataset.openedBySearch = \"true\";\r\n                    // Ensure content is visible\r\n                    if (answerEl) {\r\n                        answerEl.style.maxHeight = answerEl.scrollHeight + 50 + \"px\";\r\n                        answerEl.style.opacity = \"1\";\r\n                    }\r\n                }\r\n            } else {\r\n                if (!item.open) {\r\n                    item.open = true;\r\n                    item.dataset.openedBySearch = \"true\";\r\n                }\r\n            }\r\n          }\r\n\r\n          // Close if search cleared and was opened by search\r\n          if (!hasTerm && item.dataset.openedBySearch) {\r\n            if (isCustomAccordion) {\r\n                item.classList.remove(\"is-open\");\r\n                const header = item.querySelector(\".accordion-header\");\r\n                if (header) header.setAttribute(\"aria-expanded\", \"false\");\r\n                if (answerEl) {\r\n                    answerEl.style.maxHeight = null;\r\n                    answerEl.style.opacity = \"0\";\r\n                }\r\n            } else {\r\n                item.open = false;\r\n            }\r\n            delete item.dataset.openedBySearch;\r\n          }\r\n        } else {\r\n          item.hidden = true;\r\n          item.style.display = \"none\"; // Force hide\r\n        }\r\n      });\r\n\r\n      const noResults = document.getElementById(\"faq-no-results\");\r\n      if (noResults) {\r\n        noResults.style.display = visibleCount === 0 ? \"block\" : \"none\";\r\n      }\r\n\r\n      clearButton.style.display = hasTerm ? \"block\" : \"none\";\r\n      updateStatus(searchTerm, visibleCount);\r\n    }\r\n\r\n    searchInput.addEventListener(\"input\", function () {\r\n      clearTimeout(debounceTimer);\r\n      debounceTimer = setTimeout(() => filterFaq(), 300);\r\n    });\r\n\r\n    // ESC to clear\r\n    searchInput.addEventListener(\"keydown\", (e) => {\r\n      if (e.key === \"Escape\") {\r\n        e.preventDefault();\r\n        searchInput.value = \"\";\r\n        filterFaq();\r\n        searchInput.focus();\r\n      }\r\n    });\r\n\r\n    clearButton.addEventListener(\"click\", function () {\r\n      searchInput.value = \"\";\r\n      filterFaq();\r\n      searchInput.focus();\r\n    });\r\n\r\n    // Expand/Collapse All Logic\r\n    if (expandAllBtn) {\r\n      expandAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach(item => {\r\n          if (item.hidden || item.style.display === \"none\") return; // Skip hidden items\r\n          \r\n          const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n          if (isCustomAccordion) {\r\n            item.classList.add(\"is-open\");\r\n            const header = item.querySelector(\".accordion-header\");\r\n            const panel = item.querySelector(\".accordion-content\");\r\n            if (header) header.setAttribute(\"aria-expanded\", \"true\");\r\n            if (panel) {\r\n                panel.style.maxHeight = (panel.scrollHeight + 500) + \"px\";\r\n                panel.style.opacity = \"1\";\r\n            }\r\n          } else {\r\n            item.open = true;\r\n          }\r\n        });\r\n        expandAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (collapseAllBtn) collapseAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n      });\r\n    }\r\n\r\n    if (collapseAllBtn) {\r\n      collapseAllBtn.addEventListener(\"click\", () => {\r\n        faqItems.forEach(item => {\r\n          if (item.hidden || item.style.display === \"none\") return;\r\n          \r\n          const isCustomAccordion = !item.tagName || item.tagName.toLowerCase() !== 'details';\r\n          if (isCustomAccordion) {\r\n            item.classList.remove(\"is-open\");\r\n            const header = item.querySelector(\".accordion-header\");\r\n            const panel = item.querySelector(\".accordion-content\");\r\n            if (header) header.setAttribute(\"aria-expanded\", \"false\");\r\n            if (panel) {\r\n                panel.style.maxHeight = null;\r\n                panel.style.opacity = \"0\";\r\n            }\r\n          } else {\r\n            item.open = false;\r\n          }\r\n        });\r\n        collapseAllBtn.setAttribute(\"aria-pressed\", \"true\");\r\n        if (expandAllBtn) expandAllBtn.setAttribute(\"aria-pressed\", \"false\");\r\n      });\r\n    }\r\n\r\n    // --- New Features Logic ---\r\n\r\n    // 1. Copy Link Functionality\r\n    document.querySelectorAll('.copy-faq-link').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        e.stopPropagation(); // Prevent accordion toggle\r\n        const link = btn.dataset.link;\r\n        if (!link) return;\r\n\r\n        const url = window.location.origin + window.location.pathname + link;\r\n        \r\n        navigator.clipboard.writeText(url).then(() => {\r\n          // Visual feedback - store original HTML safely, use createElement for new content\r\n          const originalHTML = btn.innerHTML;\r\n          const originalClass = btn.className;\r\n          \r\n          // Clear and create safe icon element\r\n          btn.innerHTML = '';\r\n          const icon = document.createElement('i');\r\n          icon.className = 'fas fa-check';\r\n          icon.setAttribute('aria-hidden', 'true');\r\n          btn.appendChild(icon);\r\n          btn.style.color = '#2ecc71';\r\n          btn.classList.add('copied');\r\n          \r\n          // Show toast if available\r\n          if (window.createToast) {\r\n            window.createToast('لینک کپی شد!');\r\n          }\r\n\r\n          setTimeout(() => {\r\n            btn.innerHTML = originalHTML;\r\n            btn.className = originalClass;\r\n            btn.style.color = '';\r\n          }, 2000);\r\n        }).catch(err => {\r\n          console.error('Failed to copy: ', err);\r\n        });\r\n      });\r\n    });\r\n\r\n    // 2. Feedback Functionality\r\n    // Restore feedback state\r\n    document.querySelectorAll('.faq-item').forEach(item => {\r\n        const id = item.id;\r\n        const storedFeedback = localStorage.getItem(`faq-feedback-${id}`);\r\n        if (storedFeedback) {\r\n            const btn = item.querySelector(`.btn-feedback.${storedFeedback}`);\r\n            if (btn) btn.classList.add('active');\r\n        }\r\n    });\r\n\r\n    document.querySelectorAll('.btn-feedback').forEach(btn => {\r\n      btn.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        const parent = btn.closest('.faq-feedback');\r\n        const item = btn.closest('.faq-item');\r\n        const id = item.id;\r\n        \r\n        // Remove active class from siblings\r\n        parent.querySelectorAll('.btn-feedback').forEach(b => b.classList.remove('active'));\r\n        \r\n        // Add active class to clicked button\r\n        btn.classList.add('active');\r\n        \r\n        const isUp = btn.classList.contains('up');\r\n        localStorage.setItem(`faq-feedback-${id}`, isUp ? 'up' : 'down');\r\n        \r\n        // Visual feedback\r\n        const label = parent.querySelector(\".feedback-label\");\r\n        if (label) {\r\n            const originalText = \"آیا این پاسخ مفید بود؟\";\r\n            label.textContent = \"بازخورد شما ثبت شد. ممنون!\";\r\n            label.style.color = \"#27ae60\";\r\n            label.style.fontWeight = \"bold\";\r\n            \r\n            setTimeout(() => {\r\n                label.textContent = originalText;\r\n                label.style.color = \"\";\r\n                label.style.fontWeight = \"\";\r\n                btn.classList.remove(\"active\");\r\n            }, 3000);\r\n        }\r\n        \r\n        // Optional: Send analytics event here\r\n        const questionId = btn.closest('.faq-item').id;\r\n        console.log(`Feedback for ${questionId}: ${isUp ? 'Positive' : 'Negative'}`);\r\n        \r\n        if (window.createToast) {\r\n          window.createToast('بازخورد شما ثبت شد. ممنون!');\r\n        }\r\n      });\r\n    });\r\n\r\n    // 3. Handle Hash Navigation\r\n    if (window.location.hash) {\r\n      const targetId = window.location.hash.substring(1);\r\n      const targetItem = document.getElementById(targetId);\r\n      if (targetItem && targetItem.classList.contains('faq-item')) {\r\n        setTimeout(() => {\r\n          // Open the item\r\n          const isCustomAccordion = !targetItem.tagName || targetItem.tagName.toLowerCase() !== 'details';\r\n          if (isCustomAccordion) {\r\n            targetItem.classList.add(\"is-open\");\r\n            const header = targetItem.querySelector(\".accordion-header\");\r\n            const panel = targetItem.querySelector(\".accordion-content\");\r\n            if (header) header.setAttribute(\"aria-expanded\", \"true\");\r\n            if (panel) {\r\n                panel.style.maxHeight = (panel.scrollHeight + 500) + \"px\";\r\n                panel.style.opacity = \"1\";\r\n            }\r\n          } else {\r\n            targetItem.open = true;\r\n          }\r\n          \r\n          // Scroll to it\r\n          targetItem.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n          \r\n          // Highlight effect\r\n          targetItem.style.transition = 'background-color 0.5s';\r\n          const originalBg = targetItem.style.backgroundColor;\r\n          targetItem.style.backgroundColor = 'rgba(52, 152, 219, 0.1)';\r\n          setTimeout(() => {\r\n            targetItem.style.backgroundColor = originalBg;\r\n          }, 1500);\r\n        }, 500); // Delay to ensure page load\r\n      }\r\n    }\r\n\r\n  });\r\n})();\r\n"]}