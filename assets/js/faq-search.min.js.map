{"version":3,"file":"faq-search.min.js","names":["document","addEventListener","faqRoot","getElementById","window","createToast","message","toast","createElement","className","textContent","style","cssText","body","appendChild","requestAnimationFrame","opacity","setTimeout","remove","normalizeText","str","normalize","replace","toLowerCase","searchInput","querySelector","clearButton","faqItems","Array","from","querySelectorAll","expandAllBtn","collapseAllBtn","noResults","accordionRoot","length","hasAttribute","setAttribute","debounceTimer","status","isItemVisible","item","hidden","display","openItem","Accordion","id","open","classList","add","header","closeItem","close","highlightText","element","term","forEach","span","parent","parentNode","replaceChild","createTextNode","clearHighlights","normalizedTerm","pattern","split","map","char","escaped","join","regex","RegExp","walker","createTreeWalker","NodeFilter","SHOW_TEXT","nodesToReplace","nextNode","node","currentNode","nodeValue","contains","test","push","fragment","createDocumentFragment","part","index","filterFaq","rawTerm","undefined","value","searchTerm","hasTerm","visibleCount","summaryEl","answerEl","questionText","answerText","keywords","dataset","includes","state","isOpen","getAttribute","isItemOpen","openedBySearch","total","trimmed","trim","updateStatus","closest","clearTimeout","event","key","preventDefault","focus","btn","stopPropagation","link","url","location","origin","pathname","navigator","clipboard","writeText","then","originalHTML","innerHTML","catch","storedFeedback","localStorage","getItem","siblingBtn","isUp","setItem","label","originalText","hash","targetId","substring","escapedId","CSS","escape","targetItem","scrollIntoView","behavior","block"],"sources":["faq-search.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Minimal FAQ search and interaction logic for homepage FAQ section\n\n(function () {\n  \"use strict\";\n\n  document.addEventListener(\"DOMContentLoaded\", function () {\n    const faqRoot = document.getElementById(\"faq\");\n    if (!faqRoot) {return;}\n\n    // Toast fallback for pages where main toast helper is not loaded yet.\n    if (typeof window.createToast !== \"function\") {\n      window.createToast = function (message) {\n        const toast = document.createElement(\"div\");\n        toast.className = \"toast-notification\";\n        toast.textContent = message;\n        toast.style.cssText = `\n          position: fixed;\n          bottom: 20px;\n          left: 50%;\n          transform: translateX(-50%);\n          background: rgba(0,0,0,0.8);\n          color: white;\n          padding: 10px 20px;\n          border-radius: 20px;\n          z-index: 10000;\n          opacity: 0;\n          transition: opacity 0.3s;\n          font-family: inherit;\n          font-size: 0.9rem;\n        `;\n        document.body.appendChild(toast);\n        requestAnimationFrame(() => {\n          toast.style.opacity = \"1\";\n        });\n        setTimeout(() => {\n          toast.style.opacity = \"0\";\n          setTimeout(() => {\n            toast.remove();\n          }, 300);\n        }, 3000);\n      };\n    }\n\n    const normalizeText = (str) =>\n      (str || \"\")\n        .normalize(\"NFC\")\n        .replace(/[ي]/g, \"ی\")\n        .replace(/[ك]/g, \"ک\")\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\n        .replace(/[\\u200c\\u200d]/g, \"\")\n        .toLowerCase();\n\n    const escapeRegExp = (str) => str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n\n    const searchInput = faqRoot.querySelector(\"#faq-search\");\n    const clearButton = faqRoot.querySelector(\"#clear-search\");\n    const faqItems = Array.from(faqRoot.querySelectorAll(\".faq-item\"));\n    const expandAllBtn = faqRoot.querySelector(\"#expand-all-faq\");\n    const collapseAllBtn = faqRoot.querySelector(\"#collapse-all-faq\");\n    const noResults = faqRoot.querySelector(\"#faq-no-results\");\n    const accordionRoot = faqRoot.querySelector(\"#faq-container.accordion\") || faqRoot.querySelector(\".faq-container.accordion\");\n\n    if (!searchInput || !clearButton || !faqItems.length) {return;}\n\n    if (accordionRoot && !accordionRoot.hasAttribute(\"data-allow-multiple\")) {\n      accordionRoot.setAttribute(\"data-allow-multiple\", \"true\");\n    }\n\n    let status = faqRoot.querySelector(\"#faq-search-status\");\n    if (!status) {\n      status = document.createElement(\"div\");\n      status.id = \"faq-search-status\";\n      status.setAttribute(\"aria-live\", \"polite\");\n      status.setAttribute(\"aria-atomic\", \"true\");\n      status.className = \"faq-search-status visually-hidden\";\n      (searchInput.closest(\"form\") || searchInput.parentNode).appendChild(status);\n    } else if (!status.classList.contains(\"visually-hidden\")) {\n      status.classList.add(\"visually-hidden\");\n      status.classList.remove(\"sr-only\");\n    }\n\n    if (!clearButton.getAttribute(\"aria-label\")) {\n      clearButton.setAttribute(\"aria-label\", \"پاک کردن جستجو\");\n    }\n\n    let debounceTimer;\n\n    function isItemVisible(item) {\n      return !item.hidden && item.style.display !== \"none\";\n    }\n\n    function isItemOpen(item) {\n      if (window.Accordion && accordionRoot && item.id) {\n        const state = window.Accordion.isOpen(accordionRoot, item.id);\n        if (typeof state === \"boolean\") {return state;}\n      }\n      const header = item.querySelector(\".accordion-header\");\n      return item.classList.contains(\"is-open\") ||\n        (header && header.getAttribute(\"aria-expanded\") === \"true\");\n    }\n\n    function openItem(item) {\n      if (window.Accordion && accordionRoot && item.id) {\n        const opened = window.Accordion.open(accordionRoot, item.id);\n        if (opened) {return;}\n      }\n\n      item.classList.add(\"is-open\");\n      const header = item.querySelector(\".accordion-header\");\n      if (header) {\n        header.setAttribute(\"aria-expanded\", \"true\");\n      }\n    }\n\n    function closeItem(item) {\n      if (window.Accordion && accordionRoot && item.id) {\n        const closed = window.Accordion.close(accordionRoot, item.id);\n        if (closed) {return;}\n      }\n\n      item.classList.remove(\"is-open\");\n      const header = item.querySelector(\".accordion-header\");\n      if (header) {\n        header.setAttribute(\"aria-expanded\", \"false\");\n      }\n    }\n\n    function updateStatus(term, visibleCount) {\n      const total = faqItems.length;\n      const trimmed = (term || \"\").trim();\n\n      if (!trimmed) {\n        status.textContent = `نمایش همه ${total} سوال.`;\n        return;\n      }\n\n      status.textContent = visibleCount === 0\n        ? `نتیجه‌ای برای «${trimmed}» یافت نشد.`\n        : `${visibleCount} نتیجه برای «${trimmed}» پیدا شد.`;\n    }\n\n    function clearHighlights(element) {\n      if (!element) {return;}\n      element.querySelectorAll(\".highlight-term\").forEach((span) => {\n        const parent = span.parentNode;\n        if (!parent) {return;}\n        parent.replaceChild(document.createTextNode(span.textContent || \"\"), span);\n        parent.normalize();\n      });\n    }\n\n    function highlightText(element, term) {\n      if (!element) {return;}\n      clearHighlights(element);\n      if (!term) {return;}\n\n      const normalizedTerm = normalizeText(term);\n      if (!normalizedTerm) {return;}\n\n      const pattern = normalizedTerm\n        .split(\"\")\n        .map((char) => {\n          const escaped = escapeRegExp(char);\n          if (char === \"ی\") {return \"[یي]\";}\n          if (char === \"ک\") {return \"[کك]\";}\n          return escaped;\n        })\n        .join(\"[\\\\u064B-\\\\u065F\\\\u0670\\\\u200c\\\\u200d]*\");\n\n      const regex = new RegExp(`(${pattern})`, \"i\");\n      const walker = document.createTreeWalker(element, NodeFilter.SHOW_TEXT, null, false);\n      const nodesToReplace = [];\n\n      while (walker.nextNode()) {\n        const node = walker.currentNode;\n        const parent = node.parentNode;\n        if (!parent || !node.nodeValue) {continue;}\n        if (parent.classList && parent.classList.contains(\"highlight-term\")) {continue;}\n        if (regex.test(node.nodeValue)) {\n          nodesToReplace.push(node);\n        }\n      }\n\n      nodesToReplace.forEach((node) => {\n        const fragment = document.createDocumentFragment();\n        const parts = node.nodeValue.split(regex);\n\n        parts.forEach((part, index) => {\n          if (!part) {return;}\n          if (index % 2 === 1) {\n            const span = document.createElement(\"span\");\n            span.className = \"highlight-term\";\n            span.textContent = part;\n            fragment.appendChild(span);\n          } else {\n            fragment.appendChild(document.createTextNode(part));\n          }\n        });\n\n        if (node.parentNode) {\n          node.parentNode.replaceChild(fragment, node);\n        }\n      });\n    }\n\n    function filterFaq(term) {\n      const rawTerm = term !== undefined ? term : searchInput.value;\n      const searchTerm = normalizeText(rawTerm);\n      const hasTerm = searchTerm.length > 0;\n      let visibleCount = 0;\n\n      faqItems.forEach((item) => {\n        const summaryEl = item.querySelector(\".accordion-header .faq-question\") || item.querySelector(\".faq-question\");\n        const answerEl = item.querySelector(\".accordion-content\") || item.querySelector(\".faq-answer\");\n        const questionText = summaryEl ? normalizeText(summaryEl.textContent) : \"\";\n        const answerText = answerEl ? normalizeText(answerEl.textContent) : \"\";\n        const keywords = normalizeText(item.dataset.keywords || \"\");\n\n        const matches = !hasTerm ||\n          questionText.includes(searchTerm) ||\n          answerText.includes(searchTerm) ||\n          keywords.includes(searchTerm);\n\n        if (matches) {\n          item.hidden = false;\n          item.style.display = \"\";\n          visibleCount += 1;\n\n          highlightText(summaryEl, hasTerm ? searchTerm : null);\n          highlightText(answerEl, hasTerm ? searchTerm : null);\n\n          if (hasTerm && !isItemOpen(item)) {\n            openItem(item);\n            item.dataset.openedBySearch = \"true\";\n          }\n\n          if (!hasTerm && item.dataset.openedBySearch) {\n            closeItem(item);\n            delete item.dataset.openedBySearch;\n          }\n        } else {\n          item.hidden = true;\n          item.style.display = \"none\";\n        }\n      });\n\n      if (noResults) {\n        noResults.style.display = visibleCount === 0 ? \"block\" : \"none\";\n      }\n\n      clearButton.style.display = hasTerm ? \"block\" : \"none\";\n      updateStatus(rawTerm, visibleCount);\n    }\n\n    searchInput.addEventListener(\"input\", function () {\n      clearTimeout(debounceTimer);\n      debounceTimer = setTimeout(() => {\n        filterFaq();\n      }, 300);\n    });\n\n    searchInput.addEventListener(\"keydown\", (event) => {\n      if (event.key === \"Escape\") {\n        event.preventDefault();\n        searchInput.value = \"\";\n        filterFaq();\n        searchInput.focus();\n      }\n    });\n\n    clearButton.addEventListener(\"click\", function () {\n      searchInput.value = \"\";\n      filterFaq();\n      searchInput.focus();\n    });\n\n    if (expandAllBtn) {\n      expandAllBtn.addEventListener(\"click\", () => {\n        faqItems.forEach((item) => {\n          if (!isItemVisible(item)) {return;}\n          openItem(item);\n          delete item.dataset.openedBySearch;\n        });\n        expandAllBtn.setAttribute(\"aria-pressed\", \"true\");\n        if (collapseAllBtn) {\n          collapseAllBtn.setAttribute(\"aria-pressed\", \"false\");\n        }\n      });\n    }\n\n    if (collapseAllBtn) {\n      collapseAllBtn.addEventListener(\"click\", () => {\n        faqItems.forEach((item) => {\n          if (!isItemVisible(item)) {return;}\n          closeItem(item);\n          delete item.dataset.openedBySearch;\n        });\n        collapseAllBtn.setAttribute(\"aria-pressed\", \"true\");\n        if (expandAllBtn) {\n          expandAllBtn.setAttribute(\"aria-pressed\", \"false\");\n        }\n      });\n    }\n\n    faqRoot.querySelectorAll(\".copy-faq-link\").forEach((btn) => {\n      btn.addEventListener(\"click\", (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n\n        const link = btn.dataset.link;\n        if (!link) {return;}\n\n        const url = window.location.origin + window.location.pathname + link;\n        if (!navigator.clipboard || !navigator.clipboard.writeText) {\n          window.createToast(\"مرورگر شما از کپی پشتیبانی نمی‌کند.\");\n          return;\n        }\n\n        navigator.clipboard.writeText(url)\n          .then(() => {\n            const originalHTML = btn.innerHTML;\n            btn.innerHTML = '<i class=\"fas fa-check\" aria-hidden=\"true\"></i>';\n            btn.classList.add(\"copied\");\n            window.createToast(\"لینک کپی شد!\");\n\n            setTimeout(() => {\n              btn.innerHTML = originalHTML;\n              btn.classList.remove(\"copied\");\n            }, 2000);\n          })\n          .catch(() => {\n            window.createToast(\"کپی لینک انجام نشد.\");\n          });\n      });\n    });\n\n    faqRoot.querySelectorAll(\".faq-item\").forEach((item) => {\n      const id = item.id;\n      const storedFeedback = localStorage.getItem(`faq-feedback-${id}`);\n      if (!storedFeedback) {return;}\n      const btn = item.querySelector(`.btn-feedback.${storedFeedback}`);\n      if (btn) {\n        btn.classList.add(\"active\");\n      }\n    });\n\n    faqRoot.querySelectorAll(\".btn-feedback\").forEach((btn) => {\n      btn.addEventListener(\"click\", (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n\n        const parent = btn.closest(\".faq-feedback\");\n        const item = btn.closest(\".faq-item\");\n        if (!parent || !item) {return;}\n\n        parent.querySelectorAll(\".btn-feedback\").forEach((siblingBtn) => {\n          siblingBtn.classList.remove(\"active\");\n        });\n        btn.classList.add(\"active\");\n\n        const isUp = btn.classList.contains(\"up\");\n        localStorage.setItem(`faq-feedback-${item.id}`, isUp ? \"up\" : \"down\");\n\n        const label = parent.querySelector(\".feedback-label\");\n        if (label) {\n          const originalText = label.dataset.originalText || label.textContent;\n          label.dataset.originalText = originalText;\n          label.textContent = \"بازخورد شما ثبت شد. ممنون!\";\n\n          setTimeout(() => {\n            label.textContent = originalText;\n            btn.classList.remove(\"active\");\n          }, 3000);\n        }\n\n        window.createToast(\"بازخورد شما ثبت شد. ممنون!\");\n      });\n    });\n\n    if (window.location.hash) {\n      const targetId = window.location.hash.substring(1);\n      const escapedId = window.CSS && typeof window.CSS.escape === \"function\"\n        ? window.CSS.escape(targetId)\n        : targetId.replace(/([ #;?%&,.+*~\\':\"!^$[\\]()=>|/@])/g, \"\\\\$1\");\n      const targetItem = faqRoot.querySelector(`#${escapedId}`);\n      if (targetItem && targetItem.classList.contains(\"faq-item\")) {\n        setTimeout(() => {\n          openItem(targetItem);\n          targetItem.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n        }, 400);\n      }\n    }\n  });\n})();\n"]}