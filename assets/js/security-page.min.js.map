{"version":3,"file":"security-page.min.js","names":["document","addEventListener","isFa","documentElement","lang","toLowerCase","startsWith","messages","success","fail","unsupported","offline","online","refreshed","fetchFail","rateLimit","DAY_MS","rtfCache","RELATIVE_UNITS","formatRelative","date","rtf","locale","window","Intl","RelativeTimeFormat","numeric","getRelativeTimeFormatter","diff","Date","now","getTime","unit","ms","Math","abs","format","round","hasMatchMedia","matchMedia","prefersReduced","smallScreen","addMediaQueryChangeListener","mediaQueryList","handler","addListener","disableMotion","querySelectorAll","forEach","el","removeAttribute","classList","remove","normalizeText","str","s","String","normalize","replace","d","indexOf","matches","e","storage","test","localStorage","setItem","removeItem","sessionStorage","getStorage","TIMELINE_SEARCH_KEY","TIMELINE_YEAR_KEY","refreshTimelineBtn","refreshAdvisoriesBtn","async","cachedFetch","url","key","ttl","parser","timeout","cached","JSON","parse","getItem","t","navigator","onLine","staleError","Error","data","controller","AbortController","timer","setTimeout","abort","res","fetch","signal","undefined","cache","ok","status","headers","get","statusText","parseErr","console","error","stringify","cacheErr","name","warn","cacheKeys","oldKey","retryErr","clearTimeout","copyTextToClipboard","text","clipboard","writeText","then","createToast","catch","err","hidden","createElement","value","setAttribute","style","position","left","body","appendChild","select","successful","execCommand","removeChild","handleCopyClick","event","btn","currentTarget","dataset","copyText","targetId","copyTarget","targetEl","getElementById","textContent","trim","preventDefault","connectionEl","updateConnection","toggle","disabled","DEFAULT_TIMELINE","icon","title_fa","title_en","desc_fa","desc_en","timelineList","timelineSearch","yearFilter","clearSearchBtn","sortBtn","noResultsEl","resultsCountEl","timelineData","searchInitialized","sortAsc","ALLOWED_ICONS","Set","renderTimeline","events","firstChild","slice","sort","a","b","ev","li","aos","tabIndex","content","className","iconWrap","iconEl","add","iconClass","has","dateEl","timeEl","relTime","relSpan","createTextNode","titleEl","descEl","updateSortButton","initializeTimeline","timelineItems","length","observer","IntersectionObserver","entries","obs","entry","isIntersecting","target","unobserve","threshold","item","observe","debounceTimer","setupTimelineSearch","filterList","term","q","hasQuery","yearVal","count","matchQuery","includes","matchYear","visible","display","noResults","saved","savedYear","loadTimeline","force","json","years","Array","from","map","getFullYear","defaultOption","y","option","options","some","msg","message","isArray","finally","expirationEl","progressEl","daysTextEl","expireDate","expirationIntervalId","updateExpirationDisplay","diffDays","daysLabel","totalDays","percent","min","max","ceil","toFixed","processSecurityTxt","match","parsed","Number","isNaN","opts","year","month","day","label","toLocaleDateString","clearInterval","setInterval","loadPolicyExpiration","domainEl","codeEl","location","hostname","lastUpdatedEl","processLastUpdated","commitDate","commit","committer","dateStr","rel","loadLastUpdated","advisoriesList","renderAdvisories","advs","adv","link","href","html_url","summary","ghsa_id","id","advTime","published_at","created_at","span","loadAdvisories","idleLoad","requestIdleCallback","dispatchEvent","Event","activeTag","activeElement","tagName","ctrlKey","metaKey","altKey","focus","share","title","scrollBtn","floatingShare","toggleFloatButtons","show","scrollY","passive","scrollTo","top","behavior"],"sources":["security-page.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    const lang = document.documentElement.lang || \"en\";\r\n    const isFa = lang.toLowerCase().startsWith(\"fa\");\r\n\r\n    const messages = {\r\n      success: isFa ? \"کپی شد! ✅\" : \"Copied! ✅\",\r\n      fail: isFa ? \"عملیات کپی ناموفق بود.\" : \"Failed to copy.\",\r\n      unsupported: isFa\r\n        ? \"مرورگر از کپی پشتیبانی نمی‌کند.\"\r\n        : \"Your browser does not support copying.\",\r\n      offline: isFa ? \"شما آفلاین هستید.\" : \"You are offline.\",\r\n      online: isFa ? \"اتصال برقرار شد.\" : \"Back online.\",\r\n      refreshed: isFa ? \"بروزرسانی شد! ✅\" : \"Updated! ✅\",\r\n      fetchFail: isFa ? \"خطا در بارگیری داده.\" : \"Failed to load data.\",\r\n      rateLimit: isFa\r\n        ? \"محدودیت نرخ GitHub فعال شده است.\"\r\n        : \"GitHub rate limit exceeded.\",\r\n    };\r\n\r\n    const DAY_MS = 86400000;\r\n\r\n    // --- Relative time formatter with small cache ---\r\n\r\n    const rtfCache = {};\r\n\r\n    function getRelativeTimeFormatter(locale) {\r\n      if (!window.Intl || !Intl.RelativeTimeFormat) {\r\n        return null;\r\n      }\r\n      if (!rtfCache[locale]) {\r\n        rtfCache[locale] = new Intl.RelativeTimeFormat(locale, {\r\n          numeric: \"auto\",\r\n        });\r\n      }\r\n      return rtfCache[locale];\r\n    }\r\n\r\n    const RELATIVE_UNITS = [\r\n      [\"year\", 31536000000],\r\n      [\"month\", 2592000000],\r\n      [\"week\", 604800000],\r\n      [\"day\", 86400000],\r\n      [\"hour\", 3600000],\r\n      [\"minute\", 60000],\r\n      [\"second\", 1000],\r\n    ];\r\n\r\n    function formatRelative(date) {\r\n      if (!date) {\r\n        return \"\";\r\n      }\r\n\r\n      const locale = isFa ? \"fa\" : \"en\";\r\n      const rtf = getRelativeTimeFormatter(locale);\r\n      if (!rtf) {\r\n        return \"\";\r\n      }\r\n\r\n      const diff = Date.now() - date.getTime();\r\n\r\n      for (const [unit, ms] of RELATIVE_UNITS) {\r\n        if (Math.abs(diff) >= ms || unit === \"second\") {\r\n          return rtf.format(-Math.round(diff / ms), unit);\r\n        }\r\n      }\r\n      return \"\";\r\n    }\r\n\r\n    // --- Motion / reduced motion handling ---\r\n\r\n    const hasMatchMedia = typeof window.matchMedia === \"function\";\r\n    const prefersReduced = hasMatchMedia\r\n      ? window.matchMedia(\"(prefers-reduced-motion: reduce)\")\r\n      : null;\r\n    const smallScreen = hasMatchMedia\r\n      ? window.matchMedia(\"(max-width: 600px)\")\r\n      : null;\r\n\r\n    function addMediaQueryChangeListener(mediaQueryList, handler) {\r\n      if (!mediaQueryList || typeof handler !== \"function\") {\r\n        return;\r\n      }\r\n      if (typeof mediaQueryList.addEventListener === \"function\") {\r\n        mediaQueryList.addEventListener(\"change\", handler);\r\n      } else if (typeof mediaQueryList.addListener === \"function\") {\r\n        mediaQueryList.addListener(handler);\r\n      }\r\n    }\r\n\r\n    function disableMotion() {\r\n      document.querySelectorAll(\"[data-aos]\").forEach((el) => {\r\n        el.removeAttribute(\"data-aos\");\r\n      });\r\n      document.querySelectorAll(\".skeleton\").forEach((el) => {\r\n        el.classList.remove(\"skeleton\");\r\n      });\r\n    }\r\n\r\n    // احترام به کاربرانی که motion کم می‌خواهند\r\n    if (prefersReduced && prefersReduced.matches) {\r\n      disableMotion();\r\n    }\r\n    addMediaQueryChangeListener(prefersReduced, (e) => {\r\n      if (e.matches) {\r\n        disableMotion();\r\n      }\r\n    });\r\n\r\n    // روی موبایل/اسکرین کوچک هم انیمیشن‌ها حذف شوند\r\n    if (smallScreen && smallScreen.matches) {\r\n      disableMotion();\r\n    }\r\n    addMediaQueryChangeListener(smallScreen, (e) => {\r\n      if (e.matches) {\r\n        disableMotion();\r\n      }\r\n    });\r\n\r\n    // --- Text normalization for search ---\r\n\r\n    function normalizeText(str) {\r\n      if (!str) {\r\n        return \"\";\r\n      }\r\n      let s = String(str);\r\n      try {\r\n        if (typeof s.normalize === \"function\") {\r\n          s = s.normalize(\"NFKD\");\r\n        }\r\n      } catch {\r\n        // اگر normalize ساپورت نشود، ادامه می‌دهیم\r\n      }\r\n\r\n      const persianDigits = \"۰۱۲۳۴۵۶۷۸۹\";\r\n      return s\r\n        .replace(/[۰-۹]/g, (d) => String(persianDigits.indexOf(d)))\r\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\r\n        .toLowerCase();\r\n    }\r\n\r\n    // --- Storage wrapper ---\r\n\r\n    function getStorage() {\r\n      const test = \"__test\";\r\n      try {\r\n        localStorage.setItem(test, test);\r\n        localStorage.removeItem(test);\r\n        return localStorage;\r\n      } catch (e) {\r\n        try {\r\n          sessionStorage.setItem(test, test);\r\n          sessionStorage.removeItem(test);\r\n          return sessionStorage;\r\n        } catch {\r\n          return null;\r\n        }\r\n      }\r\n    }\r\n\r\n    const storage = getStorage();\r\n    const TIMELINE_SEARCH_KEY = \"timeline-search-term\";\r\n    const TIMELINE_YEAR_KEY = \"timeline-year\";\r\n\r\n    // eslint-disable-next-line prefer-const\r\n    let refreshTimelineBtn;\r\n    // eslint-disable-next-line prefer-const\r\n    let refreshAdvisoriesBtn;\r\n\r\n    // --- Cached fetch helper ---\r\n\r\n    async function cachedFetch(url, key, ttl, parser, timeout = 5000) {\r\n      let cached = null;\r\n      if (storage) {\r\n        try {\r\n          cached = JSON.parse(storage.getItem(key) || \"null\");\r\n        } catch {\r\n          cached = null;\r\n        }\r\n      }\r\n\r\n      const cacheIsValid = cached && Date.now() - cached.t < ttl;\r\n\r\n      if (cacheIsValid) {\r\n        return cached.d;\r\n      }\r\n\r\n      if (!navigator.onLine) {\r\n        if (cached && cached.d) {\r\n          const staleError = new Error(\"stale-data\");\r\n          staleError.data = cached.d;\r\n          throw staleError;\r\n        }\r\n        throw new Error(\"offline\");\r\n      }\r\n\r\n      const controller =\r\n        typeof AbortController !== \"undefined\"\r\n          ? new AbortController()\r\n          : null;\r\n      const timer =\r\n        controller &&\r\n        setTimeout(() => {\r\n          controller.abort();\r\n        }, timeout);\r\n\r\n      try {\r\n        const res = await fetch(url, {\r\n          signal: controller ? controller.signal : undefined,\r\n          cache: \"no-store\",\r\n        });\r\n\r\n        if (!res.ok) {\r\n          if (\r\n            res.status === 403 &&\r\n            res.headers.get(\"X-RateLimit-Remaining\") === \"0\"\r\n          ) {\r\n            throw new Error(\"rate-limit\");\r\n          }\r\n          if (cached && cached.d) {\r\n            const staleError = new Error(\"stale-data\");\r\n            staleError.data = cached.d;\r\n            throw staleError;\r\n          }\r\n          throw new Error(res.statusText || \"fetch error\");\r\n        }\r\n\r\n        let data;\r\n        try {\r\n          data = await parser(res);\r\n        } catch (parseErr) {\r\n          console.error(`Parser error for ${key}:`, parseErr);\r\n          throw new Error(\"parse-error\");\r\n        }\r\n\r\n        if (data !== null && storage) {\r\n          try {\r\n            storage.setItem(\r\n              key,\r\n              JSON.stringify({ t: Date.now(), d: data })\r\n            );\r\n          } catch (cacheErr) {\r\n            if (cacheErr.name === \"QuotaExceededError\") {\r\n              console.warn(\r\n                `localStorage quota exceeded for ${key}, attempting cleanup...`\r\n              );\r\n              try {\r\n                const cacheKeys = [\r\n                  \"security-timeline-cache\",\r\n                  \"security-advisories-cache\",\r\n                ];\r\n                for (const oldKey of cacheKeys) {\r\n                  if (oldKey !== key) {\r\n                    storage.removeItem(oldKey);\r\n                  }\r\n                }\r\n                storage.setItem(\r\n                  key,\r\n                  JSON.stringify({ t: Date.now(), d: data })\r\n                );\r\n              } catch (retryErr) {\r\n                console.error(\r\n                  `Failed to cache ${key} even after cleanup:`,\r\n                  retryErr\r\n                );\r\n              }\r\n            } else {\r\n              console.warn(\r\n                `Failed to cache ${key}, but returning fresh data:`,\r\n                cacheErr\r\n              );\r\n            }\r\n          }\r\n        }\r\n\r\n        return data;\r\n      } finally {\r\n        if (timer) {\r\n          clearTimeout(timer);\r\n        }\r\n      }\r\n    }\r\n\r\n    // --- Copy helpers ---\r\n\r\n    function copyTextToClipboard(text) {\r\n      if (!text) {\r\n        return;\r\n      }\r\n\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        navigator.clipboard\r\n          .writeText(text)\r\n          .then(() => {\r\n            if (typeof window.createToast === \"function\") {\r\n              window.createToast(messages.success);\r\n            }\r\n          })\r\n          .catch((err) => {\r\n            console.error(\"Copy failed:\", err);\r\n            if (typeof window.createToast === \"function\") {\r\n              window.createToast(messages.fail);\r\n            }\r\n          });\r\n      } else {\r\n        const hidden = document.createElement(\"textarea\");\r\n        hidden.value = text;\r\n        hidden.setAttribute(\"readonly\", \"\");\r\n        hidden.style.position = \"absolute\";\r\n        hidden.style.left = \"-9999px\";\r\n        document.body.appendChild(hidden);\r\n        hidden.select();\r\n        try {\r\n          const successful = document.execCommand(\"copy\");\r\n          if (typeof window.createToast === \"function\") {\r\n            window.createToast(\r\n              successful ? messages.success : messages.fail\r\n            );\r\n          }\r\n        } catch (err) {\r\n          console.error(\"execCommand copy failed:\", err);\r\n          if (typeof window.createToast === \"function\") {\r\n            window.createToast(messages.fail);\r\n          }\r\n        }\r\n        document.body.removeChild(hidden);\r\n      }\r\n    }\r\n\r\n    function handleCopyClick(event) {\r\n      const btn = event.currentTarget;\r\n      let text = btn.dataset.copyText || \"\";\r\n      if (!text) {\r\n        const targetId = btn.dataset.copyTarget;\r\n        const targetEl = document.getElementById(targetId);\r\n        if (targetEl) {\r\n          text = (targetEl.textContent || \"\").trim();\r\n        }\r\n      }\r\n      copyTextToClipboard(text);\r\n    }\r\n\r\n    // دکمه‌ها و المنت‌های قابل کپی\r\n    document.querySelectorAll(\".copy-button\").forEach((btn) => {\r\n      btn.addEventListener(\"click\", handleCopyClick);\r\n    });\r\n\r\n    document.querySelectorAll(\".copyable\").forEach((el) => {\r\n      const handler = () =>\r\n        copyTextToClipboard(\r\n          el.dataset.copyText || (el.textContent || \"\").trim()\r\n        );\r\n      el.addEventListener(\"click\", handler);\r\n      el.addEventListener(\"keypress\", (e) => {\r\n        if (e.key === \"Enter\" || e.key === \" \") {\r\n          e.preventDefault();\r\n          handler();\r\n        }\r\n      });\r\n    });\r\n\r\n    // --- Connection status ---\r\n\r\n    const connectionEl = document.getElementById(\"connection-status\");\r\n\r\n    function updateConnection() {\r\n      if (!connectionEl) {\r\n        return;\r\n      }\r\n      const online = navigator.onLine;\r\n\r\n      connectionEl.textContent = online\r\n        ? isFa\r\n          ? \"اتصال اینترنت برقرار است.\"\r\n          : \"You are online.\"\r\n        : isFa\r\n        ? \"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.\"\r\n        : \"You are offline. Some features may be unavailable.\";\r\n\r\n      document.body.classList.toggle(\"offline\", !online);\r\n\r\n      [refreshTimelineBtn, refreshAdvisoriesBtn].forEach((btn) => {\r\n        if (btn) {\r\n          btn.disabled = !online;\r\n        }\r\n      });\r\n    }\r\n\r\n    // --- Default timeline data ---\r\n\r\n    const DEFAULT_TIMELINE = [\r\n      {\r\n        date: \"2025-05-16\",\r\n        icon: \"fa-rocket\",\r\n        title_fa: \"شروع وب‌سایت\",\r\n        title_en: \"Website launched\",\r\n        desc_fa: \"انتشار اولیه سایت با نگاه به امنیت و عملکرد.\",\r\n        desc_en: \"Initial release with a focus on performance and safety.\",\r\n      },\r\n      {\r\n        date: \"2025-05-25\",\r\n        icon: \"fa-cloud\",\r\n        title_fa: \"ادغام با Cloudflare\",\r\n        title_en: \"Integrated with Cloudflare\",\r\n        desc_fa: \"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.\",\r\n        desc_en: \"Enhanced speed and security via Cloudflare CDN.\",\r\n      },\r\n      {\r\n        date: \"2025-06-01\",\r\n        icon: \"fa-shield-alt\",\r\n        title_fa: \"اعمال CSP سخت‌گیرانه\",\r\n        title_en: \"Strict CSP enforced\",\r\n        desc_fa: \"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.\",\r\n        desc_en: \"Implemented tighter policies to prevent web attacks.\",\r\n      },\r\n      {\r\n        date: \"2025-07-10\",\r\n        icon: \"fa-key\",\r\n        title_fa: \"انتشار کلید عمومی PGP\",\r\n        title_en: \"PGP key published\",\r\n        desc_fa: \"امکان ارتباط رمزنگاری‌شده فراهم شد.\",\r\n        desc_en: \"Secure encrypted communication enabled.\",\r\n      },\r\n      {\r\n        date: \"2025-07-20\",\r\n        icon: \"fa-bell\",\r\n        title_fa: \"راه‌اندازی اعلان‌های امنیتی\",\r\n        title_en: \"Security advisories live\",\r\n        desc_fa: \"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.\",\r\n        desc_en: \"Security updates now published via GitHub advisories.\",\r\n      },\r\n      {\r\n        date: \"2025-10-01\",\r\n        icon: \"fa-wifi\",\r\n        title_fa: \"افزودن پشتیبانی آفلاین\",\r\n        title_en: \"Offline support added\",\r\n        desc_fa:\r\n          \"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.\",\r\n        desc_en:\r\n          \"Improved user experience with local caching and connection status alerts.\",\r\n      },\r\n    ];\r\n\r\n    const timelineList = document.getElementById(\"security-timeline-list\");\r\n    const timelineSearch = document.getElementById(\"timeline-search\");\r\n    const yearFilter = document.getElementById(\"timeline-year\");\r\n    const clearSearchBtn = document.getElementById(\"clear-timeline-search\");\r\n    refreshTimelineBtn = document.getElementById(\"refresh-timeline\");\r\n    const sortBtn = document.getElementById(\"sort-timeline\");\r\n    const noResultsEl = document.getElementById(\"timeline-no-results\");\r\n    const resultsCountEl = document.getElementById(\"timeline-results-count\");\r\n\r\n    let timelineData = [];\r\n    let searchInitialized = false;\r\n    let sortAsc = storage\r\n      ? storage.getItem(\"timeline-sort\") === \"asc\"\r\n      : false;\r\n\r\n    // Strict whitelist of allowed Font Awesome icon classes\r\n    const ALLOWED_ICONS = new Set([\r\n      \"fa-rocket\",\r\n      \"fa-cloud\",\r\n      \"fa-shield-alt\",\r\n      \"fa-key\",\r\n      \"fa-bell\",\r\n      \"fa-wifi\",\r\n      \"fa-lock\",\r\n      \"fa-shield\",\r\n      \"fa-check\",\r\n      \"fa-star\",\r\n      \"fa-bookmark\",\r\n      \"fa-award\",\r\n    ]);\r\n\r\n    function renderTimeline(events) {\r\n      if (!timelineList) {\r\n        return;\r\n      }\r\n\r\n      while (timelineList.firstChild) {\r\n        timelineList.removeChild(timelineList.firstChild);\r\n      }\r\n\r\n      const sorted = events\r\n        .slice()\r\n        .sort((a, b) =>\r\n          sortAsc\r\n            ? new Date(a.date) - new Date(b.date)\r\n            : new Date(b.date) - new Date(a.date)\r\n        );\r\n\r\n      sorted.forEach((ev) => {\r\n        const li = document.createElement(\"li\");\r\n        li.dataset.aos = \"fade-up\";\r\n        li.dataset.date = ev.date;\r\n        li.tabIndex = 0;\r\n        li.setAttribute(\"role\", \"listitem\");\r\n\r\n        const content = document.createElement(\"div\");\r\n        content.className = \"timeline-content\";\r\n\r\n        const iconWrap = document.createElement(\"div\");\r\n        iconWrap.className = \"timeline-icon\";\r\n        const iconEl = document.createElement(\"i\");\r\n        iconEl.classList.add(\"fas\");\r\n\r\n        const iconClass =\r\n          typeof ev.icon === \"string\" && ALLOWED_ICONS.has(ev.icon)\r\n            ? ev.icon\r\n            : \"fa-shield-alt\";\r\n        iconEl.classList.add(iconClass);\r\n        iconEl.setAttribute(\"aria-hidden\", \"true\");\r\n        iconWrap.appendChild(iconEl);\r\n        content.appendChild(iconWrap);\r\n\r\n        const dateEl = document.createElement(\"h3\");\r\n        dateEl.className = \"date\";\r\n        const timeEl = document.createElement(\"time\");\r\n        timeEl.setAttribute(\"datetime\", ev.date);\r\n        timeEl.textContent = ev.date;\r\n        dateEl.appendChild(timeEl);\r\n\r\n        const relTime = formatRelative(new Date(ev.date));\r\n        if (relTime) {\r\n          const relSpan = document.createElement(\"span\");\r\n          relSpan.className = \"relative-time\";\r\n          relSpan.textContent = relTime;\r\n          dateEl.appendChild(document.createTextNode(\" \"));\r\n          dateEl.appendChild(relSpan);\r\n        }\r\n        content.appendChild(dateEl);\r\n\r\n        const titleEl = document.createElement(\"h3\");\r\n        titleEl.textContent = isFa ? ev.title_fa : ev.title_en;\r\n        content.appendChild(titleEl);\r\n\r\n        const descEl = document.createElement(\"p\");\r\n        descEl.textContent = isFa ? ev.desc_fa : ev.desc_en;\r\n        content.appendChild(descEl);\r\n\r\n        li.appendChild(content);\r\n        timelineList.appendChild(li);\r\n      });\r\n    }\r\n\r\n    function updateSortButton() {\r\n      if (!sortBtn) {\r\n        return;\r\n      }\r\n      sortBtn.textContent = isFa\r\n        ? sortAsc\r\n          ? \"قدیمی‌ترین\"\r\n          : \"جدیدترین\"\r\n        : sortAsc\r\n        ? \"Oldest first\"\r\n        : \"Newest first\";\r\n    }\r\n\r\n    updateSortButton();\r\n\r\n    function initializeTimeline() {\r\n      const timelineItems = document.querySelectorAll(\".timeline li\");\r\n      if (!timelineItems.length) {\r\n        return;\r\n      }\r\n\r\n      if (\"IntersectionObserver\" in window) {\r\n        const observer = new IntersectionObserver(\r\n          (entries, obs) => {\r\n            entries.forEach((entry) => {\r\n              if (entry.isIntersecting) {\r\n                entry.target.classList.add(\"timeline-item-visible\");\r\n                obs.unobserve(entry.target);\r\n              }\r\n            });\r\n          },\r\n          { threshold: 0.3 }\r\n        );\r\n        timelineItems.forEach((item) => observer.observe(item));\r\n      } else {\r\n        timelineItems.forEach((item) =>\r\n          item.classList.add(\"timeline-item-visible\")\r\n        );\r\n      }\r\n    }\r\n\r\n    let debounceTimer = null; // برای debounce سرچ\r\n\r\n    function setupTimelineSearch() {\r\n      if (!timelineList || !timelineSearch || searchInitialized) {\r\n        return;\r\n      }\r\n\r\n      function filterList(term) {\r\n        const q = normalizeText(term.trim());\r\n        const hasQuery = q.length > 0;\r\n\r\n        if (storage) {\r\n          try {\r\n            storage.setItem(TIMELINE_SEARCH_KEY, term);\r\n          } catch {}\r\n        }\r\n\r\n        const yearVal = yearFilter ? yearFilter.value : \"\";\r\n        if (storage && yearFilter) {\r\n          try {\r\n            storage.setItem(TIMELINE_YEAR_KEY, yearVal);\r\n          } catch {}\r\n        }\r\n\r\n        let count = 0;\r\n\r\n        timelineList.querySelectorAll(\"li\").forEach((li) => {\r\n          const text = normalizeText(li.textContent || \"\");\r\n          const matchQuery = hasQuery ? text.includes(q) : true;\r\n          const matchYear =\r\n            !yearVal || (li.dataset.date || \"\").startsWith(yearVal);\r\n\r\n          const visible = matchQuery && matchYear;\r\n          li.style.display = visible ? \"\" : \"none\";\r\n\r\n          if (visible && hasQuery) {\r\n            count++;\r\n          }\r\n        });\r\n\r\n        if (clearSearchBtn) {\r\n          clearSearchBtn.classList.toggle(\"visually-hidden\", !hasQuery);\r\n        }\r\n\r\n        if (noResultsEl) {\r\n          const noResults = hasQuery && count === 0;\r\n          noResultsEl.classList.toggle(\"hidden\", !noResults);\r\n          noResultsEl.classList.toggle(\"visible\", noResults);\r\n        }\r\n\r\n        if (resultsCountEl) {\r\n          if (hasQuery) {\r\n            resultsCountEl.textContent = isFa\r\n              ? `${count} مورد یافت شد`\r\n              : `${count} result${count === 1 ? \"\" : \"s\"} found`;\r\n            resultsCountEl.classList.remove(\"hidden\");\r\n            resultsCountEl.classList.add(\"visible\");\r\n          } else {\r\n            resultsCountEl.classList.add(\"hidden\");\r\n            resultsCountEl.classList.remove(\"visible\");\r\n          }\r\n        }\r\n      }\r\n\r\n      timelineSearch.addEventListener(\"input\", () => {\r\n        const term = timelineSearch.value;\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = setTimeout(() => {\r\n          filterList(term);\r\n        }, 200);\r\n      });\r\n\r\n      timelineSearch.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Escape\") {\r\n          timelineSearch.value = \"\";\r\n          clearSearchBtn &&\r\n            clearSearchBtn.classList.add(\"visually-hidden\");\r\n          filterList(\"\");\r\n        }\r\n      });\r\n\r\n      clearSearchBtn &&\r\n        clearSearchBtn.addEventListener(\"click\", () => {\r\n          timelineSearch.value = \"\";\r\n          clearSearchBtn.classList.add(\"visually-hidden\");\r\n          filterList(\"\");\r\n        });\r\n\r\n      const saved = storage\r\n        ? storage.getItem(TIMELINE_SEARCH_KEY) || \"\"\r\n        : \"\";\r\n\r\n      if (saved) {\r\n        timelineSearch.value = saved;\r\n      }\r\n\r\n      if (yearFilter) {\r\n        const savedYear = storage\r\n          ? storage.getItem(TIMELINE_YEAR_KEY) || \"\"\r\n          : \"\";\r\n        if (savedYear) {\r\n          yearFilter.value = savedYear;\r\n        }\r\n        yearFilter.addEventListener(\"change\", () =>\r\n          filterList(timelineSearch.value)\r\n        );\r\n      }\r\n\r\n      filterList(saved);\r\n      searchInitialized = true;\r\n\r\n      // Cleanup debounce timer on page unload to prevent memory leaks\r\n      window.addEventListener(\"beforeunload\", () => {\r\n        if (debounceTimer) {\r\n          clearTimeout(debounceTimer);\r\n          debounceTimer = null;\r\n        }\r\n      });\r\n    }\r\n\r\n    function loadTimeline(force = false, btn = null) {\r\n      if (!timelineList) {\r\n        return;\r\n      }\r\n\r\n      while (timelineList.firstChild) {\r\n        timelineList.removeChild(timelineList.firstChild);\r\n      }\r\n      timelineList.setAttribute(\"aria-busy\", \"true\");\r\n\r\n      if (btn) {\r\n        btn.classList.add(\"loading\");\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n      }\r\n\r\n      const key = \"security-timeline\";\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(key);\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(\r\n        \"/assets/data/security-timeline.json\",\r\n        key,\r\n        DAY_MS,\r\n        (res) => res.json()\r\n      )\r\n        .then((events) => {\r\n          timelineData = events;\r\n\r\n          if (yearFilter) {\r\n            const years = Array.from(\r\n              new Set(\r\n                events.map((ev) => new Date(ev.date).getFullYear())\r\n              )\r\n            ).sort((a, b) => b - a);\r\n\r\n            while (yearFilter.firstChild) {\r\n              yearFilter.removeChild(yearFilter.firstChild);\r\n            }\r\n\r\n            const defaultOption = document.createElement(\"option\");\r\n            defaultOption.value = \"\";\r\n            defaultOption.textContent = isFa\r\n              ? \"همه سال‌ها\"\r\n              : \"All years\";\r\n            yearFilter.appendChild(defaultOption);\r\n\r\n            years.forEach((y) => {\r\n              const option = document.createElement(\"option\");\r\n              option.value = String(y);\r\n              option.textContent = String(y);\r\n              yearFilter.appendChild(option);\r\n            });\r\n\r\n            const savedYear = storage\r\n              ? storage.getItem(TIMELINE_YEAR_KEY) || \"\"\r\n              : \"\";\r\n            if (\r\n              savedYear &&\r\n              Array.from(yearFilter.options).some(\r\n                (option) => option.value === savedYear\r\n              )\r\n            ) {\r\n              yearFilter.value = savedYear;\r\n            }\r\n          }\r\n\r\n          renderTimeline(events);\r\n          timelineList.setAttribute(\"aria-busy\", \"false\");\r\n          initializeTimeline();\r\n          setupTimelineSearch();\r\n          if (force && typeof window.createToast === \"function\") {\r\n            window.createToast(messages.refreshed);\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          if (typeof window.createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") {\r\n              msg = messages.offline;\r\n            } else if (err && err.message === \"rate-limit\") {\r\n              msg = messages.rateLimit;\r\n            } else if (err && err.message === \"stale-data\") {\r\n              // استفاده‌ی بی‌سروصدا از داده‌ی staled در ادامه\r\n              msg = \"\";\r\n            }\r\n            if (msg) {\r\n              window.createToast(msg);\r\n            }\r\n          }\r\n\r\n          if (\r\n            err &&\r\n            err.message === \"stale-data\" &&\r\n            err.data &&\r\n            Array.isArray(err.data)\r\n          ) {\r\n            timelineData = err.data;\r\n          } else {\r\n            timelineData = DEFAULT_TIMELINE;\r\n          }\r\n\r\n          renderTimeline(timelineData);\r\n          timelineList.setAttribute(\"aria-busy\", \"false\");\r\n          initializeTimeline();\r\n          setupTimelineSearch();\r\n        })\r\n        .finally(() => {\r\n          if (btn) {\r\n            btn.classList.remove(\"loading\");\r\n            btn.removeAttribute(\"aria-busy\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (timelineList) {\r\n      loadTimeline();\r\n    } else {\r\n      initializeTimeline();\r\n    }\r\n\r\n    // --- Expiration و security.txt ---\r\n\r\n    const expirationEl = document.getElementById(\"policy-expiration\");\r\n    const progressEl = document.getElementById(\r\n      \"policy-expiration-progress\"\r\n    );\r\n    const daysTextEl = document.getElementById(\"expiration-days\");\r\n\r\n    let expireDate = null;\r\n    let expirationIntervalId = null;\r\n\r\n    function updateExpirationDisplay() {\r\n      if (!expireDate || !expirationEl) {\r\n        return;\r\n      }\r\n\r\n      const now = new Date();\r\n      const diffDays = (expireDate - now) / DAY_MS;\r\n      let daysLabel = \"\";\r\n\r\n      if (progressEl) {\r\n        const totalDays = 365;\r\n        const percent = Math.min(\r\n          100,\r\n          Math.max(0, ((totalDays - diffDays) / totalDays) * 100)\r\n        );\r\n        progressEl.value = percent;\r\n        progressEl.removeAttribute(\"aria-hidden\");\r\n\r\n        if (diffDays > 0) {\r\n          daysLabel = isFa\r\n            ? `${Math.ceil(diffDays)} روز باقیمانده`\r\n            : `${Math.ceil(diffDays)} days remaining`;\r\n        } else {\r\n          daysLabel = isFa\r\n            ? \"منقضی شده\"\r\n            : \"Expired\";\r\n        }\r\n\r\n        progressEl.setAttribute(\"aria-valuenow\", percent.toFixed(0));\r\n        progressEl.setAttribute(\"aria-valuetext\", daysLabel);\r\n      }\r\n\r\n      if (daysTextEl) {\r\n        daysTextEl.textContent = daysLabel;\r\n        daysTextEl.classList.remove(\"hidden\");\r\n        daysTextEl.setAttribute(\"aria-hidden\", \"false\");\r\n      }\r\n\r\n      expirationEl.classList.remove(\"expired\", \"expiring\", \"warning\");\r\n      if (progressEl) {\r\n        progressEl.classList.remove(\"expired\", \"expiring\", \"warning\");\r\n      }\r\n\r\n      if (diffDays <= 0) {\r\n        expirationEl.classList.add(\"expired\");\r\n        progressEl && progressEl.classList.add(\"expired\");\r\n      } else if (diffDays <= 30) {\r\n        expirationEl.classList.add(\"expiring\");\r\n        progressEl && progressEl.classList.add(\"expiring\");\r\n      } else if (diffDays <= 90) {\r\n        expirationEl.classList.add(\"warning\");\r\n        progressEl && progressEl.classList.add(\"warning\");\r\n      }\r\n    }\r\n\r\n    function processSecurityTxt(text) {\r\n      const match = text.match(/^Expires:\\s*(.+)$/m);\r\n      if (match) {\r\n        const parsed = new Date(match[1].trim());\r\n        if (Number.isNaN(parsed.getTime())) {\r\n          expirationEl.textContent = isFa\r\n            ? \"تاریخ اعتبار معتبر نیست.\"\r\n            : \"Expiration date is invalid.\";\r\n          return;\r\n        }\r\n\r\n        expireDate = parsed;\r\n        const locale = isFa ? \"fa-IR\" : \"en-US\";\r\n        const opts = {\r\n          year: \"numeric\",\r\n          month: \"long\",\r\n          day: \"numeric\",\r\n        };\r\n        const label = isFa\r\n          ? `اعتبار سیاست تا ${expireDate.toLocaleDateString(\r\n              locale,\r\n              opts\r\n            )}`\r\n          : `Policy valid until ${expireDate.toLocaleDateString(\r\n              locale,\r\n              opts\r\n            )}`;\r\n        expirationEl.textContent = label;\r\n        updateExpirationDisplay();\r\n\r\n        if (expirationIntervalId) {\r\n          clearInterval(expirationIntervalId);\r\n        }\r\n        expirationIntervalId = setInterval(\r\n          updateExpirationDisplay,\r\n          3600000\r\n        );\r\n      } else {\r\n        expirationEl.textContent = isFa\r\n          ? \"تاریخ اعتبار در دسترس نیست.\"\r\n          : \"Expiration date unavailable.\";\r\n      }\r\n    }\r\n\r\n    function loadPolicyExpiration(force = false) {\r\n      if (!expirationEl) {\r\n        return;\r\n      }\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(\"security-txt\");\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(\r\n        \"/.well-known/security.txt\",\r\n        \"security-txt\",\r\n        DAY_MS,\r\n        (res) => res.text()\r\n      )\r\n        .then((text) => {\r\n          processSecurityTxt(text);\r\n        })\r\n        .catch((err) => {\r\n          // اگر داده کش‌شده داریم، از آن استفاده کن\r\n          if (\r\n            err &&\r\n            err.message === \"stale-data\" &&\r\n            typeof err.data === \"string\"\r\n          ) {\r\n            processSecurityTxt(err.data);\r\n            return;\r\n          }\r\n\r\n          expirationEl.textContent = isFa\r\n            ? \"خطا در دریافت تاریخ اعتبار.\"\r\n            : \"Failed to load expiration date.\";\r\n          if (daysTextEl) {\r\n            daysTextEl.classList.add(\"hidden\");\r\n            daysTextEl.setAttribute(\"aria-hidden\", \"true\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (expirationEl) {\r\n      loadPolicyExpiration();\r\n    }\r\n\r\n    // دامنه‌ی scope\r\n    const domainEl = document.getElementById(\"scope-domain\");\r\n    if (domainEl) {\r\n      const codeEl = document.createElement(\"code\");\r\n      codeEl.textContent = location.hostname;\r\n      domainEl.textContent = \"\";\r\n      domainEl.appendChild(codeEl);\r\n    }\r\n\r\n    // آخرین بروزرسانی از GitHub\r\n    const lastUpdatedEl = document.getElementById(\"last-updated-date\");\r\n\r\n    function processLastUpdated(data) {\r\n      if (Array.isArray(data) && data.length > 0) {\r\n        const commitDate = new Date(data[0].commit.committer.date);\r\n        if (Number.isNaN(commitDate.getTime())) {\r\n          return;\r\n        }\r\n        const locale = isFa ? \"fa-IR\" : \"en-US\";\r\n        const opts = {\r\n          year: \"numeric\",\r\n          month: \"long\",\r\n          day: \"numeric\",\r\n        };\r\n        const dateStr = commitDate.toLocaleDateString(locale, opts);\r\n        const rel = formatRelative(commitDate);\r\n        lastUpdatedEl.textContent = rel\r\n          ? `${dateStr} (${rel})`\r\n          : dateStr;\r\n      }\r\n    }\r\n\r\n    function loadLastUpdated(force = false) {\r\n      if (!lastUpdatedEl) {\r\n        return;\r\n      }\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(\"security-last\");\r\n        } catch {}\r\n      }\r\n\r\n      const apiUrl =\r\n        \"https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1\";\r\n\r\n      cachedFetch(apiUrl, \"security-last\", DAY_MS, (res) => res.json())\r\n        .then((data) => {\r\n          processLastUpdated(data);\r\n        })\r\n        .catch((err) => {\r\n          if (err && err.message === \"stale-data\" && err.data) {\r\n            processLastUpdated(err.data);\r\n            return;\r\n          }\r\n\r\n          if (typeof window.createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") {\r\n              msg = messages.offline;\r\n            } else if (err && err.message === \"rate-limit\") {\r\n              msg = messages.rateLimit;\r\n            }\r\n            window.createToast(msg);\r\n          }\r\n        });\r\n    }\r\n\r\n    if (lastUpdatedEl) {\r\n      loadLastUpdated();\r\n    }\r\n\r\n    // --- GitHub Security Advisories ---\r\n\r\n    const advisoriesList = document.getElementById(\"advisories-list\");\r\n    refreshAdvisoriesBtn = document.getElementById(\"refresh-advisories\");\r\n\r\n    function renderAdvisories(advs) {\r\n      if (!advisoriesList) {\r\n        return;\r\n      }\r\n\r\n      while (advisoriesList.firstChild) {\r\n        advisoriesList.removeChild(advisoriesList.firstChild);\r\n      }\r\n\r\n      if (Array.isArray(advs) && advs.length > 0) {\r\n        advs.forEach((adv) => {\r\n          const li = document.createElement(\"li\");\r\n          const link = document.createElement(\"a\");\r\n          link.href = adv.html_url;\r\n          link.target = \"_blank\";\r\n          link.rel = \"noopener noreferrer\";\r\n          link.textContent = adv.summary || adv.ghsa_id || adv.id;\r\n          li.appendChild(link);\r\n\r\n          const advTime = adv.published_at || adv.created_at;\r\n          if (advTime) {\r\n            const span = document.createElement(\"span\");\r\n            span.className = \"adv-time\";\r\n            span.textContent = formatRelative(new Date(advTime));\r\n            li.appendChild(document.createTextNode(\" \"));\r\n            li.appendChild(span);\r\n          }\r\n\r\n          advisoriesList.appendChild(li);\r\n        });\r\n      } else {\r\n        advisoriesList.textContent = isFa\r\n          ? \"موردی یافت نشد.\"\r\n          : \"No advisories found.\";\r\n      }\r\n    }\r\n\r\n    function loadAdvisories(force = false, btn = null) {\r\n      if (!advisoriesList) {\r\n        return;\r\n      }\r\n\r\n      while (advisoriesList.firstChild) {\r\n        advisoriesList.removeChild(advisoriesList.firstChild);\r\n      }\r\n\r\n      if (btn) {\r\n        btn.classList.add(\"loading\");\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n      }\r\n\r\n      const advUrl = \"/assets/data/security-advisories.json\";\r\n      const key = \"security-advisories\";\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(key);\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(advUrl, key, DAY_MS, (res) => res.json())\r\n        .then((advs) => {\r\n          renderAdvisories(advs);\r\n        })\r\n        .catch((err) => {\r\n          if (err && err.message === \"stale-data\" && err.data) {\r\n            renderAdvisories(err.data);\r\n          } else {\r\n            advisoriesList.textContent = isFa\r\n              ? \"خطا در دریافت اعلان‌ها.\"\r\n              : \"Failed to load advisories.\";\r\n          }\r\n\r\n          if (typeof window.createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") {\r\n              msg = messages.offline;\r\n            } else if (err && err.message === \"rate-limit\") {\r\n              msg = messages.rateLimit;\r\n            }\r\n            window.createToast(msg);\r\n          }\r\n        })\r\n        .finally(() => {\r\n          if (btn) {\r\n            btn.classList.remove(\"loading\");\r\n            btn.removeAttribute(\"aria-busy\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (refreshAdvisoriesBtn) {\r\n      refreshAdvisoriesBtn.addEventListener(\"click\", () =>\r\n        loadAdvisories(true, refreshAdvisoriesBtn)\r\n      );\r\n    }\r\n\r\n    if (advisoriesList) {\r\n      const idleLoad = () => loadAdvisories();\r\n      if (\"requestIdleCallback\" in window) {\r\n        requestIdleCallback(idleLoad, { timeout: 2000 });\r\n      } else {\r\n        setTimeout(idleLoad, 1000);\r\n      }\r\n    }\r\n\r\n    if (refreshTimelineBtn) {\r\n      refreshTimelineBtn.addEventListener(\"click\", () =>\r\n        loadTimeline(true, refreshTimelineBtn)\r\n      );\r\n    }\r\n\r\n    if (sortBtn) {\r\n      sortBtn.addEventListener(\"click\", () => {\r\n        sortAsc = !sortAsc;\r\n        if (storage) {\r\n          try {\r\n            storage.setItem(\"timeline-sort\", sortAsc ? \"asc\" : \"desc\");\r\n          } catch {}\r\n        }\r\n        updateSortButton();\r\n        renderTimeline(timelineData);\r\n        initializeTimeline();\r\n        if (timelineSearch) {\r\n          timelineSearch.dispatchEvent(new Event(\"input\"));\r\n        }\r\n      });\r\n      updateSortButton();\r\n    }\r\n\r\n    // شورتکات‌های صفحه تایم‌لاین\r\n    if (timelineSearch) {\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        const activeTag = document.activeElement.tagName.toLowerCase();\r\n        if (\r\n          e.key === \"/\" &&\r\n          activeTag !== \"input\" &&\r\n          activeTag !== \"textarea\" &&\r\n          !e.ctrlKey &&\r\n          !e.metaKey &&\r\n          !e.altKey\r\n        ) {\r\n          e.preventDefault();\r\n          timelineSearch.focus();\r\n        }\r\n      });\r\n\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        const activeTag = document.activeElement.tagName.toLowerCase();\r\n        if (\r\n          (e.key === \"r\" || e.key === \"R\") &&\r\n          activeTag !== \"input\" &&\r\n          activeTag !== \"textarea\" &&\r\n          !e.ctrlKey &&\r\n          !e.metaKey &&\r\n          !e.altKey\r\n        ) {\r\n          e.preventDefault();\r\n          loadTimeline(true);\r\n          loadAdvisories(true);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Share\r\n    document\r\n      .querySelectorAll(\"#share-page, #share-page-button\")\r\n      .forEach((btn) => {\r\n        btn.addEventListener(\"click\", () => {\r\n          if (navigator.share) {\r\n            navigator\r\n              .share({ title: document.title, url: location.href })\r\n              .catch(() => copyTextToClipboard(location.href));\r\n          } else {\r\n            copyTextToClipboard(location.href);\r\n          }\r\n        });\r\n      });\r\n\r\n    const scrollBtn = document.getElementById(\"scroll-to-top\");\r\n    const floatingShare = document.getElementById(\"share-page-button\");\r\n\r\n    function toggleFloatButtons() {\r\n      const show = window.scrollY > 200;\r\n      if (scrollBtn) {\r\n        scrollBtn.classList.toggle(\"visible\", show);\r\n      }\r\n      if (floatingShare) {\r\n        floatingShare.classList.toggle(\"visible\", show);\r\n      }\r\n    }\r\n\r\n    window.addEventListener(\"scroll\", toggleFloatButtons, {\r\n      passive: true,\r\n    });\r\n    toggleFloatButtons();\r\n\r\n    if (scrollBtn) {\r\n      scrollBtn.addEventListener(\"click\", () => {\r\n        window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n      });\r\n    }\r\n\r\n    // --- Online / Offline events ---\r\n    window.addEventListener(\"online\", () => {\r\n      updateConnection();\r\n      if (typeof window.createToast === \"function\") {\r\n        window.createToast(messages.online);\r\n      }\r\n      loadTimeline(true);\r\n      loadAdvisories(true);\r\n      loadPolicyExpiration(true);\r\n      loadLastUpdated(true);\r\n    });\r\n\r\n    window.addEventListener(\"offline\", () => {\r\n      updateConnection();\r\n      if (typeof window.createToast === \"function\") {\r\n        window.createToast(messages.offline);\r\n      }\r\n    });\r\n\r\n    // Cleanup timers and intervals قبل unload\r\n    window.addEventListener(\"beforeunload\", () => {\r\n      if (expirationIntervalId) {\r\n        clearInterval(expirationIntervalId);\r\n        expirationIntervalId = null;\r\n      }\r\n      if (debounceTimer) {\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = null;\r\n      }\r\n    });\r\n\r\n    updateConnection();\r\n  });\r\n})();\r\n"]}