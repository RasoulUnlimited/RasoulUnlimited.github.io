{"version":3,"file":"security-page.min.js","names":["document","addEventListener","isFa","documentElement","lang","toLowerCase","startsWith","messages","success","fail","unsupported","offline","online","refreshed","fetchFail","rateLimit","DAY_MS","formatRelative","date","window","Intl","RelativeTimeFormat","diff","Date","now","getTime","units","locale","unit","ms","Math","abs","numeric","format","round","prefersReduced","matchMedia","addMediaQueryChangeListener","mediaQueryList","handler","addListener","disableMotion","querySelectorAll","forEach","el","removeAttribute","classList","remove","matches","e","smallScreen","normalizeText","str","persianDigits","normalize","replace","d","String","indexOf","getStorage","test","localStorage","setItem","removeItem","sessionStorage","storage","TIMELINE_SEARCH_KEY","TIMELINE_YEAR_KEY","refreshTimelineBtn","refreshAdvisoriesBtn","async","cachedFetch","url","key","ttl","parser","timeout","cached","JSON","parse","getItem","t","navigator","onLine","staleError","Error","data","controller","AbortController","timer","setTimeout","abort","res","fetch","signal","undefined","cache","ok","status","headers","get","statusText","parseErr","console","error","stringify","cacheErr","name","warn","cacheKeys","oldKey","retryErr","clearTimeout","copyTextToClipboard","text","clipboard","writeText","then","createToast","catch","err","hidden","createElement","value","setAttribute","style","position","left","body","appendChild","select","successful","execCommand","removeChild","handleCopyClick","event","btn","currentTarget","dataset","copyText","targetId","copyTarget","targetEl","getElementById","textContent","trim","preventDefault","connectionEl","updateConnection","toggle","disabled","DEFAULT_TIMELINE","icon","title_fa","title_en","desc_fa","desc_en","timelineList","timelineSearch","yearFilter","clearSearchBtn","sortBtn","noResultsEl","resultsCountEl","timelineData","searchInitialized","sortAsc","ALLOWED_ICONS","Set","renderTimeline","events","firstChild","slice","sort","a","b","ev","li","aos","tabIndex","content","className","iconWrap","iconEl","add","iconClass","has","dateEl","timeEl","relTime","relSpan","createTextNode","titleEl","descEl","updateSortButton","initializeTimeline","timelineItems","observer","IntersectionObserver","entries","obs","entry","isIntersecting","target","unobserve","threshold","item","observe","filterDebounceTimer","debounceTimer","setupTimelineSearch","filterList","term","q","hasQuery","length","yearVal","reg","RegExp","count","contentEl","querySelector","origText","match","includes","matchYear","visible","display","parts","split","part","index","span","saved","savedYear","loadTimeline","force","json","years","Array","from","map","getFullYear","defaultOption","y","option","options","some","msg","message","isArray","finally","expirationEl","progressEl","daysTextEl","expireDate","expirationIntervalId","updateExpirationDisplay","diffDays","daysLabel","totalDays","percent","min","max","toFixed","ceil","loadPolicyExpiration","opts","year","month","day","label","toLocaleDateString","clearInterval","setInterval","domainEl","codeEl","location","hostname","lastUpdatedEl","loadLastUpdated","commitDate","commit","committer","dateStr","rel","advisoriesList","loadAdvisories","advUrl","advs","adv","link","href","html_url","summary","ghsa_id","id","advTime","published_at","created_at","idleLoad","requestIdleCallback","dispatchEvent","Event","activeTag","activeElement","tagName","ctrlKey","metaKey","altKey","focus","share","title","scrollBtn","floatingShare","toggleFloatButtons","show","scrollY","passive","scrollTo","top","behavior"],"sources":["security-page.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    const lang = document.documentElement.lang || \"en\";\r\n    const isFa = lang.toLowerCase().startsWith(\"fa\");\r\n\r\n    const messages = {\r\n      success: isFa ? \"کپی شد! ✅\" : \"Copied! ✅\",\r\n      fail: isFa ? \"عملیات کپی ناموفق بود.\" : \"Failed to copy.\",\r\n      unsupported: isFa\r\n        ? \"مرورگر از کپی پشتیبانی نمی‌کند.\"\r\n        : \"Your browser does not support copying.\",\r\n      offline: isFa ? \"شما آفلاین هستید.\" : \"You are offline.\",\r\n      online: isFa ? \"اتصال برقرار شد.\" : \"Back online.\",\r\n      refreshed: isFa ? \"بروزرسانی شد! ✅\" : \"Updated! ✅\",\r\n      fetchFail: isFa ? \"خطا در بارگیری داده.\" : \"Failed to load data.\",\r\n      rateLimit: isFa\r\n        ? \"محدودیت نرخ GitHub فعال شده است.\"\r\n        : \"GitHub rate limit exceeded.\",\r\n    };\r\n\r\n    const DAY_MS = 86400000;\r\n\r\n    function formatRelative(date) {\r\n      if (!date || !window.Intl || !Intl.RelativeTimeFormat) {\r\n        return \"\";\r\n      }\r\n      const diff = Date.now() - date.getTime();\r\n      const units = [\r\n        [\"year\", 31536000000],\r\n        [\"month\", 2592000000],\r\n        [\"week\", 604800000],\r\n        [\"day\", 86400000],\r\n        [\"hour\", 3600000],\r\n        [\"minute\", 60000],\r\n        [\"second\", 1000],\r\n      ];\r\n      const locale = isFa ? \"fa\" : \"en\";\r\n\r\n      for (const [unit, ms] of units) {\r\n        if (Math.abs(diff) >= ms || unit === \"second\") {\r\n          const rtf = new Intl.RelativeTimeFormat(locale, { numeric: \"auto\" });\r\n          return rtf.format(-Math.round(diff / ms), unit);\r\n        }\r\n      }\r\n      return \"\";\r\n    }\r\n\r\n    const prefersReduced = window.matchMedia(\r\n      \"(prefers-reduced-motion: reduce)\"\r\n    );\r\n\r\n    function addMediaQueryChangeListener(mediaQueryList, handler) {\r\n      if (!mediaQueryList || typeof handler !== \"function\") return;\r\n      if (typeof mediaQueryList.addEventListener === \"function\") {\r\n        mediaQueryList.addEventListener(\"change\", handler);\r\n      } else if (typeof mediaQueryList.addListener === \"function\") {\r\n        mediaQueryList.addListener(handler);\r\n      }\r\n    }\r\n\r\n    function disableMotion() {\r\n      document.querySelectorAll(\"[data-aos]\").forEach((el) => {\r\n        el.removeAttribute(\"data-aos\");\r\n      });\r\n      document.querySelectorAll(\".skeleton\").forEach((el) => {\r\n        el.classList.remove(\"skeleton\");\r\n      });\r\n    }\r\n\r\n    // احترام به کاربرانی که motion کم می‌خواهند\r\n    if (prefersReduced.matches) {\r\n      disableMotion();\r\n    }\r\n    addMediaQueryChangeListener(prefersReduced, (e) => {\r\n      if (e.matches) disableMotion();\r\n    });\r\n\r\n    // روی موبایل/اسکرین کوچک هم انیمیشن‌ها حذف شوند\r\n    const smallScreen = window.matchMedia(\"(max-width: 600px)\");\r\n    if (smallScreen.matches) {\r\n      disableMotion();\r\n    }\r\n    addMediaQueryChangeListener(smallScreen, (e) => {\r\n      if (e.matches) disableMotion();\r\n    });\r\n\r\n    function normalizeText(str) {\r\n      if (!str) return \"\";\r\n      const persianDigits = \"۰۱۲۳۴۵۶۷۸۹\";\r\n      return str\r\n        .normalize(\"NFKD\")\r\n        .replace(/[۰-۹]/g, (d) => String(persianDigits.indexOf(d)))\r\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\r\n        .toLowerCase();\r\n    }\r\n\r\n    function getStorage() {\r\n      const test = \"__test\";\r\n      try {\r\n        localStorage.setItem(test, test);\r\n        localStorage.removeItem(test);\r\n        return localStorage;\r\n      } catch (e) {\r\n        try {\r\n          sessionStorage.setItem(test, test);\r\n          sessionStorage.removeItem(test);\r\n          return sessionStorage;\r\n        } catch {\r\n          return null;\r\n        }\r\n      }\r\n    }\r\n\r\n    const storage = getStorage();\r\n    const TIMELINE_SEARCH_KEY = \"timeline-search-term\";\r\n    const TIMELINE_YEAR_KEY = \"timeline-year\";\r\n\r\n    let refreshTimelineBtn;\r\n    let refreshAdvisoriesBtn;\r\n\r\n    async function cachedFetch(\r\n      url,\r\n      key,\r\n      ttl,\r\n      parser,\r\n      timeout = 5000\r\n    ) {\r\n      let cached = null;\r\n      if (storage) {\r\n        try {\r\n          cached = JSON.parse(storage.getItem(key) || \"null\");\r\n        } catch {\r\n          cached = null;\r\n        }\r\n      }\r\n\r\n      // Check if cache is valid and not expired\r\n      const cacheIsValid = cached && (Date.now() - cached.t < ttl);\r\n      \r\n      // Return fresh cache if available and valid\r\n      if (cacheIsValid) {\r\n        return cached.d;\r\n      }\r\n\r\n      // If offline and no valid cache, throw immediately\r\n      if (!navigator.onLine) {\r\n        if (cached && cached.d) {\r\n          // Return stale data but indicate it's stale\r\n          const staleError = new Error(\"stale-data\");\r\n          staleError.data = cached.d;\r\n          throw staleError;\r\n        }\r\n        throw new Error(\"offline\");\r\n      }\r\n\r\n      const controller =\r\n        typeof AbortController !== \"undefined\"\r\n          ? new AbortController()\r\n          : null;\r\n      const timer =\r\n        controller &&\r\n        setTimeout(() => {\r\n          controller.abort();\r\n        }, timeout);\r\n\r\n      try {\r\n        const res = await fetch(url, {\r\n          signal: controller ? controller.signal : undefined,\r\n          cache: \"no-store\",\r\n        });\r\n\r\n        if (!res.ok) {\r\n          if (\r\n            res.status === 403 &&\r\n            res.headers.get(\"X-RateLimit-Remaining\") === \"0\"\r\n          ) {\r\n            throw new Error(\"rate-limit\");\r\n          }\r\n          // Fall back to stale cache if available\r\n          if (cached && cached.d) {\r\n            const staleError = new Error(\"stale-data\");\r\n            staleError.data = cached.d;\r\n            throw staleError;\r\n          }\r\n          throw new Error(res.statusText || \"fetch error\");\r\n        }\r\n\r\n        // Validate parser output before caching\r\n        let data;\r\n        try {\r\n          data = await parser(res);\r\n        } catch (parseErr) {\r\n          console.error(`Parser error for ${key}:`, parseErr);\r\n          throw new Error(\"parse-error\");\r\n        }\r\n\r\n        // Only cache valid data\r\n        if (data != null) {\r\n          if (storage) {\r\n            try {\r\n              storage.setItem(\r\n                key,\r\n                JSON.stringify({ t: Date.now(), d: data })\r\n              );\r\n            } catch (cacheErr) {\r\n              // Handle QuotaExceededError by clearing old cache entries\r\n              if (cacheErr.name === 'QuotaExceededError') {\r\n                console.warn(`localStorage quota exceeded for ${key}, attempting cleanup...`);\r\n                try {\r\n                  // Clear oldest cache entries (those starting with our cache keys)\r\n                  const cacheKeys = ['security-timeline-cache', 'security-advisories-cache'];\r\n                  for (const oldKey of cacheKeys) {\r\n                    if (oldKey !== key) {\r\n                      storage.removeItem(oldKey);\r\n                    }\r\n                  }\r\n                  // Retry the cache operation\r\n                  storage.setItem(\r\n                    key,\r\n                    JSON.stringify({ t: Date.now(), d: data })\r\n                  );\r\n                } catch (retryErr) {\r\n                  console.error(`Failed to cache ${key} even after cleanup:`, retryErr);\r\n                }\r\n              } else {\r\n                console.warn(`Failed to cache ${key}, but returning fresh data:`, cacheErr);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        return data;\r\n      } finally {\r\n        if (timer) clearTimeout(timer);\r\n      }\r\n    }\r\n\r\n    function copyTextToClipboard(text) {\r\n      if (!text) return;\r\n\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        navigator.clipboard\r\n          .writeText(text)\r\n          .then(() => {\r\n            if (typeof createToast === \"function\") {\r\n              createToast(messages.success);\r\n            }\r\n          })\r\n          .catch((err) => {\r\n            console.error(\"Copy failed:\", err);\r\n            if (typeof createToast === \"function\") {\r\n              createToast(messages.fail);\r\n            }\r\n          });\r\n      } else {\r\n        const hidden = document.createElement(\"textarea\");\r\n        hidden.value = text;\r\n        hidden.setAttribute(\"readonly\", \"\");\r\n        hidden.style.position = \"absolute\";\r\n        hidden.style.left = \"-9999px\";\r\n        document.body.appendChild(hidden);\r\n        hidden.select();\r\n        try {\r\n          const successful = document.execCommand(\"copy\");\r\n          if (typeof createToast === \"function\") {\r\n            createToast(successful ? messages.success : messages.fail);\r\n          }\r\n        } catch (err) {\r\n          console.error(\"execCommand copy failed:\", err);\r\n          if (typeof createToast === \"function\") {\r\n            createToast(messages.fail);\r\n          }\r\n        }\r\n        document.body.removeChild(hidden);\r\n      }\r\n    }\r\n\r\n    function handleCopyClick(event) {\r\n      const btn = event.currentTarget;\r\n      let text = btn.dataset.copyText || \"\";\r\n      if (!text) {\r\n        const targetId = btn.dataset.copyTarget;\r\n        const targetEl = document.getElementById(targetId);\r\n        if (targetEl) text = targetEl.textContent.trim();\r\n      }\r\n      copyTextToClipboard(text);\r\n    }\r\n\r\n    // دکمه‌ها و المنت‌های قابل کپی\r\n    document.querySelectorAll(\".copy-button\").forEach((btn) => {\r\n      btn.addEventListener(\"click\", handleCopyClick);\r\n    });\r\n\r\n    document.querySelectorAll(\".copyable\").forEach((el) => {\r\n      const handler = () =>\r\n        copyTextToClipboard(el.dataset.copyText || el.textContent.trim());\r\n      el.addEventListener(\"click\", handler);\r\n      el.addEventListener(\"keypress\", (e) => {\r\n        if (e.key === \"Enter\" || e.key === \" \") {\r\n          e.preventDefault();\r\n          handler();\r\n        }\r\n      });\r\n    });\r\n\r\n    const connectionEl = document.getElementById(\"connection-status\");\r\n\r\n    function updateConnection() {\r\n      if (!connectionEl) return;\r\n      const online = navigator.onLine;\r\n\r\n      connectionEl.textContent = online\r\n        ? isFa\r\n          ? \"اتصال اینترنت برقرار است.\"\r\n          : \"You are online.\"\r\n        : isFa\r\n        ? \"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.\"\r\n        : \"You are offline. Some features may be unavailable.\";\r\n\r\n      document.body.classList.toggle(\"offline\", !online);\r\n\r\n      [refreshTimelineBtn, refreshAdvisoriesBtn].forEach((btn) => {\r\n        if (btn) btn.disabled = !online;\r\n      });\r\n    }\r\n\r\n    // --- تایم‌لاین و فیلترها ---\r\n\r\n    const DEFAULT_TIMELINE = [\r\n      {\r\n        date: \"2025-05-16\",\r\n        icon: \"fa-rocket\",\r\n        title_fa: \"شروع وب‌سایت\",\r\n        title_en: \"Website launched\",\r\n        desc_fa: \"انتشار اولیه سایت با نگاه به امنیت و عملکرد.\",\r\n        desc_en: \"Initial release with a focus on performance and safety.\",\r\n      },\r\n      {\r\n        date: \"2025-05-25\",\r\n        icon: \"fa-cloud\",\r\n        title_fa: \"ادغام با Cloudflare\",\r\n        title_en: \"Integrated with Cloudflare\",\r\n        desc_fa: \"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.\",\r\n        desc_en: \"Enhanced speed and security via Cloudflare CDN.\",\r\n      },\r\n      {\r\n        date: \"2025-06-01\",\r\n        icon: \"fa-shield-alt\",\r\n        title_fa: \"اعمال CSP سخت‌گیرانه\",\r\n        title_en: \"Strict CSP enforced\",\r\n        desc_fa: \"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.\",\r\n        desc_en: \"Implemented tighter policies to prevent web attacks.\",\r\n      },\r\n      {\r\n        date: \"2025-07-10\",\r\n        icon: \"fa-key\",\r\n        title_fa: \"انتشار کلید عمومی PGP\",\r\n        title_en: \"PGP key published\",\r\n        desc_fa: \"امکان ارتباط رمزنگاری‌شده فراهم شد.\",\r\n        desc_en: \"Secure encrypted communication enabled.\",\r\n      },\r\n      {\r\n        date: \"2025-07-20\",\r\n        icon: \"fa-bell\",\r\n        title_fa: \"راه‌اندازی اعلان‌های امنیتی\",\r\n        title_en: \"Security advisories live\",\r\n        desc_fa: \"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.\",\r\n        desc_en: \"Security updates now published via GitHub advisories.\",\r\n      },\r\n      {\r\n        date: \"2025-10-01\",\r\n        icon: \"fa-wifi\",\r\n        title_fa: \"افزودن پشتیبانی آفلاین\",\r\n        title_en: \"Offline support added\",\r\n        desc_fa:\r\n          \"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.\",\r\n        desc_en:\r\n          \"Improved user experience with local caching and connection status alerts.\",\r\n      },\r\n    ];\r\n\r\n    const timelineList = document.getElementById(\"security-timeline-list\");\r\n    const timelineSearch = document.getElementById(\"timeline-search\");\r\n    const yearFilter = document.getElementById(\"timeline-year\");\r\n    const clearSearchBtn = document.getElementById(\"clear-timeline-search\");\r\n    refreshTimelineBtn = document.getElementById(\"refresh-timeline\");\r\n    const sortBtn = document.getElementById(\"sort-timeline\");\r\n    const noResultsEl = document.getElementById(\"timeline-no-results\");\r\n    const resultsCountEl = document.getElementById(\"timeline-results-count\");\r\n\r\n    let timelineData = [];\r\n    let searchInitialized = false;\r\n    let sortAsc = storage\r\n      ? storage.getItem(\"timeline-sort\") === \"asc\"\r\n      : false;\r\n\r\n    // Strict whitelist of allowed Font Awesome icon classes - defined once outside loop\r\n    const ALLOWED_ICONS = new Set([\r\n      \"fa-rocket\", \"fa-cloud\", \"fa-shield-alt\", \"fa-key\", \r\n      \"fa-bell\", \"fa-wifi\", \"fa-lock\", \"fa-shield\", \r\n      \"fa-check\", \"fa-star\", \"fa-bookmark\", \"fa-award\"\r\n    ]);\r\n\r\n    function renderTimeline(events) {\r\n      if (!timelineList) return;\r\n\r\n      // Clear safely without using innerHTML to prevent XSS\r\n      while (timelineList.firstChild) {\r\n        timelineList.removeChild(timelineList.firstChild);\r\n      }\r\n      const sorted = events\r\n        .slice()\r\n        .sort((a, b) =>\r\n          sortAsc\r\n            ? new Date(a.date) - new Date(b.date)\r\n            : new Date(b.date) - new Date(a.date)\r\n        );\r\n\r\n      sorted.forEach((ev) => {\r\n        const li = document.createElement(\"li\");\r\n        li.dataset.aos = \"fade-up\";\r\n        li.dataset.date = ev.date;\r\n        li.tabIndex = 0;\r\n        li.setAttribute(\"role\", \"listitem\");\r\n\r\n        const content = document.createElement(\"div\");\r\n        content.className = \"timeline-content\";\r\n\r\n        const iconWrap = document.createElement(\"div\");\r\n        iconWrap.className = \"timeline-icon\";\r\n        const iconEl = document.createElement(\"i\");\r\n        iconEl.classList.add(\"fas\");\r\n        \r\n        const iconClass =\r\n          typeof ev.icon === \"string\" && ALLOWED_ICONS.has(ev.icon)\r\n            ? ev.icon\r\n            : \"fa-shield-alt\";\r\n        iconEl.classList.add(iconClass);\r\n        iconEl.setAttribute(\"aria-hidden\", \"true\");\r\n        iconWrap.appendChild(iconEl);\r\n        content.appendChild(iconWrap);\r\n\r\n        const dateEl = document.createElement(\"h3\");\r\n        dateEl.className = \"date\";\r\n        const timeEl = document.createElement(\"time\");\r\n        timeEl.setAttribute(\"datetime\", ev.date);\r\n        timeEl.textContent = ev.date;\r\n        dateEl.appendChild(timeEl);\r\n\r\n        const relTime = formatRelative(new Date(ev.date));\r\n        if (relTime) {\r\n          const relSpan = document.createElement(\"span\");\r\n          relSpan.className = \"relative-time\";\r\n          relSpan.textContent = relTime;\r\n          dateEl.appendChild(document.createTextNode(\" \"));\r\n          dateEl.appendChild(relSpan);\r\n        }\r\n        content.appendChild(dateEl);\r\n\r\n        const titleEl = document.createElement(\"h3\");\r\n        titleEl.textContent = isFa ? ev.title_fa : ev.title_en;\r\n        content.appendChild(titleEl);\r\n\r\n        const descEl = document.createElement(\"p\");\r\n        descEl.textContent = isFa ? ev.desc_fa : ev.desc_en;\r\n        content.appendChild(descEl);\r\n\r\n        li.appendChild(content);\r\n        timelineList.appendChild(li);\r\n      });\r\n    }\r\n\r\n    function updateSortButton() {\r\n      if (!sortBtn) return;\r\n      sortBtn.textContent = isFa\r\n        ? sortAsc\r\n          ? \"قدیمی‌ترین\"\r\n          : \"جدیدترین\"\r\n        : sortAsc\r\n        ? \"Oldest first\"\r\n        : \"Newest first\";\r\n    }\r\n\r\n    updateSortButton();\r\n\r\n    function initializeTimeline() {\r\n      const timelineItems = document.querySelectorAll(\".timeline li\");\r\n      if (\"IntersectionObserver\" in window) {\r\n        const observer = new IntersectionObserver(\r\n          (entries, obs) => {\r\n            entries.forEach((entry) => {\r\n              if (entry.isIntersecting) {\r\n                entry.target.classList.add(\"timeline-item-visible\");\r\n                obs.unobserve(entry.target);\r\n              }\r\n            });\r\n          },\r\n          { threshold: 0.3 }\r\n        );\r\n        timelineItems.forEach((item) => observer.observe(item));\r\n      } else {\r\n        timelineItems.forEach((item) =>\r\n          item.classList.add(\"timeline-item-visible\")\r\n        );\r\n      }\r\n    }\r\n\r\n    let filterDebounceTimer = null;\r\n    let debounceTimer = null;  // Declare at module scope for proper cleanup\r\n\r\n    function setupTimelineSearch() {\r\n      if (!timelineList || !timelineSearch || searchInitialized) return;\r\n\r\n      function filterList(term) {\r\n        const q = normalizeText(term.trim());\r\n        const hasQuery = q.length > 0;\r\n\r\n        if (storage) {\r\n          try {\r\n            storage.setItem(TIMELINE_SEARCH_KEY, term);\r\n          } catch {}\r\n        }\r\n\r\n        const yearVal = yearFilter ? yearFilter.value : \"\";\r\n        if (storage && yearFilter) {\r\n          try {\r\n            storage.setItem(TIMELINE_YEAR_KEY, yearVal);\r\n          } catch {}\r\n        }\r\n\r\n        const reg = hasQuery\r\n          ? new RegExp(\r\n              `(${q.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\")})`,\r\n              \"gi\"\r\n            )\r\n          : null;\r\n\r\n        let count = 0;\r\n\r\n        timelineList.querySelectorAll(\"li\").forEach((li) => {\r\n          const contentEl = li.querySelector(\".timeline-content\");\r\n          if (!contentEl) return;\r\n\r\n          // Cache text content instead of full HTML to avoid memory bloat\r\n          if (!li.dataset.origText) li.dataset.origText = contentEl.textContent;\r\n\r\n          const text = normalizeText(li.textContent);\r\n          const match = hasQuery && text.includes(q);\r\n          const matchYear =\r\n            !yearVal || (li.dataset.date || \"\").startsWith(yearVal);\r\n\r\n          const visible = (match || !hasQuery) && matchYear;\r\n          li.style.display = visible ? \"\" : \"none\";\r\n\r\n          if (visible && match && reg) {\r\n            count++;\r\n            // Rebuild content from cached text with highlighting\r\n            const origText = li.dataset.origText;\r\n            const parts = origText.split(reg);\r\n            contentEl.textContent = \"\";\r\n            parts.forEach((part, index) => {\r\n              if (index % 2 === 1) {\r\n                // This is a match - wrapped in highlight span\r\n                const span = document.createElement(\"span\");\r\n                span.className = \"search-highlight\";\r\n                span.textContent = part;\r\n                contentEl.appendChild(span);\r\n              } else if (part) {\r\n                contentEl.appendChild(document.createTextNode(part));\r\n              }\r\n            });\r\n          } else {\r\n            // Restore original text content\r\n            contentEl.textContent = li.dataset.origText;\r\n          }\r\n        });\r\n\r\n        if (clearSearchBtn) {\r\n          clearSearchBtn.classList.toggle(\"visually-hidden\", !hasQuery);\r\n        }\r\n\r\n        if (noResultsEl) {\r\n          noResultsEl.classList.toggle(\"hidden\", count !== 0);\r\n          noResultsEl.classList.toggle(\"visible\", count === 0);\r\n        }\r\n\r\n        if (resultsCountEl) {\r\n          if (hasQuery) {\r\n            resultsCountEl.textContent = isFa\r\n              ? `${count} مورد یافت شد`\r\n              : `${count} result${count === 1 ? \"\" : \"s\"} found`;\r\n            resultsCountEl.classList.remove(\"hidden\");\r\n            resultsCountEl.classList.add(\"visible\");\r\n          } else {\r\n            resultsCountEl.classList.add(\"hidden\");\r\n            resultsCountEl.classList.remove(\"visible\");\r\n          }\r\n        }\r\n      }\r\n\r\n      // Use debounceTimer at module scope for proper cleanup\r\n      timelineSearch.addEventListener(\"input\", () => {\r\n        const term = timelineSearch.value;\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = setTimeout(() => {\r\n          filterList(term);\r\n        }, 200);\r\n      });\r\n\r\n      timelineSearch.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Escape\") {\r\n          timelineSearch.value = \"\";\r\n          clearSearchBtn &&\r\n            clearSearchBtn.classList.add(\"visually-hidden\");\r\n          filterList(\"\");\r\n        }\r\n      });\r\n\r\n      clearSearchBtn &&\r\n        clearSearchBtn.addEventListener(\"click\", () => {\r\n          timelineSearch.value = \"\";\r\n          clearSearchBtn.classList.add(\"visually-hidden\");\r\n          filterList(\"\");\r\n        });\r\n\r\n      const saved = storage\r\n        ? storage.getItem(TIMELINE_SEARCH_KEY) || \"\"\r\n        : \"\";\r\n\r\n      if (saved) {\r\n        timelineSearch.value = saved;\r\n      }\r\n\r\n      if (yearFilter) {\r\n        const savedYear = storage\r\n          ? storage.getItem(TIMELINE_YEAR_KEY) || \"\"\r\n          : \"\";\r\n        if (savedYear) yearFilter.value = savedYear;\r\n        yearFilter.addEventListener(\"change\", () =>\r\n          filterList(timelineSearch.value)\r\n        );\r\n      }\r\n\r\n      filterList(saved);\r\n      searchInitialized = true;\r\n\r\n      // Cleanup debounce timer on page unload to prevent memory leaks\r\n      window.addEventListener(\"beforeunload\", () => {\r\n        if (filterDebounceTimer) {\r\n          clearTimeout(filterDebounceTimer);\r\n          filterDebounceTimer = null;\r\n        }\r\n        if (debounceTimer) {\r\n          clearTimeout(debounceTimer);\r\n          debounceTimer = null;\r\n        }\r\n      });\r\n    }\r\n\r\n    function loadTimeline(force = false, btn = null) {\r\n      if (!timelineList) return;\r\n\r\n      // Clear safely without using innerHTML to prevent XSS\r\n      while (timelineList.firstChild) {\r\n        timelineList.removeChild(timelineList.firstChild);\r\n      }\r\n      timelineList.setAttribute(\"aria-busy\", \"true\");\r\n\r\n      if (btn) {\r\n        btn.classList.add(\"loading\");\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n      }\r\n\r\n      const key = \"security-timeline\";\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(key);\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(\r\n        \"/assets/data/security-timeline.json\",\r\n        key,\r\n        DAY_MS,\r\n        (res) => res.json()\r\n      )\r\n        .then((events) => {\r\n          timelineData = events;\r\n\r\n          if (yearFilter) {\r\n            const years = Array.from(\r\n              new Set(\r\n                events.map((ev) => new Date(ev.date).getFullYear())\r\n              )\r\n            ).sort((a, b) => b - a);\r\n\r\n            // Clear safely without using innerHTML\r\n            while (yearFilter.firstChild) {\r\n              yearFilter.removeChild(yearFilter.firstChild);\r\n            }\r\n            \r\n            const defaultOption = document.createElement(\"option\");\r\n            defaultOption.value = \"\";\r\n            defaultOption.textContent = isFa\r\n              ? \"همه سال‌ها\"\r\n              : \"All years\";\r\n            yearFilter.appendChild(defaultOption);\r\n\r\n            years.forEach((y) => {\r\n              const option = document.createElement(\"option\");\r\n              option.value = String(y);\r\n              option.textContent = String(y);\r\n              yearFilter.appendChild(option);\r\n            });\r\n\r\n            const savedYear = storage\r\n              ? storage.getItem(TIMELINE_YEAR_KEY) || \"\"\r\n              : \"\";\r\n            if (\r\n              savedYear &&\r\n              Array.from(yearFilter.options).some(\r\n                (option) => option.value === savedYear\r\n              )\r\n            ) {\r\n              yearFilter.value = savedYear;\r\n            }\r\n          }\r\n\r\n          renderTimeline(events);\r\n          timelineList.setAttribute(\"aria-busy\", \"false\");\r\n          initializeTimeline();\r\n          setupTimelineSearch();\r\n          if (force && typeof createToast === \"function\") {\r\n            createToast(messages.refreshed);\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          if (typeof createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") msg = messages.offline;\r\n            else if (err && err.message === \"rate-limit\")\r\n              msg = messages.rateLimit;\r\n            else if (err && err.message === \"stale-data\") {\r\n              // Silently use stale data without notifying user\r\n              if (err.data && Array.isArray(err.data)) {\r\n                timelineData = err.data;\r\n                renderTimeline(timelineData);\r\n                timelineList.setAttribute(\"aria-busy\", \"false\");\r\n                initializeTimeline();\r\n                setupTimelineSearch();\r\n                return; // Skip the default timeline\r\n              }\r\n              msg = messages.fetchFail;\r\n            }\r\n            createToast(msg);\r\n          }\r\n\r\n          timelineData = DEFAULT_TIMELINE;\r\n          renderTimeline(timelineData);\r\n          timelineList.setAttribute(\"aria-busy\", \"false\");\r\n          initializeTimeline();\r\n          setupTimelineSearch();\r\n        })\r\n        .finally(() => {\r\n          if (btn) {\r\n            btn.classList.remove(\"loading\");\r\n            btn.removeAttribute(\"aria-busy\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (timelineList) {\r\n      loadTimeline();\r\n    } else {\r\n      initializeTimeline();\r\n    }\r\n\r\n    // --- Expiration و security.txt ---\r\n\r\n    const expirationEl = document.getElementById(\"policy-expiration\");\r\n    const progressEl = document.getElementById(\r\n      \"policy-expiration-progress\"\r\n    );\r\n    const daysTextEl = document.getElementById(\"expiration-days\");\r\n\r\n    let expireDate = null;\r\n    let expirationIntervalId = null;\r\n\r\n    function updateExpirationDisplay() {\r\n      if (!expireDate || !expirationEl) return;\r\n\r\n      const now = new Date();\r\n      const diffDays = (expireDate - now) / DAY_MS;\r\n      let daysLabel = \"\";\r\n\r\n      if (progressEl) {\r\n        const totalDays = 365;\r\n        const percent = Math.min(\r\n          100,\r\n          Math.max(0, ((totalDays - diffDays) / totalDays) * 100)\r\n        );\r\n        progressEl.value = percent;\r\n        progressEl.removeAttribute(\"aria-hidden\");\r\n        progressEl.setAttribute(\"aria-valuenow\", percent.toFixed(0));\r\n        daysLabel = isFa\r\n          ? `${Math.ceil(diffDays)} روز باقیمانده`\r\n          : `${Math.ceil(diffDays)} days remaining`;\r\n        progressEl.setAttribute(\"aria-valuetext\", daysLabel);\r\n      }\r\n\r\n      if (daysTextEl) {\r\n        daysTextEl.textContent = daysLabel;\r\n        daysTextEl.classList.remove(\"hidden\");\r\n        daysTextEl.setAttribute(\"aria-hidden\", \"false\");\r\n      }\r\n\r\n      expirationEl.classList.remove(\r\n        \"expired\",\r\n        \"expiring\",\r\n        \"warning\"\r\n      );\r\n      if (progressEl) {\r\n        progressEl.classList.remove(\"expired\", \"expiring\", \"warning\");\r\n      }\r\n\r\n      if (diffDays <= 0) {\r\n        expirationEl.classList.add(\"expired\");\r\n        progressEl && progressEl.classList.add(\"expired\");\r\n      } else if (diffDays <= 30) {\r\n        expirationEl.classList.add(\"expiring\");\r\n        progressEl && progressEl.classList.add(\"expiring\");\r\n      } else if (diffDays <= 90) {\r\n        expirationEl.classList.add(\"warning\");\r\n        progressEl && progressEl.classList.add(\"warning\");\r\n      }\r\n    }\r\n\r\n    function loadPolicyExpiration(force = false) {\r\n      if (!expirationEl) return;\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(\"security-txt\");\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(\r\n        \"/.well-known/security.txt\",\r\n        \"security-txt\",\r\n        DAY_MS,\r\n        (res) => res.text()\r\n      )\r\n        .then((text) => {\r\n          const match = text.match(/^Expires:\\s*(.+)$/m);\r\n          if (match) {\r\n            expireDate = new Date(match[1].trim());\r\n            const locale = isFa ? \"fa-IR\" : \"en-US\";\r\n            const opts = {\r\n              year: \"numeric\",\r\n              month: \"long\",\r\n              day: \"numeric\",\r\n            };\r\n            const label = isFa\r\n              ? `اعتبار سیاست تا ${expireDate.toLocaleDateString(\r\n                  locale,\r\n                  opts\r\n                )}`\r\n              : `Policy valid until ${expireDate.toLocaleDateString(\r\n                  locale,\r\n                  opts\r\n                )}`;\r\n            expirationEl.textContent = label;\r\n            updateExpirationDisplay();\r\n\r\n            if (expirationIntervalId) {\r\n              clearInterval(expirationIntervalId);\r\n            }\r\n            expirationIntervalId = setInterval(\r\n              updateExpirationDisplay,\r\n              3600000\r\n            );\r\n          } else {\r\n            expirationEl.textContent = isFa\r\n              ? \"تاریخ اعتبار در دسترس نیست.\"\r\n              : \"Expiration date unavailable.\";\r\n          }\r\n        })\r\n        .catch(() => {\r\n          expirationEl.textContent = isFa\r\n            ? \"خطا در دریافت تاریخ اعتبار.\"\r\n            : \"Failed to load expiration date.\";\r\n          if (daysTextEl) {\r\n            daysTextEl.classList.add(\"hidden\");\r\n            daysTextEl.setAttribute(\"aria-hidden\", \"true\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (expirationEl) {\r\n      loadPolicyExpiration();\r\n    }\r\n\r\n    // دامنه‌ی scope\r\n    const domainEl = document.getElementById(\"scope-domain\");\r\n    if (domainEl) {\r\n      const codeEl = document.createElement(\"code\");\r\n      codeEl.textContent = location.hostname;\r\n      domainEl.textContent = \"\";\r\n      domainEl.appendChild(codeEl);\r\n    }\r\n\r\n    // آخرین بروزرسانی از GitHub\r\n    const lastUpdatedEl = document.getElementById(\"last-updated-date\");\r\n\r\n    function loadLastUpdated(force = false) {\r\n      if (!lastUpdatedEl) return;\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(\"security-last\");\r\n        } catch {}\r\n      }\r\n\r\n      const apiUrl =\r\n        \"https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1\";\r\n\r\n      cachedFetch(apiUrl, \"security-last\", DAY_MS, (res) => res.json())\r\n        .then((data) => {\r\n          if (Array.isArray(data) && data.length > 0) {\r\n            const commitDate = new Date(\r\n              data[0].commit.committer.date\r\n            );\r\n            const locale = isFa ? \"fa-IR\" : \"en-US\";\r\n            const opts = {\r\n              year: \"numeric\",\r\n              month: \"long\",\r\n              day: \"numeric\",\r\n            };\r\n            const dateStr = commitDate.toLocaleDateString(\r\n              locale,\r\n              opts\r\n            );\r\n            const rel = formatRelative(commitDate);\r\n            lastUpdatedEl.textContent = rel\r\n              ? `${dateStr} (${rel})`\r\n              : dateStr;\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          if (typeof createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") msg = messages.offline;\r\n            else if (err && err.message === \"rate-limit\")\r\n              msg = messages.rateLimit;\r\n            createToast(msg);\r\n          }\r\n        });\r\n    }\r\n\r\n    if (lastUpdatedEl) {\r\n      loadLastUpdated();\r\n    }\r\n\r\n    // GitHub Security Advisories\r\n    const advisoriesList = document.getElementById(\"advisories-list\");\r\n    refreshAdvisoriesBtn = document.getElementById(\"refresh-advisories\");\r\n\r\n    function loadAdvisories(force = false, btn = null) {\r\n      if (!advisoriesList) return;\r\n\r\n      // Clear safely without using innerHTML to prevent XSS\r\n      while (advisoriesList.firstChild) {\r\n        advisoriesList.removeChild(advisoriesList.firstChild);\r\n      }\r\n\r\n      if (btn) {\r\n        btn.classList.add(\"loading\");\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n      }\r\n\r\n      const advUrl = \"/assets/data/security-advisories.json\";\r\n      const key = \"security-advisories\";\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(key);\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(advUrl, key, DAY_MS, (res) => res.json())\r\n        .then((advs) => {\r\n          if (Array.isArray(advs) && advs.length > 0) {\r\n            advs.forEach((adv) => {\r\n              const li = document.createElement(\"li\");\r\n              const link = document.createElement(\"a\");\r\n              link.href = adv.html_url;\r\n              link.target = \"_blank\";\r\n              link.rel = \"noopener\";\r\n              link.textContent =\r\n                adv.summary || adv.ghsa_id || adv.id;\r\n              li.appendChild(link);\r\n\r\n              const advTime = adv.published_at || adv.created_at;\r\n              if (advTime) {\r\n                const span = document.createElement(\"span\");\r\n                span.className = \"adv-time\";\r\n                span.textContent = formatRelative(new Date(advTime));\r\n                li.appendChild(document.createTextNode(\" \"));\r\n                li.appendChild(span);\r\n              }\r\n\r\n              advisoriesList.appendChild(li);\r\n            });\r\n          } else {\r\n            advisoriesList.textContent = isFa\r\n              ? \"موردی یافت نشد.\"\r\n              : \"No advisories found.\";\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          advisoriesList.textContent = isFa\r\n            ? \"خطا در دریافت اعلان‌ها.\"\r\n            : \"Failed to load advisories.\";\r\n          if (typeof createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") msg = messages.offline;\r\n            else if (err && err.message === \"rate-limit\")\r\n              msg = messages.rateLimit;\r\n            createToast(msg);\r\n          }\r\n        })\r\n        .finally(() => {\r\n          if (btn) {\r\n            btn.classList.remove(\"loading\");\r\n            btn.removeAttribute(\"aria-busy\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (refreshAdvisoriesBtn) {\r\n      refreshAdvisoriesBtn.addEventListener(\"click\", () =>\r\n        loadAdvisories(true, refreshAdvisoriesBtn)\r\n      );\r\n    }\r\n\r\n    if (advisoriesList) {\r\n      const idleLoad = () => loadAdvisories();\r\n      if (\"requestIdleCallback\" in window) {\r\n        requestIdleCallback(idleLoad, { timeout: 2000 });\r\n      } else {\r\n        setTimeout(idleLoad, 1000);\r\n      }\r\n    }\r\n\r\n    if (refreshTimelineBtn) {\r\n      refreshTimelineBtn.addEventListener(\"click\", () =>\r\n        loadTimeline(true, refreshTimelineBtn)\r\n      );\r\n    }\r\n\r\n    if (sortBtn) {\r\n      sortBtn.addEventListener(\"click\", () => {\r\n        sortAsc = !sortAsc;\r\n        if (storage) {\r\n          try {\r\n            storage.setItem(\"timeline-sort\", sortAsc ? \"asc\" : \"desc\");\r\n          } catch {}\r\n        }\r\n        updateSortButton();\r\n        renderTimeline(timelineData);\r\n        initializeTimeline();\r\n        if (timelineSearch) {\r\n          timelineSearch.dispatchEvent(new Event(\"input\"));\r\n        }\r\n      });\r\n      updateSortButton();\r\n    }\r\n\r\n    // شورتکات‌های صفحه تایم‌لاین\r\n    if (timelineSearch) {\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        const activeTag = document.activeElement.tagName.toLowerCase();\r\n        if (\r\n          e.key === \"/\" &&\r\n          activeTag !== \"input\" &&\r\n          activeTag !== \"textarea\" &&\r\n          !e.ctrlKey &&\r\n          !e.metaKey &&\r\n          !e.altKey\r\n        ) {\r\n          e.preventDefault();\r\n          timelineSearch.focus();\r\n        }\r\n      });\r\n\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        const activeTag = document.activeElement.tagName.toLowerCase();\r\n        if (\r\n          (e.key === \"r\" || e.key === \"R\") &&\r\n          activeTag !== \"input\" &&\r\n          activeTag !== \"textarea\" &&\r\n          !e.ctrlKey &&\r\n          !e.metaKey &&\r\n          !e.altKey\r\n        ) {\r\n          e.preventDefault();\r\n          loadTimeline(true);\r\n          loadAdvisories(true);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Share\r\n    document\r\n      .querySelectorAll(\"#share-page, #share-page-button\")\r\n      .forEach((btn) => {\r\n        btn.addEventListener(\"click\", () => {\r\n          if (navigator.share) {\r\n            navigator\r\n              .share({ title: document.title, url: location.href })\r\n              .catch(() => copyTextToClipboard(location.href));\r\n          } else {\r\n            copyTextToClipboard(location.href);\r\n          }\r\n        });\r\n      });\r\n\r\n    const scrollBtn = document.getElementById(\"scroll-to-top\");\r\n    const floatingShare = document.getElementById(\"share-page-button\");\r\n\r\n    function toggleFloatButtons() {\r\n      const show = window.scrollY > 200;\r\n      if (scrollBtn) scrollBtn.classList.toggle(\"visible\", show);\r\n      if (floatingShare)\r\n        floatingShare.classList.toggle(\"visible\", show);\r\n    }\r\n\r\n    window.addEventListener(\"scroll\", toggleFloatButtons, {\r\n      passive: true,\r\n    });\r\n    toggleFloatButtons();\r\n\r\n    if (scrollBtn) {\r\n      scrollBtn.addEventListener(\"click\", () => {\r\n        window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n      });\r\n    }\r\n\r\n    // --- Online / Offline events ---\r\n    window.addEventListener(\"online\", () => {\r\n      updateConnection();\r\n      if (typeof createToast === \"function\") {\r\n        createToast(messages.online);\r\n      }\r\n      loadTimeline(true);\r\n      loadAdvisories(true);\r\n      loadPolicyExpiration(true);\r\n      loadLastUpdated(true);\r\n    });\r\n\r\n    window.addEventListener(\"offline\", () => {\r\n      updateConnection();\r\n      if (typeof createToast === \"function\") {\r\n        createToast(messages.offline);\r\n      }\r\n    });\r\n\r\n    // Cleanup timers and intervals before page unload to prevent memory leaks\r\n    window.addEventListener(\"beforeunload\", () => {\r\n      if (expirationIntervalId) {\r\n        clearInterval(expirationIntervalId);\r\n        expirationIntervalId = null;\r\n      }\r\n      \r\n      // Clear debounce timers to prevent race conditions\r\n      if (debounceTimer) {\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = null;\r\n      }\r\n      if (filterDebounceTimer) {\r\n        clearTimeout(filterDebounceTimer);\r\n        filterDebounceTimer = null;\r\n      }\r\n    });\r\n\r\n    updateConnection();\r\n  });\r\n})();\r\n"]}