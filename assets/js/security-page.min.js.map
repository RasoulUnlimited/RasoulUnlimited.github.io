{"version":3,"file":"security-page.min.js","names":["document","addEventListener","isFa","documentElement","lang","toLowerCase","startsWith","messages","success","fail","unsupported","offline","online","refreshed","fetchFail","rateLimit","DAY_MS","formatRelative","date","window","Intl","RelativeTimeFormat","diff","Date","now","getTime","units","locale","unit","ms","Math","abs","numeric","format","round","prefersReduced","matchMedia","addMediaQueryChangeListener","mediaQueryList","handler","addListener","disableMotion","querySelectorAll","forEach","el","removeAttribute","classList","remove","matches","e","smallScreen","normalizeText","str","normalize","replace","d","String","indexOf","storage","test","localStorage","setItem","removeItem","sessionStorage","getStorage","TIMELINE_SEARCH_KEY","TIMELINE_YEAR_KEY","refreshTimelineBtn","refreshAdvisoriesBtn","async","cachedFetch","url","key","ttl","parser","timeout","cached","JSON","parse","getItem","t","navigator","onLine","staleError","Error","data","controller","AbortController","timer","setTimeout","abort","res","fetch","signal","undefined","cache","ok","status","headers","get","statusText","parseErr","console","error","stringify","cacheErr","name","warn","cacheKeys","oldKey","retryErr","clearTimeout","copyTextToClipboard","text","clipboard","writeText","then","createToast","catch","err","hidden","createElement","value","setAttribute","style","position","left","body","appendChild","select","successful","execCommand","removeChild","handleCopyClick","event","btn","currentTarget","dataset","copyText","targetId","copyTarget","targetEl","getElementById","textContent","trim","preventDefault","connectionEl","updateConnection","toggle","disabled","DEFAULT_TIMELINE","icon","title_fa","title_en","desc_fa","desc_en","timelineList","timelineSearch","yearFilter","clearSearchBtn","sortBtn","noResultsEl","resultsCountEl","timelineData","searchInitialized","sortAsc","ALLOWED_ICONS","Set","renderTimeline","events","firstChild","slice","sort","a","b","ev","li","aos","tabIndex","content","className","iconWrap","iconEl","add","iconClass","has","dateEl","timeEl","relTime","relSpan","createTextNode","titleEl","descEl","updateSortButton","initializeTimeline","timelineItems","observer","IntersectionObserver","entries","obs","entry","isIntersecting","target","unobserve","threshold","item","observe","debounceTimer","setupTimelineSearch","filterList","term","q","hasQuery","length","yearVal","count","matchQuery","includes","matchYear","visible","display","noResults","saved","savedYear","loadTimeline","force","json","years","Array","from","map","getFullYear","defaultOption","y","option","options","some","msg","message","isArray","finally","expirationEl","progressEl","daysTextEl","expireDate","expirationIntervalId","updateExpirationDisplay","diffDays","daysLabel","totalDays","percent","min","max","toFixed","ceil","loadPolicyExpiration","match","opts","year","month","day","label","toLocaleDateString","clearInterval","setInterval","domainEl","codeEl","location","hostname","lastUpdatedEl","loadLastUpdated","commitDate","commit","committer","dateStr","rel","advisoriesList","loadAdvisories","advs","adv","link","href","html_url","summary","ghsa_id","id","advTime","published_at","created_at","span","idleLoad","requestIdleCallback","dispatchEvent","Event","activeTag","activeElement","tagName","ctrlKey","metaKey","altKey","focus","share","title","scrollBtn","floatingShare","toggleFloatButtons","show","scrollY","passive","scrollTo","top","behavior"],"sources":["security-page.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    const lang = document.documentElement.lang || \"en\";\r\n    const isFa = lang.toLowerCase().startsWith(\"fa\");\r\n\r\n    const messages = {\r\n      success: isFa ? \"کپی شد! ✅\" : \"Copied! ✅\",\r\n      fail: isFa ? \"عملیات کپی ناموفق بود.\" : \"Failed to copy.\",\r\n      unsupported: isFa\r\n        ? \"مرورگر از کپی پشتیبانی نمی‌کند.\"\r\n        : \"Your browser does not support copying.\",\r\n      offline: isFa ? \"شما آفلاین هستید.\" : \"You are offline.\",\r\n      online: isFa ? \"اتصال برقرار شد.\" : \"Back online.\",\r\n      refreshed: isFa ? \"بروزرسانی شد! ✅\" : \"Updated! ✅\",\r\n      fetchFail: isFa ? \"خطا در بارگیری داده.\" : \"Failed to load data.\",\r\n      rateLimit: isFa\r\n        ? \"محدودیت نرخ GitHub فعال شده است.\"\r\n        : \"GitHub rate limit exceeded.\",\r\n    };\r\n\r\n    const DAY_MS = 86400000;\r\n\r\n    function formatRelative(date) {\r\n      if (!date || !window.Intl || !Intl.RelativeTimeFormat) {\r\n        return \"\";\r\n      }\r\n      const diff = Date.now() - date.getTime();\r\n      const units = [\r\n        [\"year\", 31536000000],\r\n        [\"month\", 2592000000],\r\n        [\"week\", 604800000],\r\n        [\"day\", 86400000],\r\n        [\"hour\", 3600000],\r\n        [\"minute\", 60000],\r\n        [\"second\", 1000],\r\n      ];\r\n      const locale = isFa ? \"fa\" : \"en\";\r\n\r\n      for (const [unit, ms] of units) {\r\n        if (Math.abs(diff) >= ms || unit === \"second\") {\r\n          const rtf = new Intl.RelativeTimeFormat(locale, { numeric: \"auto\" });\r\n          return rtf.format(-Math.round(diff / ms), unit);\r\n        }\r\n      }\r\n      return \"\";\r\n    }\r\n\r\n    const prefersReduced = window.matchMedia(\r\n      \"(prefers-reduced-motion: reduce)\"\r\n    );\r\n\r\n    function addMediaQueryChangeListener(mediaQueryList, handler) {\r\n      if (!mediaQueryList || typeof handler !== \"function\") {return;}\r\n      if (typeof mediaQueryList.addEventListener === \"function\") {\r\n        mediaQueryList.addEventListener(\"change\", handler);\r\n      } else if (typeof mediaQueryList.addListener === \"function\") {\r\n        mediaQueryList.addListener(handler);\r\n      }\r\n    }\r\n\r\n    function disableMotion() {\r\n      document.querySelectorAll(\"[data-aos]\").forEach((el) => {\r\n        el.removeAttribute(\"data-aos\");\r\n      });\r\n      document.querySelectorAll(\".skeleton\").forEach((el) => {\r\n        el.classList.remove(\"skeleton\");\r\n      });\r\n    }\r\n\r\n    // احترام به کاربرانی که motion کم می‌خواهند\r\n    if (prefersReduced.matches) {\r\n      disableMotion();\r\n    }\r\n    addMediaQueryChangeListener(prefersReduced, (e) => {\r\n      if (e.matches) {disableMotion();}\r\n    });\r\n\r\n    // روی موبایل/اسکرین کوچک هم انیمیشن‌ها حذف شوند\r\n    const smallScreen = window.matchMedia(\"(max-width: 600px)\");\r\n    if (smallScreen.matches) {\r\n      disableMotion();\r\n    }\r\n    addMediaQueryChangeListener(smallScreen, (e) => {\r\n      if (e.matches) {disableMotion();}\r\n    });\r\n\r\n    function normalizeText(str) {\r\n      if (!str) {return \"\";}\r\n      const persianDigits = \"۰۱۲۳۴۵۶۷۸۹\";\r\n      return str\r\n        .normalize(\"NFKD\")\r\n        .replace(/[۰-۹]/g, (d) => String(persianDigits.indexOf(d)))\r\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\r\n        .toLowerCase();\r\n    }\r\n\r\n    function getStorage() {\r\n      const test = \"__test\";\r\n      try {\r\n        localStorage.setItem(test, test);\r\n        localStorage.removeItem(test);\r\n        return localStorage;\r\n      } catch (e) {\r\n        try {\r\n          sessionStorage.setItem(test, test);\r\n          sessionStorage.removeItem(test);\r\n          return sessionStorage;\r\n        } catch {\r\n          return null;\r\n        }\r\n      }\r\n    }\r\n\r\n    const storage = getStorage();\r\n    const TIMELINE_SEARCH_KEY = \"timeline-search-term\";\r\n    const TIMELINE_YEAR_KEY = \"timeline-year\";\r\n\r\n    // eslint-disable-next-line prefer-const\r\n    let refreshTimelineBtn;\r\n    // eslint-disable-next-line prefer-const\r\n    let refreshAdvisoriesBtn;\r\n\r\n    async function cachedFetch(\r\n      url,\r\n      key,\r\n      ttl,\r\n      parser,\r\n      timeout = 5000\r\n    ) {\r\n      let cached = null;\r\n      if (storage) {\r\n        try {\r\n          cached = JSON.parse(storage.getItem(key) || \"null\");\r\n        } catch {\r\n          cached = null;\r\n        }\r\n      }\r\n\r\n      const cacheIsValid = cached && (Date.now() - cached.t < ttl);\r\n\r\n      if (cacheIsValid) {\r\n        return cached.d;\r\n      }\r\n\r\n      if (!navigator.onLine) {\r\n        if (cached && cached.d) {\r\n          const staleError = new Error(\"stale-data\");\r\n          staleError.data = cached.d;\r\n          throw staleError;\r\n        }\r\n        throw new Error(\"offline\");\r\n      }\r\n\r\n      const controller =\r\n        typeof AbortController !== \"undefined\"\r\n          ? new AbortController()\r\n          : null;\r\n      const timer =\r\n        controller &&\r\n        setTimeout(() => {\r\n          controller.abort();\r\n        }, timeout);\r\n\r\n      try {\r\n        const res = await fetch(url, {\r\n          signal: controller ? controller.signal : undefined,\r\n          cache: \"no-store\",\r\n        });\r\n\r\n        if (!res.ok) {\r\n          if (\r\n            res.status === 403 &&\r\n            res.headers.get(\"X-RateLimit-Remaining\") === \"0\"\r\n          ) {\r\n            throw new Error(\"rate-limit\");\r\n          }\r\n          if (cached && cached.d) {\r\n            const staleError = new Error(\"stale-data\");\r\n            staleError.data = cached.d;\r\n            throw staleError;\r\n          }\r\n          throw new Error(res.statusText || \"fetch error\");\r\n        }\r\n\r\n        let data;\r\n        try {\r\n          data = await parser(res);\r\n        } catch (parseErr) {\r\n          console.error(`Parser error for ${key}:`, parseErr);\r\n          throw new Error(\"parse-error\");\r\n        }\r\n\r\n        if (data !== null) {\r\n          if (storage) {\r\n            try {\r\n              storage.setItem(\r\n                key,\r\n                JSON.stringify({ t: Date.now(), d: data })\r\n              );\r\n            } catch (cacheErr) {\r\n              if (cacheErr.name === \"QuotaExceededError\") {\r\n                console.warn(`localStorage quota exceeded for ${key}, attempting cleanup...`);\r\n                try {\r\n                  const cacheKeys = [\"security-timeline-cache\", \"security-advisories-cache\"];\r\n                  for (const oldKey of cacheKeys) {\r\n                    if (oldKey !== key) {\r\n                      storage.removeItem(oldKey);\r\n                    }\r\n                  }\r\n                  storage.setItem(\r\n                    key,\r\n                    JSON.stringify({ t: Date.now(), d: data })\r\n                  );\r\n                } catch (retryErr) {\r\n                  console.error(`Failed to cache ${key} even after cleanup:`, retryErr);\r\n                }\r\n              } else {\r\n                console.warn(`Failed to cache ${key}, but returning fresh data:`, cacheErr);\r\n              }\r\n            }\r\n          }\r\n        }\r\n        return data;\r\n      } finally {\r\n        if (timer) {clearTimeout(timer);}\r\n      }\r\n    }\r\n\r\n    function copyTextToClipboard(text) {\r\n      if (!text) {return;}\r\n\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\r\n        navigator.clipboard\r\n          .writeText(text)\r\n          .then(() => {\r\n            if (typeof createToast === \"function\") {\r\n              createToast(messages.success);\r\n            }\r\n          })\r\n          .catch((err) => {\r\n            console.error(\"Copy failed:\", err);\r\n            if (typeof createToast === \"function\") {\r\n              createToast(messages.fail);\r\n            }\r\n          });\r\n      } else {\r\n        const hidden = document.createElement(\"textarea\");\r\n        hidden.value = text;\r\n        hidden.setAttribute(\"readonly\", \"\");\r\n        hidden.style.position = \"absolute\";\r\n        hidden.style.left = \"-9999px\";\r\n        document.body.appendChild(hidden);\r\n        hidden.select();\r\n        try {\r\n          const successful = document.execCommand(\"copy\");\r\n          if (typeof createToast === \"function\") {\r\n            createToast(successful ? messages.success : messages.fail);\r\n          }\r\n        } catch (err) {\r\n          console.error(\"execCommand copy failed:\", err);\r\n          if (typeof createToast === \"function\") {\r\n            createToast(messages.fail);\r\n          }\r\n        }\r\n        document.body.removeChild(hidden);\r\n      }\r\n    }\r\n\r\n    function handleCopyClick(event) {\r\n      const btn = event.currentTarget;\r\n      let text = btn.dataset.copyText || \"\";\r\n      if (!text) {\r\n        const targetId = btn.dataset.copyTarget;\r\n        const targetEl = document.getElementById(targetId);\r\n        if (targetEl) {text = targetEl.textContent.trim();}\r\n      }\r\n      copyTextToClipboard(text);\r\n    }\r\n\r\n    // دکمه‌ها و المنت‌های قابل کپی\r\n    document.querySelectorAll(\".copy-button\").forEach((btn) => {\r\n      btn.addEventListener(\"click\", handleCopyClick);\r\n    });\r\n\r\n    document.querySelectorAll(\".copyable\").forEach((el) => {\r\n      const handler = () =>\r\n        copyTextToClipboard(el.dataset.copyText || el.textContent.trim());\r\n      el.addEventListener(\"click\", handler);\r\n      el.addEventListener(\"keypress\", (e) => {\r\n        if (e.key === \"Enter\" || e.key === \" \") {\r\n          e.preventDefault();\r\n          handler();\r\n        }\r\n      });\r\n    });\r\n\r\n    const connectionEl = document.getElementById(\"connection-status\");\r\n\r\n    function updateConnection() {\r\n      if (!connectionEl) {return;}\r\n      const online = navigator.onLine;\r\n\r\n      connectionEl.textContent = online\r\n        ? isFa\r\n          ? \"اتصال اینترنت برقرار است.\"\r\n          : \"You are online.\"\r\n        : isFa\r\n          ? \"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.\"\r\n          : \"You are offline. Some features may be unavailable.\";\r\n\r\n      document.body.classList.toggle(\"offline\", !online);\r\n\r\n      [refreshTimelineBtn, refreshAdvisoriesBtn].forEach((btn) => {\r\n        if (btn) {btn.disabled = !online;}\r\n      });\r\n    }\r\n\r\n    // --- تایم‌لاین و فیلترها ---\r\n\r\n    const DEFAULT_TIMELINE = [\r\n      {\r\n        date: \"2025-05-16\",\r\n        icon: \"fa-rocket\",\r\n        title_fa: \"شروع وب‌سایت\",\r\n        title_en: \"Website launched\",\r\n        desc_fa: \"انتشار اولیه سایت با نگاه به امنیت و عملکرد.\",\r\n        desc_en: \"Initial release with a focus on performance and safety.\",\r\n      },\r\n      {\r\n        date: \"2025-05-25\",\r\n        icon: \"fa-cloud\",\r\n        title_fa: \"ادغام با Cloudflare\",\r\n        title_en: \"Integrated with Cloudflare\",\r\n        desc_fa: \"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.\",\r\n        desc_en: \"Enhanced speed and security via Cloudflare CDN.\",\r\n      },\r\n      {\r\n        date: \"2025-06-01\",\r\n        icon: \"fa-shield-alt\",\r\n        title_fa: \"اعمال CSP سخت‌گیرانه\",\r\n        title_en: \"Strict CSP enforced\",\r\n        desc_fa: \"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.\",\r\n        desc_en: \"Implemented tighter policies to prevent web attacks.\",\r\n      },\r\n      {\r\n        date: \"2025-07-10\",\r\n        icon: \"fa-key\",\r\n        title_fa: \"انتشار کلید عمومی PGP\",\r\n        title_en: \"PGP key published\",\r\n        desc_fa: \"امکان ارتباط رمزنگاری‌شده فراهم شد.\",\r\n        desc_en: \"Secure encrypted communication enabled.\",\r\n      },\r\n      {\r\n        date: \"2025-07-20\",\r\n        icon: \"fa-bell\",\r\n        title_fa: \"راه‌اندازی اعلان‌های امنیتی\",\r\n        title_en: \"Security advisories live\",\r\n        desc_fa: \"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.\",\r\n        desc_en: \"Security updates now published via GitHub advisories.\",\r\n      },\r\n      {\r\n        date: \"2025-10-01\",\r\n        icon: \"fa-wifi\",\r\n        title_fa: \"افزودن پشتیبانی آفلاین\",\r\n        title_en: \"Offline support added\",\r\n        desc_fa:\r\n          \"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.\",\r\n        desc_en:\r\n          \"Improved user experience with local caching and connection status alerts.\",\r\n      },\r\n    ];\r\n\r\n    const timelineList = document.getElementById(\"security-timeline-list\");\r\n    const timelineSearch = document.getElementById(\"timeline-search\");\r\n    const yearFilter = document.getElementById(\"timeline-year\");\r\n    const clearSearchBtn = document.getElementById(\"clear-timeline-search\");\r\n    refreshTimelineBtn = document.getElementById(\"refresh-timeline\");\r\n    const sortBtn = document.getElementById(\"sort-timeline\");\r\n    const noResultsEl = document.getElementById(\"timeline-no-results\");\r\n    const resultsCountEl = document.getElementById(\"timeline-results-count\");\r\n\r\n    let timelineData = [];\r\n    let searchInitialized = false;\r\n    let sortAsc = storage\r\n      ? storage.getItem(\"timeline-sort\") === \"asc\"\r\n      : false;\r\n\r\n    // Strict whitelist of allowed Font Awesome icon classes - defined once outside loop\r\n    const ALLOWED_ICONS = new Set([\r\n      \"fa-rocket\", \"fa-cloud\", \"fa-shield-alt\", \"fa-key\",\r\n      \"fa-bell\", \"fa-wifi\", \"fa-lock\", \"fa-shield\",\r\n      \"fa-check\", \"fa-star\", \"fa-bookmark\", \"fa-award\"\r\n    ]);\r\n\r\n    function renderTimeline(events) {\r\n      if (!timelineList) {return;}\r\n\r\n      while (timelineList.firstChild) {\r\n        timelineList.removeChild(timelineList.firstChild);\r\n      }\r\n      const sorted = events\r\n        .slice()\r\n        .sort((a, b) =>\r\n          sortAsc\r\n            ? new Date(a.date) - new Date(b.date)\r\n            : new Date(b.date) - new Date(a.date)\r\n        );\r\n\r\n      sorted.forEach((ev) => {\r\n        const li = document.createElement(\"li\");\r\n        li.dataset.aos = \"fade-up\";\r\n        li.dataset.date = ev.date;\r\n        li.tabIndex = 0;\r\n        li.setAttribute(\"role\", \"listitem\");\r\n\r\n        const content = document.createElement(\"div\");\r\n        content.className = \"timeline-content\";\r\n\r\n        const iconWrap = document.createElement(\"div\");\r\n        iconWrap.className = \"timeline-icon\";\r\n        const iconEl = document.createElement(\"i\");\r\n        iconEl.classList.add(\"fas\");\r\n\r\n        const iconClass =\r\n          typeof ev.icon === \"string\" && ALLOWED_ICONS.has(ev.icon)\r\n            ? ev.icon\r\n            : \"fa-shield-alt\";\r\n        iconEl.classList.add(iconClass);\r\n        iconEl.setAttribute(\"aria-hidden\", \"true\");\r\n        iconWrap.appendChild(iconEl);\r\n        content.appendChild(iconWrap);\r\n\r\n        const dateEl = document.createElement(\"h3\");\r\n        dateEl.className = \"date\";\r\n        const timeEl = document.createElement(\"time\");\r\n        timeEl.setAttribute(\"datetime\", ev.date);\r\n        timeEl.textContent = ev.date;\r\n        dateEl.appendChild(timeEl);\r\n\r\n        const relTime = formatRelative(new Date(ev.date));\r\n        if (relTime) {\r\n          const relSpan = document.createElement(\"span\");\r\n          relSpan.className = \"relative-time\";\r\n          relSpan.textContent = relTime;\r\n          dateEl.appendChild(document.createTextNode(\" \"));\r\n          dateEl.appendChild(relSpan);\r\n        }\r\n        content.appendChild(dateEl);\r\n\r\n        const titleEl = document.createElement(\"h3\");\r\n        titleEl.textContent = isFa ? ev.title_fa : ev.title_en;\r\n        content.appendChild(titleEl);\r\n\r\n        const descEl = document.createElement(\"p\");\r\n        descEl.textContent = isFa ? ev.desc_fa : ev.desc_en;\r\n        content.appendChild(descEl);\r\n\r\n        li.appendChild(content);\r\n        timelineList.appendChild(li);\r\n      });\r\n    }\r\n\r\n    function updateSortButton() {\r\n      if (!sortBtn) {return;}\r\n      sortBtn.textContent = isFa\r\n        ? sortAsc\r\n          ? \"قدیمی‌ترین\"\r\n          : \"جدیدترین\"\r\n        : sortAsc\r\n          ? \"Oldest first\"\r\n          : \"Newest first\";\r\n    }\r\n\r\n    updateSortButton();\r\n\r\n    function initializeTimeline() {\r\n      const timelineItems = document.querySelectorAll(\".timeline li\");\r\n      if (\"IntersectionObserver\" in window) {\r\n        const observer = new IntersectionObserver(\r\n          (entries, obs) => {\r\n            entries.forEach((entry) => {\r\n              if (entry.isIntersecting) {\r\n                entry.target.classList.add(\"timeline-item-visible\");\r\n                obs.unobserve(entry.target);\r\n              }\r\n            });\r\n          },\r\n          { threshold: 0.3 }\r\n        );\r\n        timelineItems.forEach((item) => observer.observe(item));\r\n      } else {\r\n        timelineItems.forEach((item) =>\r\n          item.classList.add(\"timeline-item-visible\")\r\n        );\r\n      }\r\n    }\r\n\r\n    let debounceTimer = null;  // برای debounce سرچ\r\n\r\n    function setupTimelineSearch() {\r\n      if (!timelineList || !timelineSearch || searchInitialized) {return;}\r\n\r\n      function filterList(term) {\r\n        const q = normalizeText(term.trim());\r\n        const hasQuery = q.length > 0;\r\n\r\n        if (storage) {\r\n          try {\r\n            storage.setItem(TIMELINE_SEARCH_KEY, term);\r\n          } catch {}\r\n        }\r\n\r\n        const yearVal = yearFilter ? yearFilter.value : \"\";\r\n        if (storage && yearFilter) {\r\n          try {\r\n            storage.setItem(TIMELINE_YEAR_KEY, yearVal);\r\n          } catch {}\r\n        }\r\n\r\n        let count = 0;\r\n\r\n        timelineList.querySelectorAll(\"li\").forEach((li) => {\r\n          const text = normalizeText(li.textContent || \"\");\r\n          const matchQuery = hasQuery ? text.includes(q) : true;\r\n          const matchYear =\r\n            !yearVal || (li.dataset.date || \"\").startsWith(yearVal);\r\n\r\n          const visible = matchQuery && matchYear;\r\n          li.style.display = visible ? \"\" : \"none\";\r\n\r\n          if (visible && hasQuery) {\r\n            count++;\r\n          }\r\n        });\r\n\r\n        if (clearSearchBtn) {\r\n          clearSearchBtn.classList.toggle(\"visually-hidden\", !hasQuery);\r\n        }\r\n\r\n        if (noResultsEl) {\r\n          const noResults = hasQuery && count === 0;\r\n          noResultsEl.classList.toggle(\"hidden\", !noResults);\r\n          noResultsEl.classList.toggle(\"visible\", noResults);\r\n        }\r\n\r\n        if (resultsCountEl) {\r\n          if (hasQuery) {\r\n            resultsCountEl.textContent = isFa\r\n              ? `${count} مورد یافت شد`\r\n              : `${count} result${count === 1 ? \"\" : \"s\"} found`;\r\n            resultsCountEl.classList.remove(\"hidden\");\r\n            resultsCountEl.classList.add(\"visible\");\r\n          } else {\r\n            resultsCountEl.classList.add(\"hidden\");\r\n            resultsCountEl.classList.remove(\"visible\");\r\n          }\r\n        }\r\n      }\r\n\r\n      timelineSearch.addEventListener(\"input\", () => {\r\n        const term = timelineSearch.value;\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = setTimeout(() => {\r\n          filterList(term);\r\n        }, 200);\r\n      });\r\n\r\n      timelineSearch.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Escape\") {\r\n          timelineSearch.value = \"\";\r\n          clearSearchBtn &&\r\n            clearSearchBtn.classList.add(\"visually-hidden\");\r\n          filterList(\"\");\r\n        }\r\n      });\r\n\r\n      clearSearchBtn &&\r\n        clearSearchBtn.addEventListener(\"click\", () => {\r\n          timelineSearch.value = \"\";\r\n          clearSearchBtn.classList.add(\"visually-hidden\");\r\n          filterList(\"\");\r\n        });\r\n\r\n      const saved = storage\r\n        ? storage.getItem(TIMELINE_SEARCH_KEY) || \"\"\r\n        : \"\";\r\n\r\n      if (saved) {\r\n        timelineSearch.value = saved;\r\n      }\r\n\r\n      if (yearFilter) {\r\n        const savedYear = storage\r\n          ? storage.getItem(TIMELINE_YEAR_KEY) || \"\"\r\n          : \"\";\r\n        if (savedYear) {yearFilter.value = savedYear;}\r\n        yearFilter.addEventListener(\"change\", () =>\r\n          filterList(timelineSearch.value)\r\n        );\r\n      }\r\n\r\n      filterList(saved);\r\n      searchInitialized = true;\r\n\r\n      // Cleanup debounce timer on page unload to prevent memory leaks\r\n      window.addEventListener(\"beforeunload\", () => {\r\n        if (debounceTimer) {\r\n          clearTimeout(debounceTimer);\r\n          debounceTimer = null;\r\n        }\r\n      });\r\n    }\r\n\r\n    function loadTimeline(force = false, btn = null) {\r\n      if (!timelineList) {return;}\r\n\r\n      while (timelineList.firstChild) {\r\n        timelineList.removeChild(timelineList.firstChild);\r\n      }\r\n      timelineList.setAttribute(\"aria-busy\", \"true\");\r\n\r\n      if (btn) {\r\n        btn.classList.add(\"loading\");\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n      }\r\n\r\n      const key = \"security-timeline\";\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(key);\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(\r\n        \"/assets/data/security-timeline.json\",\r\n        key,\r\n        DAY_MS,\r\n        (res) => res.json()\r\n      )\r\n        .then((events) => {\r\n          timelineData = events;\r\n\r\n          if (yearFilter) {\r\n            const years = Array.from(\r\n              new Set(\r\n                events.map((ev) => new Date(ev.date).getFullYear())\r\n              )\r\n            ).sort((a, b) => b - a);\r\n\r\n            while (yearFilter.firstChild) {\r\n              yearFilter.removeChild(yearFilter.firstChild);\r\n            }\r\n\r\n            const defaultOption = document.createElement(\"option\");\r\n            defaultOption.value = \"\";\r\n            defaultOption.textContent = isFa\r\n              ? \"همه سال‌ها\"\r\n              : \"All years\";\r\n            yearFilter.appendChild(defaultOption);\r\n\r\n            years.forEach((y) => {\r\n              const option = document.createElement(\"option\");\r\n              option.value = String(y);\r\n              option.textContent = String(y);\r\n              yearFilter.appendChild(option);\r\n            });\r\n\r\n            const savedYear = storage\r\n              ? storage.getItem(TIMELINE_YEAR_KEY) || \"\"\r\n              : \"\";\r\n            if (\r\n              savedYear &&\r\n              Array.from(yearFilter.options).some(\r\n                (option) => option.value === savedYear\r\n              )\r\n            ) {\r\n              yearFilter.value = savedYear;\r\n            }\r\n          }\r\n\r\n          renderTimeline(events);\r\n          timelineList.setAttribute(\"aria-busy\", \"false\");\r\n          initializeTimeline();\r\n          setupTimelineSearch();\r\n          if (force && typeof createToast === \"function\") {\r\n            createToast(messages.refreshed);\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          if (typeof createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") {msg = messages.offline;}\r\n            else if (err && err.message === \"rate-limit\")\r\n            {msg = messages.rateLimit;}\r\n            else if (err && err.message === \"stale-data\") {\r\n              // استفاده‌ی بی‌سروصدا از داده‌ی staled\r\n              if (err.data && Array.isArray(err.data)) {\r\n                timelineData = err.data;\r\n                renderTimeline(timelineData);\r\n                timelineList.setAttribute(\"aria-busy\", \"false\");\r\n                initializeTimeline();\r\n                setupTimelineSearch();\r\n                return;\r\n              }\r\n              msg = messages.fetchFail;\r\n            }\r\n            createToast(msg);\r\n          }\r\n\r\n          timelineData = DEFAULT_TIMELINE;\r\n          renderTimeline(timelineData);\r\n          timelineList.setAttribute(\"aria-busy\", \"false\");\r\n          initializeTimeline();\r\n          setupTimelineSearch();\r\n        })\r\n        .finally(() => {\r\n          if (btn) {\r\n            btn.classList.remove(\"loading\");\r\n            btn.removeAttribute(\"aria-busy\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (timelineList) {\r\n      loadTimeline();\r\n    } else {\r\n      initializeTimeline();\r\n    }\r\n\r\n    // --- Expiration و security.txt ---\r\n\r\n    const expirationEl = document.getElementById(\"policy-expiration\");\r\n    const progressEl = document.getElementById(\r\n      \"policy-expiration-progress\"\r\n    );\r\n    const daysTextEl = document.getElementById(\"expiration-days\");\r\n\r\n    let expireDate = null;\r\n    let expirationIntervalId = null;\r\n\r\n    function updateExpirationDisplay() {\r\n      if (!expireDate || !expirationEl) {return;}\r\n\r\n      const now = new Date();\r\n      const diffDays = (expireDate - now) / DAY_MS;\r\n      let daysLabel = \"\";\r\n\r\n      if (progressEl) {\r\n        const totalDays = 365;\r\n        const percent = Math.min(\r\n          100,\r\n          Math.max(0, ((totalDays - diffDays) / totalDays) * 100)\r\n        );\r\n        progressEl.value = percent;\r\n        progressEl.removeAttribute(\"aria-hidden\");\r\n        progressEl.setAttribute(\"aria-valuenow\", percent.toFixed(0));\r\n        daysLabel = isFa\r\n          ? `${Math.ceil(diffDays)} روز باقیمانده`\r\n          : `${Math.ceil(diffDays)} days remaining`;\r\n        progressEl.setAttribute(\"aria-valuetext\", daysLabel);\r\n      }\r\n\r\n      if (daysTextEl) {\r\n        daysTextEl.textContent = daysLabel;\r\n        daysTextEl.classList.remove(\"hidden\");\r\n        daysTextEl.setAttribute(\"aria-hidden\", \"false\");\r\n      }\r\n\r\n      expirationEl.classList.remove(\r\n        \"expired\",\r\n        \"expiring\",\r\n        \"warning\"\r\n      );\r\n      if (progressEl) {\r\n        progressEl.classList.remove(\"expired\", \"expiring\", \"warning\");\r\n      }\r\n\r\n      if (diffDays <= 0) {\r\n        expirationEl.classList.add(\"expired\");\r\n        progressEl && progressEl.classList.add(\"expired\");\r\n      } else if (diffDays <= 30) {\r\n        expirationEl.classList.add(\"expiring\");\r\n        progressEl && progressEl.classList.add(\"expiring\");\r\n      } else if (diffDays <= 90) {\r\n        expirationEl.classList.add(\"warning\");\r\n        progressEl && progressEl.classList.add(\"warning\");\r\n      }\r\n    }\r\n\r\n    function loadPolicyExpiration(force = false) {\r\n      if (!expirationEl) {return;}\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(\"security-txt\");\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(\r\n        \"/.well-known/security.txt\",\r\n        \"security-txt\",\r\n        DAY_MS,\r\n        (res) => res.text()\r\n      )\r\n        .then((text) => {\r\n          const match = text.match(/^Expires:\\s*(.+)$/m);\r\n          if (match) {\r\n            expireDate = new Date(match[1].trim());\r\n            const locale = isFa ? \"fa-IR\" : \"en-US\";\r\n            const opts = {\r\n              year: \"numeric\",\r\n              month: \"long\",\r\n              day: \"numeric\",\r\n            };\r\n            const label = isFa\r\n              ? `اعتبار سیاست تا ${expireDate.toLocaleDateString(\r\n                locale,\r\n                opts\r\n              )}`\r\n              : `Policy valid until ${expireDate.toLocaleDateString(\r\n                locale,\r\n                opts\r\n              )}`;\r\n            expirationEl.textContent = label;\r\n            updateExpirationDisplay();\r\n\r\n            if (expirationIntervalId) {\r\n              clearInterval(expirationIntervalId);\r\n            }\r\n            expirationIntervalId = setInterval(\r\n              updateExpirationDisplay,\r\n              3600000\r\n            );\r\n          } else {\r\n            expirationEl.textContent = isFa\r\n              ? \"تاریخ اعتبار در دسترس نیست.\"\r\n              : \"Expiration date unavailable.\";\r\n          }\r\n        })\r\n        .catch(() => {\r\n          expirationEl.textContent = isFa\r\n            ? \"خطا در دریافت تاریخ اعتبار.\"\r\n            : \"Failed to load expiration date.\";\r\n          if (daysTextEl) {\r\n            daysTextEl.classList.add(\"hidden\");\r\n            daysTextEl.setAttribute(\"aria-hidden\", \"true\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (expirationEl) {\r\n      loadPolicyExpiration();\r\n    }\r\n\r\n    // دامنه‌ی scope\r\n    const domainEl = document.getElementById(\"scope-domain\");\r\n    if (domainEl) {\r\n      const codeEl = document.createElement(\"code\");\r\n      codeEl.textContent = location.hostname;\r\n      domainEl.textContent = \"\";\r\n      domainEl.appendChild(codeEl);\r\n    }\r\n\r\n    // آخرین بروزرسانی از GitHub\r\n    const lastUpdatedEl = document.getElementById(\"last-updated-date\");\r\n\r\n    function loadLastUpdated(force = false) {\r\n      if (!lastUpdatedEl) {return;}\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(\"security-last\");\r\n        } catch {}\r\n      }\r\n\r\n      const apiUrl =\r\n        \"https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1\";\r\n\r\n      cachedFetch(apiUrl, \"security-last\", DAY_MS, (res) => res.json())\r\n        .then((data) => {\r\n          if (Array.isArray(data) && data.length > 0) {\r\n            const commitDate = new Date(\r\n              data[0].commit.committer.date\r\n            );\r\n            const locale = isFa ? \"fa-IR\" : \"en-US\";\r\n            const opts = {\r\n              year: \"numeric\",\r\n              month: \"long\",\r\n              day: \"numeric\",\r\n            };\r\n            const dateStr = commitDate.toLocaleDateString(\r\n              locale,\r\n              opts\r\n            );\r\n            const rel = formatRelative(commitDate);\r\n            lastUpdatedEl.textContent = rel\r\n              ? `${dateStr} (${rel})`\r\n              : dateStr;\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          if (typeof createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") {msg = messages.offline;}\r\n            else if (err && err.message === \"rate-limit\")\r\n            {msg = messages.rateLimit;}\r\n            createToast(msg);\r\n          }\r\n        });\r\n    }\r\n\r\n    if (lastUpdatedEl) {\r\n      loadLastUpdated();\r\n    }\r\n\r\n    // GitHub Security Advisories\r\n    const advisoriesList = document.getElementById(\"advisories-list\");\r\n    refreshAdvisoriesBtn = document.getElementById(\"refresh-advisories\");\r\n\r\n    function loadAdvisories(force = false, btn = null) {\r\n      if (!advisoriesList) {return;}\r\n\r\n      while (advisoriesList.firstChild) {\r\n        advisoriesList.removeChild(advisoriesList.firstChild);\r\n      }\r\n\r\n      if (btn) {\r\n        btn.classList.add(\"loading\");\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n      }\r\n\r\n      const advUrl = \"/assets/data/security-advisories.json\";\r\n      const key = \"security-advisories\";\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(key);\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(advUrl, key, DAY_MS, (res) => res.json())\r\n        .then((advs) => {\r\n          if (Array.isArray(advs) && advs.length > 0) {\r\n            advs.forEach((adv) => {\r\n              const li = document.createElement(\"li\");\r\n              const link = document.createElement(\"a\");\r\n              link.href = adv.html_url;\r\n              link.target = \"_blank\";\r\n              link.rel = \"noopener\";\r\n              link.textContent =\r\n                adv.summary || adv.ghsa_id || adv.id;\r\n              li.appendChild(link);\r\n\r\n              const advTime = adv.published_at || adv.created_at;\r\n              if (advTime) {\r\n                const span = document.createElement(\"span\");\r\n                span.className = \"adv-time\";\r\n                span.textContent = formatRelative(new Date(advTime));\r\n                li.appendChild(document.createTextNode(\" \"));\r\n                li.appendChild(span);\r\n              }\r\n\r\n              advisoriesList.appendChild(li);\r\n            });\r\n          } else {\r\n            advisoriesList.textContent = isFa\r\n              ? \"موردی یافت نشد.\"\r\n              : \"No advisories found.\";\r\n          }\r\n        })\r\n        .catch((err) => {\r\n          advisoriesList.textContent = isFa\r\n            ? \"خطا در دریافت اعلان‌ها.\"\r\n            : \"Failed to load advisories.\";\r\n          if (typeof createToast === \"function\") {\r\n            let msg = messages.fetchFail;\r\n            if (err && err.message === \"offline\") {msg = messages.offline;}\r\n            else if (err && err.message === \"rate-limit\")\r\n            {msg = messages.rateLimit;}\r\n            createToast(msg);\r\n          }\r\n        })\r\n        .finally(() => {\r\n          if (btn) {\r\n            btn.classList.remove(\"loading\");\r\n            btn.removeAttribute(\"aria-busy\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (refreshAdvisoriesBtn) {\r\n      refreshAdvisoriesBtn.addEventListener(\"click\", () =>\r\n        loadAdvisories(true, refreshAdvisoriesBtn)\r\n      );\r\n    }\r\n\r\n    if (advisoriesList) {\r\n      const idleLoad = () => loadAdvisories();\r\n      if (\"requestIdleCallback\" in window) {\r\n        requestIdleCallback(idleLoad, { timeout: 2000 });\r\n      } else {\r\n        setTimeout(idleLoad, 1000);\r\n      }\r\n    }\r\n\r\n    if (refreshTimelineBtn) {\r\n      refreshTimelineBtn.addEventListener(\"click\", () =>\r\n        loadTimeline(true, refreshTimelineBtn)\r\n      );\r\n    }\r\n\r\n    if (sortBtn) {\r\n      sortBtn.addEventListener(\"click\", () => {\r\n        sortAsc = !sortAsc;\r\n        if (storage) {\r\n          try {\r\n            storage.setItem(\"timeline-sort\", sortAsc ? \"asc\" : \"desc\");\r\n          } catch {}\r\n        }\r\n        updateSortButton();\r\n        renderTimeline(timelineData);\r\n        initializeTimeline();\r\n        if (timelineSearch) {\r\n          timelineSearch.dispatchEvent(new Event(\"input\"));\r\n        }\r\n      });\r\n      updateSortButton();\r\n    }\r\n\r\n    // شورتکات‌های صفحه تایم‌لاین\r\n    if (timelineSearch) {\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        const activeTag = document.activeElement.tagName.toLowerCase();\r\n        if (\r\n          e.key === \"/\" &&\r\n          activeTag !== \"input\" &&\r\n          activeTag !== \"textarea\" &&\r\n          !e.ctrlKey &&\r\n          !e.metaKey &&\r\n          !e.altKey\r\n        ) {\r\n          e.preventDefault();\r\n          timelineSearch.focus();\r\n        }\r\n      });\r\n\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        const activeTag = document.activeElement.tagName.toLowerCase();\r\n        if (\r\n          (e.key === \"r\" || e.key === \"R\") &&\r\n          activeTag !== \"input\" &&\r\n          activeTag !== \"textarea\" &&\r\n          !e.ctrlKey &&\r\n          !e.metaKey &&\r\n          !e.altKey\r\n        ) {\r\n          e.preventDefault();\r\n          loadTimeline(true);\r\n          loadAdvisories(true);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Share\r\n    document\r\n      .querySelectorAll(\"#share-page, #share-page-button\")\r\n      .forEach((btn) => {\r\n        btn.addEventListener(\"click\", () => {\r\n          if (navigator.share) {\r\n            navigator\r\n              .share({ title: document.title, url: location.href })\r\n              .catch(() => copyTextToClipboard(location.href));\r\n          } else {\r\n            copyTextToClipboard(location.href);\r\n          }\r\n        });\r\n      });\r\n\r\n    const scrollBtn = document.getElementById(\"scroll-to-top\");\r\n    const floatingShare = document.getElementById(\"share-page-button\");\r\n\r\n    function toggleFloatButtons() {\r\n      const show = window.scrollY > 200;\r\n      if (scrollBtn) {scrollBtn.classList.toggle(\"visible\", show);}\r\n      if (floatingShare)\r\n      {floatingShare.classList.toggle(\"visible\", show);}\r\n    }\r\n\r\n    window.addEventListener(\"scroll\", toggleFloatButtons, {\r\n      passive: true,\r\n    });\r\n    toggleFloatButtons();\r\n\r\n    if (scrollBtn) {\r\n      scrollBtn.addEventListener(\"click\", () => {\r\n        window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n      });\r\n    }\r\n\r\n    // --- Online / Offline events ---\r\n    window.addEventListener(\"online\", () => {\r\n      updateConnection();\r\n      if (typeof createToast === \"function\") {\r\n        createToast(messages.online);\r\n      }\r\n      loadTimeline(true);\r\n      loadAdvisories(true);\r\n      loadPolicyExpiration(true);\r\n      loadLastUpdated(true);\r\n    });\r\n\r\n    window.addEventListener(\"offline\", () => {\r\n      updateConnection();\r\n      if (typeof createToast === \"function\") {\r\n        createToast(messages.offline);\r\n      }\r\n    });\r\n\r\n    // Cleanup timers and intervals قبل unload\r\n    window.addEventListener(\"beforeunload\", () => {\r\n      if (expirationIntervalId) {\r\n        clearInterval(expirationIntervalId);\r\n        expirationIntervalId = null;\r\n      }\r\n      if (debounceTimer) {\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = null;\r\n      }\r\n    });\r\n\r\n    updateConnection();\r\n  });\r\n})();\r\n"]}