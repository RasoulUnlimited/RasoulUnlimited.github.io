{"version":3,"file":"security-page.min.js","names":["document","addEventListener","isFa","documentElement","lang","toLowerCase","startsWith","messages","success","fail","unsupported","offline","online","refreshed","fetchFail","rateLimit","DAY_MS","toastCooldowns","Map","emitToast","message","options","window","createToast","id","kind","duration","cooldownMs","now","Date","get","set","rtfCache","RELATIVE_UNITS","formatRelative","date","rtf","locale","Intl","RelativeTimeFormat","numeric","getRelativeTimeFormatter","diff","getTime","unit","ms","Math","abs","format","round","hasMatchMedia","matchMedia","prefersReduced","smallScreen","addMediaQueryChangeListener","mediaQueryList","handler","addListener","disableMotion","querySelectorAll","forEach","el","removeAttribute","classList","remove","normalizeText","str","s","String","normalize","replace","d","indexOf","matches","e","storage","test","localStorage","setItem","removeItem","sessionStorage","getStorage","TIMELINE_SEARCH_KEY","TIMELINE_YEAR_KEY","refreshTimelineBtn","refreshAdvisoriesBtn","async","cachedFetch","url","key","ttl","parser","timeout","cached","JSON","parse","getItem","t","navigator","onLine","staleError","Error","data","controller","AbortController","timer","setTimeout","abort","res","fetch","signal","undefined","cache","ok","status","headers","statusText","parseErr","console","error","stringify","cacheErr","name","warn","cacheKeys","oldKey","retryErr","clearTimeout","copyTextToClipboard","text","clipboard","writeText","then","catch","err","hidden","createElement","value","setAttribute","style","position","left","body","appendChild","select","successful","execCommand","removeChild","handleCopyClick","event","btn","currentTarget","dataset","copyText","targetId","copyTarget","targetEl","getElementById","textContent","trim","preventDefault","connectionEl","updateConnection","toggle","disabled","DEFAULT_TIMELINE","icon","title_fa","title_en","desc_fa","desc_en","timelineList","timelineSearch","yearFilter","clearSearchBtn","sortBtn","noResultsEl","resultsCountEl","timelineData","searchInitialized","sortAsc","ALLOWED_ICONS","Set","renderTimeline","events","firstChild","slice","sort","a","b","ev","li","aos","tabIndex","content","className","iconWrap","iconEl","add","iconClass","has","dateEl","timeEl","relTime","relSpan","createTextNode","titleEl","descEl","updateSortButton","initializeTimeline","timelineItems","length","observer","IntersectionObserver","entries","obs","entry","isIntersecting","target","unobserve","threshold","item","observe","debounceTimer","setupTimelineSearch","filterList","term","q","hasQuery","yearVal","count","matchQuery","includes","matchYear","visible","display","noResults","saved","savedYear","loadTimeline","force","json","years","Array","from","map","getFullYear","defaultOption","y","option","some","msg","isArray","finally","expirationEl","progressEl","daysTextEl","expireDate","expirationIntervalId","updateExpirationDisplay","diffDays","daysLabel","totalDays","percent","min","max","ceil","toFixed","processSecurityTxt","match","parsed","Number","isNaN","opts","year","month","day","label","toLocaleDateString","clearInterval","setInterval","loadPolicyExpiration","domainEl","codeEl","location","hostname","lastUpdatedEl","processLastUpdated","commitDate","commit","committer","dateStr","rel","loadLastUpdated","advisoriesList","renderAdvisories","advs","adv","link","href","html_url","summary","ghsa_id","advTime","published_at","created_at","span","loadAdvisories","idleLoad","requestIdleCallback","dispatchEvent","Event","activeTag","activeElement","tagName","ctrlKey","metaKey","altKey","focus","share","title","scrollBtn","floatingShare","toggleFloatButtons","show","scrollY","passive","scrollTo","top","behavior"],"sources":["security-page.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    const lang = document.documentElement.lang || \"en\";\r\n    const isFa = lang.toLowerCase().startsWith(\"fa\");\r\n\r\n    const messages = {\r\n      success: isFa ? \"کپی شد! ✅\" : \"Copied! ✅\",\r\n      fail: isFa ? \"عملیات کپی ناموفق بود.\" : \"Failed to copy.\",\r\n      unsupported: isFa\r\n        ? \"مرورگر از کپی پشتیبانی نمی‌کند.\"\r\n        : \"Your browser does not support copying.\",\r\n      offline: isFa ? \"شما آفلاین هستید.\" : \"You are offline.\",\r\n      online: isFa ? \"اتصال برقرار شد.\" : \"Back online.\",\r\n      refreshed: isFa ? \"بروزرسانی شد! ✅\" : \"Updated! ✅\",\r\n      fetchFail: isFa ? \"خطا در بارگیری داده.\" : \"Failed to load data.\",\r\n      rateLimit: isFa\r\n        ? \"محدودیت نرخ GitHub فعال شده است.\"\r\n        : \"GitHub rate limit exceeded.\",\r\n    };\r\n\r\n    const DAY_MS = 86400000;\n    const toastCooldowns = new Map();\n\n    function emitToast(message, options = {}) {\n      if (!message || typeof window.createToast !== \"function\") {\n        return;\n      }\n\n      const {\n        id = \"\",\n        kind = \"info\",\n        duration = 2600,\n        cooldownMs = 0,\n      } = options;\n\n      if (id && cooldownMs > 0) {\n        const now = Date.now();\n        const lastAt = toastCooldowns.get(id) || 0;\n        if (now - lastAt < cooldownMs) {\n          return;\n        }\n        toastCooldowns.set(id, now);\n      }\n\n      window.createToast(message, { id, kind, duration });\n    }\n\r\n    // --- Relative time formatter with small cache ---\r\n\r\n    const rtfCache = {};\r\n\r\n    function getRelativeTimeFormatter(locale) {\r\n      if (!window.Intl || !Intl.RelativeTimeFormat) {\r\n        return null;\r\n      }\r\n      if (!rtfCache[locale]) {\r\n        rtfCache[locale] = new Intl.RelativeTimeFormat(locale, {\r\n          numeric: \"auto\",\r\n        });\r\n      }\r\n      return rtfCache[locale];\r\n    }\r\n\r\n    const RELATIVE_UNITS = [\r\n      [\"year\", 31536000000],\r\n      [\"month\", 2592000000],\r\n      [\"week\", 604800000],\r\n      [\"day\", 86400000],\r\n      [\"hour\", 3600000],\r\n      [\"minute\", 60000],\r\n      [\"second\", 1000],\r\n    ];\r\n\r\n    function formatRelative(date) {\r\n      if (!date) {\r\n        return \"\";\r\n      }\r\n\r\n      const locale = isFa ? \"fa\" : \"en\";\r\n      const rtf = getRelativeTimeFormatter(locale);\r\n      if (!rtf) {\r\n        return \"\";\r\n      }\r\n\r\n      const diff = Date.now() - date.getTime();\r\n\r\n      for (const [unit, ms] of RELATIVE_UNITS) {\r\n        if (Math.abs(diff) >= ms || unit === \"second\") {\r\n          return rtf.format(-Math.round(diff / ms), unit);\r\n        }\r\n      }\r\n      return \"\";\r\n    }\r\n\r\n    // --- Motion / reduced motion handling ---\r\n\r\n    const hasMatchMedia = typeof window.matchMedia === \"function\";\r\n    const prefersReduced = hasMatchMedia\r\n      ? window.matchMedia(\"(prefers-reduced-motion: reduce)\")\r\n      : null;\r\n    const smallScreen = hasMatchMedia\r\n      ? window.matchMedia(\"(max-width: 600px)\")\r\n      : null;\r\n\r\n    function addMediaQueryChangeListener(mediaQueryList, handler) {\r\n      if (!mediaQueryList || typeof handler !== \"function\") {\r\n        return;\r\n      }\r\n      if (typeof mediaQueryList.addEventListener === \"function\") {\r\n        mediaQueryList.addEventListener(\"change\", handler);\r\n      } else if (typeof mediaQueryList.addListener === \"function\") {\r\n        mediaQueryList.addListener(handler);\r\n      }\r\n    }\r\n\r\n    function disableMotion() {\r\n      document.querySelectorAll(\"[data-aos]\").forEach((el) => {\r\n        el.removeAttribute(\"data-aos\");\r\n      });\r\n      document.querySelectorAll(\".skeleton\").forEach((el) => {\r\n        el.classList.remove(\"skeleton\");\r\n      });\r\n    }\r\n\r\n    // احترام به کاربرانی که motion کم می‌خواهند\r\n    if (prefersReduced && prefersReduced.matches) {\r\n      disableMotion();\r\n    }\r\n    addMediaQueryChangeListener(prefersReduced, (e) => {\r\n      if (e.matches) {\r\n        disableMotion();\r\n      }\r\n    });\r\n\r\n    // روی موبایل/اسکرین کوچک هم انیمیشن‌ها حذف شوند\r\n    if (smallScreen && smallScreen.matches) {\r\n      disableMotion();\r\n    }\r\n    addMediaQueryChangeListener(smallScreen, (e) => {\r\n      if (e.matches) {\r\n        disableMotion();\r\n      }\r\n    });\r\n\r\n    // --- Text normalization for search ---\r\n\r\n    function normalizeText(str) {\r\n      if (!str) {\r\n        return \"\";\r\n      }\r\n      let s = String(str);\r\n      try {\r\n        if (typeof s.normalize === \"function\") {\r\n          s = s.normalize(\"NFKD\");\r\n        }\r\n      } catch {\r\n        // اگر normalize ساپورت نشود، ادامه می‌دهیم\r\n      }\r\n\r\n      const persianDigits = \"۰۱۲۳۴۵۶۷۸۹\";\r\n      return s\r\n        .replace(/[۰-۹]/g, (d) => String(persianDigits.indexOf(d)))\r\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\r\n        .toLowerCase();\r\n    }\r\n\r\n    // --- Storage wrapper ---\r\n\r\n    function getStorage() {\r\n      const test = \"__test\";\r\n      try {\r\n        localStorage.setItem(test, test);\r\n        localStorage.removeItem(test);\r\n        return localStorage;\r\n      } catch (e) {\r\n        try {\r\n          sessionStorage.setItem(test, test);\r\n          sessionStorage.removeItem(test);\r\n          return sessionStorage;\r\n        } catch {\r\n          return null;\r\n        }\r\n      }\r\n    }\r\n\r\n    const storage = getStorage();\r\n    const TIMELINE_SEARCH_KEY = \"timeline-search-term\";\r\n    const TIMELINE_YEAR_KEY = \"timeline-year\";\r\n\r\n    // eslint-disable-next-line prefer-const\r\n    let refreshTimelineBtn;\r\n    // eslint-disable-next-line prefer-const\r\n    let refreshAdvisoriesBtn;\r\n\r\n    // --- Cached fetch helper ---\r\n\r\n    async function cachedFetch(url, key, ttl, parser, timeout = 5000) {\r\n      let cached = null;\r\n      if (storage) {\r\n        try {\r\n          cached = JSON.parse(storage.getItem(key) || \"null\");\r\n        } catch {\r\n          cached = null;\r\n        }\r\n      }\r\n\r\n      const cacheIsValid = cached && Date.now() - cached.t < ttl;\r\n\r\n      if (cacheIsValid) {\r\n        return cached.d;\r\n      }\r\n\r\n      if (!navigator.onLine) {\r\n        if (cached && cached.d) {\r\n          const staleError = new Error(\"stale-data\");\r\n          staleError.data = cached.d;\r\n          throw staleError;\r\n        }\r\n        throw new Error(\"offline\");\r\n      }\r\n\r\n      const controller =\r\n        typeof AbortController !== \"undefined\"\r\n          ? new AbortController()\r\n          : null;\r\n      const timer =\r\n        controller &&\r\n        setTimeout(() => {\r\n          controller.abort();\r\n        }, timeout);\r\n\r\n      try {\r\n        const res = await fetch(url, {\r\n          signal: controller ? controller.signal : undefined,\r\n          cache: \"no-store\",\r\n        });\r\n\r\n        if (!res.ok) {\r\n          if (\r\n            res.status === 403 &&\r\n            res.headers.get(\"X-RateLimit-Remaining\") === \"0\"\r\n          ) {\r\n            throw new Error(\"rate-limit\");\r\n          }\r\n          if (cached && cached.d) {\r\n            const staleError = new Error(\"stale-data\");\r\n            staleError.data = cached.d;\r\n            throw staleError;\r\n          }\r\n          throw new Error(res.statusText || \"fetch error\");\r\n        }\r\n\r\n        let data;\r\n        try {\r\n          data = await parser(res);\r\n        } catch (parseErr) {\r\n          console.error(`Parser error for ${key}:`, parseErr);\r\n          throw new Error(\"parse-error\");\r\n        }\r\n\r\n        if (data !== null && storage) {\r\n          try {\r\n            storage.setItem(\r\n              key,\r\n              JSON.stringify({ t: Date.now(), d: data })\r\n            );\r\n          } catch (cacheErr) {\r\n            if (cacheErr.name === \"QuotaExceededError\") {\r\n              console.warn(\r\n                `localStorage quota exceeded for ${key}, attempting cleanup...`\r\n              );\r\n              try {\r\n                const cacheKeys = [\r\n                  \"security-timeline-cache\",\r\n                  \"security-advisories-cache\",\r\n                ];\r\n                for (const oldKey of cacheKeys) {\r\n                  if (oldKey !== key) {\r\n                    storage.removeItem(oldKey);\r\n                  }\r\n                }\r\n                storage.setItem(\r\n                  key,\r\n                  JSON.stringify({ t: Date.now(), d: data })\r\n                );\r\n              } catch (retryErr) {\r\n                console.error(\r\n                  `Failed to cache ${key} even after cleanup:`,\r\n                  retryErr\r\n                );\r\n              }\r\n            } else {\r\n              console.warn(\r\n                `Failed to cache ${key}, but returning fresh data:`,\r\n                cacheErr\r\n              );\r\n            }\r\n          }\r\n        }\r\n\r\n        return data;\r\n      } finally {\r\n        if (timer) {\r\n          clearTimeout(timer);\r\n        }\r\n      }\r\n    }\r\n\r\n    // --- Copy helpers ---\r\n\r\n    function copyTextToClipboard(text) {\r\n      if (!text) {\r\n        return;\r\n      }\r\n\r\n      if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard\n          .writeText(text)\n          .then(() => {\n            emitToast(messages.success, {\n              id: \"security-copy-success-toast\",\n              kind: \"success\",\n              duration: 1800,\n              cooldownMs: 300,\n            });\n          })\n          .catch((err) => {\n            console.error(\"Copy failed:\", err);\n            emitToast(messages.fail, {\n              id: \"security-copy-fail-toast\",\n              kind: \"error\",\n              duration: 2600,\n              cooldownMs: 300,\n            });\n          });\n      } else {\n        const hidden = document.createElement(\"textarea\");\r\n        hidden.value = text;\r\n        hidden.setAttribute(\"readonly\", \"\");\r\n        hidden.style.position = \"absolute\";\r\n        hidden.style.left = \"-9999px\";\r\n        document.body.appendChild(hidden);\r\n        hidden.select();\n        try {\n          const successful = document.execCommand(\"copy\");\n          emitToast(successful ? messages.success : messages.fail, {\n            id: successful\n              ? \"security-copy-success-toast\"\n              : \"security-copy-fail-toast\",\n            kind: successful ? \"success\" : \"error\",\n            duration: successful ? 1800 : 2600,\n            cooldownMs: 300,\n          });\n        } catch (err) {\n          console.error(\"execCommand copy failed:\", err);\n          emitToast(messages.fail, {\n            id: \"security-copy-fail-toast\",\n            kind: \"error\",\n            duration: 2600,\n            cooldownMs: 300,\n          });\n        }\n        document.body.removeChild(hidden);\r\n      }\r\n    }\r\n\r\n    function handleCopyClick(event) {\r\n      const btn = event.currentTarget;\r\n      let text = btn.dataset.copyText || \"\";\r\n      if (!text) {\r\n        const targetId = btn.dataset.copyTarget;\r\n        const targetEl = document.getElementById(targetId);\r\n        if (targetEl) {\r\n          text = (targetEl.textContent || \"\").trim();\r\n        }\r\n      }\r\n      copyTextToClipboard(text);\r\n    }\r\n\r\n    // دکمه‌ها و المنت‌های قابل کپی\r\n    document.querySelectorAll(\".copy-button\").forEach((btn) => {\r\n      btn.addEventListener(\"click\", handleCopyClick);\r\n    });\r\n\r\n    document.querySelectorAll(\".copyable\").forEach((el) => {\r\n      const handler = () =>\r\n        copyTextToClipboard(\r\n          el.dataset.copyText || (el.textContent || \"\").trim()\r\n        );\r\n      el.addEventListener(\"click\", handler);\r\n      el.addEventListener(\"keypress\", (e) => {\r\n        if (e.key === \"Enter\" || e.key === \" \") {\r\n          e.preventDefault();\r\n          handler();\r\n        }\r\n      });\r\n    });\r\n\r\n    // --- Connection status ---\r\n\r\n    const connectionEl = document.getElementById(\"connection-status\");\r\n\r\n    function updateConnection() {\r\n      if (!connectionEl) {\r\n        return;\r\n      }\r\n      const online = navigator.onLine;\r\n\r\n      connectionEl.textContent = online\r\n        ? isFa\r\n          ? \"اتصال اینترنت برقرار است.\"\r\n          : \"You are online.\"\r\n        : isFa\r\n          ? \"شما آفلاین هستید. برخی قابلیت‌ها غیرفعال است.\"\r\n          : \"You are offline. Some features may be unavailable.\";\r\n\r\n      document.body.classList.toggle(\"offline\", !online);\r\n\r\n      [refreshTimelineBtn, refreshAdvisoriesBtn].forEach((btn) => {\r\n        if (btn) {\r\n          btn.disabled = !online;\r\n        }\r\n      });\r\n    }\r\n\r\n    // --- Default timeline data ---\r\n\r\n    const DEFAULT_TIMELINE = [\r\n      {\r\n        date: \"2025-05-16\",\r\n        icon: \"fa-rocket\",\r\n        title_fa: \"شروع وب‌سایت\",\r\n        title_en: \"Website launched\",\r\n        desc_fa: \"انتشار اولیه سایت با نگاه به امنیت و عملکرد.\",\r\n        desc_en: \"Initial release with a focus on performance and safety.\",\r\n      },\r\n      {\r\n        date: \"2025-05-25\",\r\n        icon: \"fa-cloud\",\r\n        title_fa: \"ادغام با Cloudflare\",\r\n        title_en: \"Integrated with Cloudflare\",\r\n        desc_fa: \"بهبود سرعت و امنیت از طریق شبکه توزیع کلودفلر.\",\r\n        desc_en: \"Enhanced speed and security via Cloudflare CDN.\",\r\n      },\r\n      {\r\n        date: \"2025-06-01\",\r\n        icon: \"fa-shield-alt\",\r\n        title_fa: \"اعمال CSP سخت‌گیرانه\",\r\n        title_en: \"Strict CSP enforced\",\r\n        desc_fa: \"اجرای سیاست‌های دقیق برای جلوگیری از حملات وب.\",\r\n        desc_en: \"Implemented tighter policies to prevent web attacks.\",\r\n      },\r\n      {\r\n        date: \"2025-07-10\",\r\n        icon: \"fa-key\",\r\n        title_fa: \"انتشار کلید عمومی PGP\",\r\n        title_en: \"PGP key published\",\r\n        desc_fa: \"امکان ارتباط رمزنگاری‌شده فراهم شد.\",\r\n        desc_en: \"Secure encrypted communication enabled.\",\r\n      },\r\n      {\r\n        date: \"2025-07-20\",\r\n        icon: \"fa-bell\",\r\n        title_fa: \"راه‌اندازی اعلان‌های امنیتی\",\r\n        title_en: \"Security advisories live\",\r\n        desc_fa: \"به‌روزرسانی‌های امنیتی از طریق GitHub در دسترس قرار گرفت.\",\r\n        desc_en: \"Security updates now published via GitHub advisories.\",\r\n      },\r\n      {\r\n        date: \"2025-10-01\",\r\n        icon: \"fa-wifi\",\r\n        title_fa: \"افزودن پشتیبانی آفلاین\",\r\n        title_en: \"Offline support added\",\r\n        desc_fa:\r\n          \"بهبود تجربه کاربر با کش محلی و هشدار وضعیت اتصال.\",\r\n        desc_en:\r\n          \"Improved user experience with local caching and connection status alerts.\",\r\n      },\r\n    ];\r\n\r\n    const timelineList = document.getElementById(\"security-timeline-list\");\r\n    const timelineSearch = document.getElementById(\"timeline-search\");\r\n    const yearFilter = document.getElementById(\"timeline-year\");\r\n    const clearSearchBtn = document.getElementById(\"clear-timeline-search\");\r\n    refreshTimelineBtn = document.getElementById(\"refresh-timeline\");\r\n    const sortBtn = document.getElementById(\"sort-timeline\");\r\n    const noResultsEl = document.getElementById(\"timeline-no-results\");\r\n    const resultsCountEl = document.getElementById(\"timeline-results-count\");\r\n\r\n    let timelineData = [];\r\n    let searchInitialized = false;\r\n    let sortAsc = storage\r\n      ? storage.getItem(\"timeline-sort\") === \"asc\"\r\n      : false;\r\n\r\n    // Strict whitelist of allowed Font Awesome icon classes\r\n    const ALLOWED_ICONS = new Set([\r\n      \"fa-rocket\",\r\n      \"fa-cloud\",\r\n      \"fa-shield-alt\",\r\n      \"fa-key\",\r\n      \"fa-bell\",\r\n      \"fa-wifi\",\r\n      \"fa-lock\",\r\n      \"fa-shield\",\r\n      \"fa-check\",\r\n      \"fa-star\",\r\n      \"fa-bookmark\",\r\n      \"fa-award\",\r\n    ]);\r\n\r\n    function renderTimeline(events) {\r\n      if (!timelineList) {\r\n        return;\r\n      }\r\n\r\n      while (timelineList.firstChild) {\r\n        timelineList.removeChild(timelineList.firstChild);\r\n      }\r\n\r\n      const sorted = events\r\n        .slice()\r\n        .sort((a, b) =>\r\n          sortAsc\r\n            ? new Date(a.date) - new Date(b.date)\r\n            : new Date(b.date) - new Date(a.date)\r\n        );\r\n\r\n      sorted.forEach((ev) => {\r\n        const li = document.createElement(\"li\");\r\n        li.dataset.aos = \"fade-up\";\r\n        li.dataset.date = ev.date;\r\n        li.tabIndex = 0;\r\n        li.setAttribute(\"role\", \"listitem\");\r\n\r\n        const content = document.createElement(\"div\");\r\n        content.className = \"timeline-content\";\r\n\r\n        const iconWrap = document.createElement(\"div\");\r\n        iconWrap.className = \"timeline-icon\";\r\n        const iconEl = document.createElement(\"i\");\r\n        iconEl.classList.add(\"fas\");\r\n\r\n        const iconClass =\r\n          typeof ev.icon === \"string\" && ALLOWED_ICONS.has(ev.icon)\r\n            ? ev.icon\r\n            : \"fa-shield-alt\";\r\n        iconEl.classList.add(iconClass);\r\n        iconEl.setAttribute(\"aria-hidden\", \"true\");\r\n        iconWrap.appendChild(iconEl);\r\n        content.appendChild(iconWrap);\r\n\r\n        const dateEl = document.createElement(\"h3\");\r\n        dateEl.className = \"date\";\r\n        const timeEl = document.createElement(\"time\");\r\n        timeEl.setAttribute(\"datetime\", ev.date);\r\n        timeEl.textContent = ev.date;\r\n        dateEl.appendChild(timeEl);\r\n\r\n        const relTime = formatRelative(new Date(ev.date));\r\n        if (relTime) {\r\n          const relSpan = document.createElement(\"span\");\r\n          relSpan.className = \"relative-time\";\r\n          relSpan.textContent = relTime;\r\n          dateEl.appendChild(document.createTextNode(\" \"));\r\n          dateEl.appendChild(relSpan);\r\n        }\r\n        content.appendChild(dateEl);\r\n\r\n        const titleEl = document.createElement(\"h3\");\r\n        titleEl.textContent = isFa ? ev.title_fa : ev.title_en;\r\n        content.appendChild(titleEl);\r\n\r\n        const descEl = document.createElement(\"p\");\r\n        descEl.textContent = isFa ? ev.desc_fa : ev.desc_en;\r\n        content.appendChild(descEl);\r\n\r\n        li.appendChild(content);\r\n        timelineList.appendChild(li);\r\n      });\r\n    }\r\n\r\n    function updateSortButton() {\r\n      if (!sortBtn) {\r\n        return;\r\n      }\r\n      sortBtn.textContent = isFa\r\n        ? sortAsc\r\n          ? \"قدیمی‌ترین\"\r\n          : \"جدیدترین\"\r\n        : sortAsc\r\n          ? \"Oldest first\"\r\n          : \"Newest first\";\r\n    }\r\n\r\n    updateSortButton();\r\n\r\n    function initializeTimeline() {\r\n      const timelineItems = document.querySelectorAll(\".timeline li\");\r\n      if (!timelineItems.length) {\r\n        return;\r\n      }\r\n\r\n      if (\"IntersectionObserver\" in window) {\r\n        const observer = new IntersectionObserver(\r\n          (entries, obs) => {\r\n            entries.forEach((entry) => {\r\n              if (entry.isIntersecting) {\r\n                entry.target.classList.add(\"timeline-item-visible\");\r\n                obs.unobserve(entry.target);\r\n              }\r\n            });\r\n          },\r\n          { threshold: 0.3 }\r\n        );\r\n        timelineItems.forEach((item) => observer.observe(item));\r\n      } else {\r\n        timelineItems.forEach((item) =>\r\n          item.classList.add(\"timeline-item-visible\")\r\n        );\r\n      }\r\n    }\r\n\r\n    let debounceTimer = null; // برای debounce سرچ\r\n\r\n    function setupTimelineSearch() {\r\n      if (!timelineList || !timelineSearch || searchInitialized) {\r\n        return;\r\n      }\r\n\r\n      function filterList(term) {\r\n        const q = normalizeText(term.trim());\r\n        const hasQuery = q.length > 0;\r\n\r\n        if (storage) {\r\n          try {\r\n            storage.setItem(TIMELINE_SEARCH_KEY, term);\r\n          } catch {}\r\n        }\r\n\r\n        const yearVal = yearFilter ? yearFilter.value : \"\";\r\n        if (storage && yearFilter) {\r\n          try {\r\n            storage.setItem(TIMELINE_YEAR_KEY, yearVal);\r\n          } catch {}\r\n        }\r\n\r\n        let count = 0;\r\n\r\n        timelineList.querySelectorAll(\"li\").forEach((li) => {\r\n          const text = normalizeText(li.textContent || \"\");\r\n          const matchQuery = hasQuery ? text.includes(q) : true;\r\n          const matchYear =\r\n            !yearVal || (li.dataset.date || \"\").startsWith(yearVal);\r\n\r\n          const visible = matchQuery && matchYear;\r\n          li.style.display = visible ? \"\" : \"none\";\r\n\r\n          if (visible && hasQuery) {\r\n            count++;\r\n          }\r\n        });\r\n\r\n        if (clearSearchBtn) {\r\n          clearSearchBtn.classList.toggle(\"visually-hidden\", !hasQuery);\r\n        }\r\n\r\n        if (noResultsEl) {\r\n          const noResults = hasQuery && count === 0;\r\n          noResultsEl.classList.toggle(\"hidden\", !noResults);\r\n          noResultsEl.classList.toggle(\"visible\", noResults);\r\n        }\r\n\r\n        if (resultsCountEl) {\r\n          if (hasQuery) {\r\n            resultsCountEl.textContent = isFa\r\n              ? `${count} مورد یافت شد`\r\n              : `${count} result${count === 1 ? \"\" : \"s\"} found`;\r\n            resultsCountEl.classList.remove(\"hidden\");\r\n            resultsCountEl.classList.add(\"visible\");\r\n          } else {\r\n            resultsCountEl.classList.add(\"hidden\");\r\n            resultsCountEl.classList.remove(\"visible\");\r\n          }\r\n        }\r\n      }\r\n\r\n      timelineSearch.addEventListener(\"input\", () => {\r\n        const term = timelineSearch.value;\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = setTimeout(() => {\r\n          filterList(term);\r\n        }, 200);\r\n      });\r\n\r\n      timelineSearch.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Escape\") {\r\n          timelineSearch.value = \"\";\r\n          clearSearchBtn &&\r\n            clearSearchBtn.classList.add(\"visually-hidden\");\r\n          filterList(\"\");\r\n        }\r\n      });\r\n\r\n      clearSearchBtn &&\r\n        clearSearchBtn.addEventListener(\"click\", () => {\r\n          timelineSearch.value = \"\";\r\n          clearSearchBtn.classList.add(\"visually-hidden\");\r\n          filterList(\"\");\r\n        });\r\n\r\n      const saved = storage\r\n        ? storage.getItem(TIMELINE_SEARCH_KEY) || \"\"\r\n        : \"\";\r\n\r\n      if (saved) {\r\n        timelineSearch.value = saved;\r\n      }\r\n\r\n      if (yearFilter) {\r\n        const savedYear = storage\r\n          ? storage.getItem(TIMELINE_YEAR_KEY) || \"\"\r\n          : \"\";\r\n        if (savedYear) {\r\n          yearFilter.value = savedYear;\r\n        }\r\n        yearFilter.addEventListener(\"change\", () =>\r\n          filterList(timelineSearch.value)\r\n        );\r\n      }\r\n\r\n      filterList(saved);\r\n      searchInitialized = true;\r\n\r\n      // Cleanup debounce timer on page unload to prevent memory leaks\r\n      window.addEventListener(\"beforeunload\", () => {\r\n        if (debounceTimer) {\r\n          clearTimeout(debounceTimer);\r\n          debounceTimer = null;\r\n        }\r\n      });\r\n    }\r\n\r\n    function loadTimeline(force = false, btn = null) {\r\n      if (!timelineList) {\r\n        return;\r\n      }\r\n\r\n      while (timelineList.firstChild) {\r\n        timelineList.removeChild(timelineList.firstChild);\r\n      }\r\n      timelineList.setAttribute(\"aria-busy\", \"true\");\r\n\r\n      if (btn) {\r\n        btn.classList.add(\"loading\");\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n      }\r\n\r\n      const key = \"security-timeline\";\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(key);\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(\r\n        \"/assets/data/security-timeline.json\",\r\n        key,\r\n        DAY_MS,\r\n        (res) => res.json()\r\n      )\r\n        .then((events) => {\r\n          timelineData = events;\r\n\r\n          if (yearFilter) {\r\n            const years = Array.from(\r\n              new Set(\r\n                events.map((ev) => new Date(ev.date).getFullYear())\r\n              )\r\n            ).sort((a, b) => b - a);\r\n\r\n            while (yearFilter.firstChild) {\r\n              yearFilter.removeChild(yearFilter.firstChild);\r\n            }\r\n\r\n            const defaultOption = document.createElement(\"option\");\r\n            defaultOption.value = \"\";\r\n            defaultOption.textContent = isFa\r\n              ? \"همه سال‌ها\"\r\n              : \"All years\";\r\n            yearFilter.appendChild(defaultOption);\r\n\r\n            years.forEach((y) => {\r\n              const option = document.createElement(\"option\");\r\n              option.value = String(y);\r\n              option.textContent = String(y);\r\n              yearFilter.appendChild(option);\r\n            });\r\n\r\n            const savedYear = storage\r\n              ? storage.getItem(TIMELINE_YEAR_KEY) || \"\"\r\n              : \"\";\r\n            if (\r\n              savedYear &&\r\n              Array.from(yearFilter.options).some(\r\n                (option) => option.value === savedYear\r\n              )\r\n            ) {\r\n              yearFilter.value = savedYear;\r\n            }\r\n          }\r\n\r\n          renderTimeline(events);\r\n          timelineList.setAttribute(\"aria-busy\", \"false\");\r\n          initializeTimeline();\r\n          setupTimelineSearch();\r\n          if (force) {\n            emitToast(messages.refreshed, {\n              id: \"security-timeline-refresh-toast\",\n              kind: \"success\",\n              duration: 2200,\n              cooldownMs: 600,\n            });\n          }\n        })\n        .catch((err) => {\n          let msg = messages.fetchFail;\n          if (err && err.message === \"offline\") {\n            msg = messages.offline;\n          } else if (err && err.message === \"rate-limit\") {\n            msg = messages.rateLimit;\n          } else if (err && err.message === \"stale-data\") {\n            // استفاده‌ی بی‌سروصدا از داده‌ی staled در ادامه\n            msg = \"\";\n          }\n          if (msg) {\n            emitToast(msg, {\n              id: \"security-timeline-fetch-toast\",\n              kind: msg === messages.offline ? \"info\" : \"error\",\n              duration: 3000,\n              cooldownMs: 1200,\n            });\n          }\n\n          if (\n            err &&\n            err.message === \"stale-data\" &&\n            err.data &&\r\n            Array.isArray(err.data)\r\n          ) {\r\n            timelineData = err.data;\r\n          } else {\r\n            timelineData = DEFAULT_TIMELINE;\r\n          }\r\n\r\n          renderTimeline(timelineData);\r\n          timelineList.setAttribute(\"aria-busy\", \"false\");\r\n          initializeTimeline();\r\n          setupTimelineSearch();\r\n        })\r\n        .finally(() => {\r\n          if (btn) {\r\n            btn.classList.remove(\"loading\");\r\n            btn.removeAttribute(\"aria-busy\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (timelineList) {\r\n      loadTimeline();\r\n    } else {\r\n      initializeTimeline();\r\n    }\r\n\r\n    // --- Expiration و security.txt ---\r\n\r\n    const expirationEl = document.getElementById(\"policy-expiration\");\r\n    const progressEl = document.getElementById(\r\n      \"policy-expiration-progress\"\r\n    );\r\n    const daysTextEl = document.getElementById(\"expiration-days\");\r\n\r\n    let expireDate = null;\r\n    let expirationIntervalId = null;\r\n\r\n    function updateExpirationDisplay() {\r\n      if (!expireDate || !expirationEl) {\r\n        return;\r\n      }\r\n\r\n      const now = new Date();\r\n      const diffDays = (expireDate - now) / DAY_MS;\r\n      let daysLabel = \"\";\r\n\r\n      if (progressEl) {\r\n        const totalDays = 365;\r\n        const percent = Math.min(\r\n          100,\r\n          Math.max(0, ((totalDays - diffDays) / totalDays) * 100)\r\n        );\r\n        progressEl.value = percent;\r\n        progressEl.removeAttribute(\"aria-hidden\");\r\n\r\n        if (diffDays > 0) {\r\n          daysLabel = isFa\r\n            ? `${Math.ceil(diffDays)} روز باقیمانده`\r\n            : `${Math.ceil(diffDays)} days remaining`;\r\n        } else {\r\n          daysLabel = isFa\r\n            ? \"منقضی شده\"\r\n            : \"Expired\";\r\n        }\r\n\r\n        progressEl.setAttribute(\"aria-valuenow\", percent.toFixed(0));\r\n        progressEl.setAttribute(\"aria-valuetext\", daysLabel);\r\n      }\r\n\r\n      if (daysTextEl) {\r\n        daysTextEl.textContent = daysLabel;\r\n        daysTextEl.classList.remove(\"hidden\");\r\n        daysTextEl.setAttribute(\"aria-hidden\", \"false\");\r\n      }\r\n\r\n      expirationEl.classList.remove(\"expired\", \"expiring\", \"warning\");\r\n      if (progressEl) {\r\n        progressEl.classList.remove(\"expired\", \"expiring\", \"warning\");\r\n      }\r\n\r\n      if (diffDays <= 0) {\r\n        expirationEl.classList.add(\"expired\");\r\n        progressEl && progressEl.classList.add(\"expired\");\r\n      } else if (diffDays <= 30) {\r\n        expirationEl.classList.add(\"expiring\");\r\n        progressEl && progressEl.classList.add(\"expiring\");\r\n      } else if (diffDays <= 90) {\r\n        expirationEl.classList.add(\"warning\");\r\n        progressEl && progressEl.classList.add(\"warning\");\r\n      }\r\n    }\r\n\r\n    function processSecurityTxt(text) {\r\n      const match = text.match(/^Expires:\\s*(.+)$/m);\r\n      if (match) {\r\n        const parsed = new Date(match[1].trim());\r\n        if (Number.isNaN(parsed.getTime())) {\r\n          expirationEl.textContent = isFa\r\n            ? \"تاریخ اعتبار معتبر نیست.\"\r\n            : \"Expiration date is invalid.\";\r\n          return;\r\n        }\r\n\r\n        expireDate = parsed;\r\n        const locale = isFa ? \"fa-IR\" : \"en-US\";\r\n        const opts = {\r\n          year: \"numeric\",\r\n          month: \"long\",\r\n          day: \"numeric\",\r\n        };\r\n        const label = isFa\r\n          ? `اعتبار سیاست تا ${expireDate.toLocaleDateString(\r\n            locale,\r\n            opts\r\n          )}`\r\n          : `Policy valid until ${expireDate.toLocaleDateString(\r\n            locale,\r\n            opts\r\n          )}`;\r\n        expirationEl.textContent = label;\r\n        updateExpirationDisplay();\r\n\r\n        if (expirationIntervalId) {\r\n          clearInterval(expirationIntervalId);\r\n        }\r\n        expirationIntervalId = setInterval(\r\n          updateExpirationDisplay,\r\n          3600000\r\n        );\r\n      } else {\r\n        expirationEl.textContent = isFa\r\n          ? \"تاریخ اعتبار در دسترس نیست.\"\r\n          : \"Expiration date unavailable.\";\r\n      }\r\n    }\r\n\r\n    function loadPolicyExpiration(force = false) {\r\n      if (!expirationEl) {\r\n        return;\r\n      }\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(\"security-txt\");\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(\r\n        \"/.well-known/security.txt\",\r\n        \"security-txt\",\r\n        DAY_MS,\r\n        (res) => res.text()\r\n      )\r\n        .then((text) => {\r\n          processSecurityTxt(text);\r\n        })\r\n        .catch((err) => {\r\n          // اگر داده کش‌شده داریم، از آن استفاده کن\r\n          if (\r\n            err &&\r\n            err.message === \"stale-data\" &&\r\n            typeof err.data === \"string\"\r\n          ) {\r\n            processSecurityTxt(err.data);\r\n            return;\r\n          }\r\n\r\n          expirationEl.textContent = isFa\r\n            ? \"خطا در دریافت تاریخ اعتبار.\"\r\n            : \"Failed to load expiration date.\";\r\n          if (daysTextEl) {\r\n            daysTextEl.classList.add(\"hidden\");\r\n            daysTextEl.setAttribute(\"aria-hidden\", \"true\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (expirationEl) {\r\n      loadPolicyExpiration();\r\n    }\r\n\r\n    // دامنه‌ی scope\r\n    const domainEl = document.getElementById(\"scope-domain\");\r\n    if (domainEl) {\r\n      const codeEl = document.createElement(\"code\");\r\n      codeEl.textContent = location.hostname;\r\n      domainEl.textContent = \"\";\r\n      domainEl.appendChild(codeEl);\r\n    }\r\n\r\n    // آخرین بروزرسانی از GitHub\r\n    const lastUpdatedEl = document.getElementById(\"last-updated-date\");\r\n\r\n    function processLastUpdated(data) {\r\n      if (Array.isArray(data) && data.length > 0) {\r\n        const commitDate = new Date(data[0].commit.committer.date);\r\n        if (Number.isNaN(commitDate.getTime())) {\r\n          return;\r\n        }\r\n        const locale = isFa ? \"fa-IR\" : \"en-US\";\r\n        const opts = {\r\n          year: \"numeric\",\r\n          month: \"long\",\r\n          day: \"numeric\",\r\n        };\r\n        const dateStr = commitDate.toLocaleDateString(locale, opts);\r\n        const rel = formatRelative(commitDate);\r\n        lastUpdatedEl.textContent = rel\r\n          ? `${dateStr} (${rel})`\r\n          : dateStr;\r\n      }\r\n    }\r\n\r\n    function loadLastUpdated(force = false) {\r\n      if (!lastUpdatedEl) {\r\n        return;\r\n      }\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(\"security-last\");\r\n        } catch {}\r\n      }\r\n\r\n      const apiUrl =\r\n        \"https://api.github.com/repos/RasoulUnlimited/RasoulUnlimited.github.io/commits?path=security.html&page=1&per_page=1\";\r\n\r\n      cachedFetch(apiUrl, \"security-last\", DAY_MS, (res) => res.json())\r\n        .then((data) => {\r\n          processLastUpdated(data);\r\n        })\r\n        .catch((err) => {\r\n          if (err && err.message === \"stale-data\" && err.data) {\r\n            processLastUpdated(err.data);\r\n            return;\r\n          }\r\n\r\n          let msg = messages.fetchFail;\n          if (err && err.message === \"offline\") {\n            msg = messages.offline;\n          } else if (err && err.message === \"rate-limit\") {\n            msg = messages.rateLimit;\n          }\n          emitToast(msg, {\n            id: \"security-last-updated-fetch-toast\",\n            kind: msg === messages.offline ? \"info\" : \"error\",\n            duration: 3000,\n            cooldownMs: 1200,\n          });\n        });\r\n    }\r\n\r\n    if (lastUpdatedEl) {\r\n      loadLastUpdated();\r\n    }\r\n\r\n    // --- GitHub Security Advisories ---\r\n\r\n    const advisoriesList = document.getElementById(\"advisories-list\");\r\n    refreshAdvisoriesBtn = document.getElementById(\"refresh-advisories\");\r\n\r\n    function renderAdvisories(advs) {\r\n      if (!advisoriesList) {\r\n        return;\r\n      }\r\n\r\n      while (advisoriesList.firstChild) {\r\n        advisoriesList.removeChild(advisoriesList.firstChild);\r\n      }\r\n\r\n      if (Array.isArray(advs) && advs.length > 0) {\r\n        advs.forEach((adv) => {\r\n          const li = document.createElement(\"li\");\r\n          const link = document.createElement(\"a\");\r\n          link.href = adv.html_url;\r\n          link.target = \"_blank\";\r\n          link.rel = \"noopener noreferrer\";\r\n          link.textContent = adv.summary || adv.ghsa_id || adv.id;\r\n          li.appendChild(link);\r\n\r\n          const advTime = adv.published_at || adv.created_at;\r\n          if (advTime) {\r\n            const span = document.createElement(\"span\");\r\n            span.className = \"adv-time\";\r\n            span.textContent = formatRelative(new Date(advTime));\r\n            li.appendChild(document.createTextNode(\" \"));\r\n            li.appendChild(span);\r\n          }\r\n\r\n          advisoriesList.appendChild(li);\r\n        });\r\n      } else {\r\n        advisoriesList.textContent = isFa\r\n          ? \"موردی یافت نشد.\"\r\n          : \"No advisories found.\";\r\n      }\r\n    }\r\n\r\n    function loadAdvisories(force = false, btn = null) {\r\n      if (!advisoriesList) {\r\n        return;\r\n      }\r\n\r\n      while (advisoriesList.firstChild) {\r\n        advisoriesList.removeChild(advisoriesList.firstChild);\r\n      }\r\n\r\n      if (btn) {\r\n        btn.classList.add(\"loading\");\r\n        btn.setAttribute(\"aria-busy\", \"true\");\r\n      }\r\n\r\n      const advUrl = \"/assets/data/security-advisories.json\";\r\n      const key = \"security-advisories\";\r\n\r\n      if (force && storage) {\r\n        try {\r\n          storage.removeItem(key);\r\n        } catch {}\r\n      }\r\n\r\n      cachedFetch(advUrl, key, DAY_MS, (res) => res.json())\r\n        .then((advs) => {\r\n          renderAdvisories(advs);\r\n        })\r\n        .catch((err) => {\r\n          if (err && err.message === \"stale-data\" && err.data) {\r\n            renderAdvisories(err.data);\r\n          } else {\r\n            advisoriesList.textContent = isFa\r\n              ? \"خطا در دریافت اعلان‌ها.\"\r\n              : \"Failed to load advisories.\";\r\n          }\r\n\r\n          let msg = messages.fetchFail;\n          if (err && err.message === \"offline\") {\n            msg = messages.offline;\n          } else if (err && err.message === \"rate-limit\") {\n            msg = messages.rateLimit;\n          }\n          emitToast(msg, {\n            id: \"security-advisories-fetch-toast\",\n            kind: msg === messages.offline ? \"info\" : \"error\",\n            duration: 3000,\n            cooldownMs: 1200,\n          });\n        })\r\n        .finally(() => {\r\n          if (btn) {\r\n            btn.classList.remove(\"loading\");\r\n            btn.removeAttribute(\"aria-busy\");\r\n          }\r\n        });\r\n    }\r\n\r\n    if (refreshAdvisoriesBtn) {\r\n      refreshAdvisoriesBtn.addEventListener(\"click\", () =>\r\n        loadAdvisories(true, refreshAdvisoriesBtn)\r\n      );\r\n    }\r\n\r\n    if (advisoriesList) {\r\n      const idleLoad = () => loadAdvisories();\r\n      if (\"requestIdleCallback\" in window) {\r\n        requestIdleCallback(idleLoad, { timeout: 2000 });\r\n      } else {\r\n        setTimeout(idleLoad, 1000);\r\n      }\r\n    }\r\n\r\n    if (refreshTimelineBtn) {\r\n      refreshTimelineBtn.addEventListener(\"click\", () =>\r\n        loadTimeline(true, refreshTimelineBtn)\r\n      );\r\n    }\r\n\r\n    if (sortBtn) {\r\n      sortBtn.addEventListener(\"click\", () => {\r\n        sortAsc = !sortAsc;\r\n        if (storage) {\r\n          try {\r\n            storage.setItem(\"timeline-sort\", sortAsc ? \"asc\" : \"desc\");\r\n          } catch {}\r\n        }\r\n        updateSortButton();\r\n        renderTimeline(timelineData);\r\n        initializeTimeline();\r\n        if (timelineSearch) {\r\n          timelineSearch.dispatchEvent(new Event(\"input\"));\r\n        }\r\n      });\r\n      updateSortButton();\r\n    }\r\n\r\n    // شورتکات‌های صفحه تایم‌لاین\r\n    if (timelineSearch) {\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        const activeTag = document.activeElement.tagName.toLowerCase();\r\n        if (\r\n          e.key === \"/\" &&\r\n          activeTag !== \"input\" &&\r\n          activeTag !== \"textarea\" &&\r\n          !e.ctrlKey &&\r\n          !e.metaKey &&\r\n          !e.altKey\r\n        ) {\r\n          e.preventDefault();\r\n          timelineSearch.focus();\r\n        }\r\n      });\r\n\r\n      document.addEventListener(\"keydown\", (e) => {\r\n        const activeTag = document.activeElement.tagName.toLowerCase();\r\n        if (\r\n          (e.key === \"r\" || e.key === \"R\") &&\r\n          activeTag !== \"input\" &&\r\n          activeTag !== \"textarea\" &&\r\n          !e.ctrlKey &&\r\n          !e.metaKey &&\r\n          !e.altKey\r\n        ) {\r\n          e.preventDefault();\r\n          loadTimeline(true);\r\n          loadAdvisories(true);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Share\r\n    document\r\n      .querySelectorAll(\"#share-page, #share-page-button\")\r\n      .forEach((btn) => {\r\n        btn.addEventListener(\"click\", () => {\r\n          if (navigator.share) {\r\n            navigator\r\n              .share({ title: document.title, url: location.href })\r\n              .catch(() => copyTextToClipboard(location.href));\r\n          } else {\r\n            copyTextToClipboard(location.href);\r\n          }\r\n        });\r\n      });\r\n\r\n    const scrollBtn = document.getElementById(\"scroll-to-top\");\r\n    const floatingShare = document.getElementById(\"share-page-button\");\r\n\r\n    function toggleFloatButtons() {\r\n      const show = window.scrollY > 200;\r\n      if (scrollBtn) {\r\n        scrollBtn.classList.toggle(\"visible\", show);\r\n      }\r\n      if (floatingShare) {\r\n        floatingShare.classList.toggle(\"visible\", show);\r\n      }\r\n    }\r\n\r\n    window.addEventListener(\"scroll\", toggleFloatButtons, {\r\n      passive: true,\r\n    });\r\n    toggleFloatButtons();\r\n\r\n    if (scrollBtn) {\r\n      scrollBtn.addEventListener(\"click\", () => {\r\n        window.scrollTo({ top: 0, behavior: \"smooth\" });\r\n      });\r\n    }\r\n\r\n    // --- Online / Offline events ---\r\n    window.addEventListener(\"online\", () => {\n      updateConnection();\n      emitToast(messages.online, {\n        id: \"security-network-online-toast\",\n        kind: \"success\",\n        duration: 2200,\n        cooldownMs: 800,\n      });\n      loadTimeline(true);\n      loadAdvisories(true);\n      loadPolicyExpiration(true);\n      loadLastUpdated(true);\n    });\n\n    window.addEventListener(\"offline\", () => {\n      updateConnection();\n      emitToast(messages.offline, {\n        id: \"security-network-offline-toast\",\n        kind: \"info\",\n        duration: 2600,\n        cooldownMs: 800,\n      });\n    });\n\r\n    // Cleanup timers and intervals قبل unload\r\n    window.addEventListener(\"beforeunload\", () => {\r\n      if (expirationIntervalId) {\r\n        clearInterval(expirationIntervalId);\r\n        expirationIntervalId = null;\r\n      }\r\n      if (debounceTimer) {\r\n        clearTimeout(debounceTimer);\r\n        debounceTimer = null;\r\n      }\r\n    });\r\n\r\n    updateConnection();\r\n  });\r\n})();\r\n"]}