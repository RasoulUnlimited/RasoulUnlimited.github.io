{"version":3,"file":"gallery-filter.min.js","names":["initGalleryFilter","filterBar","document","querySelector","cards","Array","from","querySelectorAll","length","buttons","_filterAbortController","abort","controller","AbortController","liveRegion","setActiveButton","targetBtn","forEach","btn","isActive","classList","toggle","setAttribute","applyFilter","filterValue","sourceButton","filter","find","b","getAttribute","visibleCount","card","categories","split","map","c","trim","Boolean","getCardCategories","show","includes","hidden","total","textContent","updateLiveRegion","createElement","className","appendChild","addEventListener","event","button","target","closest","preventDefault","signal","initialFromAttr","activeBtn","contains"],"sources":["gallery-filter.js"],"mappings":"CAAA,WACE,aAEA,SAASA,IACP,MAAMC,EAAYC,SAASC,cAAc,eACzC,IAAKF,EAAY,OAEjB,MAAMG,EAAQC,MAAMC,KAAKJ,SAASK,iBAAiB,mBACnD,IAAKH,EAAMI,OAAS,OAEpB,MAAMC,EAAUJ,MAAMC,KACpBL,EAAUM,iBAAiB,wBAE7B,IAAKE,EAAQD,OAAS,OAGlBP,EAAUS,wBACZT,EAAUS,uBAAuBC,QAEnC,MAAMC,EAAa,IAAIC,gBACvBZ,EAAUS,uBAAyBE,EAGnC,IAAIE,EAAab,EAAUE,cAAc,6BAmBzC,SAASY,EAAgBC,GACvBP,EAAQQ,QAASC,IACf,MAAMC,EAAWD,IAAQF,EACzBE,EAAIE,UAAUC,OAAO,SAAUF,GAC/BD,EAAII,aAAa,eAAgBH,EAAW,OAAS,UAEzD,CAgBA,SAASI,EAAYC,EAAaC,GAChC,MAAMC,EAASF,GAAe,MAE9B,GAAIC,EACFV,EAAgBU,OACX,CACL,MAAMP,EAAMT,EAAQkB,KACjBC,GAAMA,EAAEC,aAAa,iBAAmBH,GAEvCR,GAAMH,EAAgBG,EAC5B,CAEA,IAAIY,EAAe,EAEnB1B,EAAMa,QAASc,IACb,MAAMC,EA7CV,SAA2BD,GAEzB,OADYA,EAAKF,aAAa,kBAAoB,IAE/CI,MAAM,OACNC,IAAKC,GAAMA,EAAEC,QACbV,OAAOW,QACZ,CAuCuBC,CAAkBP,GAC/BQ,EACO,QAAXb,GACCM,EAAWxB,QAAUwB,EAAWQ,SAASd,GAG5CK,EAAKU,QAAUF,EACfR,EAAKX,UAAUC,OAAO,mBAAoBkB,GACtCA,IAAOT,GAAgB,KArC/B,SAA0BA,GACxB,MAAMY,EAAQtC,EAAMI,OACfM,IAEHA,EAAW6B,YADTb,IAAiBY,EACM,GAAGZ,SACT,IAAjBA,EAAqB,GAAK,YAGH,GAAGA,QAAmBY,SACnC,IAAVA,EAAc,GAAK,YAGzB,CA4BEE,CAAiBd,EACnB,CAnEKhB,IACHA,EAAaZ,SAAS2C,cAAc,QACpC/B,EAAWQ,aAAa,YAAa,UACrCR,EAAWQ,aAAa,cAAe,QACvCR,EAAWQ,aAAa,mBAAoB,QAC5CR,EAAWgC,UAAY,sBACvB7C,EAAU8C,YAAYjC,IAgExBb,EAAU+C,iBAAiB,QAAUC,IACnC,MAAMC,EAASD,EAAME,OAAOC,QAAQ,uBACpC,IAAKF,EAAS,OACdD,EAAMI,iBAGN9B,EADe2B,EAAOrB,aAAa,gBAAkB,MACjCqB,IACnB,CAAEI,OAAQ1C,EAAW0C,SAGxB,MAAMC,EAAkBtD,EAAU4B,aAAa,uBACzC2B,EACJ/C,EAAQkB,KAAMC,GAAMA,EAAER,UAAUqC,SAAS,YACzChD,EAAQ,GAOVc,EAJEgC,GACAC,GAAW3B,aAAa,gBACxB,MAEyB2B,EAC7B,CAEAtD,SAAS8C,iBAAiB,mBAAoBhD,GAC9CE,SAAS8C,iBAAiB,iBAAkBhD,EAC7C,CAvHD","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  function initGalleryFilter() {\r\n    const filterBar = document.querySelector(\".filter-bar\");\r\n    if (!filterBar) {return;}\r\n\r\n    const cards = Array.from(document.querySelectorAll(\".presskit-card\"));\r\n    if (!cards.length) {return;}\r\n\r\n    const buttons = Array.from(\r\n      filterBar.querySelectorAll(\"button[data-filter]\")\r\n    );\r\n    if (!buttons.length) {return;}\r\n\r\n    // Cleanup previous listeners if any\r\n    if (filterBar._filterAbortController) {\r\n      filterBar._filterAbortController.abort();\r\n    }\r\n    const controller = new AbortController();\r\n    filterBar._filterAbortController = controller;\r\n\r\n    // Live region برای اعلام تعداد نتایج\r\n    let liveRegion = filterBar.querySelector(\"[data-filter-live=\\\"true\\\"]\");\r\n    if (!liveRegion) {\r\n      liveRegion = document.createElement(\"span\");\r\n      liveRegion.setAttribute(\"aria-live\", \"polite\");\r\n      liveRegion.setAttribute(\"aria-atomic\", \"true\");\r\n      liveRegion.setAttribute(\"data-filter-live\", \"true\");\r\n      liveRegion.className = \"filter-live sr-only\"; // تو CSS .sr-only رو تعریف کن\r\n      filterBar.appendChild(liveRegion);\r\n    }\r\n\r\n    // نرمال‌سازی categoryها (پشتیبانی از چند دسته)\r\n    function getCardCategories(card) {\r\n      const raw = card.getAttribute(\"data-category\") || \"\";\r\n      return raw\r\n        .split(/\\s+/)\r\n        .map((c) => c.trim())\r\n        .filter(Boolean);\r\n    }\r\n\r\n    function setActiveButton(targetBtn) {\r\n      buttons.forEach((btn) => {\r\n        const isActive = btn === targetBtn;\r\n        btn.classList.toggle(\"active\", isActive);\r\n        btn.setAttribute(\"aria-pressed\", isActive ? \"true\" : \"false\");\r\n      });\r\n    }\r\n\r\n    function updateLiveRegion(visibleCount) {\r\n      const total = cards.length;\r\n      if (!liveRegion) {return;}\r\n      if (visibleCount === total) {\r\n        liveRegion.textContent = `${visibleCount} item${\r\n          visibleCount === 1 ? \"\" : \"s\"\r\n        } shown`;\r\n      } else {\r\n        liveRegion.textContent = `${visibleCount} of ${total} item${\r\n          total === 1 ? \"\" : \"s\"\r\n        } shown`;\r\n      }\r\n    }\r\n\r\n    function applyFilter(filterValue, sourceButton) {\r\n      const filter = filterValue || \"all\";\r\n\r\n      if (sourceButton) {\r\n        setActiveButton(sourceButton);\r\n      } else {\r\n        const btn = buttons.find(\r\n          (b) => b.getAttribute(\"data-filter\") === filter\r\n        );\r\n        if (btn) {setActiveButton(btn);}\r\n      }\r\n\r\n      let visibleCount = 0;\r\n\r\n      cards.forEach((card) => {\r\n        const categories = getCardCategories(card);\r\n        const show =\r\n          filter === \"all\" ||\r\n          (categories.length && categories.includes(filter));\r\n\r\n        // برای انیمیشن، کلاس رو هم می‌تونیم کنترل کنیم\r\n        card.hidden = !show;\r\n        card.classList.toggle(\"is-filtered-out\", !show);\r\n        if (show) {visibleCount += 1;}\r\n      });\r\n\r\n      updateLiveRegion(visibleCount);\r\n    }\r\n\r\n    // کلیک روی filter bar (event delegation)\r\n    filterBar.addEventListener(\"click\", (event) => {\r\n      const button = event.target.closest(\"button[data-filter]\");\r\n      if (!button) {return;}\r\n      event.preventDefault();\r\n\r\n      const filter = button.getAttribute(\"data-filter\") || \"all\";\r\n      applyFilter(filter, button);\r\n    }, { signal: controller.signal });\r\n\r\n    // اینیت اولیه: از data-initial-filter یا از دکمه‌ی active\r\n    const initialFromAttr = filterBar.getAttribute(\"data-initial-filter\");\r\n    const activeBtn =\r\n      buttons.find((b) => b.classList.contains(\"active\")) ||\r\n      buttons[0]; // fallback به اولین دکمه\r\n\r\n    const initialFilter =\r\n      initialFromAttr ||\r\n      activeBtn?.getAttribute(\"data-filter\") ||\r\n      \"all\";\r\n\r\n    applyFilter(initialFilter, activeBtn);\r\n  }\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", initGalleryFilter);\r\n  document.addEventListener(\"includesLoaded\", initGalleryFilter);\r\n})();\r\n"]}