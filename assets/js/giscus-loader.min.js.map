{"version":3,"file":"giscus-loader.min.js","names":["window","document","ROOTS","STATES","WeakMap","themeBindingsAttached","connectivityBindingsAttached","query","root","selector","querySelector","showElement","element","visible","removeAttribute","setAttribute","resolveLocale","dataset","giscusLang","documentElement","lang","toLowerCase","startsWith","resolveTheme","current","getAttribute","trim","defaultErrorMessage","emit","name","detail","dispatchEvent","CustomEvent","bubbles","setStatus","status","message","loading","error","errorMessage","giscusStatus","isLoading","classList","toggle","isError","textContent","busy","container","setBusyState","gtag","event_category","event_label","reportState","clearRuntime","state","timeoutId","clearTimeout","retryTimer","observer","disconnect","iframe","iframeLoadHandler","removeEventListener","script","syncTheme","theme","giscusThemeApplied","contentWindow","postMessage","giscus","setConfig","syncAllReadyThemes","forEach","get","scheduleAutoRetry","reason","autoRetryCount","navigator","onLine","shouldAutoRetry","attempt","source","setTimeout","active","startLoad","fail","giscusErrorReason","giscusErrorMessage","succeed","prefersReducedMotion","matchMedia","matches","remove","offsetWidth","add","pulseReady","forceRetry","firstChild","removeChild","clearContainer","config","parsedTimeout","Number","parseInt","giscusTimeout","repo","giscusRepo","repoId","giscusRepoId","category","giscusCategory","categoryId","giscusCategoryId","mapping","giscusMapping","term","giscusTerm","strict","giscusStrict","reactionsEnabled","giscusReactionsEnabled","emitMetadata","giscusEmitMetadata","inputPosition","giscusInputPosition","giscusLoading","timeoutMs","isFinite","getConfig","validateConfig","createElement","src","async","crossOrigin","buildScript","onerror","MutationObserver","addEventListener","once","observe","childList","subtree","appendChild","initRoot","giscusBooted","io","set","push","fallbackLink","giscusFallbackUrl","retryButton","IntersectionObserver","entries","entry","isIntersecting","rootMargin","threshold","boot","roots","Array","from","querySelectorAll","length","attributes","attributeFilter","attachThemeBindings","onOnline","attachConnectivityBindings","readyState","__giscusLoader","reloadAll","getStatus"],"sources":["giscus-loader.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Shared, resilient Giscus loader for FA/EN home pages.\n(function () {\n  \"use strict\";\n\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\n    return;\n  }\n\n  const ROOT_SELECTOR = \"[data-giscus-root]\";\n  const GISCUS_SCRIPT_SRC = \"https://giscus.app/client.js\";\n  const GISCUS_ORIGIN = \"https://giscus.app\";\n  const DEFAULT_TIMEOUT_MS = 8000;\n  const IO_ROOT_MARGIN = \"320px 0px\";\n  const MAX_AUTO_RETRIES = 1;\n  const AUTO_RETRY_DELAY_MS = 900;\n  const ROOTS = [];\n  const STATES = new WeakMap();\n\n  let themeBindingsAttached = false;\n  let connectivityBindingsAttached = false;\n\n  function query(root, selector) {\n    return root ? root.querySelector(selector) : null;\n  }\n\n  function showElement(element, visible) {\n    if (!element) {return;}\n    if (visible) {\n      element.removeAttribute(\"hidden\");\n    } else {\n      element.setAttribute(\"hidden\", \"\");\n    }\n  }\n\n  function resolveLocale(root) {\n    const lang =\n      root.dataset.giscusLang ||\n      document.documentElement.lang ||\n      \"en\";\n    return lang.toLowerCase().startsWith(\"fa\") ? \"fa\" : \"en\";\n  }\n\n  function resolveTheme() {\n    const current =\n      (document.documentElement.getAttribute(\"data-theme\") || \"\")\n        .trim()\n        .toLowerCase();\n    if (current === \"dark\") {return \"dark\";}\n    if (current === \"light\") {return \"light\";}\n    return \"preferred_color_scheme\";\n  }\n\n  function defaultErrorMessage(root) {\n    return resolveLocale(root) === \"fa\"\n      ? \"بارگذاری نظرات با مشکل مواجه شد. لطفاً دوباره تلاش کنید.\"\n      : \"Comments could not be loaded. Please try again.\";\n  }\n\n  function reportState(status) {\n    if (typeof window.gtag !== \"function\") {return;}\n    if (status === \"idle\") {return;}\n\n    try {\n      window.gtag(\"event\", \"giscus_state_change\", {\n        event_category: \"engagement\",\n        event_label: status,\n      });\n    } catch {\n      // Metrics should never block UX.\n    }\n  }\n\n  function setBusyState(root, busy) {\n    const container = query(root, \".giscus-container\");\n    if (container) {\n      container.setAttribute(\"aria-busy\", busy ? \"true\" : \"false\");\n    }\n    root.setAttribute(\"aria-busy\", busy ? \"true\" : \"false\");\n  }\n\n  function emit(root, name, detail) {\n    try {\n      root.dispatchEvent(\n        new CustomEvent(name, {\n          bubbles: true,\n          detail: detail || {},\n        })\n      );\n    } catch {\n      // Silently ignore in older browsers.\n    }\n  }\n\n  function setStatus(root, status, message) {\n    const loading = query(root, \".giscus-loading\");\n    const error = query(root, \".giscus-error\");\n    const errorMessage = query(root, \".giscus-error-message\");\n\n    root.dataset.giscusStatus = status;\n\n    const isLoading = status === \"loading\";\n    if (loading) {\n      loading.classList.toggle(\"hidden\", !isLoading);\n      showElement(loading, isLoading);\n    }\n\n    const isError = status === \"error\";\n    if (error) {\n      error.classList.toggle(\"hidden\", !isError);\n      showElement(error, isError);\n    }\n\n    if (isError && errorMessage) {\n      errorMessage.textContent = message || defaultErrorMessage(root);\n    }\n\n    setBusyState(root, isLoading);\n    emit(root, \"giscus:state-change\", { status });\n    reportState(status);\n  }\n\n  function clearContainer(root) {\n    const container = query(root, \".giscus-container\");\n    if (!container) {return;}\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n  }\n\n  function clearRuntime(state) {\n    if (!state) {return;}\n\n    if (state.timeoutId) {\n      window.clearTimeout(state.timeoutId);\n      state.timeoutId = null;\n    }\n\n    if (state.retryTimer) {\n      window.clearTimeout(state.retryTimer);\n      state.retryTimer = null;\n    }\n\n    if (state.observer) {\n      state.observer.disconnect();\n      state.observer = null;\n    }\n\n    if (state.iframe && state.iframeLoadHandler) {\n      state.iframe.removeEventListener(\"load\", state.iframeLoadHandler);\n      state.iframeLoadHandler = null;\n    }\n\n    state.iframe = null;\n    state.script = null;\n  }\n\n  function pulseReady(root) {\n    const prefersReducedMotion = window.matchMedia?.(\"(prefers-reduced-motion: reduce)\").matches;\n    if (prefersReducedMotion) {return;}\n\n    root.classList.remove(\"giscus-ready-pulse\");\n    // Trigger reflow so a subsequent class re-add restarts animation.\n    void root.offsetWidth;\n    root.classList.add(\"giscus-ready-pulse\");\n\n    window.setTimeout(() => {\n      root.classList.remove(\"giscus-ready-pulse\");\n    }, 700);\n  }\n\n  function syncTheme(root) {\n    const theme = resolveTheme();\n    root.dataset.giscusThemeApplied = theme;\n\n    const iframe = query(root, \"iframe.giscus-frame\");\n    if (!iframe || !iframe.contentWindow) {return;}\n\n    try {\n      iframe.contentWindow.postMessage(\n        {\n          giscus: {\n            setConfig: {\n              theme,\n            },\n          },\n        },\n        GISCUS_ORIGIN\n      );\n      emit(root, \"giscus:theme-sync\", { theme });\n    } catch {\n      // Cross-origin sync failures should not break UX.\n    }\n  }\n\n  function syncAllReadyThemes() {\n    ROOTS.forEach((root) => {\n      const state = STATES.get(root);\n      if (!state || state.status !== \"ready\") {return;}\n      syncTheme(root);\n    });\n  }\n\n  function attachThemeBindings() {\n    if (themeBindingsAttached) {return;}\n    themeBindingsAttached = true;\n\n    const observer = new MutationObserver(() => {\n      syncAllReadyThemes();\n    });\n\n    observer.observe(document.documentElement, {\n      attributes: true,\n      attributeFilter: [\"data-theme\"],\n    });\n\n    window.addEventListener(\"themechange\", syncAllReadyThemes);\n    window.addEventListener(\n      \"beforeunload\",\n      () => {\n        observer.disconnect();\n        window.removeEventListener(\"themechange\", syncAllReadyThemes);\n      },\n      { once: true }\n    );\n  }\n\n  function attachConnectivityBindings() {\n    if (connectivityBindingsAttached) {return;}\n    connectivityBindingsAttached = true;\n\n    const onOnline = () => {\n      ROOTS.forEach((root) => {\n        const state = STATES.get(root);\n        if (!state || state.status !== \"error\") {return;}\n        startLoad(root, true, \"online\");\n      });\n    };\n\n    window.addEventListener(\"online\", onOnline);\n    window.addEventListener(\n      \"beforeunload\",\n      () => {\n        window.removeEventListener(\"online\", onOnline);\n      },\n      { once: true }\n    );\n  }\n\n  function getConfig(root) {\n    const parsedTimeout = Number.parseInt(root.dataset.giscusTimeout || \"\", 10);\n\n    return {\n      repo: root.dataset.giscusRepo || \"\",\n      repoId: root.dataset.giscusRepoId || \"\",\n      category: root.dataset.giscusCategory || \"\",\n      categoryId: root.dataset.giscusCategoryId || \"\",\n      mapping: root.dataset.giscusMapping || \"specific\",\n      term: root.dataset.giscusTerm || \"\",\n      lang: root.dataset.giscusLang || resolveLocale(root),\n      strict: root.dataset.giscusStrict || \"1\",\n      reactionsEnabled: root.dataset.giscusReactionsEnabled || \"1\",\n      emitMetadata: root.dataset.giscusEmitMetadata || \"0\",\n      inputPosition: root.dataset.giscusInputPosition || \"top\",\n      loading: root.dataset.giscusLoading || \"lazy\",\n      timeoutMs:\n        Number.isFinite(parsedTimeout) && parsedTimeout > 0\n          ? parsedTimeout\n          : DEFAULT_TIMEOUT_MS,\n    };\n  }\n\n  function validateConfig(config) {\n    if (!config.repo || !config.repoId) {return false;}\n    if (!config.category || !config.categoryId) {return false;}\n    if (config.mapping === \"specific\" && !config.term) {return false;}\n    return true;\n  }\n\n  function buildScript(config) {\n    const script = document.createElement(\"script\");\n    script.src = GISCUS_SCRIPT_SRC;\n    script.async = true;\n    script.crossOrigin = \"anonymous\";\n\n    script.setAttribute(\"data-repo\", config.repo);\n    script.setAttribute(\"data-repo-id\", config.repoId);\n    script.setAttribute(\"data-category\", config.category);\n    script.setAttribute(\"data-category-id\", config.categoryId);\n    script.setAttribute(\"data-mapping\", config.mapping);\n    script.setAttribute(\"data-lang\", config.lang);\n    script.setAttribute(\"data-strict\", config.strict);\n    script.setAttribute(\"data-reactions-enabled\", config.reactionsEnabled);\n    script.setAttribute(\"data-emit-metadata\", config.emitMetadata);\n    script.setAttribute(\"data-input-position\", config.inputPosition);\n    script.setAttribute(\"data-loading\", config.loading);\n    script.setAttribute(\"data-theme\", resolveTheme());\n    script.setAttribute(\"data-ai-integration\", \"giscus-comments\");\n\n    if (config.mapping === \"specific\" && config.term) {\n      script.setAttribute(\"data-term\", config.term);\n    }\n\n    return script;\n  }\n\n  function shouldAutoRetry(state, reason) {\n    if (!state) {return false;}\n    if (state.autoRetryCount >= MAX_AUTO_RETRIES) {return false;}\n    if (reason !== \"timeout\" && reason !== \"script-error\") {return false;}\n    if (!navigator.onLine) {return false;}\n    return true;\n  }\n\n  function scheduleAutoRetry(root, reason) {\n    const state = STATES.get(root);\n    if (!state || !shouldAutoRetry(state, reason)) {return;}\n\n    state.autoRetryCount += 1;\n    const attempt = state.autoRetryCount;\n    emit(root, \"giscus:retry\", { reason, attempt, source: \"auto\" });\n\n    state.retryTimer = window.setTimeout(() => {\n      const active = STATES.get(root);\n      if (!active || active.status !== \"error\") {return;}\n      startLoad(root, true, \"auto\");\n    }, AUTO_RETRY_DELAY_MS * attempt);\n  }\n\n  function fail(root, reason) {\n    const state = STATES.get(root);\n    if (!state || state.status !== \"loading\") {return;}\n\n    clearRuntime(state);\n    state.status = \"error\";\n    root.dataset.giscusErrorReason = reason;\n\n    setStatus(\n      root,\n      \"error\",\n      root.dataset.giscusErrorMessage || defaultErrorMessage(root)\n    );\n\n    emit(root, \"giscus:error\", { reason });\n    scheduleAutoRetry(root, reason);\n  }\n\n  function succeed(root) {\n    const state = STATES.get(root);\n    if (!state || state.status !== \"loading\") {return;}\n\n    clearRuntime(state);\n    state.status = \"ready\";\n    state.autoRetryCount = 0;\n    setStatus(root, \"ready\");\n    syncTheme(root);\n    pulseReady(root);\n\n    emit(root, \"giscus:ready\", { theme: resolveTheme() });\n  }\n\n  function startLoad(root, forceRetry, source = \"manual\") {\n    const state = STATES.get(root);\n    if (!state) {return;}\n\n    if (source !== \"auto\") {\n      state.autoRetryCount = 0;\n    }\n\n    if (state.status === \"loading\") {return;}\n    if (state.status === \"ready\" && !forceRetry) {return;}\n\n    clearRuntime(state);\n    clearContainer(root);\n\n    const config = getConfig(root);\n    if (!validateConfig(config)) {\n      state.status = \"error\";\n      setStatus(root, \"error\", defaultErrorMessage(root));\n      emit(root, \"giscus:error\", { reason: \"invalid-config\" });\n      return;\n    }\n\n    const container = query(root, \".giscus-container\");\n    if (!container) {\n      state.status = \"error\";\n      setStatus(root, \"error\", defaultErrorMessage(root));\n      emit(root, \"giscus:error\", { reason: \"missing-container\" });\n      return;\n    }\n\n    state.status = \"loading\";\n    setStatus(root, \"loading\");\n    root.dataset.giscusThemeApplied = resolveTheme();\n    root.dataset.giscusErrorReason = \"\";\n    emit(root, \"giscus:loading\", { source });\n\n    const script = buildScript(config);\n    state.script = script;\n\n    state.timeoutId = window.setTimeout(() => {\n      fail(root, \"timeout\");\n    }, config.timeoutMs);\n\n    script.onerror = () => {\n      fail(root, \"script-error\");\n    };\n\n    state.observer = new MutationObserver(() => {\n      const iframe = query(root, \"iframe.giscus-frame\");\n      if (!iframe || state.iframe === iframe) {return;}\n\n      state.iframe = iframe;\n      state.iframeLoadHandler = () => {\n        succeed(root);\n      };\n      iframe.addEventListener(\"load\", state.iframeLoadHandler, { once: true });\n\n      // Cross-origin iframes may not reliably fire a visible load event.\n      window.setTimeout(() => {\n        const active = STATES.get(root);\n        if (!active || active.status !== \"loading\") {return;}\n        succeed(root);\n      }, 1200);\n    });\n\n    state.observer.observe(container, { childList: true, subtree: true });\n    container.appendChild(script);\n  }\n\n  function initRoot(root) {\n    if (!root || root.dataset.giscusBooted === \"true\") {return;}\n    root.dataset.giscusBooted = \"true\";\n\n    const state = {\n      status: \"idle\",\n      observer: null,\n      timeoutId: null,\n      retryTimer: null,\n      autoRetryCount: 0,\n      iframe: null,\n      iframeLoadHandler: null,\n      script: null,\n      io: null,\n    };\n    STATES.set(root, state);\n    ROOTS.push(root);\n\n    const fallbackLink = query(root, \".giscus-fallback-link\");\n    if (fallbackLink && root.dataset.giscusFallbackUrl) {\n      fallbackLink.setAttribute(\"href\", root.dataset.giscusFallbackUrl);\n    }\n\n    const retryButton = query(root, \".giscus-retry-btn\");\n    if (retryButton) {\n      retryButton.addEventListener(\"click\", () => {\n        emit(root, \"giscus:retry\", { reason: \"manual-click\", attempt: 0, source: \"manual\" });\n        startLoad(root, true, \"manual\");\n      });\n    }\n\n    setStatus(root, \"idle\");\n\n    if (\"IntersectionObserver\" in window) {\n      state.io = new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            if (!entry.isIntersecting) {return;}\n            if (state.io) {\n              state.io.disconnect();\n              state.io = null;\n            }\n            startLoad(root, false, \"init\");\n          });\n        },\n        { rootMargin: IO_ROOT_MARGIN, threshold: 0.01 }\n      );\n      state.io.observe(root);\n    } else {\n      startLoad(root, false, \"init\");\n    }\n  }\n\n  function boot() {\n    const roots = Array.from(document.querySelectorAll(ROOT_SELECTOR));\n    if (!roots.length) {return;}\n\n    roots.forEach(initRoot);\n    attachThemeBindings();\n    attachConnectivityBindings();\n  }\n\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\n  } else {\n    boot();\n  }\n\n  window.__giscusLoader = {\n    reloadAll() {\n      ROOTS.forEach((root) => startLoad(root, true, \"manual\"));\n    },\n    getStatus(root) {\n      const state = STATES.get(root);\n      return state ? state.status : \"unknown\";\n    },\n  };\n})();\n"]}