{"version":3,"file":"giscus-loader.min.js","names":["window","document","ROOTS","STATES","WeakMap","themeBindingsAttached","query","root","selector","querySelector","showElement","element","visible","removeAttribute","setAttribute","resolveLocale","dataset","giscusLang","documentElement","lang","toLowerCase","startsWith","resolveTheme","current","getAttribute","trim","defaultErrorMessage","setStatus","status","message","loading","error","errorMessage","giscusStatus","isLoading","classList","toggle","isError","textContent","busy","container","setBusyState","clearRuntime","state","timeoutId","clearTimeout","observer","disconnect","iframe","iframeLoadHandler","removeEventListener","script","emit","name","detail","dispatchEvent","CustomEvent","bubbles","syncTheme","theme","giscusThemeApplied","contentWindow","postMessage","giscus","setConfig","syncAllReadyThemes","forEach","get","fail","reason","giscusErrorReason","giscusErrorMessage","succeed","startLoad","forceRetry","firstChild","removeChild","clearContainer","config","parsedTimeout","Number","parseInt","giscusTimeout","repo","giscusRepo","repoId","giscusRepoId","category","giscusCategory","categoryId","giscusCategoryId","mapping","giscusMapping","term","giscusTerm","strict","giscusStrict","reactionsEnabled","giscusReactionsEnabled","emitMetadata","giscusEmitMetadata","inputPosition","giscusInputPosition","giscusLoading","timeoutMs","isFinite","getConfig","validateConfig","createElement","src","async","crossOrigin","buildScript","setTimeout","onerror","MutationObserver","addEventListener","once","active","observe","childList","subtree","appendChild","initRoot","giscusBooted","io","set","push","fallbackLink","giscusFallbackUrl","retryButton","IntersectionObserver","entries","entry","isIntersecting","rootMargin","threshold","boot","roots","Array","from","querySelectorAll","length","attributes","attributeFilter","attachThemeBindings","readyState","__giscusLoader","reloadAll","getStatus"],"sources":["giscus-loader.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Shared, resilient Giscus loader for FA/EN home pages.\n(function () {\n  \"use strict\";\n\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\n    return;\n  }\n\n  const ROOT_SELECTOR = \"[data-giscus-root]\";\n  const GISCUS_SCRIPT_SRC = \"https://giscus.app/client.js\";\n  const GISCUS_ORIGIN = \"https://giscus.app\";\n  const DEFAULT_TIMEOUT_MS = 8000;\n  const IO_ROOT_MARGIN = \"320px 0px\";\n  const ROOTS = [];\n  const STATES = new WeakMap();\n\n  let themeBindingsAttached = false;\n\n  function query(root, selector) {\n    return root ? root.querySelector(selector) : null;\n  }\n\n  function showElement(element, visible) {\n    if (!element) {return;}\n    if (visible) {\n      element.removeAttribute(\"hidden\");\n    } else {\n      element.setAttribute(\"hidden\", \"\");\n    }\n  }\n\n  function resolveLocale(root) {\n    const lang =\n      root.dataset.giscusLang ||\n      document.documentElement.lang ||\n      \"en\";\n    return lang.toLowerCase().startsWith(\"fa\") ? \"fa\" : \"en\";\n  }\n\n  function resolveTheme() {\n    const current =\n      (document.documentElement.getAttribute(\"data-theme\") || \"\")\n        .trim()\n        .toLowerCase();\n    if (current === \"dark\") {return \"dark\";}\n    if (current === \"light\") {return \"light\";}\n    return \"preferred_color_scheme\";\n  }\n\n  function defaultErrorMessage(root) {\n    return resolveLocale(root) === \"fa\"\n      ? \"بارگذاری نظرات با مشکل مواجه شد. لطفاً دوباره تلاش کنید.\"\n      : \"Comments could not be loaded. Please try again.\";\n  }\n\n  function setBusyState(root, busy) {\n    const container = query(root, \".giscus-container\");\n    if (container) {\n      container.setAttribute(\"aria-busy\", busy ? \"true\" : \"false\");\n    }\n    root.setAttribute(\"aria-busy\", busy ? \"true\" : \"false\");\n  }\n\n  function setStatus(root, status, message) {\n    const loading = query(root, \".giscus-loading\");\n    const error = query(root, \".giscus-error\");\n    const errorMessage = query(root, \".giscus-error-message\");\n\n    root.dataset.giscusStatus = status;\n\n    const isLoading = status === \"loading\";\n    if (loading) {\n      loading.classList.toggle(\"hidden\", !isLoading);\n      showElement(loading, isLoading);\n    }\n\n    const isError = status === \"error\";\n    if (error) {\n      error.classList.toggle(\"hidden\", !isError);\n      showElement(error, isError);\n    }\n\n    if (isError && errorMessage) {\n      errorMessage.textContent = message || defaultErrorMessage(root);\n    }\n\n    setBusyState(root, isLoading);\n  }\n\n  function clearContainer(root) {\n    const container = query(root, \".giscus-container\");\n    if (!container) {return;}\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n  }\n\n  function clearRuntime(state) {\n    if (!state) {return;}\n\n    if (state.timeoutId) {\n      window.clearTimeout(state.timeoutId);\n      state.timeoutId = null;\n    }\n\n    if (state.observer) {\n      state.observer.disconnect();\n      state.observer = null;\n    }\n\n    if (state.iframe && state.iframeLoadHandler) {\n      state.iframe.removeEventListener(\"load\", state.iframeLoadHandler);\n      state.iframeLoadHandler = null;\n    }\n\n    state.iframe = null;\n    state.script = null;\n  }\n\n  function emit(root, name, detail) {\n    try {\n      root.dispatchEvent(\n        new CustomEvent(name, {\n          bubbles: true,\n          detail: detail || {},\n        })\n      );\n    } catch {\n      // Silently ignore in older browsers.\n    }\n  }\n\n  function syncTheme(root) {\n    const theme = resolveTheme();\n    root.dataset.giscusThemeApplied = theme;\n\n    const iframe = query(root, \"iframe.giscus-frame\");\n    if (!iframe || !iframe.contentWindow) {return;}\n\n    try {\n      iframe.contentWindow.postMessage(\n        {\n          giscus: {\n            setConfig: {\n              theme,\n            },\n          },\n        },\n        GISCUS_ORIGIN\n      );\n      emit(root, \"giscus:theme-sync\", { theme });\n    } catch {\n      // Cross-origin sync failures should not break UX.\n    }\n  }\n\n  function syncAllReadyThemes() {\n    ROOTS.forEach((root) => {\n      const state = STATES.get(root);\n      if (!state || state.status !== \"ready\") {return;}\n      syncTheme(root);\n    });\n  }\n\n  function attachThemeBindings() {\n    if (themeBindingsAttached) {return;}\n    themeBindingsAttached = true;\n\n    const observer = new MutationObserver(() => {\n      syncAllReadyThemes();\n    });\n\n    observer.observe(document.documentElement, {\n      attributes: true,\n      attributeFilter: [\"data-theme\"],\n    });\n\n    window.addEventListener(\"themechange\", syncAllReadyThemes);\n    window.addEventListener(\n      \"beforeunload\",\n      () => {\n        observer.disconnect();\n        window.removeEventListener(\"themechange\", syncAllReadyThemes);\n      },\n      { once: true }\n    );\n  }\n\n  function getConfig(root) {\n    const parsedTimeout = Number.parseInt(root.dataset.giscusTimeout || \"\", 10);\n\n    return {\n      repo: root.dataset.giscusRepo || \"\",\n      repoId: root.dataset.giscusRepoId || \"\",\n      category: root.dataset.giscusCategory || \"\",\n      categoryId: root.dataset.giscusCategoryId || \"\",\n      mapping: root.dataset.giscusMapping || \"specific\",\n      term: root.dataset.giscusTerm || \"\",\n      lang: root.dataset.giscusLang || resolveLocale(root),\n      strict: root.dataset.giscusStrict || \"1\",\n      reactionsEnabled: root.dataset.giscusReactionsEnabled || \"1\",\n      emitMetadata: root.dataset.giscusEmitMetadata || \"0\",\n      inputPosition: root.dataset.giscusInputPosition || \"top\",\n      loading: root.dataset.giscusLoading || \"lazy\",\n      timeoutMs:\n        Number.isFinite(parsedTimeout) && parsedTimeout > 0\n          ? parsedTimeout\n          : DEFAULT_TIMEOUT_MS,\n    };\n  }\n\n  function validateConfig(config) {\n    if (!config.repo || !config.repoId) {return false;}\n    if (!config.category || !config.categoryId) {return false;}\n    if (config.mapping === \"specific\" && !config.term) {return false;}\n    return true;\n  }\n\n  function buildScript(config) {\n    const script = document.createElement(\"script\");\n    script.src = GISCUS_SCRIPT_SRC;\n    script.async = true;\n    script.crossOrigin = \"anonymous\";\n\n    script.setAttribute(\"data-repo\", config.repo);\n    script.setAttribute(\"data-repo-id\", config.repoId);\n    script.setAttribute(\"data-category\", config.category);\n    script.setAttribute(\"data-category-id\", config.categoryId);\n    script.setAttribute(\"data-mapping\", config.mapping);\n    script.setAttribute(\"data-lang\", config.lang);\n    script.setAttribute(\"data-strict\", config.strict);\n    script.setAttribute(\"data-reactions-enabled\", config.reactionsEnabled);\n    script.setAttribute(\"data-emit-metadata\", config.emitMetadata);\n    script.setAttribute(\"data-input-position\", config.inputPosition);\n    script.setAttribute(\"data-loading\", config.loading);\n    script.setAttribute(\"data-theme\", resolveTheme());\n    script.setAttribute(\"data-ai-integration\", \"giscus-comments\");\n\n    if (config.mapping === \"specific\" && config.term) {\n      script.setAttribute(\"data-term\", config.term);\n    }\n\n    return script;\n  }\n\n  function fail(root, reason) {\n    const state = STATES.get(root);\n    if (!state || state.status !== \"loading\") {return;}\n\n    clearRuntime(state);\n    state.status = \"error\";\n    root.dataset.giscusErrorReason = reason;\n\n    setStatus(\n      root,\n      \"error\",\n      root.dataset.giscusErrorMessage || defaultErrorMessage(root)\n    );\n\n    emit(root, \"giscus:error\", { reason });\n  }\n\n  function succeed(root) {\n    const state = STATES.get(root);\n    if (!state || state.status !== \"loading\") {return;}\n\n    clearRuntime(state);\n    state.status = \"ready\";\n    setStatus(root, \"ready\");\n    syncTheme(root);\n\n    emit(root, \"giscus:ready\", { theme: resolveTheme() });\n  }\n\n  function startLoad(root, forceRetry) {\n    const state = STATES.get(root);\n    if (!state) {return;}\n\n    if (state.status === \"loading\") {return;}\n    if (state.status === \"ready\" && !forceRetry) {return;}\n\n    clearRuntime(state);\n    clearContainer(root);\n\n    const config = getConfig(root);\n    if (!validateConfig(config)) {\n      state.status = \"error\";\n      setStatus(root, \"error\", defaultErrorMessage(root));\n      emit(root, \"giscus:error\", { reason: \"invalid-config\" });\n      return;\n    }\n\n    const container = query(root, \".giscus-container\");\n    if (!container) {\n      state.status = \"error\";\n      setStatus(root, \"error\", defaultErrorMessage(root));\n      emit(root, \"giscus:error\", { reason: \"missing-container\" });\n      return;\n    }\n\n    state.status = \"loading\";\n    setStatus(root, \"loading\");\n    root.dataset.giscusThemeApplied = resolveTheme();\n    root.dataset.giscusErrorReason = \"\";\n    emit(root, \"giscus:loading\", {});\n\n    const script = buildScript(config);\n    state.script = script;\n\n    state.timeoutId = window.setTimeout(() => {\n      fail(root, \"timeout\");\n    }, config.timeoutMs);\n\n    script.onerror = () => {\n      fail(root, \"script-error\");\n    };\n\n    state.observer = new MutationObserver(() => {\n      const iframe = query(root, \"iframe.giscus-frame\");\n      if (!iframe || state.iframe === iframe) {return;}\n\n      state.iframe = iframe;\n      state.iframeLoadHandler = () => {\n        succeed(root);\n      };\n      iframe.addEventListener(\"load\", state.iframeLoadHandler, { once: true });\n\n      // Cross-origin iframes may not reliably fire a visible load event.\n      window.setTimeout(() => {\n        const active = STATES.get(root);\n        if (!active || active.status !== \"loading\") {return;}\n        succeed(root);\n      }, 1200);\n    });\n\n    state.observer.observe(container, { childList: true, subtree: true });\n    container.appendChild(script);\n  }\n\n  function initRoot(root) {\n    if (!root || root.dataset.giscusBooted === \"true\") {return;}\n    root.dataset.giscusBooted = \"true\";\n\n    const state = {\n      status: \"idle\",\n      observer: null,\n      timeoutId: null,\n      iframe: null,\n      iframeLoadHandler: null,\n      script: null,\n      io: null,\n    };\n    STATES.set(root, state);\n    ROOTS.push(root);\n\n    const fallbackLink = query(root, \".giscus-fallback-link\");\n    if (fallbackLink && root.dataset.giscusFallbackUrl) {\n      fallbackLink.setAttribute(\"href\", root.dataset.giscusFallbackUrl);\n    }\n\n    const retryButton = query(root, \".giscus-retry-btn\");\n    if (retryButton) {\n      retryButton.addEventListener(\"click\", () => {\n        startLoad(root, true);\n      });\n    }\n\n    setStatus(root, \"idle\");\n\n    if (\"IntersectionObserver\" in window) {\n      state.io = new IntersectionObserver(\n        (entries) => {\n          entries.forEach((entry) => {\n            if (!entry.isIntersecting) {return;}\n            if (state.io) {\n              state.io.disconnect();\n              state.io = null;\n            }\n            startLoad(root, false);\n          });\n        },\n        { rootMargin: IO_ROOT_MARGIN, threshold: 0.01 }\n      );\n      state.io.observe(root);\n    } else {\n      startLoad(root, false);\n    }\n  }\n\n  function boot() {\n    const roots = Array.from(document.querySelectorAll(ROOT_SELECTOR));\n    if (!roots.length) {return;}\n\n    roots.forEach(initRoot);\n    attachThemeBindings();\n  }\n\n  if (document.readyState === \"loading\") {\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\n  } else {\n    boot();\n  }\n\n  window.__giscusLoader = {\n    reloadAll() {\n      ROOTS.forEach((root) => startLoad(root, true));\n    },\n    getStatus(root) {\n      const state = STATES.get(root);\n      return state ? state.status : \"unknown\";\n    },\n  };\n})();\n"]}