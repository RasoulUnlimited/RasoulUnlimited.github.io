{"version":3,"file":"giscus-loader.min.js","names":["window","document","ROOTS","STATES","WeakMap","themeBindingsAttached","connectivityBindingsAttached","query","root","selector","querySelector","showElement","element","visible","removeAttribute","setAttribute","resolveLocale","dataset","giscusLang","documentElement","lang","toLowerCase","startsWith","resolveTheme","current","getAttribute","trim","defaultErrorMessage","emit","name","detail","dispatchEvent","CustomEvent","bubbles","setStatus","status","message","loading","error","errorMessage","giscusStatus","isLoading","classList","toggle","isError","textContent","busy","container","setBusyState","gtag","event_category","event_label","reportState","clearRuntime","state","timeoutId","clearTimeout","retryTimer","observer","disconnect","iframe","iframeLoadHandler","removeEventListener","script","syncTheme","theme","giscusThemeApplied","contentWindow","postMessage","giscus","setConfig","syncAllReadyThemes","forEach","get","scheduleAutoRetry","reason","autoRetryCount","navigator","onLine","shouldAutoRetry","attempt","source","setTimeout","active","startLoad","fail","giscusErrorReason","giscusErrorMessage","succeed","prefersReducedMotion","matchMedia","matches","remove","offsetWidth","add","pulseReady","forceRetry","firstChild","removeChild","clearContainer","config","parsedTimeout","Number","parseInt","giscusTimeout","repo","giscusRepo","repoId","giscusRepoId","category","giscusCategory","categoryId","giscusCategoryId","mapping","giscusMapping","term","giscusTerm","strict","giscusStrict","reactionsEnabled","giscusReactionsEnabled","emitMetadata","giscusEmitMetadata","inputPosition","giscusInputPosition","giscusLoading","timeoutMs","isFinite","getConfig","validateConfig","createElement","src","async","crossOrigin","buildScript","onerror","MutationObserver","addEventListener","once","observe","childList","subtree","appendChild","initRoot","giscusBooted","io","set","push","fallbackLink","giscusFallbackUrl","retryButton","IntersectionObserver","entries","entry","isIntersecting","rootMargin","threshold","boot","roots","Array","from","querySelectorAll","length","attributes","attributeFilter","attachThemeBindings","onOnline","attachConnectivityBindings","readyState","__giscusLoader","reloadAll","getStatus"],"sources":["giscus-loader.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Shared, resilient Giscus loader for FA/EN home pages.\r\n(function () {\r\n  \"use strict\";\r\n\r\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  const ROOT_SELECTOR = \"[data-giscus-root]\";\r\n  const GISCUS_SCRIPT_SRC = \"https://giscus.app/client.js\";\r\n  const GISCUS_ORIGIN = \"https://giscus.app\";\r\n  const DEFAULT_TIMEOUT_MS = 8000;\r\n  const IO_ROOT_MARGIN = \"320px 0px\";\r\n  const MAX_AUTO_RETRIES = 1;\r\n  const AUTO_RETRY_DELAY_MS = 900;\r\n  const ROOTS = [];\r\n  const STATES = new WeakMap();\r\n\r\n  let themeBindingsAttached = false;\r\n  let connectivityBindingsAttached = false;\r\n\r\n  function query(root, selector) {\r\n    return root ? root.querySelector(selector) : null;\r\n  }\r\n\r\n  function showElement(element, visible) {\r\n    if (!element) {return;}\r\n    if (visible) {\r\n      element.removeAttribute(\"hidden\");\r\n    } else {\r\n      element.setAttribute(\"hidden\", \"\");\r\n    }\r\n  }\r\n\r\n  function resolveLocale(root) {\r\n    const lang =\r\n      root.dataset.giscusLang ||\r\n      document.documentElement.lang ||\r\n      \"en\";\r\n    return lang.toLowerCase().startsWith(\"fa\") ? \"fa\" : \"en\";\r\n  }\r\n\r\n  function resolveTheme() {\r\n    const current =\r\n      (document.documentElement.getAttribute(\"data-theme\") || \"\")\r\n        .trim()\r\n        .toLowerCase();\r\n    if (current === \"dark\") {return \"dark\";}\r\n    if (current === \"light\") {return \"light\";}\r\n    return \"preferred_color_scheme\";\r\n  }\r\n\r\n  function defaultErrorMessage(root) {\r\n    return resolveLocale(root) === \"fa\"\r\n      ? \"بارگذاری نظرات با مشکل مواجه شد. لطفاً دوباره تلاش کنید.\"\r\n      : \"Comments could not be loaded. Please try again.\";\r\n  }\r\n\r\n  function reportState(status) {\r\n    if (typeof window.gtag !== \"function\") {return;}\r\n    if (status === \"idle\") {return;}\r\n\r\n    try {\r\n      window.gtag(\"event\", \"giscus_state_change\", {\r\n        event_category: \"engagement\",\r\n        event_label: status,\r\n      });\r\n    } catch {\r\n      // Metrics should never block UX.\r\n    }\r\n  }\r\n\r\n  function setBusyState(root, busy) {\r\n    const container = query(root, \".giscus-container\");\r\n    if (container) {\r\n      container.setAttribute(\"aria-busy\", busy ? \"true\" : \"false\");\r\n    }\r\n    root.setAttribute(\"aria-busy\", busy ? \"true\" : \"false\");\r\n  }\r\n\r\n  function emit(root, name, detail) {\r\n    try {\r\n      root.dispatchEvent(\r\n        new CustomEvent(name, {\r\n          bubbles: true,\r\n          detail: detail || {},\r\n        })\r\n      );\r\n    } catch {\r\n      // Silently ignore in older browsers.\r\n    }\r\n  }\r\n\r\n  function setStatus(root, status, message) {\r\n    const loading = query(root, \".giscus-loading\");\r\n    const error = query(root, \".giscus-error\");\r\n    const errorMessage = query(root, \".giscus-error-message\");\r\n\r\n    root.dataset.giscusStatus = status;\r\n\r\n    const isLoading = status === \"loading\";\r\n    if (loading) {\r\n      loading.classList.toggle(\"hidden\", !isLoading);\r\n      showElement(loading, isLoading);\r\n    }\r\n\r\n    const isError = status === \"error\";\r\n    if (error) {\r\n      error.classList.toggle(\"hidden\", !isError);\r\n      showElement(error, isError);\r\n    }\r\n\r\n    if (isError && errorMessage) {\r\n      errorMessage.textContent = message || defaultErrorMessage(root);\r\n    }\r\n\r\n    setBusyState(root, isLoading);\r\n    emit(root, \"giscus:state-change\", { status });\r\n    reportState(status);\r\n  }\r\n\r\n  function clearContainer(root) {\r\n    const container = query(root, \".giscus-container\");\r\n    if (!container) {return;}\r\n    while (container.firstChild) {\r\n      container.removeChild(container.firstChild);\r\n    }\r\n  }\r\n\r\n  function clearRuntime(state) {\r\n    if (!state) {return;}\r\n\r\n    if (state.timeoutId) {\r\n      window.clearTimeout(state.timeoutId);\r\n      state.timeoutId = null;\r\n    }\r\n\r\n    if (state.retryTimer) {\r\n      window.clearTimeout(state.retryTimer);\r\n      state.retryTimer = null;\r\n    }\r\n\r\n    if (state.observer) {\r\n      state.observer.disconnect();\r\n      state.observer = null;\r\n    }\r\n\r\n    if (state.iframe && state.iframeLoadHandler) {\r\n      state.iframe.removeEventListener(\"load\", state.iframeLoadHandler);\r\n      state.iframeLoadHandler = null;\r\n    }\r\n\r\n    state.iframe = null;\r\n    state.script = null;\r\n  }\r\n\r\n  function pulseReady(root) {\r\n    const prefersReducedMotion = window.matchMedia?.(\"(prefers-reduced-motion: reduce)\").matches;\r\n    if (prefersReducedMotion) {return;}\r\n\r\n    root.classList.remove(\"giscus-ready-pulse\");\r\n    // Trigger reflow so a subsequent class re-add restarts animation.\r\n    void root.offsetWidth;\r\n    root.classList.add(\"giscus-ready-pulse\");\r\n\r\n    window.setTimeout(() => {\r\n      root.classList.remove(\"giscus-ready-pulse\");\r\n    }, 700);\r\n  }\r\n\r\n  function syncTheme(root) {\r\n    const theme = resolveTheme();\r\n    root.dataset.giscusThemeApplied = theme;\r\n\r\n    const iframe = query(root, \"iframe.giscus-frame\");\r\n    if (!iframe || !iframe.contentWindow) {return;}\r\n\r\n    try {\r\n      iframe.contentWindow.postMessage(\r\n        {\r\n          giscus: {\r\n            setConfig: {\r\n              theme,\r\n            },\r\n          },\r\n        },\r\n        GISCUS_ORIGIN\r\n      );\r\n      emit(root, \"giscus:theme-sync\", { theme });\r\n    } catch {\r\n      // Cross-origin sync failures should not break UX.\r\n    }\r\n  }\r\n\r\n  function syncAllReadyThemes() {\r\n    ROOTS.forEach((root) => {\r\n      const state = STATES.get(root);\r\n      if (!state || state.status !== \"ready\") {return;}\r\n      syncTheme(root);\r\n    });\r\n  }\r\n\r\n  function attachThemeBindings() {\r\n    if (themeBindingsAttached) {return;}\r\n    themeBindingsAttached = true;\r\n\r\n    const observer = new MutationObserver(() => {\r\n      syncAllReadyThemes();\r\n    });\r\n\r\n    observer.observe(document.documentElement, {\r\n      attributes: true,\r\n      attributeFilter: [\"data-theme\"],\r\n    });\r\n\r\n    window.addEventListener(\"themechange\", syncAllReadyThemes);\r\n    window.addEventListener(\r\n      \"beforeunload\",\r\n      () => {\r\n        observer.disconnect();\r\n        window.removeEventListener(\"themechange\", syncAllReadyThemes);\r\n      },\r\n      { once: true }\r\n    );\r\n  }\r\n\r\n  function attachConnectivityBindings() {\r\n    if (connectivityBindingsAttached) {return;}\r\n    connectivityBindingsAttached = true;\r\n\r\n    const onOnline = () => {\r\n      ROOTS.forEach((root) => {\r\n        const state = STATES.get(root);\r\n        if (!state || state.status !== \"error\") {return;}\r\n        startLoad(root, true, \"online\");\r\n      });\r\n    };\r\n\r\n    window.addEventListener(\"online\", onOnline);\r\n    window.addEventListener(\r\n      \"beforeunload\",\r\n      () => {\r\n        window.removeEventListener(\"online\", onOnline);\r\n      },\r\n      { once: true }\r\n    );\r\n  }\r\n\r\n  function getConfig(root) {\r\n    const parsedTimeout = Number.parseInt(root.dataset.giscusTimeout || \"\", 10);\r\n\r\n    return {\r\n      repo: root.dataset.giscusRepo || \"\",\r\n      repoId: root.dataset.giscusRepoId || \"\",\r\n      category: root.dataset.giscusCategory || \"\",\r\n      categoryId: root.dataset.giscusCategoryId || \"\",\r\n      mapping: root.dataset.giscusMapping || \"specific\",\r\n      term: root.dataset.giscusTerm || \"\",\r\n      lang: root.dataset.giscusLang || resolveLocale(root),\r\n      strict: root.dataset.giscusStrict || \"1\",\r\n      reactionsEnabled: root.dataset.giscusReactionsEnabled || \"1\",\r\n      emitMetadata: root.dataset.giscusEmitMetadata || \"0\",\r\n      inputPosition: root.dataset.giscusInputPosition || \"top\",\r\n      loading: root.dataset.giscusLoading || \"lazy\",\r\n      timeoutMs:\r\n        Number.isFinite(parsedTimeout) && parsedTimeout > 0\r\n          ? parsedTimeout\r\n          : DEFAULT_TIMEOUT_MS,\r\n    };\r\n  }\r\n\r\n  function validateConfig(config) {\r\n    if (!config.repo || !config.repoId) {return false;}\r\n    if (!config.category || !config.categoryId) {return false;}\r\n    if (config.mapping === \"specific\" && !config.term) {return false;}\r\n    return true;\r\n  }\r\n\r\n  function buildScript(config) {\r\n    const script = document.createElement(\"script\");\r\n    script.src = GISCUS_SCRIPT_SRC;\r\n    script.async = true;\r\n    script.crossOrigin = \"anonymous\";\r\n\r\n    script.setAttribute(\"data-repo\", config.repo);\r\n    script.setAttribute(\"data-repo-id\", config.repoId);\r\n    script.setAttribute(\"data-category\", config.category);\r\n    script.setAttribute(\"data-category-id\", config.categoryId);\r\n    script.setAttribute(\"data-mapping\", config.mapping);\r\n    script.setAttribute(\"data-lang\", config.lang);\r\n    script.setAttribute(\"data-strict\", config.strict);\r\n    script.setAttribute(\"data-reactions-enabled\", config.reactionsEnabled);\r\n    script.setAttribute(\"data-emit-metadata\", config.emitMetadata);\r\n    script.setAttribute(\"data-input-position\", config.inputPosition);\r\n    script.setAttribute(\"data-loading\", config.loading);\r\n    script.setAttribute(\"data-theme\", resolveTheme());\r\n    script.setAttribute(\"data-ai-integration\", \"giscus-comments\");\r\n\r\n    if (config.mapping === \"specific\" && config.term) {\r\n      script.setAttribute(\"data-term\", config.term);\r\n    }\r\n\r\n    return script;\r\n  }\r\n\r\n  function shouldAutoRetry(state, reason) {\r\n    if (!state) {return false;}\r\n    if (state.autoRetryCount >= MAX_AUTO_RETRIES) {return false;}\r\n    if (reason !== \"timeout\" && reason !== \"script-error\") {return false;}\r\n    if (!navigator.onLine) {return false;}\r\n    return true;\r\n  }\r\n\r\n  function scheduleAutoRetry(root, reason) {\r\n    const state = STATES.get(root);\r\n    if (!state || !shouldAutoRetry(state, reason)) {return;}\r\n\r\n    state.autoRetryCount += 1;\r\n    const attempt = state.autoRetryCount;\r\n    emit(root, \"giscus:retry\", { reason, attempt, source: \"auto\" });\r\n\r\n    state.retryTimer = window.setTimeout(() => {\r\n      const active = STATES.get(root);\r\n      if (!active || active.status !== \"error\") {return;}\r\n      startLoad(root, true, \"auto\");\r\n    }, AUTO_RETRY_DELAY_MS * attempt);\r\n  }\r\n\r\n  function fail(root, reason) {\r\n    const state = STATES.get(root);\r\n    if (!state || state.status !== \"loading\") {return;}\r\n\r\n    clearRuntime(state);\r\n    state.status = \"error\";\r\n    root.dataset.giscusErrorReason = reason;\r\n\r\n    setStatus(\r\n      root,\r\n      \"error\",\r\n      root.dataset.giscusErrorMessage || defaultErrorMessage(root)\r\n    );\r\n\r\n    emit(root, \"giscus:error\", { reason });\r\n    scheduleAutoRetry(root, reason);\r\n  }\r\n\r\n  function succeed(root) {\r\n    const state = STATES.get(root);\r\n    if (!state || state.status !== \"loading\") {return;}\r\n\r\n    clearRuntime(state);\r\n    state.status = \"ready\";\r\n    state.autoRetryCount = 0;\r\n    setStatus(root, \"ready\");\r\n    syncTheme(root);\r\n    pulseReady(root);\r\n\r\n    emit(root, \"giscus:ready\", { theme: resolveTheme() });\r\n  }\r\n\r\n  function startLoad(root, forceRetry, source = \"manual\") {\r\n    const state = STATES.get(root);\r\n    if (!state) {return;}\r\n\r\n    if (source !== \"auto\") {\r\n      state.autoRetryCount = 0;\r\n    }\r\n\r\n    if (state.status === \"loading\") {return;}\r\n    if (state.status === \"ready\" && !forceRetry) {return;}\r\n\r\n    clearRuntime(state);\r\n    clearContainer(root);\r\n\r\n    const config = getConfig(root);\r\n    if (!validateConfig(config)) {\r\n      state.status = \"error\";\r\n      setStatus(root, \"error\", defaultErrorMessage(root));\r\n      emit(root, \"giscus:error\", { reason: \"invalid-config\" });\r\n      return;\r\n    }\r\n\r\n    const container = query(root, \".giscus-container\");\r\n    if (!container) {\r\n      state.status = \"error\";\r\n      setStatus(root, \"error\", defaultErrorMessage(root));\r\n      emit(root, \"giscus:error\", { reason: \"missing-container\" });\r\n      return;\r\n    }\r\n\r\n    state.status = \"loading\";\r\n    setStatus(root, \"loading\");\r\n    root.dataset.giscusThemeApplied = resolveTheme();\r\n    root.dataset.giscusErrorReason = \"\";\r\n    emit(root, \"giscus:loading\", { source });\r\n\r\n    const script = buildScript(config);\r\n    state.script = script;\r\n\r\n    state.timeoutId = window.setTimeout(() => {\r\n      fail(root, \"timeout\");\r\n    }, config.timeoutMs);\r\n\r\n    script.onerror = () => {\r\n      fail(root, \"script-error\");\r\n    };\r\n\r\n    state.observer = new MutationObserver(() => {\r\n      const iframe = query(root, \"iframe.giscus-frame\");\r\n      if (!iframe || state.iframe === iframe) {return;}\r\n\r\n      state.iframe = iframe;\r\n      state.iframeLoadHandler = () => {\r\n        succeed(root);\r\n      };\r\n      iframe.addEventListener(\"load\", state.iframeLoadHandler, { once: true });\r\n\r\n      // Cross-origin iframes may not reliably fire a visible load event.\r\n      window.setTimeout(() => {\r\n        const active = STATES.get(root);\r\n        if (!active || active.status !== \"loading\") {return;}\r\n        succeed(root);\r\n      }, 1200);\r\n    });\r\n\r\n    state.observer.observe(container, { childList: true, subtree: true });\r\n    container.appendChild(script);\r\n  }\r\n\r\n  function initRoot(root) {\r\n    if (!root || root.dataset.giscusBooted === \"true\") {return;}\r\n    root.dataset.giscusBooted = \"true\";\r\n\r\n    const state = {\r\n      status: \"idle\",\r\n      observer: null,\r\n      timeoutId: null,\r\n      retryTimer: null,\r\n      autoRetryCount: 0,\r\n      iframe: null,\r\n      iframeLoadHandler: null,\r\n      script: null,\r\n      io: null,\r\n    };\r\n    STATES.set(root, state);\r\n    ROOTS.push(root);\r\n\r\n    const fallbackLink = query(root, \".giscus-fallback-link\");\r\n    if (fallbackLink && root.dataset.giscusFallbackUrl) {\r\n      fallbackLink.setAttribute(\"href\", root.dataset.giscusFallbackUrl);\r\n    }\r\n\r\n    const retryButton = query(root, \".giscus-retry-btn\");\r\n    if (retryButton) {\r\n      retryButton.addEventListener(\"click\", () => {\r\n        emit(root, \"giscus:retry\", { reason: \"manual-click\", attempt: 0, source: \"manual\" });\r\n        startLoad(root, true, \"manual\");\r\n      });\r\n    }\r\n\r\n    setStatus(root, \"idle\");\r\n\r\n    if (\"IntersectionObserver\" in window) {\r\n      state.io = new IntersectionObserver(\r\n        (entries) => {\r\n          entries.forEach((entry) => {\r\n            if (!entry.isIntersecting) {return;}\r\n            if (state.io) {\r\n              state.io.disconnect();\r\n              state.io = null;\r\n            }\r\n            startLoad(root, false, \"init\");\r\n          });\r\n        },\r\n        { rootMargin: IO_ROOT_MARGIN, threshold: 0.01 }\r\n      );\r\n      state.io.observe(root);\r\n    } else {\r\n      startLoad(root, false, \"init\");\r\n    }\r\n  }\r\n\r\n  function boot() {\r\n    const roots = Array.from(document.querySelectorAll(ROOT_SELECTOR));\r\n    if (!roots.length) {return;}\r\n\r\n    roots.forEach(initRoot);\r\n    attachThemeBindings();\r\n    attachConnectivityBindings();\r\n  }\r\n\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", boot, { once: true });\r\n  } else {\r\n    boot();\r\n  }\r\n\r\n  window.__giscusLoader = {\r\n    reloadAll() {\r\n      ROOTS.forEach((root) => startLoad(root, true, \"manual\"));\r\n    },\r\n    getStatus(root) {\r\n      const state = STATES.get(root);\r\n      return state ? state.status : \"unknown\";\r\n    },\r\n  };\r\n})();\r\n"]}