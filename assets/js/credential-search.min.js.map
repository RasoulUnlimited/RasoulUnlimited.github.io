{"version":3,"file":"credential-search.min.js","names":["initCredentialSearch","searchInput","document","getElementById","clearButton","voiceButton","resultsInfo","cards","querySelectorAll","lang","dataset","documentElement","length","_searchAbortController","abort","controller","AbortController","signal","setAttribute","STORAGE_KEY","storage","testKey","localStorage","setItem","removeItem","err","getSafeStorage","safeToast","message","options","window","createToast","savedTerm","getItem","debounceTimer","value","style","display","normalizeText","str","normalize","replace","toLowerCase","forEach","card","nameEl","querySelector","summaryEl","original","textContent","originalHtml","innerHTML","highlightText","el","term","mark","parent","parentNode","replaceChild","createTextNode","walker","createTreeWalker","NodeFilter","SHOW_TEXT","nodesToReplace","pattern","split","map","char","escaped","join","regex","RegExp","nextNode","node","currentNode","classList","contains","nodeValue","test","push","fragment","createDocumentFragment","part","index","createElement","className","appendChild","filterCards","searchTerm","undefined","trim","searchNormalized","visibleCount","normalizedName","normalizedSummary","normalizedKeywords","keywords","includes","count","startsWith","word","updateResultsInfo","persistTerm","clearSearch","clearTimeout","focus","addEventListener","setTimeout","e","key","preventDefault","SpeechRecognition","webkitSpeechRecognition","recognition","interimResults","handleClickStart","start","handleStart","add","handleEnd","remove","handleResult","transcript","results","handleError","error","cleanup","removeEventListener","active","activeElement","tag","tagName","isTextField","isContentEditable","ctrlKey","metaKey"],"sources":["credential-search.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Minimal credential search functionality\r\n// Similar to faq-search.js but for proof pages\r\n\r\nfunction initCredentialSearch() {\r\n  const searchInput = document.getElementById(\"credential-search\");\r\n  const clearButton = document.getElementById(\"clear-credential-search\");\r\n  const voiceButton = document.getElementById(\"voice-search-btn\");\r\n  const resultsInfo = document.getElementById(\"results-info\");\r\n  const cards = document.querySelectorAll(\".credential-card\");\r\n  const lang =\r\n    (resultsInfo && resultsInfo.dataset.lang) ||\r\n    document.documentElement.lang ||\r\n    \"en\";\r\n\r\n  if (!searchInput || !clearButton || !cards.length) {return;}\r\n\r\n  // Cleanup previous listeners if any\r\n  if (searchInput._searchAbortController) {\r\n    searchInput._searchAbortController.abort();\r\n  }\r\n  const controller = new AbortController();\r\n  searchInput._searchAbortController = controller;\r\n  const signal = { signal: controller.signal };\r\n\r\n  // Make results info a live region for screen readers\r\n  if (resultsInfo) {\r\n    resultsInfo.setAttribute(\"aria-live\", \"polite\");\r\n    resultsInfo.setAttribute(\"aria-atomic\", \"true\");\r\n  }\r\n\r\n  const STORAGE_KEY = \"credentialSearchTerm\";\r\n\r\n  function getSafeStorage() {\r\n    const testKey = \"__credential_search__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch (err) {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\r\n\r\n  // Safe wrapper for createToast (works with 1-arg or 2-arg versions)\r\n  function safeToast(message, options) {\r\n    if (typeof window.createToast !== \"function\") {return;}\r\n    try {\r\n      return window.createToast(message, options);\r\n    } catch {\r\n      // fallback for minimal createToast(message)\r\n      try {\r\n        return window.createToast(message);\r\n      } catch {\r\n        // ignore\r\n      }\r\n    }\r\n  }\r\n\r\n  const savedTerm = storage?.getItem(STORAGE_KEY) || \"\";\r\n  if (savedTerm) {\r\n    searchInput.value = savedTerm;\r\n    clearButton.style.display = \"block\";\r\n  }\r\n\r\n  let debounceTimer;\r\n\r\n  const normalizeText = (str) =>\r\n    (str || \"\")\r\n      .normalize(\"NFC\")\r\n      .replace(/[ي]/g, \"ی\")\r\n      .replace(/[ك]/g, \"ک\")\r\n      .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\r\n      .replace(/‌/g, \"\")\r\n      .toLowerCase();\r\n\r\n  const escapeRegExp = (str) => str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n\r\n  // cache original texts and HTML\r\n  cards.forEach((card) => {\r\n    const nameEl = card.querySelector(\"h3\");\r\n    const summaryEl = card.querySelector(\".credential-summary\");\r\n    if (nameEl && !nameEl.dataset.original) {\r\n      nameEl.dataset.original = nameEl.textContent || \"\";\r\n      nameEl.dataset.originalHtml = nameEl.innerHTML || \"\";\r\n    }\r\n    if (summaryEl && !summaryEl.dataset.original) {\r\n      summaryEl.dataset.original = summaryEl.textContent || \"\";\r\n      summaryEl.dataset.originalHtml = summaryEl.innerHTML || \"\";\r\n    }\r\n  });\r\n\r\n  const highlightText = (el, term) => {\r\n    if (!el) {return;}\r\n    \r\n    // Remove existing highlights first to preserve event listeners\r\n    // This replaces the destructive innerHTML restoration\r\n    const highlights = el.querySelectorAll(\"mark.search-highlight\");\r\n    highlights.forEach(mark => {\r\n      const parent = mark.parentNode;\r\n      parent.replaceChild(document.createTextNode(mark.textContent), mark);\r\n      parent.normalize();\r\n    });\r\n\r\n    if (!term) {\r\n      return;\r\n    }\r\n\r\n    const walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, null, false);\r\n    const nodesToReplace = [];\r\n    \r\n    // Normalize term to base characters first to match filter logic\r\n    const normalizedTerm = normalizeText(term);\r\n    \r\n    // Build regex that allows for diacritics and ZWNJ between characters\r\n    const noise = \"[\\\\u064B-\\\\u065F\\\\u0670\\\\u200c\\\\u200d]*\";\r\n    const pattern = normalizedTerm.split(\"\").map(char => {\r\n      const escaped = escapeRegExp(char);\r\n      if (char === \"ی\") return \"[یي]\";\r\n      if (char === \"ک\") return \"[کك]\";\r\n      return escaped;\r\n    }).join(noise);\r\n\r\n    // Remove 'g' flag to avoid stateful behavior with test() in loop\r\n    const regex = new RegExp(`(${pattern})`, \"i\");\r\n\r\n    while (walker.nextNode()) {\r\n      const node = walker.currentNode;\r\n      // Skip if parent is already a highlight\r\n      if (node.parentNode.classList.contains(\"search-highlight\")) continue;\r\n\r\n      if (node.nodeValue && regex.test(node.nodeValue)) {\r\n        nodesToReplace.push(node);\r\n      }\r\n    }\r\n\r\n    nodesToReplace.forEach(node => {\r\n      const fragment = document.createDocumentFragment();\r\n      const parts = node.nodeValue.split(regex);\r\n      \r\n      parts.forEach((part, index) => {\r\n        if (index % 2 === 1) { // Matched part\r\n          const mark = document.createElement(\"mark\");\r\n          mark.className = \"search-highlight\"; // Add class for safe removal\r\n          mark.textContent = part;\r\n          fragment.appendChild(mark);\r\n        } else if (part) {\r\n          fragment.appendChild(document.createTextNode(part));\r\n        }\r\n      });\r\n      \r\n      node.parentNode.replaceChild(fragment, node);\r\n    });\r\n  };\r\n\r\n  const updateResultsInfo = (count) => {\r\n    if (!resultsInfo) {return;}\r\n    if (lang.startsWith(\"fa\")) {\r\n      resultsInfo.textContent =\r\n        count === 0 ? \"موردی یافت نشد\" : `${count} نتیجه یافت شد`;\r\n    } else {\r\n      const word = count === 1 ? \"result\" : \"results\";\r\n      resultsInfo.textContent =\r\n        count === 0 ? \"No results found\" : `${count} ${word} found`;\r\n    }\r\n  };\r\n\r\n  const filterCards = (term) => {\r\n    const searchTerm = term !== undefined ? term : searchInput.value.trim();\r\n    const searchNormalized = normalizeText(searchTerm).toLowerCase();\r\n    let visibleCount = 0;\r\n\r\n    cards.forEach((card) => {\r\n      const nameEl = card.querySelector(\"h3\");\r\n      const summaryEl = card.querySelector(\".credential-summary\");\r\n\r\n      // Cache normalized values to avoid redundant normalization calls\r\n      const normalizedName = nameEl && nameEl.dataset.original\r\n        ? normalizeText(nameEl.dataset.original).toLowerCase()\r\n        : \"\";\r\n      const normalizedSummary = summaryEl && summaryEl.dataset.original\r\n        ? normalizeText(summaryEl.dataset.original).toLowerCase()\r\n        : \"\";\r\n      const normalizedKeywords = normalizeText(card.dataset.keywords || \"\").toLowerCase();\r\n\r\n      const matches =\r\n        !searchNormalized ||\r\n        normalizedName.includes(searchNormalized) ||\r\n        normalizedSummary.includes(searchNormalized) ||\r\n        normalizedKeywords.includes(searchNormalized);\r\n\r\n      if (matches) {\r\n        card.style.display = \"grid\";\r\n        highlightText(nameEl, searchTerm);\r\n        highlightText(summaryEl, searchTerm);\r\n        visibleCount++;\r\n      } else {\r\n        card.style.display = \"none\";\r\n        highlightText(nameEl, \"\");\r\n        highlightText(summaryEl, \"\");\r\n      }\r\n    });\r\n\r\n    updateResultsInfo(visibleCount);\r\n  };\r\n\r\n  function persistTerm(term) {\r\n    if (!storage) {return;}\r\n    try {\r\n      if (term) {\r\n        storage.setItem(STORAGE_KEY, term);\r\n      } else {\r\n        storage.removeItem(STORAGE_KEY);\r\n      }\r\n    } catch {\r\n      // ignore storage errors (e.g. Safari private mode)\r\n    }\r\n  }\r\n\r\n  function clearSearch() {\r\n    searchInput.value = \"\";\r\n    clearButton.style.display = \"none\";\r\n    clearTimeout(debounceTimer);\r\n    persistTerm(\"\");\r\n    filterCards(\"\");\r\n    searchInput.focus();\r\n  }\r\n\r\n  // text search\r\n  searchInput.addEventListener(\"input\", () => {\r\n    const term = searchInput.value.trim();\r\n    clearButton.style.display = term ? \"block\" : \"none\";\r\n    persistTerm(term);\r\n\r\n    clearTimeout(debounceTimer);\r\n    debounceTimer = setTimeout(() => filterCards(term), 200);\r\n  }, { signal: controller.signal });\r\n\r\n  clearButton.addEventListener(\"click\", clearSearch, { signal: controller.signal });\r\n\r\n  searchInput.addEventListener(\"keydown\", (e) => {\r\n    if (e.key === \"Escape\") {\r\n      e.preventDefault();\r\n      clearSearch();\r\n    }\r\n  }, { signal: controller.signal });\r\n\r\n  // Voice search\r\n  if (voiceButton) {\r\n    const SpeechRecognition =\r\n      window.SpeechRecognition || window.webkitSpeechRecognition;\r\n    if (SpeechRecognition) {\r\n      const recognition = new SpeechRecognition();\r\n      recognition.lang = lang.startsWith(\"fa\") ? \"fa-IR\" : \"en-US\";\r\n      recognition.interimResults = false;\r\n\r\n      // Define event handlers with proper cleanup capability\r\n      const handleClickStart = () => recognition.start();\r\n      const handleStart = () => {\r\n        voiceButton.classList.add(\"listening\");\r\n        voiceButton.setAttribute(\"aria-pressed\", \"true\");\r\n      };\r\n      const handleEnd = () => {\r\n        voiceButton.classList.remove(\"listening\");\r\n        voiceButton.setAttribute(\"aria-pressed\", \"false\");\r\n      };\r\n      const handleResult = (e) => {\r\n        const transcript = (e.results[0][0].transcript || \"\").trim();\r\n        searchInput.value = transcript;\r\n        clearButton.style.display = transcript ? \"block\" : \"none\";\r\n        persistTerm(transcript);\r\n        \r\n        // Clear any pending debounce timers to prevent memory buildup\r\n        clearTimeout(debounceTimer);\r\n        // Immediately filter without debounce for voice results (more responsive UX)\r\n        filterCards(transcript);\r\n      };\r\n      const handleError = (err) => {\r\n        // ignore \"no-speech\" / \"aborted\" noise\r\n        if (err && (err.error === \"no-speech\" || err.error === \"aborted\"))\r\n        {return;}\r\n        safeToast(\r\n          lang.startsWith(\"fa\")\r\n            ? \"امکان دریافت صدا نیست.\"\r\n            : \"Voice recognition unavailable.\"\r\n        );\r\n      };\r\n\r\n      voiceButton.addEventListener(\"click\", handleClickStart, { signal: controller.signal });\r\n      recognition.addEventListener(\"start\", handleStart);\r\n      recognition.addEventListener(\"end\", handleEnd);\r\n      recognition.addEventListener(\"result\", handleResult);\r\n      recognition.addEventListener(\"error\", handleError);\r\n\r\n      // Cleanup on page unload or re-init\r\n      const cleanup = () => {\r\n        try {\r\n          recognition.abort();\r\n        } catch (e) {\r\n          // Ignore errors during abort\r\n        }\r\n        // voiceButton listener is removed by signal\r\n        recognition.removeEventListener(\"start\", handleStart);\r\n        recognition.removeEventListener(\"end\", handleEnd);\r\n        recognition.removeEventListener(\"result\", handleResult);\r\n        recognition.removeEventListener(\"error\", handleError);\r\n      };\r\n\r\n      controller.signal.addEventListener('abort', cleanup);\r\n      window.addEventListener(\"beforeunload\", cleanup, { signal: controller.signal });\r\n    } else {\r\n      voiceButton.style.display = \"none\";\r\n      safeToast(\r\n        lang.startsWith(\"fa\")\r\n          ? \"مرورگر شما از جستجوی صوتی پشتیبانی نمی‌کند.\"\r\n          : \"Voice search isn't supported.\"\r\n      );\r\n    }\r\n  }\r\n\r\n  // Global keyboard shortcuts: / or Ctrl/Cmd+K to focus search\r\n  document.addEventListener(\"keydown\", (e) => {\r\n    const active = document.activeElement;\r\n    const tag = active && active.tagName;\r\n\r\n    const isTextField =\r\n      active &&\r\n      (tag === \"INPUT\" ||\r\n        tag === \"TEXTAREA\" ||\r\n        active.isContentEditable === true);\r\n\r\n    if (\r\n      (e.key === \"/\" ||\r\n        (e.key.toLowerCase() === \"k\" && (e.ctrlKey || e.metaKey))) &&\r\n      !isTextField &&\r\n      active !== searchInput\r\n    ) {\r\n      e.preventDefault();\r\n      searchInput.focus();\r\n      return;\r\n    }\r\n\r\n    if (e.key === \"Escape\" && active === searchInput) {\r\n      e.preventDefault();\r\n      clearSearch();\r\n    }\r\n  }, { signal: controller.signal });\r\n\r\n  // Initial filter with saved term (if any)\r\n  filterCards(savedTerm);\r\n\r\n  // Cleanup on page unload to prevent memory leaks\r\n  window.addEventListener(\"beforeunload\", () => {\r\n    clearTimeout(debounceTimer);\r\n  }, { signal: controller.signal });\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", initCredentialSearch);\r\ndocument.addEventListener(\"includesLoaded\", initCredentialSearch);\r\n"]}