{"version":3,"file":"credential-search.min.js","names":["window","document","addEventListener","searchInput","getElementById","clearButton","voiceButton","resultsInfo","cards","querySelectorAll","lang","dataset","documentElement","length","isFarsi","toLowerCase","startsWith","STORAGE_KEY","setAttribute","storage","testKey","localStorage","setItem","removeItem","getSafeStorage","safeToast","message","options","createToast","normalizeText","str","normalize","replace","forEach","card","nameEl","querySelector","summaryEl","original","textContent","originalHtml","innerHTML","searchIndex","keywords","filter","Boolean","join","highlightText","el","term","mark","parent","parentNode","replaceChild","createTextNode","walker","createTreeWalker","NodeFilter","SHOW_TEXT","nodesToReplace","pattern","split","map","char","escaped","regex","RegExp","nextNode","node","currentNode","nodeValue","classList","contains","test","push","fragment","createDocumentFragment","part","index","createElement","className","appendChild","savedTerm","getItem","debounceTimer","value","style","display","filterCards","searchTerm","undefined","trim","searchNormalized","visibleCount","includes","count","word","updateResultsInfo","persistTerm","clearSearch","clearTimeout","focus","setTimeout","e","key","preventDefault","SpeechRecognition","webkitSpeechRecognition","recognition","interimResults","handleClickStart","start","handleStart","add","handleEnd","remove","handleResult","transcript","results","handleError","err","error","cleanup","abort","removeEventListener","active","activeElement","tag","tagName","isTextField","isContentEditable","ctrlKey","metaKey"],"sources":["credential-search.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// Minimal credential search functionality\r\n// Similar to faq-search.js but for proof pages\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  // جلوگیری از ارور در محیط‌هایی مثل SSR/Node\r\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", function () {\r\n    const searchInput = document.getElementById(\"credential-search\");\r\n    const clearButton = document.getElementById(\"clear-credential-search\");\r\n    const voiceButton = document.getElementById(\"voice-search-btn\");\r\n    const resultsInfo = document.getElementById(\"results-info\");\r\n    const cards = document.querySelectorAll(\".credential-card\");\r\n    const lang =\r\n      (resultsInfo && resultsInfo.dataset.lang) ||\r\n      document.documentElement.lang ||\r\n      \"en\";\r\n\r\n    if (!searchInput || !clearButton || !cards.length) return;\r\n\r\n    const isFarsi = lang.toLowerCase().startsWith(\"fa\");\r\n    const STORAGE_KEY = \"credentialSearchTerm\";\r\n\r\n    // Make results info a live region for screen readers\r\n    if (resultsInfo) {\r\n      resultsInfo.setAttribute(\"aria-live\", \"polite\");\r\n      resultsInfo.setAttribute(\"aria-atomic\", \"true\");\r\n    }\r\n\r\n    function getSafeStorage() {\r\n      const testKey = \"__credential_search__\";\r\n      try {\r\n        localStorage.setItem(testKey, testKey);\r\n        localStorage.removeItem(testKey);\r\n        return localStorage;\r\n      } catch {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    const storage = getSafeStorage();\r\n\r\n    /**\r\n     * Safe wrapper for createToast (works with 1-arg or 2-arg versions)\r\n     */\r\n    function safeToast(message, options) {\r\n      if (!message || typeof window.createToast !== \"function\") return;\r\n      try {\r\n        return window.createToast(message, options);\r\n      } catch {\r\n        try {\r\n          return window.createToast(message);\r\n        } catch {\r\n          // ignore\r\n        }\r\n      }\r\n    }\r\n\r\n    // نرمالایز برای سرچ (فارسی + حذف حرکات و ZWNJ)\r\n    const normalizeText = (str) =>\r\n      (str || \"\")\r\n        .normalize(\"NFC\")\r\n        .replace(/[ي]/g, \"ی\")\r\n        .replace(/[ك]/g, \"ک\")\r\n        .replace(/[\\u064B-\\u065F\\u0670]/g, \"\")\r\n        .replace(/‌/g, \"\")\r\n        .toLowerCase();\r\n\r\n    const escapeRegExp = (str) => str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n\r\n    // cache original texts/HTML + ساخت search index نرمالایز‌شده\r\n    cards.forEach((card) => {\r\n      const nameEl = card.querySelector(\"h3\");\r\n      const summaryEl = card.querySelector(\".credential-summary\");\r\n\r\n      if (nameEl && !nameEl.dataset.original) {\r\n        nameEl.dataset.original = nameEl.textContent || \"\";\r\n        nameEl.dataset.originalHtml = nameEl.innerHTML || \"\";\r\n      }\r\n      if (summaryEl && !summaryEl.dataset.original) {\r\n        summaryEl.dataset.original = summaryEl.textContent || \"\";\r\n        summaryEl.dataset.originalHtml = summaryEl.innerHTML || \"\";\r\n      }\r\n\r\n      const normalizedName = nameEl?.dataset.original\r\n        ? normalizeText(nameEl.dataset.original)\r\n        : \"\";\r\n      const normalizedSummary = summaryEl?.dataset.original\r\n        ? normalizeText(summaryEl.dataset.original)\r\n        : \"\";\r\n      const normalizedKeywords = normalizeText(card.dataset.keywords || \"\");\r\n\r\n      // یک ایندکس واحد برای جستجو\r\n      const searchIndex = [\r\n        normalizedName,\r\n        normalizedSummary,\r\n        normalizedKeywords,\r\n      ]\r\n        .filter(Boolean)\r\n        .join(\" \");\r\n\r\n      card.dataset.searchIndex = searchIndex;\r\n    });\r\n\r\n    /**\r\n     * حذف هایلایت‌های قبلی و اعمال هایلایت جدید روی متن\r\n     * هایلایت طوری انجام می‌شود که ساختار DOM کلی حفظ شود (کمترین تخریب)\r\n     * @param {HTMLElement | null} el\r\n     * @param {string} term\r\n     */\r\n    const highlightText = (el, term) => {\r\n      if (!el) return;\r\n\r\n      // Remove existing highlights (mark.search-highlight) بدون دست‌کاری بقیه DOM\r\n      const highlights = el.querySelectorAll(\"mark.search-highlight\");\r\n      highlights.forEach((mark) => {\r\n        const parent = mark.parentNode;\r\n        if (!parent) return;\r\n        parent.replaceChild(document.createTextNode(mark.textContent), mark);\r\n        parent.normalize();\r\n      });\r\n\r\n      if (!term) return;\r\n\r\n      const walker = document.createTreeWalker(\r\n        el,\r\n        NodeFilter.SHOW_TEXT,\r\n        null,\r\n        false\r\n      );\r\n\r\n      const nodesToReplace = [];\r\n      const normalizedTerm = normalizeText(term);\r\n\r\n      // ساخت pattern که اجازهٔ حرکات / ZWNJ بین کاراکترها را می‌دهد\r\n      const noise = \"[\\\\u064B-\\\\u065F\\\\u0670\\\\u200c\\\\u200d]*\";\r\n      const pattern = normalizedTerm\r\n        .split(\"\")\r\n        .map((char) => {\r\n          const escaped = escapeRegExp(char);\r\n          if (char === \"ی\") return \"[یي]\";\r\n          if (char === \"ک\") return \"[کك]\";\r\n          return escaped;\r\n        })\r\n        .join(noise);\r\n\r\n      const regex = new RegExp(`(${pattern})`, \"i\"); // بدون g تا stateful نباشد\r\n\r\n      while (walker.nextNode()) {\r\n        const node = walker.currentNode;\r\n\r\n        if (\r\n          !node.nodeValue ||\r\n          (node.parentNode &&\r\n            node.parentNode.classList &&\r\n            node.parentNode.classList.contains(\"search-highlight\"))\r\n        ) {\r\n          continue;\r\n        }\r\n\r\n        if (regex.test(node.nodeValue)) {\r\n          nodesToReplace.push(node);\r\n        }\r\n      }\r\n\r\n      nodesToReplace.forEach((node) => {\r\n        const fragment = document.createDocumentFragment();\r\n        const parts = node.nodeValue.split(regex);\r\n\r\n        parts.forEach((part, index) => {\r\n          if (index % 2 === 1) {\r\n            // matched segment\r\n            const mark = document.createElement(\"mark\");\r\n            mark.className = \"search-highlight\";\r\n            mark.textContent = part;\r\n            fragment.appendChild(mark);\r\n          } else if (part) {\r\n            fragment.appendChild(document.createTextNode(part));\r\n          }\r\n        });\r\n\r\n        node.parentNode.replaceChild(fragment, node);\r\n      });\r\n    };\r\n\r\n    const updateResultsInfo = (count) => {\r\n      if (!resultsInfo) return;\r\n      if (isFarsi) {\r\n        resultsInfo.textContent =\r\n          count === 0 ? \"موردی یافت نشد\" : `${count} نتیجه یافت شد`;\r\n      } else {\r\n        const word = count === 1 ? \"result\" : \"results\";\r\n        resultsInfo.textContent =\r\n          count === 0 ? \"No results found\" : `${count} ${word} found`;\r\n      }\r\n    };\r\n\r\n    const savedTerm = storage?.getItem(STORAGE_KEY) || \"\";\r\n    if (savedTerm) {\r\n      searchInput.value = savedTerm;\r\n      clearButton.style.display = \"block\";\r\n    }\r\n\r\n    let debounceTimer;\r\n\r\n    const filterCards = (term) => {\r\n      const searchTerm =\r\n        term !== undefined ? term : searchInput.value.trim() || \"\";\r\n      const searchNormalized = normalizeText(searchTerm);\r\n      let visibleCount = 0;\r\n\r\n      cards.forEach((card) => {\r\n        const nameEl = card.querySelector(\"h3\");\r\n        const summaryEl = card.querySelector(\".credential-summary\");\r\n        const searchIndex = card.dataset.searchIndex || \"\";\r\n\r\n        const matches =\r\n          !searchNormalized || searchIndex.includes(searchNormalized);\r\n\r\n        if (matches) {\r\n          card.style.display = \"grid\";\r\n          highlightText(nameEl, searchTerm);\r\n          highlightText(summaryEl, searchTerm);\r\n          visibleCount++;\r\n        } else {\r\n          card.style.display = \"none\";\r\n          highlightText(nameEl, \"\");\r\n          highlightText(summaryEl, \"\");\r\n        }\r\n      });\r\n\r\n      updateResultsInfo(visibleCount);\r\n    };\r\n\r\n    function persistTerm(term) {\r\n      if (!storage) return;\r\n      try {\r\n        if (term) {\r\n          storage.setItem(STORAGE_KEY, term);\r\n        } else {\r\n          storage.removeItem(STORAGE_KEY);\r\n        }\r\n      } catch {\r\n        // ignore storage errors (e.g. Safari private mode)\r\n      }\r\n    }\r\n\r\n    function clearSearch() {\r\n      searchInput.value = \"\";\r\n      clearButton.style.display = \"none\";\r\n      clearTimeout(debounceTimer);\r\n      persistTerm(\"\");\r\n      filterCards(\"\");\r\n      searchInput.focus();\r\n    }\r\n\r\n    // text search\r\n    searchInput.addEventListener(\"input\", () => {\r\n      const term = searchInput.value.trim();\r\n      clearButton.style.display = term ? \"block\" : \"none\";\r\n      persistTerm(term);\r\n\r\n      clearTimeout(debounceTimer);\r\n      debounceTimer = setTimeout(() => filterCards(term), 200);\r\n    });\r\n\r\n    clearButton.addEventListener(\"click\", clearSearch);\r\n\r\n    searchInput.addEventListener(\"keydown\", (e) => {\r\n      if (e.key === \"Escape\") {\r\n        e.preventDefault();\r\n        clearSearch();\r\n      }\r\n    });\r\n\r\n    // Voice search\r\n    if (voiceButton) {\r\n      const SpeechRecognition =\r\n        window.SpeechRecognition || window.webkitSpeechRecognition;\r\n\r\n      if (SpeechRecognition) {\r\n        const recognition = new SpeechRecognition();\r\n        recognition.lang = isFarsi ? \"fa-IR\" : \"en-US\";\r\n        recognition.interimResults = false;\r\n\r\n        const handleClickStart = () => recognition.start();\r\n        const handleStart = () => {\r\n          voiceButton.classList.add(\"listening\");\r\n          voiceButton.setAttribute(\"aria-pressed\", \"true\");\r\n        };\r\n        const handleEnd = () => {\r\n          voiceButton.classList.remove(\"listening\");\r\n          voiceButton.setAttribute(\"aria-pressed\", \"false\");\r\n        };\r\n        const handleResult = (e) => {\r\n          const transcript = (e.results[0][0].transcript || \"\").trim();\r\n          searchInput.value = transcript;\r\n          clearButton.style.display = transcript ? \"block\" : \"none\";\r\n          persistTerm(transcript);\r\n\r\n          clearTimeout(debounceTimer);\r\n          // برای تجربه‌ی بهتر، نتایج صوتی را بدون debounce اعمال می‌کنیم\r\n          filterCards(transcript);\r\n        };\r\n        const handleError = (err) => {\r\n          if (\r\n            err &&\r\n            (err.error === \"no-speech\" || err.error === \"aborted\")\r\n          ) {\r\n            return;\r\n          }\r\n          safeToast(\r\n            isFarsi\r\n              ? \"امکان دریافت صدا نیست.\"\r\n              : \"Voice recognition unavailable.\"\r\n          );\r\n        };\r\n\r\n        voiceButton.addEventListener(\"click\", handleClickStart);\r\n        recognition.addEventListener(\"start\", handleStart);\r\n        recognition.addEventListener(\"end\", handleEnd);\r\n        recognition.addEventListener(\"result\", handleResult);\r\n        recognition.addEventListener(\"error\", handleError);\r\n\r\n        // Cleanup on page unload to prevent memory leaks\r\n        const cleanup = () => {\r\n          try {\r\n            recognition.abort();\r\n          } catch {\r\n            // Ignore errors during abort\r\n          }\r\n          voiceButton.removeEventListener(\"click\", handleClickStart);\r\n          recognition.removeEventListener(\"start\", handleStart);\r\n          recognition.removeEventListener(\"end\", handleEnd);\r\n          recognition.removeEventListener(\"result\", handleResult);\r\n          recognition.removeEventListener(\"error\", handleError);\r\n          window.removeEventListener(\"beforeunload\", cleanup);\r\n        };\r\n\r\n        window.addEventListener(\"beforeunload\", cleanup);\r\n      } else {\r\n        voiceButton.style.display = \"none\";\r\n        safeToast(\r\n          isFarsi\r\n            ? \"مرورگر شما از جستجوی صوتی پشتیبانی نمی‌کند.\"\r\n            : \"Voice search isn't supported.\"\r\n        );\r\n      }\r\n    }\r\n\r\n    // Global keyboard shortcuts: / or Ctrl/Cmd+K to focus search\r\n    document.addEventListener(\"keydown\", (e) => {\r\n      const active = document.activeElement;\r\n      const tag = active && active.tagName;\r\n\r\n      const isTextField =\r\n        active &&\r\n        (tag === \"INPUT\" ||\r\n          tag === \"TEXTAREA\" ||\r\n          active.isContentEditable === true);\r\n\r\n      if (\r\n        (e.key === \"/\" ||\r\n          (e.key.toLowerCase() === \"k\" && (e.ctrlKey || e.metaKey))) &&\r\n        !isTextField &&\r\n        active !== searchInput\r\n      ) {\r\n        e.preventDefault();\r\n        searchInput.focus();\r\n        return;\r\n      }\r\n\r\n      if (e.key === \"Escape\" && active === searchInput) {\r\n        e.preventDefault();\r\n        clearSearch();\r\n      }\r\n    });\r\n\r\n    // Initial filter with saved term (if any)\r\n    filterCards(savedTerm);\r\n\r\n    // Cleanup on page unload to prevent memory leaks\r\n    window.addEventListener(\"beforeunload\", () => {\r\n      clearTimeout(debounceTimer);\r\n    });\r\n  });\r\n})();\r\n"]}