!function(){"use strict";const t=window.location.origin,e="ru-include-v2::",n=["/assets/js/","/includes/"],r=new Map,a=new WeakMap;function i(t){return new Promise(e=>setTimeout(e,t))}function o(t,e){try{window.dispatchEvent(new CustomEvent(t,{detail:e||{}}))}catch{}}const c=function(){try{const t="__ru_include_storage_probe__";return localStorage.setItem(t,"1"),localStorage.removeItem(t),localStorage}catch{return null}}();function l(n){try{const r=new URL(n,t);return e+r.pathname}catch{return e+n}}function s(t,n){if(!c||!n)return;const r=l(t),a=JSON.stringify({t:Date.now(),html:n});try{c.setItem(r,a)}catch{!function(){if(!c)return;const t=[];for(let n=0;n<c.length;n++){const r=c.key(n);if(!r||!r.startsWith(e))continue;let a=0;try{const t=JSON.parse(c.getItem(r)||"{}");a=Number(t.t)||0}catch{a=0}t.push({key:r,timestamp:a})}t.length&&t.sort((t,e)=>t.timestamp-e.timestamp).slice(0,Math.ceil(t.length/2)).forEach(t=>{try{c.removeItem(t.key)}catch{}})}();try{c.setItem(r,a)}catch{}}}function u(t){if(!c)return null;const e=l(t),n=c.getItem(e);if(!n)return null;try{const t=JSON.parse(n),r=Number(t.t)||0,a="string"==typeof t.html?t.html:"";return a?Date.now()-r>6048e5?(c.removeItem(e),null):a:(c.removeItem(e),null)}catch{return c.removeItem(e),null}}function d(t){if(t){if(t.nodeType===Node.ELEMENT_NODE){Array.from(t.attributes).forEach(e=>{e.name.toLowerCase().startsWith("on")&&t.removeAttribute(e.name)});const e=t.tagName.toLowerCase();if(["object","embed","iframe"].includes(e))return void t.remove();return["href","xlink:href","action","formaction"].forEach(e=>{let n=t.getAttribute(e);n||"xlink:href"!==e||(n=t.getAttributeNS("http://www.w3.org/1999/xlink","href")),n&&n.toLowerCase().trim().startsWith("javascript:")&&(t.removeAttribute(e),"xlink:href"===e&&t.removeAttributeNS("http://www.w3.org/1999/xlink","href"))}),void Array.from(t.childNodes).forEach(d)}t.nodeType!==Node.COMMENT_NODE&&t.nodeType!==Node.PROCESSING_INSTRUCTION_NODE||t.remove()}}function m(t){const e=a.get(t);e&&(e.timerId&&clearTimeout(e.timerId),a.delete(t),delete t.dataset.includeRetryAttempt)}function f(t,e){if(!1===navigator.onLine)return;const n=a.get(t)||{attempts:0,timerId:null};if(n.timerId)return;if(n.attempts>=4)return;n.attempts+=1,t.dataset.includeRetryAttempt=String(n.attempts);const r=1200*2**(n.attempts-1)+Math.floor(220*Math.random());n.timerId=setTimeout(()=>{if(n.timerId=null,!document.documentElement.contains(t))return void m(t);if("true"===t.dataset.includeLoaded||"true"===t.dataset.includePending)return void m(t);const r=t.getAttribute("data-include-html")||e;r?(t.setAttribute("data-include-html",r),w()):m(t)},r),a.set(t,n)}function h(e,r,a,i){const o=function(t,e){const n=(new DOMParser).parseFromString(e,"text/html");if(n.querySelector("parsererror"))throw new Error("Failed to parse HTML for "+t);return Array.from(n.body.childNodes).forEach(d),n}(r,a),c=document.querySelector("script[data-csp-nonce]"),l=c?.nonce||null;for(e.innerHTML="";o.body&&o.body.firstChild;)e.appendChild(o.body.firstChild);if(/footer\.html$/i.test(r)){const t=e.querySelector("#footer-year")||e.querySelector("#current-year");t&&(t.textContent=String((new Date).getFullYear()))}e.querySelectorAll("script").forEach(e=>{if(e.src&&!function(e){if(!e)return!0;try{const r=new URL(e,t);return r.origin===t&&n.some(t=>r.pathname.startsWith(t))}catch{return!1}}(e.src))return void e.remove();const r=document.createElement("script"),a=["type","async","defer","charset","id","class"];for(const t of e.attributes)(a.includes(t.name)||t.name.startsWith("data-"))&&r.setAttribute(t.name,t.value);l&&(r.nonce=l),e.src?r.src=e.src:r.textContent=e.textContent,e.parentNode.replaceChild(r,e)}),i?e.setAttribute("data-include-stale","true"):e.removeAttribute("data-include-stale"),e.removeAttribute("data-include-failed"),e.removeAttribute("data-include-retryable"),e.setAttribute("data-include-source",r)}function y(t,e,n){const r=!1!==n,a=document.createElement("div");if(a.className="include-fallback",a.setAttribute("role","status"),a.setAttribute("aria-live","polite"),a.textContent="This section is temporarily unavailable. Please refresh when your connection is stable.",r){const n=document.createElement("div");n.className="include-fallback-actions";const r=document.createElement("button");r.type="button",r.className="include-retry",r.textContent="Retry now",r.addEventListener("click",()=>{m(t),"true"!==t.dataset.includePending&&(e&&t.setAttribute("data-include-html",e),w())}),n.appendChild(r),a.appendChild(n)}t.innerHTML="",t.appendChild(a),t.setAttribute("data-include-failed","true"),r?t.setAttribute("data-include-retryable","true"):t.removeAttribute("data-include-retryable"),t.removeAttribute("data-include-stale"),e&&t.setAttribute("data-include-source",e)}async function p(t){const e="function"==typeof AbortController?new AbortController:null;let n=null;e&&(n=setTimeout(()=>{e.abort()},7e3));try{return await fetch(t,{credentials:"same-origin",cache:"no-cache",...e?{signal:e.signal}:{}})}finally{n&&clearTimeout(n)}}async function b(t){if(r.has(t))return r.get(t);const e=(async()=>{try{const e=await async function(t){let e=null;for(let n=1;n<=3;n++)try{const e=await p(t);if(!e.ok)throw new Error("HTTP "+e.status+" for "+t);return await e.text()}catch(t){if(e=t,n<3){const t=350*2**(n-1)+Math.floor(120*Math.random());await i(t)}}throw e||new Error("Unknown include fetch error for "+t)}(t);return{html:e,stale:!1}}catch(e){const n=u(t);if(n)return console.warn("Using stale include cache for",t,e),{html:n,stale:!0};throw e}})();r.set(t,e);try{return await e}finally{r.delete(t)}}async function w(e){const n=document.querySelectorAll("[data-include-html]");if(!n.length){if("function"==typeof e)try{e()}catch(t){console.error("includeHTML callback error:",t)}return}const r=[];for(const e of n){if("true"===e.dataset.includeLoaded||"true"===e.dataset.includePending)continue;const n=e.getAttribute("data-include-html");if(!n)continue;let a=null;try{if(a=new URL(n,t),a.origin!==t){console.error("Blocked cross-origin include:",n),y(e,n,!1),e.removeAttribute("data-include-html"),o("include:failed",{file:n,reason:"cross-origin-blocked"});continue}}catch{console.error("Invalid include URL:",n),y(e,n,!1),e.removeAttribute("data-include-html"),o("include:failed",{file:n,reason:"invalid-url"});continue}e.dataset.includePending="true";const i=(async()=>{try{const{html:t,stale:r}=await b(n);try{h(e,n,t,r)}catch(a){if(r)throw a;{const r=u(n);if(!r||r===t)throw a;h(e,n,r,!0)}}r||s(n,t),e.dataset.includeLoaded="true",e.removeAttribute("data-include-html"),m(e),o("include:loaded",{file:a?a.pathname:n,stale:r})}catch(t){console.error("Include error for",n,t),y(e,n,!0),f(e,n),o("include:failed",{file:a?a.pathname:n,reason:String(t&&t.message?t.message:t)})}finally{delete e.dataset.includePending}})();r.push(i)}if(await Promise.all(r),"function"==typeof e)try{e()}catch(t){console.error("includeHTML callback error:",t)}}document.addEventListener("DOMContentLoaded",function(){w(()=>{!function(){const e=t=>(t||"/").replace(/\/index\.html$/i,"/").replace(/\/+$/,"/")||"/",n=e(window.location.pathname);document.querySelectorAll(".navbar nav a").forEach(r=>{const a=r.getAttribute("href")||"";if(a.startsWith("#")||a.startsWith("mailto:")||a.startsWith("javascript:"))return r.classList.remove("active"),r.removeAttribute("aria-current"),void(r.parentElement&&"LI"===r.parentElement.tagName&&r.parentElement.classList.remove("active"));let i="";try{const n=new URL(a,t);i=e(n.pathname)}catch{i=""}const o=i===n;r.classList.toggle("active",o),o?r.setAttribute("aria-current","page"):r.removeAttribute("aria-current"),r.parentElement&&"LI"===r.parentElement.tagName&&r.parentElement.classList.toggle("active",o)})}(),document.dispatchEvent(new Event("includesLoaded"))})}),window.addEventListener("online",()=>{document.querySelectorAll('[data-include-stale="true"][data-include-source]').forEach(t=>{if("true"===t.dataset.includePending)return;const e=t.getAttribute("data-include-source");e&&(t.setAttribute("data-include-html",e),delete t.dataset.includeLoaded)}),document.querySelector("[data-include-html]")&&w()}),window.includeHTML=w}();