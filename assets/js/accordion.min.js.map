{"version":3,"file":"accordion.min.js","names":["initAccordion","root","allowMultiple","getAttribute","hasAttribute","items","Array","from","querySelectorAll","headers","toggleItem","item","header","querySelector","panel","isExpanded","forEach","otherItem","collapseItem","setAttribute","style","maxHeight","scrollHeight","opacity","classList","add","onTransitionEnd","e","propertyName","removeEventListener","addEventListener","dispatchEvent","CustomEvent","bubbles","detail","accordionId","dataset","expandItem","offsetHeight","requestAnimationFrame","remove","index","accId","headerId","id","panelId","initiallyOpen","contains","push","key","preventDefault","currentIndex","indexOf","focus","length","initAllAccordions","document","acc","String"],"sources":["accordion.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// js/accordion.js\r\n(function () {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Initialize a single accordion container.\r\n   * @param {HTMLElement} root\r\n   */\r\n  function initAccordion(root) {\r\n    if (!root) {return;}\r\n\r\n    const allowMultiple =\r\n      root.getAttribute(\"data-allow-multiple\") === \"true\" ||\r\n      root.hasAttribute(\"data-allow-multiple\");\r\n\r\n    const items = Array.from(root.querySelectorAll(\".accordion-item\"));\r\n    const headers = [];\r\n\r\n    // First pass: Collect all headers and setup ARIA attributes\r\n    items.forEach((item, index) => {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n\r\n      if (!header || !panel) {return;}\r\n\r\n      const accId = root.dataset.accordionId || \"main\";\r\n      const headerId = header.id || `accordion-header-${accId}-${index}`;\r\n      const panelId = panel.id || `accordion-panel-${accId}-${index}`;\r\n\r\n      header.id = headerId;\r\n      panel.id = panelId;\r\n\r\n      // آیا این آیتم در HTML به صورت پیش‌فرض باز است؟\r\n      const initiallyOpen =\r\n        item.classList.contains(\"is-open\") || item.hasAttribute(\"data-open\");\r\n\r\n      // ARIA wiring\r\n      header.setAttribute(\"role\", \"button\");\r\n      header.setAttribute(\"aria-controls\", panelId);\r\n      header.setAttribute(\"aria-expanded\", initiallyOpen ? \"true\" : \"false\");\r\n      header.setAttribute(\"tabindex\", \"0\");\r\n\r\n      panel.setAttribute(\"role\", \"region\");\r\n      panel.setAttribute(\"aria-labelledby\", headerId);\r\n      // panel.hidden = !initiallyOpen; // Removed for animation support\r\n\r\n      if (initiallyOpen) {\r\n        item.classList.add(\"is-open\");\r\n        // Use \"none\" to allow content to determine height, avoiding issues with hidden containers\r\n        panel.style.maxHeight = \"none\";\r\n        panel.style.opacity = \"1\";\r\n      } else {\r\n        item.classList.remove(\"is-open\");\r\n        panel.style.maxHeight = null;\r\n        panel.style.opacity = \"0\";\r\n      }\r\n\r\n      // Add to headers array for keyboard navigation\r\n      headers.push(header);\r\n    });\r\n\r\n    // Second pass: Attach event listeners using complete headers array\r\n    items.forEach((item, index) => {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n\r\n      if (!header || !panel) {return;}\r\n\r\n      // Click / keyboard handlers\r\n      header.addEventListener(\"click\", () => {\r\n        toggleItem(item, allowMultiple);\r\n      });\r\n\r\n      header.addEventListener(\"keydown\", (e) => {\r\n        const key = e.key;\r\n\r\n        if (key === \"Enter\" || key === \" \") {\r\n          e.preventDefault();\r\n          toggleItem(item, allowMultiple);\r\n          return;\r\n        }\r\n\r\n        const currentIndex = headers.indexOf(header);\r\n        if (currentIndex === -1) {return;}\r\n\r\n        if (key === \"ArrowDown\") {\r\n          e.preventDefault();\r\n          const next = headers[currentIndex + 1] || headers[0];\r\n          next.focus();\r\n        } else if (key === \"ArrowUp\") {\r\n          e.preventDefault();\r\n          const prev = headers[currentIndex - 1] || headers[headers.length - 1];\r\n          prev.focus();\r\n        } else if (key === \"Home\") {\r\n          e.preventDefault();\r\n          headers[0].focus();\r\n        } else if (key === \"End\") {\r\n          e.preventDefault();\r\n          headers[headers.length - 1].focus();\r\n        }\r\n      });\r\n    });\r\n\r\n    /**\r\n     * Toggle one accordion item\r\n     * @param {HTMLElement} item\r\n     * @param {boolean} allowMultiple\r\n     */\r\n    function toggleItem(item, allowMultiple) {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n      if (!header || !panel) {return;}\r\n\r\n      const isExpanded = header.getAttribute(\"aria-expanded\") === \"true\";\r\n\r\n      if (!allowMultiple) {\r\n        items.forEach((otherItem) => {\r\n          if (otherItem === item) {return;}\r\n          collapseItem(otherItem);\r\n        });\r\n      }\r\n\r\n      if (isExpanded) {\r\n        collapseItem(item);\r\n      } else {\r\n        expandItem(item);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Collapse item\r\n     * @param {HTMLElement} item\r\n     */\r\n    function collapseItem(item) {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n      if (!header || !panel) {return;}\r\n\r\n      // If max-height is \"none\", set it to explicit pixel value first to enable transition\r\n      if (panel.style.maxHeight === \"none\") {\r\n        panel.style.maxHeight = panel.scrollHeight + \"px\";\r\n        // Force reflow\r\n        void panel.offsetHeight;\r\n      }\r\n\r\n      requestAnimationFrame(() => {\r\n        header.setAttribute(\"aria-expanded\", \"false\");\r\n        panel.style.maxHeight = null;\r\n        panel.style.opacity = \"0\";\r\n        item.classList.remove(\"is-open\");\r\n      });\r\n\r\n      // Custom event for hooks / analytics / extra animations\r\n      item.dispatchEvent(\r\n        new CustomEvent(\"accordion:collapse\", {\r\n          bubbles: true,\r\n          detail: { item, accordionId: root.dataset.accordionId },\r\n        })\r\n      );\r\n    }\r\n\r\n    /**\r\n     * Expand item\r\n     * @param {HTMLElement} item\r\n     */\r\n    function expandItem(item) {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n      if (!header || !panel) {return;}\r\n\r\n      header.setAttribute(\"aria-expanded\", \"true\");\r\n      \r\n      // Set explicit height for transition\r\n      panel.style.maxHeight = panel.scrollHeight + \"px\";\r\n      panel.style.opacity = \"1\";\r\n      item.classList.add(\"is-open\");\r\n\r\n      // After transition, set to none to allow content to resize naturally\r\n      const onTransitionEnd = (e) => {\r\n        // Ensure we're handling the height transition\r\n        if (e.propertyName === \"max-height\") {\r\n          panel.style.maxHeight = \"none\";\r\n          panel.removeEventListener(\"transitionend\", onTransitionEnd);\r\n        }\r\n      };\r\n      panel.addEventListener(\"transitionend\", onTransitionEnd);\r\n\r\n      // Custom event for hooks / analytics / extra animations\r\n      item.dispatchEvent(\r\n        new CustomEvent(\"accordion:expand\", {\r\n          bubbles: true,\r\n          detail: { item, accordionId: root.dataset.accordionId },\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  // Handle resize to adjust max-height of open items\r\n  // Removed: This was causing issues by forcing fixed pixel heights, breaking responsiveness.\r\n  // The expandItem function already sets max-height to \"none\" after transition, which handles resize automatically.\r\n  /*\r\n  window.addEventListener('resize', () => {\r\n      document.querySelectorAll(\".accordion-item.is-open .accordion-content\").forEach(content => {\r\n          content.style.maxHeight = (content.scrollHeight + 500) + \"px\";\r\n      });\r\n  });\r\n  */\r\n\r\n  function initAllAccordions() {\r\n    const accordions = document.querySelectorAll(\".accordion\");\r\n    accordions.forEach((acc, index) => {\r\n      // Prevent double initialization\r\n      if (acc.classList.contains(\"js-accordion-init\")) {return;}\r\n\r\n      if (!acc.dataset.accordionId) {\r\n        acc.dataset.accordionId = String(index + 1);\r\n      }\r\n      initAccordion(acc);\r\n      acc.classList.add(\"js-accordion-init\");\r\n    });\r\n  }\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", initAllAccordions);\r\n  document.addEventListener(\"includesLoaded\", initAllAccordions);\r\n})();\r\n"]}