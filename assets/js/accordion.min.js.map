{"version":3,"file":"accordion.min.js","names":["window","document","ACCORDION_REGISTRY","Map","ACCORDION_ATTR","PREFERS_REDUCED_MOTION","motionQuery","matchMedia","matches","motionListener","e","Boolean","addEventListener","addListener","initAccordion","root","dataset","accordionInitialized","accordionId","allowMultiple","getAttribute","hasAttribute","allowToggle","itemRefs","headers","reduceMotion","items","Array","from","querySelectorAll","length","forEach","item","index","header","querySelector","panel","headerId","id","panelId","initiallyOpen","classList","contains","setAttribute","applyInstantState","setExpandedState","push","some","ref","isItemExpanded","toggleItem","key","preventDefault","currentIndex","indexOf","focus","set","expandItem","collapseItem","dispatchAccordionEvent","type","event","detail","CustomEvent","bubbles","evt","createEvent","initCustomEvent","createAccordionEvent","dispatchEvent","expanded","toggle","hidden","currentlyExpanded","reduce","count","otherRef","resolveRecord","accordionIdOrElement","trim","get","HTMLElement","closest","resolveItemRef","record","target","find","acc","String","Accordion","open","close","isOpen","openAll","closeAll","firstOpen","init","rootOrSelector","node","size"],"sources":["accordion.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// js/accordion.js\r\n(function () {\r\n  \"use strict\";\r\n\r\n  // اگر در محیطی مثل SSR/Node اجرا شد، هیچ کاری نکنیم\r\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} AccordionItemRefs\r\n   * @property {HTMLElement} item\r\n   * @property {HTMLElement} header\r\n   * @property {HTMLElement} panel\r\n   */\r\n\r\n  /**\r\n   * @typedef {Object} AccordionRecord\r\n   * @property {HTMLElement} root\r\n   * @property {AccordionItemRefs[]} itemRefs\r\n   * @property {boolean} allowMultiple\r\n   * @property {boolean} allowToggle\r\n   * @property {(ref: AccordionItemRefs) => void} expandItem\r\n   * @property {(ref: AccordionItemRefs) => void} collapseItem\r\n   * @property {(ref: AccordionItemRefs) => void} toggleItem\r\n   * @property {(ref: AccordionItemRefs) => boolean} isItemExpanded\r\n   */\r\n\r\n  /** @type {Map<string, AccordionRecord>} */\r\n  const ACCORDION_REGISTRY = new Map();\r\n  const ACCORDION_ATTR = \"accordionId\";\r\n\r\n  // ترجیح کاربر برای کاهش انیمیشن + گوش دادن به تغییرات سیستم\r\n  let PREFERS_REDUCED_MOTION = false;\r\n  const motionQuery =\r\n    window.matchMedia &&\r\n    window.matchMedia(\"(prefers-reduced-motion: reduce)\");\r\n\r\n  if (motionQuery) {\r\n    PREFERS_REDUCED_MOTION = motionQuery.matches;\r\n    const motionListener = (e) => {\r\n      PREFERS_REDUCED_MOTION = Boolean(e.matches);\r\n    };\r\n\r\n    if (typeof motionQuery.addEventListener === \"function\") {\r\n      motionQuery.addEventListener(\"change\", motionListener);\r\n    } else if (typeof motionQuery.addListener === \"function\") {\r\n      // برای مرورگرهای قدیمی‌تر\r\n      motionQuery.addListener(motionListener);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * سازنده‌ی امن CustomEvent برای مرورگرهای قدیمی‌تر\r\n   * @param {string} type\r\n   * @param {any} detail\r\n   * @returns {CustomEvent}\r\n   */\r\n  function createAccordionEvent(type, detail) {\r\n    if (typeof window.CustomEvent === \"function\") {\r\n      return new CustomEvent(type, {\r\n        bubbles: true,\r\n        detail,\r\n      });\r\n    }\r\n    const evt = document.createEvent(\"CustomEvent\");\r\n    evt.initCustomEvent(type, true, false, detail);\r\n    return evt;\r\n  }\r\n\r\n  // NOTE: JS-driven transition timing helpers were removed to keep the\r\n  // accordion CSP-safe (no inline style manipulation).\r\n\r\n  /**\r\n   * Initialize a single accordion container.\r\n   * @param {HTMLElement} root\r\n   */\r\n  function initAccordion(root) {\r\n    if (!root) {return;}\r\n\r\n    // جلوگیری از دوباره‌سازی\r\n    if (root.dataset.accordionInitialized === \"true\") {\r\n      return;\r\n    }\r\n\r\n    const accordionId = root.dataset[ACCORDION_ATTR] || \"main\";\r\n\r\n    const allowMultiple =\r\n      root.getAttribute(\"data-allow-multiple\") === \"true\" ||\r\n      root.hasAttribute(\"data-allow-multiple\");\r\n\r\n    const allowToggle =\r\n      root.getAttribute(\"data-allow-toggle\") !== \"false\"; // اگر false باشد، حداقل یک آیتم همیشه باز می‌ماند\r\n\r\n    /** @type {AccordionItemRefs[]} */\r\n    const itemRefs = [];\r\n    /** @type {HTMLElement[]} */\r\n    const headers = [];\r\n\r\n    const reduceMotion = PREFERS_REDUCED_MOTION;\r\n\r\n    const items = Array.from(root.querySelectorAll(\".accordion-item\"));\r\n    if (!items.length) {\r\n      root.dataset.accordionInitialized = \"true\";\r\n      return;\r\n    }\r\n\r\n    // NOTE: we used to use JS transition hooks here, but the site runs with a\r\n    // strict Content-Security-Policy and we avoid inline style manipulation.\r\n\r\n    /**\r\n     * Dispatch a custom event from an item.\r\n     * @param {HTMLElement} item\r\n     * @param {string} type\r\n     */\r\n    function dispatchAccordionEvent(item, type) {\r\n      if (!item) {return;}\r\n      const event = createAccordionEvent(type, { item, accordionId });\r\n      item.dispatchEvent(event);\r\n    }\r\n\r\n    /**\r\n     * Check if an item is expanded.\r\n     * @param {AccordionItemRefs} ref\r\n     * @returns {boolean}\r\n     */\r\n    function isItemExpanded(ref) {\r\n      return ref.header.getAttribute(\"aria-expanded\") === \"true\";\r\n    }\r\n\r\n    /**\r\n     * تعداد آیتم‌های باز در این آکاردئون.\r\n     * @returns {number}\r\n     */\r\n    function getExpandedCount() {\r\n      return itemRefs.reduce(\r\n        (count, ref) => (isItemExpanded(ref) ? count + 1 : count),\r\n        0\r\n      );\r\n    }\r\n\r\n    /**\r\n     * تنظیم وضعیت ARIA و کلاس is-open\r\n     * @param {AccordionItemRefs} ref\r\n     * @param {boolean} expanded\r\n     */\r\n    function setExpandedState(ref, expanded) {\r\n      const { item, header, panel } = ref;\r\n      header.setAttribute(\"aria-expanded\", expanded ? \"true\" : \"false\");\r\n      panel.setAttribute(\"aria-hidden\", expanded ? \"false\" : \"true\");\r\n      item.classList.toggle(\"is-open\", expanded);\r\n      panel.hidden = !expanded;\r\n    }\r\n\r\n    /**\r\n     * برای حالت بدون انیمیشن (reduceMotion = true)\r\n     * @param {AccordionItemRefs} ref\r\n     * @param {boolean} expanded\r\n     */\r\n    function applyInstantState(ref, expanded) {\r\n      const { panel } = ref;\r\n      setExpandedState(ref, expanded);\r\n      if (!panel) {return;}\r\n\r\n      // CSP note: avoid inline styles (panel.style.*) because strict policies\r\n      // may block style attributes. We rely on CSS rules driven by aria-expanded\r\n      // and the `.is-open` class.\r\n      panel.hidden = !expanded;\r\n    }\r\n\r\n    // --- First pass: setup ARIA / state ---\r\n    items.forEach((item, index) => {\r\n      const header = /** @type {HTMLElement|null} */ (\r\n        item.querySelector(\".accordion-header\")\r\n      );\r\n      const panel = /** @type {HTMLElement|null} */ (\r\n        item.querySelector(\".accordion-content\")\r\n      );\r\n\r\n      if (!header || !panel) {return;}\r\n\r\n      const headerId = header.id || `accordion-header-${accordionId}-${index}`;\r\n      const panelId = panel.id || `accordion-panel-${accordionId}-${index}`;\r\n\r\n      header.id = headerId;\r\n      panel.id = panelId;\r\n\r\n      const initiallyOpen =\r\n        item.classList.contains(\"is-open\") || item.hasAttribute(\"data-open\");\r\n\r\n      // ARIA wiring\r\n      header.setAttribute(\"role\", \"button\");\r\n      header.setAttribute(\"aria-controls\", panelId);\r\n      header.setAttribute(\"tabindex\", \"0\");\r\n\r\n      panel.setAttribute(\"role\", \"region\");\r\n      panel.setAttribute(\"aria-labelledby\", headerId);\r\n\r\n      if (reduceMotion) {\r\n        applyInstantState({ item, header, panel }, initiallyOpen);\r\n      } else {\r\n        setExpandedState({ item, header, panel }, initiallyOpen);\r\n      }\r\n\r\n      headers.push(header);\r\n      itemRefs.push({ item, header, panel });\r\n    });\r\n\r\n    if (!itemRefs.length) {\r\n      root.dataset.accordionInitialized = \"true\";\r\n      return;\r\n    }\r\n\r\n    // اگر اجازه‌ی toggle نداریم، مطمئن شو حداقل یک آیتم از ابتدا باز است\r\n    if (!allowToggle) {\r\n      const hasOpen = itemRefs.some((ref) => isItemExpanded(ref));\r\n      if (!hasOpen && itemRefs[0]) {\r\n        const ref = itemRefs[0];\r\n        if (reduceMotion) {\r\n          applyInstantState(ref, true);\r\n        } else {\r\n          setExpandedState(ref, true);\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Collapse a single item.\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function collapseItem(ref) {\r\n      const { panel } = ref;\r\n      if (!panel) {return;}\r\n\r\n      if (reduceMotion) {\r\n        applyInstantState(ref, false);\r\n      } else {\r\n        setExpandedState(ref, false);\r\n\r\n        // CSP-safe behavior: skip JS-driven height/opacity transitions.\r\n        // Hide immediately; CSS handles animation where possible.\r\n        panel.hidden = true;\r\n      }\r\n\r\n      dispatchAccordionEvent(ref.item, \"accordion:collapse\");\r\n    }\r\n\r\n    /**\r\n     * Expand a single item.\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function expandItem(ref) {\r\n      const { panel } = ref;\r\n      if (!panel) {return;}\r\n\r\n      if (reduceMotion) {\r\n        applyInstantState(ref, true);\r\n      } else {\r\n        setExpandedState(ref, true);\r\n\r\n        // show panel; CSS (accordion.css) expands content via `.is-open`\r\n        panel.hidden = false;\r\n      }\r\n\r\n      dispatchAccordionEvent(ref.item, \"accordion:expand\");\r\n    }\r\n\r\n    /**\r\n     * Toggle one accordion item\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function toggleItem(ref) {\r\n      const { item } = ref;\r\n      const currentlyExpanded = isItemExpanded(ref);\r\n\r\n      // اگر اجازه‌ی toggle نداریم و این تنها آیتم باز است، نبندش\r\n      if (!allowToggle && currentlyExpanded && getExpandedCount() <= 1) {\r\n        return;\r\n      }\r\n\r\n      if (!allowMultiple) {\r\n        itemRefs.forEach((otherRef) => {\r\n          if (otherRef.item === item) {return;}\r\n          if (isItemExpanded(otherRef)) {\r\n            collapseItem(otherRef);\r\n          }\r\n        });\r\n      }\r\n\r\n      if (currentlyExpanded) {\r\n        collapseItem(ref);\r\n      } else {\r\n        expandItem(ref);\r\n      }\r\n    }\r\n\r\n    // --- Events: click + keyboard ---\r\n\r\n    itemRefs.forEach((ref) => {\r\n      const { header } = ref;\r\n\r\n      // Click handler\r\n      header.addEventListener(\"click\", () => {\r\n        if (header.hasAttribute(\"aria-disabled\")) {return;}\r\n        toggleItem(ref);\r\n      });\r\n\r\n      // Keyboard handler\r\n      header.addEventListener(\"keydown\", (e) => {\r\n        const key = e.key;\r\n\r\n        if (header.hasAttribute(\"aria-disabled\")) {return;}\r\n\r\n        if (key === \"Enter\" || key === \" \") {\r\n          e.preventDefault();\r\n          toggleItem(ref);\r\n          return;\r\n        }\r\n\r\n        const currentIndex = headers.indexOf(header);\r\n        if (currentIndex === -1) {return;}\r\n\r\n        if (key === \"ArrowDown\") {\r\n          e.preventDefault();\r\n          const next = headers[currentIndex + 1] || headers[0];\r\n          next.focus();\r\n        } else if (key === \"ArrowUp\") {\r\n          e.preventDefault();\r\n          const prev = headers[currentIndex - 1] || headers[headers.length - 1];\r\n          prev.focus();\r\n        } else if (key === \"Home\") {\r\n          e.preventDefault();\r\n          headers[0].focus();\r\n        } else if (key === \"End\") {\r\n          e.preventDefault();\r\n          headers[headers.length - 1].focus();\r\n        }\r\n      });\r\n    });\r\n\r\n    // ثبت در رجیستری برای استفاده‌ی API بیرونی\r\n    ACCORDION_REGISTRY.set(accordionId, {\r\n      root,\r\n      itemRefs,\r\n      allowMultiple,\r\n      allowToggle,\r\n      expandItem,\r\n      collapseItem,\r\n      toggleItem,\r\n      isItemExpanded,\r\n    });\r\n\r\n    root.dataset.accordionInitialized = \"true\";\r\n  }\r\n\r\n  /**\r\n   * Resolve registry record by id or element.\r\n   * @param {string | HTMLElement} accordionIdOrElement\r\n   * @returns {AccordionRecord | null}\r\n   */\r\n  function resolveRecord(accordionIdOrElement) {\r\n    if (!accordionIdOrElement) {return null;}\r\n\r\n    if (typeof accordionIdOrElement === \"string\") {\r\n      const id = accordionIdOrElement.trim();\r\n      if (!id) {return null;}\r\n      const record = ACCORDION_REGISTRY.get(id);\r\n      return record || null;\r\n    }\r\n\r\n    if (accordionIdOrElement instanceof HTMLElement) {\r\n      // اگر خود روت نبود، نزدیک‌ترین والد با کلاس accordion را پیدا کن\r\n      const root = accordionIdOrElement.matches(\".accordion\")\r\n        ? accordionIdOrElement\r\n        : accordionIdOrElement.closest(\".accordion\");\r\n\r\n      if (!root) {return null;}\r\n\r\n      const id = root.dataset[ACCORDION_ATTR];\r\n      if (!id) {return null;}\r\n      const record = ACCORDION_REGISTRY.get(id);\r\n      return record || null;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Resolve item ref by index or id.\r\n   * @param {AccordionRecord | null} record\r\n   * @param {number | string} target\r\n   * @returns {AccordionItemRefs | null}\r\n   */\r\n  function resolveItemRef(record, target) {\r\n    if (!record || target === null || target === undefined) {return null;}\r\n    const { itemRefs } = record;\r\n\r\n    if (typeof target === \"number\") {\r\n      if (target < 0 || target >= itemRefs.length) {return null;}\r\n      return itemRefs[target] || null;\r\n    }\r\n\r\n    if (typeof target === \"string\") {\r\n      return (\r\n        itemRefs.find(\r\n          (ref) =>\r\n            ref.item.id === target ||\r\n            ref.header.id === target ||\r\n            ref.panel.id === target\r\n        ) || null\r\n      );\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  // Auto-init on DOMContentLoaded\r\n  document.addEventListener(\"DOMContentLoaded\", () => {\r\n    const accordions = document.querySelectorAll(\".accordion\");\r\n    accordions.forEach((acc, index) => {\r\n      if (!acc.dataset[ACCORDION_ATTR]) {\r\n        acc.dataset[ACCORDION_ATTR] = String(index + 1);\r\n      }\r\n      initAccordion(acc);\r\n    });\r\n  });\r\n\r\n  // --- Global API ---\r\n  /**\r\n   * @typedef {Object} AccordionGlobalAPI\r\n   * @property {(accordionIdOrElement: string | HTMLElement, target: number | string) => boolean} open\r\n   * @property {(accordionIdOrElement: string | HTMLElement, target: number | string) => boolean} close\r\n   * @property {(accordionIdOrElement: string | HTMLElement, target: number | string) => boolean} toggle\r\n   * @property {(accordionIdOrElement: string | HTMLElement, target: number | string) => (boolean | null)} isOpen\r\n   * @property {(accordionIdOrElement: string | HTMLElement) => void} openAll\r\n   * @property {(accordionIdOrElement: string | HTMLElement) => void} closeAll\r\n   * @property {(rootOrSelector: string | HTMLElement) => void} init\r\n   */\r\n\r\n  /** @type {AccordionGlobalAPI & (typeof window.Accordion)} */\r\n  window.Accordion = window.Accordion || {};\r\n\r\n  /**\r\n   * باز کردن یک آیتم\r\n   */\r\n  window.Accordion.open = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) {return false;}\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) {return false;}\r\n    record.expandItem(ref);\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * بستن یک آیتم\r\n   */\r\n  window.Accordion.close = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) {return false;}\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) {return false;}\r\n    record.collapseItem(ref);\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * تغییر وضعیت یک آیتم\r\n   */\r\n  window.Accordion.toggle = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) {return false;}\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) {return false;}\r\n    record.toggleItem(ref);\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * وضعیت باز/بسته بودن یک آیتم\r\n   * @returns {boolean | null} true/false اگر آیتم پیدا شود، null اگر پیدا نشود\r\n   */\r\n  window.Accordion.isOpen = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) {return null;}\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) {return null;}\r\n    return record.isItemExpanded(ref);\r\n  };\r\n\r\n  /**\r\n   * باز کردن همه آیتم‌ها (فقط اگر allowMultiple = true باشد)\r\n   */\r\n  window.Accordion.openAll = function (accordionIdOrElement) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) {return;}\r\n    const { allowMultiple, itemRefs, expandItem } = record;\r\n    if (!allowMultiple) {\r\n      if (itemRefs[0]) {expandItem(itemRefs[0]);}\r\n      return;\r\n    }\r\n    itemRefs.forEach((ref) => expandItem(ref));\r\n  };\r\n\r\n  /**\r\n   * بستن همه آیتم‌ها (اگر allowToggle=false، یکی را باز نگه می‌داریم)\r\n   */\r\n  window.Accordion.closeAll = function (accordionIdOrElement) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) {return;}\r\n    const { allowToggle, itemRefs, collapseItem, isItemExpanded, expandItem } =\r\n      record;\r\n\r\n    if (!allowToggle) {\r\n      // حداقل یک آیتم باید باز بماند\r\n      let firstOpen = itemRefs.find((ref) => isItemExpanded(ref));\r\n      if (!firstOpen && itemRefs[0]) {\r\n        firstOpen = itemRefs[0];\r\n      }\r\n\r\n      itemRefs.forEach((ref) => {\r\n        if (ref === firstOpen) {return;}\r\n        collapseItem(ref);\r\n      });\r\n\r\n      if (firstOpen && !isItemExpanded(firstOpen)) {\r\n        expandItem(firstOpen);\r\n      }\r\n      return;\r\n    }\r\n\r\n    itemRefs.forEach((ref) => collapseItem(ref));\r\n  };\r\n\r\n  /**\r\n   * init دستی برای آکاردئون‌هایی که بعداً به DOM اضافه می‌کنی\r\n   * @param {string | HTMLElement} rootOrSelector\r\n   */\r\n  window.Accordion.init = function (rootOrSelector) {\r\n    if (!rootOrSelector) {return;}\r\n\r\n    if (typeof rootOrSelector === \"string\") {\r\n      const nodes = document.querySelectorAll(rootOrSelector);\r\n      nodes.forEach((node, index) => {\r\n        if (!node.dataset[ACCORDION_ATTR]) {\r\n          node.dataset[ACCORDION_ATTR] = String(\r\n            ACCORDION_REGISTRY.size + index + 1\r\n          );\r\n        }\r\n        initAccordion(node);\r\n      });\r\n    } else if (rootOrSelector instanceof HTMLElement) {\r\n      if (!rootOrSelector.dataset[ACCORDION_ATTR]) {\r\n        rootOrSelector.dataset[ACCORDION_ATTR] = String(\r\n          ACCORDION_REGISTRY.size + 1\r\n        );\r\n      }\r\n      initAccordion(rootOrSelector);\r\n    }\r\n  };\r\n})();\r\n"]}