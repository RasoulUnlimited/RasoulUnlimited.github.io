{"version":3,"file":"accordion.min.js","names":["window","document","ACCORDION_REGISTRY","Map","ACCORDION_ATTR","PREFERS_REDUCED_MOTION","motionQuery","matchMedia","matches","motionListener","e","addEventListener","addListener","initAccordion","root","dataset","accordionInitialized","accordionId","allowMultiple","getAttribute","hasAttribute","allowToggle","itemRefs","headers","reduceMotion","items","Array","from","querySelectorAll","length","transitionEndHandlers","WeakMap","transitionTimeoutIds","clearTransitionHandlers","panel","existingHandler","get","removeEventListener","delete","timeoutId","clearTimeout","setupTransitionEnd","onEnd","finished","finish","handler","propertyName","set","timeoutMs","el","style","getComputedStyle","durations","transitionDuration","split","delays","transitionDelay","toMs","value","trim","num","parseFloat","Number","isNaN","includes","maxTotal","i","total","getTransitionDurationMS","setTimeout","dispatchAccordionEvent","item","type","event","detail","CustomEvent","bubbles","evt","createEvent","initCustomEvent","createAccordionEvent","dispatchEvent","isItemExpanded","ref","header","setExpandedState","expanded","setAttribute","classList","toggle","hidden","applyInstantState","maxHeight","opacity","forEach","index","querySelector","headerId","id","panelId","initiallyOpen","contains","push","some","toggleItem","key","preventDefault","currentIndex","indexOf","focus","expandItem","collapseItem","startHeight","scrollHeight","offsetHeight","requestAnimationFrame","targetHeight","currentlyExpanded","reduce","count","otherRef","resolveRecord","accordionIdOrElement","HTMLElement","closest","resolveItemRef","record","target","find","acc","String","Accordion","open","close","isOpen","openAll","closeAll","firstOpen","init","rootOrSelector","node","size"],"sources":["accordion.js"],"mappings":"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","ignoreList":[],"sourcesContent":["// js/accordion.js\r\n(function () {\r\n  \"use strict\";\r\n\r\n  // اگر در محیطی مثل SSR/Node اجرا شد، هیچ کاری نکنیم\r\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} AccordionItemRefs\r\n   * @property {HTMLElement} item\r\n   * @property {HTMLElement} header\r\n   * @property {HTMLElement} panel\r\n   */\r\n\r\n  /**\r\n   * @typedef {Object} AccordionRecord\r\n   * @property {HTMLElement} root\r\n   * @property {AccordionItemRefs[]} itemRefs\r\n   * @property {boolean} allowMultiple\r\n   * @property {boolean} allowToggle\r\n   * @property {(ref: AccordionItemRefs) => void} expandItem\r\n   * @property {(ref: AccordionItemRefs) => void} collapseItem\r\n   * @property {(ref: AccordionItemRefs) => void} toggleItem\r\n   * @property {(ref: AccordionItemRefs) => boolean} isItemExpanded\r\n   */\r\n\r\n  /** @type {Map<string, AccordionRecord>} */\r\n  const ACCORDION_REGISTRY = new Map();\r\n  const ACCORDION_ATTR = \"accordionId\";\r\n\r\n  // ترجیح کاربر برای کاهش انیمیشن + گوش دادن به تغییرات سیستم\r\n  let PREFERS_REDUCED_MOTION = false;\r\n  const motionQuery =\r\n    window.matchMedia &&\r\n    window.matchMedia(\"(prefers-reduced-motion: reduce)\");\r\n\r\n  if (motionQuery) {\r\n    PREFERS_REDUCED_MOTION = motionQuery.matches;\r\n    const motionListener = (e) => {\r\n      PREFERS_REDUCED_MOTION = !!e.matches;\r\n    };\r\n\r\n    if (typeof motionQuery.addEventListener === \"function\") {\r\n      motionQuery.addEventListener(\"change\", motionListener);\r\n    } else if (typeof motionQuery.addListener === \"function\") {\r\n      // برای مرورگرهای قدیمی‌تر\r\n      motionQuery.addListener(motionListener);\r\n    }\r\n  }\r\n\r\n  // مدت‌زمان fallback برای ترنزیشن‌ها (اگر از CSS نتوانستیم بخوانیم)\r\n  const TRANSITION_FALLBACK_MS = 500;\r\n\r\n  /**\r\n   * سازنده‌ی امن CustomEvent برای مرورگرهای قدیمی‌تر\r\n   * @param {string} type\r\n   * @param {any} detail\r\n   * @returns {CustomEvent}\r\n   */\r\n  function createAccordionEvent(type, detail) {\r\n    if (typeof window.CustomEvent === \"function\") {\r\n      return new CustomEvent(type, {\r\n        bubbles: true,\r\n        detail,\r\n      });\r\n    }\r\n    const evt = document.createEvent(\"CustomEvent\");\r\n    evt.initCustomEvent(type, true, false, detail);\r\n    return evt;\r\n  }\r\n\r\n  /**\r\n   * مدت‌زمان transition را از CSS محاسبه می‌کند (duration + delay)\r\n   * @param {HTMLElement} el\r\n   * @returns {number} ms\r\n   */\r\n  function getTransitionDurationMS(el) {\r\n    if (!el) return TRANSITION_FALLBACK_MS;\r\n\r\n    const style = window.getComputedStyle(el);\r\n    const durations = style.transitionDuration.split(\",\");\r\n    const delays = style.transitionDelay.split(\",\");\r\n\r\n    const toMs = (value) => {\r\n      value = value.trim();\r\n      if (!value) return 0;\r\n      const num = parseFloat(value);\r\n      if (Number.isNaN(num)) return 0;\r\n      return value.includes(\"ms\") ? num : num * 1000;\r\n    };\r\n\r\n    let maxTotal = 0;\r\n    for (let i = 0; i < durations.length; i++) {\r\n      const dur = toMs(durations[i] || \"0s\");\r\n      const delay = toMs(delays[i] || delays[0] || \"0s\");\r\n      const total = dur + delay;\r\n      if (total > maxTotal) {\r\n        maxTotal = total;\r\n      }\r\n    }\r\n\r\n    return maxTotal || TRANSITION_FALLBACK_MS;\r\n  }\r\n\r\n  /**\r\n   * Initialize a single accordion container.\r\n   * @param {HTMLElement} root\r\n   */\r\n  function initAccordion(root) {\r\n    if (!root) return;\r\n\r\n    // جلوگیری از دوباره‌سازی\r\n    if (root.dataset.accordionInitialized === \"true\") {\r\n      return;\r\n    }\r\n\r\n    const accordionId = root.dataset[ACCORDION_ATTR] || \"main\";\r\n\r\n    const allowMultiple =\r\n      root.getAttribute(\"data-allow-multiple\") === \"true\" ||\r\n      root.hasAttribute(\"data-allow-multiple\");\r\n\r\n    const allowToggle =\r\n      root.getAttribute(\"data-allow-toggle\") !== \"false\"; // اگر false باشد، حداقل یک آیتم همیشه باز می‌ماند\r\n\r\n    /** @type {AccordionItemRefs[]} */\r\n    const itemRefs = [];\r\n    /** @type {HTMLElement[]} */\r\n    const headers = [];\r\n\r\n    const reduceMotion = PREFERS_REDUCED_MOTION;\r\n\r\n    const items = Array.from(root.querySelectorAll(\".accordion-item\"));\r\n    if (!items.length) {\r\n      root.dataset.accordionInitialized = \"true\";\r\n      return;\r\n    }\r\n\r\n    // برای نگه‌داری هندلرهای transitionend و timeoutها (فقط در صورت نیاز به انیمیشن)\r\n    /** @type {WeakMap<HTMLElement, (e: TransitionEvent) => void> | null} */\r\n    const transitionEndHandlers = reduceMotion ? null : new WeakMap();\r\n    /** @type {WeakMap<HTMLElement, number> | null} */\r\n    const transitionTimeoutIds = reduceMotion ? null : new WeakMap();\r\n\r\n    /**\r\n     * پاک کردن هندلر transitionend و timeout از پنل\r\n     * @param {HTMLElement} panel\r\n     */\r\n    function clearTransitionHandlers(panel) {\r\n      if (reduceMotion || !panel || !transitionEndHandlers || !transitionTimeoutIds) return;\r\n      const existingHandler = transitionEndHandlers.get(panel);\r\n      if (existingHandler) {\r\n        panel.removeEventListener(\"transitionend\", existingHandler);\r\n        transitionEndHandlers.delete(panel);\r\n      }\r\n      const timeoutId = transitionTimeoutIds.get(panel);\r\n      if (timeoutId != null) {\r\n        clearTimeout(timeoutId);\r\n        transitionTimeoutIds.delete(panel);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * ثبت هندلر transitionend + fallback timeout روی پنل\r\n     * @param {HTMLElement} panel\r\n     * @param {(e?: TransitionEvent) => void} onEnd\r\n     */\r\n    function setupTransitionEnd(panel, onEnd) {\r\n      if (reduceMotion || !panel || !transitionEndHandlers || !transitionTimeoutIds) {\r\n        // در حالت کاهش موشن، مستقیم فراخوانی می‌کنیم\r\n        onEnd();\r\n        return;\r\n      }\r\n\r\n      clearTransitionHandlers(panel);\r\n\r\n      let finished = false;\r\n\r\n      function finish(e) {\r\n        if (finished) return;\r\n        finished = true;\r\n        clearTransitionHandlers(panel);\r\n        onEnd(e);\r\n      }\r\n\r\n      const handler = (e) => {\r\n        // فقط روی تغییر max-height واکنش نشان بده\r\n        if (e.propertyName === \"max-height\") {\r\n          finish(e);\r\n        }\r\n      };\r\n\r\n      panel.addEventListener(\"transitionend\", handler);\r\n      transitionEndHandlers.set(panel, handler);\r\n\r\n      const timeoutMs = getTransitionDurationMS(panel) + 50; // کمی حاشیه\r\n      const timeoutId = window.setTimeout(() => {\r\n        finish();\r\n      }, timeoutMs || TRANSITION_FALLBACK_MS);\r\n      transitionTimeoutIds.set(panel, timeoutId);\r\n    }\r\n\r\n    /**\r\n     * Dispatch a custom event from an item.\r\n     * @param {HTMLElement} item\r\n     * @param {string} type\r\n     */\r\n    function dispatchAccordionEvent(item, type) {\r\n      if (!item) return;\r\n      const event = createAccordionEvent(type, { item, accordionId });\r\n      item.dispatchEvent(event);\r\n    }\r\n\r\n    /**\r\n     * Check if an item is expanded.\r\n     * @param {AccordionItemRefs} ref\r\n     * @returns {boolean}\r\n     */\r\n    function isItemExpanded(ref) {\r\n      return ref.header.getAttribute(\"aria-expanded\") === \"true\";\r\n    }\r\n\r\n    /**\r\n     * تعداد آیتم‌های باز در این آکاردئون.\r\n     * @returns {number}\r\n     */\r\n    function getExpandedCount() {\r\n      return itemRefs.reduce(\r\n        (count, ref) => (isItemExpanded(ref) ? count + 1 : count),\r\n        0\r\n      );\r\n    }\r\n\r\n    /**\r\n     * تنظیم وضعیت ARIA و کلاس is-open\r\n     * @param {AccordionItemRefs} ref\r\n     * @param {boolean} expanded\r\n     */\r\n    function setExpandedState(ref, expanded) {\r\n      const { item, header, panel } = ref;\r\n      header.setAttribute(\"aria-expanded\", expanded ? \"true\" : \"false\");\r\n      panel.setAttribute(\"aria-hidden\", expanded ? \"false\" : \"true\");\r\n      item.classList.toggle(\"is-open\", expanded);\r\n      panel.hidden = !expanded;\r\n    }\r\n\r\n    /**\r\n     * برای حالت بدون انیمیشن (reduceMotion = true)\r\n     * @param {AccordionItemRefs} ref\r\n     * @param {boolean} expanded\r\n     */\r\n    function applyInstantState(ref, expanded) {\r\n      const { panel } = ref;\r\n      setExpandedState(ref, expanded);\r\n      if (!panel) return;\r\n\r\n      if (expanded) {\r\n        panel.style.maxHeight = \"none\";\r\n        panel.style.opacity = \"1\";\r\n        panel.hidden = false;\r\n      } else {\r\n        panel.style.maxHeight = \"0px\";\r\n        panel.style.opacity = \"0\";\r\n        panel.hidden = true;\r\n      }\r\n    }\r\n\r\n    // --- First pass: setup ARIA / state ---\r\n    items.forEach((item, index) => {\r\n      const header = /** @type {HTMLElement|null} */ (\r\n        item.querySelector(\".accordion-header\")\r\n      );\r\n      const panel = /** @type {HTMLElement|null} */ (\r\n        item.querySelector(\".accordion-content\")\r\n      );\r\n\r\n      if (!header || !panel) return;\r\n\r\n      const headerId = header.id || `accordion-header-${accordionId}-${index}`;\r\n      const panelId = panel.id || `accordion-panel-${accordionId}-${index}`;\r\n\r\n      header.id = headerId;\r\n      panel.id = panelId;\r\n\r\n      const initiallyOpen =\r\n        item.classList.contains(\"is-open\") || item.hasAttribute(\"data-open\");\r\n\r\n      // ARIA wiring\r\n      header.setAttribute(\"role\", \"button\");\r\n      header.setAttribute(\"aria-controls\", panelId);\r\n      header.setAttribute(\"tabindex\", \"0\");\r\n\r\n      panel.setAttribute(\"role\", \"region\");\r\n      panel.setAttribute(\"aria-labelledby\", headerId);\r\n\r\n      if (reduceMotion) {\r\n        applyInstantState({ item, header, panel }, initiallyOpen);\r\n      } else {\r\n        setExpandedState({ item, header, panel }, initiallyOpen);\r\n\r\n        if (initiallyOpen) {\r\n          panel.style.maxHeight = \"none\";\r\n          panel.style.opacity = \"1\";\r\n        } else {\r\n          panel.style.maxHeight = \"0px\";\r\n          panel.style.opacity = \"0\";\r\n        }\r\n      }\r\n\r\n      headers.push(header);\r\n      itemRefs.push({ item, header, panel });\r\n    });\r\n\r\n    if (!itemRefs.length) {\r\n      root.dataset.accordionInitialized = \"true\";\r\n      return;\r\n    }\r\n\r\n    // اگر اجازه‌ی toggle نداریم، مطمئن شو حداقل یک آیتم از ابتدا باز است\r\n    if (!allowToggle) {\r\n      const hasOpen = itemRefs.some((ref) => isItemExpanded(ref));\r\n      if (!hasOpen && itemRefs[0]) {\r\n        const ref = itemRefs[0];\r\n        if (reduceMotion) {\r\n          applyInstantState(ref, true);\r\n        } else {\r\n          setExpandedState(ref, true);\r\n          ref.panel.style.maxHeight = \"none\";\r\n          ref.panel.style.opacity = \"1\";\r\n        }\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Collapse a single item.\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function collapseItem(ref) {\r\n      const { panel } = ref;\r\n      if (!panel) return;\r\n\r\n      if (reduceMotion) {\r\n        applyInstantState(ref, false);\r\n      } else {\r\n        setExpandedState(ref, false);\r\n        clearTransitionHandlers(panel);\r\n\r\n        // مطمئن شو برای محاسبه scrollHeight مخفی نیست\r\n        panel.hidden = false;\r\n\r\n        const startHeight = panel.scrollHeight;\r\n        panel.style.maxHeight = startHeight + \"px\";\r\n\r\n        // Force reflow\r\n        void panel.offsetHeight;\r\n\r\n        setupTransitionEnd(panel, () => {\r\n          panel.hidden = true;\r\n          panel.style.maxHeight = \"0px\";\r\n        });\r\n\r\n        requestAnimationFrame(() => {\r\n          panel.style.maxHeight = \"0px\";\r\n          panel.style.opacity = \"0\";\r\n        });\r\n      }\r\n\r\n      dispatchAccordionEvent(ref.item, \"accordion:collapse\");\r\n    }\r\n\r\n    /**\r\n     * Expand a single item.\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function expandItem(ref) {\r\n      const { panel } = ref;\r\n      if (!panel) return;\r\n\r\n      if (reduceMotion) {\r\n        applyInstantState(ref, true);\r\n      } else {\r\n        setExpandedState(ref, true);\r\n        clearTransitionHandlers(panel);\r\n\r\n        panel.hidden = false;\r\n        panel.style.maxHeight = \"0px\";\r\n        panel.style.opacity = \"0\";\r\n\r\n        setupTransitionEnd(panel, () => {\r\n          panel.style.maxHeight = \"none\";\r\n        });\r\n\r\n        requestAnimationFrame(() => {\r\n          const targetHeight = panel.scrollHeight;\r\n          panel.style.maxHeight = targetHeight + \"px\";\r\n          panel.style.opacity = \"1\";\r\n        });\r\n      }\r\n\r\n      dispatchAccordionEvent(ref.item, \"accordion:expand\");\r\n    }\r\n\r\n    /**\r\n     * Toggle one accordion item\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function toggleItem(ref) {\r\n      const { item } = ref;\r\n      const currentlyExpanded = isItemExpanded(ref);\r\n\r\n      // اگر اجازه‌ی toggle نداریم و این تنها آیتم باز است، نبندش\r\n      if (!allowToggle && currentlyExpanded && getExpandedCount() <= 1) {\r\n        return;\r\n      }\r\n\r\n      if (!allowMultiple) {\r\n        itemRefs.forEach((otherRef) => {\r\n          if (otherRef.item === item) return;\r\n          if (isItemExpanded(otherRef)) {\r\n            collapseItem(otherRef);\r\n          }\r\n        });\r\n      }\r\n\r\n      if (currentlyExpanded) {\r\n        collapseItem(ref);\r\n      } else {\r\n        expandItem(ref);\r\n      }\r\n    }\r\n\r\n    // --- Events: click + keyboard ---\r\n\r\n    itemRefs.forEach((ref) => {\r\n      const { header } = ref;\r\n\r\n      // Click handler\r\n      header.addEventListener(\"click\", () => {\r\n        if (header.hasAttribute(\"aria-disabled\")) return;\r\n        toggleItem(ref);\r\n      });\r\n\r\n      // Keyboard handler\r\n      header.addEventListener(\"keydown\", (e) => {\r\n        const key = e.key;\r\n\r\n        if (header.hasAttribute(\"aria-disabled\")) return;\r\n\r\n        if (key === \"Enter\" || key === \" \") {\r\n          e.preventDefault();\r\n          toggleItem(ref);\r\n          return;\r\n        }\r\n\r\n        const currentIndex = headers.indexOf(header);\r\n        if (currentIndex === -1) return;\r\n\r\n        if (key === \"ArrowDown\") {\r\n          e.preventDefault();\r\n          const next = headers[currentIndex + 1] || headers[0];\r\n          next.focus();\r\n        } else if (key === \"ArrowUp\") {\r\n          e.preventDefault();\r\n          const prev = headers[currentIndex - 1] || headers[headers.length - 1];\r\n          prev.focus();\r\n        } else if (key === \"Home\") {\r\n          e.preventDefault();\r\n          headers[0].focus();\r\n        } else if (key === \"End\") {\r\n          e.preventDefault();\r\n          headers[headers.length - 1].focus();\r\n        }\r\n      });\r\n    });\r\n\r\n    // ثبت در رجیستری برای استفاده‌ی API بیرونی\r\n    ACCORDION_REGISTRY.set(accordionId, {\r\n      root,\r\n      itemRefs,\r\n      allowMultiple,\r\n      allowToggle,\r\n      expandItem,\r\n      collapseItem,\r\n      toggleItem,\r\n      isItemExpanded,\r\n    });\r\n\r\n    root.dataset.accordionInitialized = \"true\";\r\n  }\r\n\r\n  /**\r\n   * Resolve registry record by id or element.\r\n   * @param {string | HTMLElement} accordionIdOrElement\r\n   * @returns {AccordionRecord | null}\r\n   */\r\n  function resolveRecord(accordionIdOrElement) {\r\n    if (!accordionIdOrElement) return null;\r\n\r\n    if (typeof accordionIdOrElement === \"string\") {\r\n      const id = accordionIdOrElement.trim();\r\n      if (!id) return null;\r\n      const record = ACCORDION_REGISTRY.get(id);\r\n      return record || null;\r\n    }\r\n\r\n    if (accordionIdOrElement instanceof HTMLElement) {\r\n      // اگر خود روت نبود، نزدیک‌ترین والد با کلاس accordion را پیدا کن\r\n      const root = accordionIdOrElement.matches(\".accordion\")\r\n        ? accordionIdOrElement\r\n        : accordionIdOrElement.closest(\".accordion\");\r\n\r\n      if (!root) return null;\r\n\r\n      const id = root.dataset[ACCORDION_ATTR];\r\n      if (!id) return null;\r\n      const record = ACCORDION_REGISTRY.get(id);\r\n      return record || null;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Resolve item ref by index or id.\r\n   * @param {AccordionRecord | null} record\r\n   * @param {number | string} target\r\n   * @returns {AccordionItemRefs | null}\r\n   */\r\n  function resolveItemRef(record, target) {\r\n    if (!record || target == null) return null;\r\n    const { itemRefs } = record;\r\n\r\n    if (typeof target === \"number\") {\r\n      if (target < 0 || target >= itemRefs.length) return null;\r\n      return itemRefs[target] || null;\r\n    }\r\n\r\n    if (typeof target === \"string\") {\r\n      return (\r\n        itemRefs.find(\r\n          (ref) =>\r\n            ref.item.id === target ||\r\n            ref.header.id === target ||\r\n            ref.panel.id === target\r\n        ) || null\r\n      );\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  // Auto-init on DOMContentLoaded\r\n  document.addEventListener(\"DOMContentLoaded\", () => {\r\n    const accordions = document.querySelectorAll(\".accordion\");\r\n    accordions.forEach((acc, index) => {\r\n      if (!acc.dataset[ACCORDION_ATTR]) {\r\n        acc.dataset[ACCORDION_ATTR] = String(index + 1);\r\n      }\r\n      initAccordion(acc);\r\n    });\r\n  });\r\n\r\n  // --- Global API ---\r\n  /**\r\n   * @typedef {Object} AccordionGlobalAPI\r\n   * @property {(accordionIdOrElement: string | HTMLElement, target: number | string) => boolean} open\r\n   * @property {(accordionIdOrElement: string | HTMLElement, target: number | string) => boolean} close\r\n   * @property {(accordionIdOrElement: string | HTMLElement, target: number | string) => boolean} toggle\r\n   * @property {(accordionIdOrElement: string | HTMLElement, target: number | string) => (boolean | null)} isOpen\r\n   * @property {(accordionIdOrElement: string | HTMLElement) => void} openAll\r\n   * @property {(accordionIdOrElement: string | HTMLElement) => void} closeAll\r\n   * @property {(rootOrSelector: string | HTMLElement) => void} init\r\n   */\r\n\r\n  /** @type {AccordionGlobalAPI & (typeof window.Accordion)} */\r\n  window.Accordion = window.Accordion || {};\r\n\r\n  /**\r\n   * باز کردن یک آیتم\r\n   */\r\n  window.Accordion.open = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return false;\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) return false;\r\n    record.expandItem(ref);\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * بستن یک آیتم\r\n   */\r\n  window.Accordion.close = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return false;\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) return false;\r\n    record.collapseItem(ref);\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * تغییر وضعیت یک آیتم\r\n   */\r\n  window.Accordion.toggle = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return false;\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) return false;\r\n    record.toggleItem(ref);\r\n    return true;\r\n  };\r\n\r\n  /**\r\n   * وضعیت باز/بسته بودن یک آیتم\r\n   * @returns {boolean | null} true/false اگر آیتم پیدا شود، null اگر پیدا نشود\r\n   */\r\n  window.Accordion.isOpen = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return null;\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) return null;\r\n    return record.isItemExpanded(ref);\r\n  };\r\n\r\n  /**\r\n   * باز کردن همه آیتم‌ها (فقط اگر allowMultiple = true باشد)\r\n   */\r\n  window.Accordion.openAll = function (accordionIdOrElement) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return;\r\n    const { allowMultiple, itemRefs, expandItem } = record;\r\n    if (!allowMultiple) {\r\n      if (itemRefs[0]) expandItem(itemRefs[0]);\r\n      return;\r\n    }\r\n    itemRefs.forEach((ref) => expandItem(ref));\r\n  };\r\n\r\n  /**\r\n   * بستن همه آیتم‌ها (اگر allowToggle=false، یکی را باز نگه می‌داریم)\r\n   */\r\n  window.Accordion.closeAll = function (accordionIdOrElement) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return;\r\n    const { allowToggle, itemRefs, collapseItem, isItemExpanded, expandItem } =\r\n      record;\r\n\r\n    if (!allowToggle) {\r\n      // حداقل یک آیتم باید باز بماند\r\n      let firstOpen = itemRefs.find((ref) => isItemExpanded(ref));\r\n      if (!firstOpen && itemRefs[0]) {\r\n        firstOpen = itemRefs[0];\r\n      }\r\n\r\n      itemRefs.forEach((ref) => {\r\n        if (ref === firstOpen) return;\r\n        collapseItem(ref);\r\n      });\r\n\r\n      if (firstOpen && !isItemExpanded(firstOpen)) {\r\n        expandItem(firstOpen);\r\n      }\r\n      return;\r\n    }\r\n\r\n    itemRefs.forEach((ref) => collapseItem(ref));\r\n  };\r\n\r\n  /**\r\n   * init دستی برای آکاردئون‌هایی که بعداً به DOM اضافه می‌کنی\r\n   * @param {string | HTMLElement} rootOrSelector\r\n   */\r\n  window.Accordion.init = function (rootOrSelector) {\r\n    if (!rootOrSelector) return;\r\n\r\n    if (typeof rootOrSelector === \"string\") {\r\n      const nodes = document.querySelectorAll(rootOrSelector);\r\n      nodes.forEach((node, index) => {\r\n        if (!node.dataset[ACCORDION_ATTR]) {\r\n          node.dataset[ACCORDION_ATTR] = String(\r\n            ACCORDION_REGISTRY.size + index + 1\r\n          );\r\n        }\r\n        initAccordion(node);\r\n      });\r\n    } else if (rootOrSelector instanceof HTMLElement) {\r\n      if (!rootOrSelector.dataset[ACCORDION_ATTR]) {\r\n        rootOrSelector.dataset[ACCORDION_ATTR] = String(\r\n          ACCORDION_REGISTRY.size + 1\r\n        );\r\n      }\r\n      initAccordion(rootOrSelector);\r\n    }\r\n  };\r\n})();\r\n"]}