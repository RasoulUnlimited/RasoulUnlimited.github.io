{"version":3,"file":"accordion.min.js","names":["window","addEventListener","document","querySelectorAll","forEach","content","style","maxHeight","scrollHeight","acc","index","dataset","accordionId","String","root","allowMultiple","getAttribute","hasAttribute","items","Array","from","headers","toggleItem","item","header","querySelector","panel","isExpanded","otherItem","collapseItem","setAttribute","opacity","classList","add","onTransitionEnd","e","propertyName","removeEventListener","dispatchEvent","CustomEvent","bubbles","detail","expandItem","offsetHeight","requestAnimationFrame","remove","accId","headerId","id","panelId","initiallyOpen","contains","push","key","preventDefault","currentIndex","indexOf","focus","length","initAccordion"],"sources":["accordion.js"],"mappings":"CACA,WACE,aAoMAA,OAAOC,iBAAiB,SAAU,KAC9BC,SAASC,iBAAiB,8CAA8CC,QAAQC,IAC5EA,EAAQC,MAAMC,UAAaF,EAAQG,aAAe,IAAO,SAIjEN,SAASD,iBAAiB,mBAAoB,KACzBC,SAASC,iBAAiB,cAClCC,QAAQ,CAACK,EAAKC,KAClBD,EAAIE,QAAQC,cACfH,EAAIE,QAAQC,YAAcC,OAAOH,EAAQ,IAxM/C,SAAuBI,GACrB,IAAKA,EAAO,OAEZ,MAAMC,EACyC,SAA7CD,EAAKE,aAAa,wBAClBF,EAAKG,aAAa,uBAEdC,EAAQC,MAAMC,KAAKN,EAAKX,iBAAiB,oBACzCkB,EAAU,GA4FhB,SAASC,EAAWC,EAAMR,GACxB,MAAMS,EAASD,EAAKE,cAAc,qBAC5BC,EAAQH,EAAKE,cAAc,sBACjC,IAAKD,IAAWE,EAAQ,OAExB,MAAMC,EAAsD,SAAzCH,EAAOR,aAAa,iBAElCD,GACHG,EAAMd,QAASwB,IACTA,IAAcL,GAClBM,EAAaD,KAIbD,EACFE,EAAaN,GA0CjB,SAAoBA,GAClB,MAAMC,EAASD,EAAKE,cAAc,qBAC5BC,EAAQH,EAAKE,cAAc,sBACjC,IAAKD,IAAWE,EAAQ,OAExBF,EAAOM,aAAa,gBAAiB,QAGrCJ,EAAMpB,MAAMC,UAAYmB,EAAMlB,aAAe,KAC7CkB,EAAMpB,MAAMyB,QAAU,IACtBR,EAAKS,UAAUC,IAAI,WAGnB,MAAMC,EAAmBC,IAEA,eAAnBA,EAAEC,eACJV,EAAMpB,MAAMC,UAAY,OACxBmB,EAAMW,oBAAoB,gBAAiBH,KAG/CR,EAAMzB,iBAAiB,gBAAiBiC,GAGxCX,EAAKe,cACH,IAAIC,YAAY,mBAAoB,CAClCC,SAAS,EACTC,OAAQ,CAAElB,OAAMX,YAAaE,EAAKH,QAAQC,eAGhD,CArEI8B,CAAWnB,EAEf,CAMA,SAASM,EAAaN,GACpB,MAAMC,EAASD,EAAKE,cAAc,qBAC5BC,EAAQH,EAAKE,cAAc,sBAC5BD,GAAWE,IAGc,SAA1BA,EAAMpB,MAAMC,YACdmB,EAAMpB,MAAMC,UAAYmB,EAAMlB,aAAe,KAExCkB,EAAMiB,cAGbC,sBAAsB,KACpBpB,EAAOM,aAAa,gBAAiB,SACrCJ,EAAMpB,MAAMC,UAAY,KACxBmB,EAAMpB,MAAMyB,QAAU,IACtBR,EAAKS,UAAUa,OAAO,aAIxBtB,EAAKe,cACH,IAAIC,YAAY,qBAAsB,CACpCC,SAAS,EACTC,OAAQ,CAAElB,OAAMX,YAAaE,EAAKH,QAAQC,gBAGhD,CA5IAM,EAAMd,QAAQ,CAACmB,EAAMb,KACnB,MAAMc,EAASD,EAAKE,cAAc,qBAC5BC,EAAQH,EAAKE,cAAc,sBAEjC,IAAKD,IAAWE,EAAQ,OAExB,MAAMoB,EAAQhC,EAAKH,QAAQC,aAAe,OACpCmC,EAAWvB,EAAOwB,IAAM,oBAAoBF,KAASpC,IACrDuC,EAAUvB,EAAMsB,IAAM,mBAAmBF,KAASpC,IAExDc,EAAOwB,GAAKD,EACZrB,EAAMsB,GAAKC,EAGX,MAAMC,EACJ3B,EAAKS,UAAUmB,SAAS,YAAc5B,EAAKN,aAAa,aAG1DO,EAAOM,aAAa,OAAQ,UAC5BN,EAAOM,aAAa,gBAAiBmB,GACrCzB,EAAOM,aAAa,gBAAiBoB,EAAgB,OAAS,SAC9D1B,EAAOM,aAAa,WAAY,KAEhCJ,EAAMI,aAAa,OAAQ,UAC3BJ,EAAMI,aAAa,kBAAmBiB,GAGlCG,GACF3B,EAAKS,UAAUC,IAAI,WAEnBP,EAAMpB,MAAMC,UAAY,OACxBmB,EAAMpB,MAAMyB,QAAU,MAEtBR,EAAKS,UAAUa,OAAO,WACtBnB,EAAMpB,MAAMC,UAAY,KACxBmB,EAAMpB,MAAMyB,QAAU,KAIxBV,EAAQ+B,KAAK5B,KAIfN,EAAMd,QAAQ,CAACmB,EAAMb,KACnB,MAAMc,EAASD,EAAKE,cAAc,qBAC5BC,EAAQH,EAAKE,cAAc,sBAE5BD,GAAWE,IAGhBF,EAAOvB,iBAAiB,QAAS,KAC/BqB,EAAWC,EAAMR,KAGnBS,EAAOvB,iBAAiB,UAAYkC,IAClC,MAAMkB,EAAMlB,EAAEkB,IAEd,GAAY,UAARA,GAA2B,MAARA,EAGrB,OAFAlB,EAAEmB,sBACFhC,EAAWC,EAAMR,GAInB,MAAMwC,EAAelC,EAAQmC,QAAQhC,IACf,IAAlB+B,IAEQ,cAARF,GACFlB,EAAEmB,kBACWjC,EAAQkC,EAAe,IAAMlC,EAAQ,IAC7CoC,SACY,YAARJ,GACTlB,EAAEmB,kBACWjC,EAAQkC,EAAe,IAAMlC,EAAQA,EAAQqC,OAAS,IAC9DD,SACY,SAARJ,GACTlB,EAAEmB,iBACFjC,EAAQ,GAAGoC,SACM,QAARJ,IACTlB,EAAEmB,iBACFjC,EAAQA,EAAQqC,OAAS,GAAGD,cAiGpC,CAeIE,CAAclD,MAGnB,CApND","ignoreList":[],"sourcesContent":["// js/accordion.js\r\n(function () {\r\n  \"use strict\";\r\n\r\n  /**\r\n   * Initialize a single accordion container.\r\n   * @param {HTMLElement} root\r\n   */\r\n  function initAccordion(root) {\r\n    if (!root) {return;}\r\n\r\n    const allowMultiple =\r\n      root.getAttribute(\"data-allow-multiple\") === \"true\" ||\r\n      root.hasAttribute(\"data-allow-multiple\");\r\n\r\n    const items = Array.from(root.querySelectorAll(\".accordion-item\"));\r\n    const headers = [];\r\n\r\n    // First pass: Collect all headers and setup ARIA attributes\r\n    items.forEach((item, index) => {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n\r\n      if (!header || !panel) {return;}\r\n\r\n      const accId = root.dataset.accordionId || \"main\";\r\n      const headerId = header.id || `accordion-header-${accId}-${index}`;\r\n      const panelId = panel.id || `accordion-panel-${accId}-${index}`;\r\n\r\n      header.id = headerId;\r\n      panel.id = panelId;\r\n\r\n      // آیا این آیتم در HTML به صورت پیش‌فرض باز است؟\r\n      const initiallyOpen =\r\n        item.classList.contains(\"is-open\") || item.hasAttribute(\"data-open\");\r\n\r\n      // ARIA wiring\r\n      header.setAttribute(\"role\", \"button\");\r\n      header.setAttribute(\"aria-controls\", panelId);\r\n      header.setAttribute(\"aria-expanded\", initiallyOpen ? \"true\" : \"false\");\r\n      header.setAttribute(\"tabindex\", \"0\");\r\n\r\n      panel.setAttribute(\"role\", \"region\");\r\n      panel.setAttribute(\"aria-labelledby\", headerId);\r\n      // panel.hidden = !initiallyOpen; // Removed for animation support\r\n\r\n      if (initiallyOpen) {\r\n        item.classList.add(\"is-open\");\r\n        // Use \"none\" to allow content to determine height, avoiding issues with hidden containers\r\n        panel.style.maxHeight = \"none\";\r\n        panel.style.opacity = \"1\";\r\n      } else {\r\n        item.classList.remove(\"is-open\");\r\n        panel.style.maxHeight = null;\r\n        panel.style.opacity = \"0\";\r\n      }\r\n\r\n      // Add to headers array for keyboard navigation\r\n      headers.push(header);\r\n    });\r\n\r\n    // Second pass: Attach event listeners using complete headers array\r\n    items.forEach((item, index) => {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n\r\n      if (!header || !panel) {return;}\r\n\r\n      // Click / keyboard handlers\r\n      header.addEventListener(\"click\", () => {\r\n        toggleItem(item, allowMultiple);\r\n      });\r\n\r\n      header.addEventListener(\"keydown\", (e) => {\r\n        const key = e.key;\r\n\r\n        if (key === \"Enter\" || key === \" \") {\r\n          e.preventDefault();\r\n          toggleItem(item, allowMultiple);\r\n          return;\r\n        }\r\n\r\n        const currentIndex = headers.indexOf(header);\r\n        if (currentIndex === -1) {return;}\r\n\r\n        if (key === \"ArrowDown\") {\r\n          e.preventDefault();\r\n          const next = headers[currentIndex + 1] || headers[0];\r\n          next.focus();\r\n        } else if (key === \"ArrowUp\") {\r\n          e.preventDefault();\r\n          const prev = headers[currentIndex - 1] || headers[headers.length - 1];\r\n          prev.focus();\r\n        } else if (key === \"Home\") {\r\n          e.preventDefault();\r\n          headers[0].focus();\r\n        } else if (key === \"End\") {\r\n          e.preventDefault();\r\n          headers[headers.length - 1].focus();\r\n        }\r\n      });\r\n    });\r\n\r\n    /**\r\n     * Toggle one accordion item\r\n     * @param {HTMLElement} item\r\n     * @param {boolean} allowMultiple\r\n     */\r\n    function toggleItem(item, allowMultiple) {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n      if (!header || !panel) {return;}\r\n\r\n      const isExpanded = header.getAttribute(\"aria-expanded\") === \"true\";\r\n\r\n      if (!allowMultiple) {\r\n        items.forEach((otherItem) => {\r\n          if (otherItem === item) {return;}\r\n          collapseItem(otherItem);\r\n        });\r\n      }\r\n\r\n      if (isExpanded) {\r\n        collapseItem(item);\r\n      } else {\r\n        expandItem(item);\r\n      }\r\n    }\r\n\r\n    /**\r\n     * Collapse item\r\n     * @param {HTMLElement} item\r\n     */\r\n    function collapseItem(item) {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n      if (!header || !panel) {return;}\r\n\r\n      // If max-height is \"none\", set it to explicit pixel value first to enable transition\r\n      if (panel.style.maxHeight === \"none\") {\r\n        panel.style.maxHeight = panel.scrollHeight + \"px\";\r\n        // Force reflow\r\n        void panel.offsetHeight;\r\n      }\r\n\r\n      requestAnimationFrame(() => {\r\n        header.setAttribute(\"aria-expanded\", \"false\");\r\n        panel.style.maxHeight = null;\r\n        panel.style.opacity = \"0\";\r\n        item.classList.remove(\"is-open\");\r\n      });\r\n\r\n      // Custom event for hooks / analytics / extra animations\r\n      item.dispatchEvent(\r\n        new CustomEvent(\"accordion:collapse\", {\r\n          bubbles: true,\r\n          detail: { item, accordionId: root.dataset.accordionId },\r\n        })\r\n      );\r\n    }\r\n\r\n    /**\r\n     * Expand item\r\n     * @param {HTMLElement} item\r\n     */\r\n    function expandItem(item) {\r\n      const header = item.querySelector(\".accordion-header\");\r\n      const panel = item.querySelector(\".accordion-content\");\r\n      if (!header || !panel) {return;}\r\n\r\n      header.setAttribute(\"aria-expanded\", \"true\");\r\n      \r\n      // Set explicit height for transition\r\n      panel.style.maxHeight = panel.scrollHeight + \"px\";\r\n      panel.style.opacity = \"1\";\r\n      item.classList.add(\"is-open\");\r\n\r\n      // After transition, set to none to allow content to resize naturally\r\n      const onTransitionEnd = (e) => {\r\n        // Ensure we're handling the height transition\r\n        if (e.propertyName === \"max-height\") {\r\n          panel.style.maxHeight = \"none\";\r\n          panel.removeEventListener(\"transitionend\", onTransitionEnd);\r\n        }\r\n      };\r\n      panel.addEventListener(\"transitionend\", onTransitionEnd);\r\n\r\n      // Custom event for hooks / analytics / extra animations\r\n      item.dispatchEvent(\r\n        new CustomEvent(\"accordion:expand\", {\r\n          bubbles: true,\r\n          detail: { item, accordionId: root.dataset.accordionId },\r\n        })\r\n      );\r\n    }\r\n  }\r\n\r\n  // Handle resize to adjust max-height of open items\r\n  window.addEventListener('resize', () => {\r\n      document.querySelectorAll(\".accordion-item.is-open .accordion-content\").forEach(content => {\r\n          content.style.maxHeight = (content.scrollHeight + 500) + \"px\";\r\n      });\r\n  });\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", () => {\r\n    const accordions = document.querySelectorAll(\".accordion\");\r\n    accordions.forEach((acc, index) => {\r\n      if (!acc.dataset.accordionId) {\r\n        acc.dataset.accordionId = String(index + 1);\r\n      }\r\n      initAccordion(acc);\r\n    });\r\n  });\r\n})();\r\n"]}