{"version":3,"file":"accordion.min.js","names":["window","document","ACCORDION_REGISTRY","Map","PREFERS_REDUCED_MOTION","matchMedia","matches","resolveRecord","accordionIdOrElement","get","HTMLElement","id","dataset","accordionId","resolveItemRef","record","target","itemRefs","find","ref","item","header","panel","addEventListener","querySelectorAll","forEach","acc","index","String","root","allowMultiple","getAttribute","hasAttribute","allowToggle","headers","reduceMotion","items","Array","from","length","transitionEndHandlers","WeakMap","querySelector","headerId","panelId","initiallyOpen","classList","contains","setAttribute","hidden","add","style","maxHeight","opacity","remove","push","some","toggleItem","e","key","preventDefault","currentIndex","indexOf","focus","set","expandItem","collapseItem","isItemExpanded","dispatchAccordionEvent","type","dispatchEvent","CustomEvent","bubbles","detail","scrollHeight","offsetHeight","requestAnimationFrame","existingHandler","removeEventListener","onTransitionEnd","propertyName","delete","currentlyExpanded","reduce","count","r","otherRef","initAccordion","Accordion","open","close","toggle","openAll","closeAll","firstOpen"],"sources":["accordion.js"],"mappings":"CACA,WACE,aAGA,GAAsB,oBAAXA,QAA8C,oBAAbC,SAC1C,OAuBF,MAAMC,EAAqB,IAAIC,IAGzBC,KACDJ,OAAOK,aACRL,OAAOK,WAAW,oCAAoCC,SAsS1D,SAASC,EAAcC,GACrB,IAAKA,EAAsB,OAAO,KAElC,GAAoC,iBAAzBA,EACT,OAAON,EAAmBO,IAAID,IAAyB,KAGzD,GAAIA,aAAgCE,YAAa,CAC/C,MAAMC,EAAKH,EAAqBI,QAC5BJ,EAAqBI,QAAQC,YAC7B,KACJ,OAAKF,GACET,EAAmBO,IAAIE,IADd,IAElB,CAEA,OAAO,IACT,CAQA,SAASG,EAAeC,EAAQC,GAC9B,IAAKD,GAAoB,MAAVC,EAAgB,OAAO,KACtC,MAAMC,SAAEA,GAAaF,EAErB,MAAsB,iBAAXC,EACFC,EAASD,IAAW,KAGP,iBAAXA,GAEPC,EAASC,KACNC,GACCA,EAAIC,KAAKT,KAAOK,GAChBG,EAAIE,OAAOV,KAAOK,GAClBG,EAAIG,MAAMX,KAAOK,IAKlB,IACT,CAGAf,SAASsB,iBAAiB,mBAAoB,KACzBtB,SAASuB,iBAAiB,cAClCC,QAAQ,CAACC,EAAKC,KAClBD,EAAId,QAAQC,cACfa,EAAId,QAAQC,YAAce,OAAOD,EAAQ,IAnV/C,SAAuBE,GACrB,IAAKA,EAAM,OAEX,MAAMhB,EAAcgB,EAAKjB,QAAQC,aAAe,OAE1CiB,EACyC,SAA7CD,EAAKE,aAAa,wBAClBF,EAAKG,aAAa,uBAEdC,EACuC,UAA3CJ,EAAKE,aAAa,qBAGdd,EAAW,GAEXiB,EAAU,GAEVC,EAAe/B,EAEfgC,EAAQC,MAAMC,KAAKT,EAAKL,iBAAiB,oBAC/C,IAAKY,EAAMG,OAAQ,OAInB,MAAMC,EAAwB,IAAIC,QA+ClC,GA5CAL,EAAMX,QAAQ,CAACL,EAAMO,KACnB,MAAMN,EACJD,EAAKsB,cAAc,qBAEfpB,EACJF,EAAKsB,cAAc,sBAGrB,IAAKrB,IAAWC,EAAO,OAEvB,MAAMqB,EAAWtB,EAAOV,IAAM,oBAAoBE,KAAec,IAC3DiB,EAAUtB,EAAMX,IAAM,mBAAmBE,KAAec,IAE9DN,EAAOV,GAAKgC,EACZrB,EAAMX,GAAKiC,EAEX,MAAMC,EACJzB,EAAK0B,UAAUC,SAAS,YAAc3B,EAAKY,aAAa,aAG1DX,EAAO2B,aAAa,OAAQ,UAC5B3B,EAAO2B,aAAa,gBAAiBJ,GACrCvB,EAAO2B,aAAa,gBAAiBH,EAAgB,OAAS,SAC9DxB,EAAO2B,aAAa,WAAY,KAEhC1B,EAAM0B,aAAa,OAAQ,UAC3B1B,EAAM0B,aAAa,kBAAmBL,GACtCrB,EAAM0B,aAAa,cAAeH,EAAgB,QAAU,QAC5DvB,EAAM2B,QAAUJ,EAEZA,GACFzB,EAAK0B,UAAUI,IAAI,WACnB5B,EAAM6B,MAAMC,UAAY,OACxB9B,EAAM6B,MAAME,QAAU,MAEtBjC,EAAK0B,UAAUQ,OAAO,WACtBhC,EAAM6B,MAAMC,UAAY,KACxB9B,EAAM6B,MAAME,QAAU,KAGxBnB,EAAQqB,KAAKlC,GACbJ,EAASsC,KAAK,CAAEnC,OAAMC,SAAQC,YAG3BL,EAASsB,OAAd,CAGA,IAAKN,IACahB,EAASuC,KAAMrC,GACgB,SAA7CA,EAAIE,OAAOU,aAAa,mBAEVd,EAAS,GAAI,CAC3B,MAAMG,KAAEA,EAAIC,OAAEA,EAAMC,MAAEA,GAAUL,EAAS,GACzCI,EAAO2B,aAAa,gBAAiB,QACrC5B,EAAK0B,UAAUI,IAAI,WACnB5B,EAAM0B,aAAa,cAAe,SAClC1B,EAAM2B,QAAS,EACf3B,EAAM6B,MAAMC,UAAY,OACxB9B,EAAM6B,MAAME,QAAU,GACxB,CA+IFpC,EAASQ,QAASN,IAChB,MAAME,OAAEA,GAAWF,EAGnBE,EAAOE,iBAAiB,QAAS,KAC3BF,EAAOW,aAAa,kBACxByB,EAAWtC,KAIbE,EAAOE,iBAAiB,UAAYmC,IAClC,MAAMC,EAAMD,EAAEC,IAEd,GAAItC,EAAOW,aAAa,iBAAkB,OAE1C,GAAY,UAAR2B,GAA2B,MAARA,EAGrB,OAFAD,EAAEE,sBACFH,EAAWtC,GAIb,MAAM0C,EAAe3B,EAAQ4B,QAAQzC,IACf,IAAlBwC,IAEQ,cAARF,GACFD,EAAEE,kBACW1B,EAAQ2B,EAAe,IAAM3B,EAAQ,IAC7C6B,SACY,YAARJ,GACTD,EAAEE,kBACW1B,EAAQ2B,EAAe,IAAM3B,EAAQA,EAAQK,OAAS,IAC9DwB,SACY,SAARJ,GACTD,EAAEE,iBACF1B,EAAQ,GAAG6B,SACM,QAARJ,IACTD,EAAEE,iBACF1B,EAAQA,EAAQK,OAAS,GAAGwB,cAMlC7D,EAAmB8D,IAAInD,EAAa,CAClCgB,OACAZ,WACAa,gBACAG,cACAgC,aACAC,eACAT,aACAU,kBAjN0B,CA0B5B,SAASC,EAAuBhD,EAAMiD,EAAMxD,GACrCO,GACLA,EAAKkD,cACH,IAAIC,YAAYF,EAAM,CACpBG,SAAS,EACTC,OAAQ,CAAErD,OAAMP,iBAGtB,CAOA,SAASsD,EAAehD,GACtB,MAAoD,SAA7CA,EAAIE,OAAOU,aAAa,gBACjC,CAMA,SAASmC,EAAa/C,GACpB,MAAMC,KAAEA,EAAIC,OAAEA,EAAMC,MAAEA,GAAUH,EAC3BE,GAAWC,IAEhBD,EAAO2B,aAAa,gBAAiB,SACrC5B,EAAK0B,UAAUQ,OAAO,WACtBhC,EAAM0B,aAAa,cAAe,QAClC1B,EAAM2B,QAAS,EAEXd,GACFb,EAAM6B,MAAMC,UAAY,KACxB9B,EAAM6B,MAAME,QAAU,MAGQ,SAA1B/B,EAAM6B,MAAMC,YACd9B,EAAM6B,MAAMC,UAAY9B,EAAMoD,aAAe,KAExCpD,EAAMqD,cAGbC,sBAAsB,KACpBtD,EAAM6B,MAAMC,UAAY,KACxB9B,EAAM6B,MAAME,QAAU,OAI1Be,EAAuBhD,EAAM,qBAAsBP,GACrD,CAMA,SAASoD,EAAW9C,GAClB,MAAMC,KAAEA,EAAIC,OAAEA,EAAMC,MAAEA,GAAUH,EAChC,GAAKE,GAAWC,EAAhB,CAOA,GALAD,EAAO2B,aAAa,gBAAiB,QACrC5B,EAAK0B,UAAUI,IAAI,WACnB5B,EAAM0B,aAAa,cAAe,SAClC1B,EAAM2B,QAAS,EAEXd,EACFb,EAAM6B,MAAMC,UAAY,OACxB9B,EAAM6B,MAAME,QAAU,QACjB,CAEL/B,EAAM6B,MAAMC,UAAY9B,EAAMoD,aAAe,KAC7CpD,EAAM6B,MAAME,QAAU,IAGtB,MAAMwB,EAAkBrC,EAAsB/B,IAAIa,GAC9CuD,GACFvD,EAAMwD,oBAAoB,gBAAiBD,GAG7C,MAAME,EAAmBrB,IACA,eAAnBA,EAAEsB,eAEJ1D,EAAM6B,MAAMC,UAAY,OACxB9B,EAAMwD,oBAAoB,gBAAiBC,GAC3CvC,EAAsByC,OAAO3D,KAIjCkB,EAAsBwB,IAAI1C,EAAOyD,GACjCzD,EAAMC,iBAAiB,gBAAiBwD,EAC1C,CAEAX,EAAuBhD,EAAM,mBAAoBP,EAlCpB,CAmC/B,CAMA,SAAS4C,EAAWtC,GAClB,MAAMC,KAAEA,GAASD,EACX+D,EAAoBf,EAAehD,IAGpCc,GAAeiD,GACIjE,EAASkE,OAC7B,CAACC,EAAOC,IAAOlB,EAAekB,GAAKD,EAAQ,EAAIA,EAC/C,IAEmB,IAKlBtD,GACHb,EAASQ,QAAS6D,IACZA,EAASlE,OAASA,GAClB+C,EAAemB,IACjBpB,EAAaoB,KAKfJ,EACFhB,EAAa/C,GAEb8C,EAAW9C,GAEf,CAyDF,CA2DIoE,CAAc7D,OAKlB1B,OAAOwF,UAAYxF,OAAOwF,WAAa,CAAC,EAOxCxF,OAAOwF,UAAUC,KAAO,SAAUjF,EAAsBQ,GACtD,MAAMD,EAASR,EAAcC,GAC7B,IAAKO,EAAQ,OACb,MAAMI,EAAML,EAAeC,EAAQC,GAC9BG,GACLJ,EAAOkD,WAAW9C,EACpB,EAOAnB,OAAOwF,UAAUE,MAAQ,SAAUlF,EAAsBQ,GACvD,MAAMD,EAASR,EAAcC,GAC7B,IAAKO,EAAQ,OACb,MAAMI,EAAML,EAAeC,EAAQC,GAC9BG,GACLJ,EAAOmD,aAAa/C,EACtB,EAOAnB,OAAOwF,UAAUG,OAAS,SAAUnF,EAAsBQ,GACxD,MAAMD,EAASR,EAAcC,GAC7B,IAAKO,EAAQ,OACb,MAAMI,EAAML,EAAeC,EAAQC,GAC9BG,GACLJ,EAAO0C,WAAWtC,EACpB,EAMAnB,OAAOwF,UAAUI,QAAU,SAAUpF,GACnC,MAAMO,EAASR,EAAcC,GAC7B,IAAKO,EAAQ,OACb,MAAMe,cAAEA,EAAab,SAAEA,EAAQgD,WAAEA,GAAelD,EAC3Ce,EAKLb,EAASQ,QAASN,GAAQ8C,EAAW9C,IAH/BF,EAAS,IAAIgD,EAAWhD,EAAS,GAIzC,EAMAjB,OAAOwF,UAAUK,SAAW,SAAUrF,GACpC,MAAMO,EAASR,EAAcC,GAC7B,IAAKO,EAAQ,OACb,MAAMkB,YAAEA,EAAWhB,SAAEA,EAAQiD,aAAEA,EAAYC,eAAEA,GAAmBpD,EAEhE,IAAKkB,EAAa,CAEhB,IAAI6D,EAAY7E,EAASC,KAAMC,GAAQgD,EAAehD,IAQtD,OAPK2E,GAAa7E,EAAS,KACzB6E,EAAY7E,EAAS,SAEvBA,EAASQ,QAASN,IACZA,IAAQ2E,GACZ5B,EAAa/C,IAGjB,CAEAF,EAASQ,QAASN,GAAQ+C,EAAa/C,GACzC,CACD,CAldD","ignoreList":[],"sourcesContent":["// js/accordion.js\r\n(function () {\r\n  \"use strict\";\r\n\r\n  // اگر در محیطی مثل SSR/Node اجرا شد، هیچ کاری نکنیم\r\n  if (typeof window === \"undefined\" || typeof document === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} AccordionItemRefs\r\n   * @property {HTMLElement} item\r\n   * @property {HTMLElement} header\r\n   * @property {HTMLElement} panel\r\n   */\r\n\r\n  /**\r\n   * رجیستری آکاردئون‌ها برای استفاده در API سراسری\r\n   * @type {Map<string, {\r\n   *   root: HTMLElement,\r\n   *   itemRefs: AccordionItemRefs[],\r\n   *   allowMultiple: boolean,\r\n   *   allowToggle: boolean,\r\n   *   expandItem: (ref: AccordionItemRefs) => void,\r\n   *   collapseItem: (ref: AccordionItemRefs) => void,\r\n   *   toggleItem: (ref: AccordionItemRefs) => void,\r\n   *   isItemExpanded: (ref: AccordionItemRefs) => boolean\r\n   * }>}\r\n   */\r\n  const ACCORDION_REGISTRY = new Map();\r\n\r\n  // ترجیح کاربر برای کاهش انیمیشن فقط یک بار محاسبه می‌شود\r\n  const PREFERS_REDUCED_MOTION =\r\n    !!(window.matchMedia &&\r\n      window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches);\r\n\r\n  /**\r\n   * Initialize a single accordion container.\r\n   * @param {HTMLElement} root\r\n   */\r\n  function initAccordion(root) {\r\n    if (!root) return;\r\n\r\n    const accordionId = root.dataset.accordionId || \"main\";\r\n\r\n    const allowMultiple =\r\n      root.getAttribute(\"data-allow-multiple\") === \"true\" ||\r\n      root.hasAttribute(\"data-allow-multiple\");\r\n\r\n    const allowToggle =\r\n      root.getAttribute(\"data-allow-toggle\") !== \"false\"; // اگر false باشد، حداقل یک آیتم همیشه باز می‌ماند\r\n\r\n    /** @type {AccordionItemRefs[]} */\r\n    const itemRefs = [];\r\n    /** @type {HTMLElement[]} */\r\n    const headers = [];\r\n\r\n    const reduceMotion = PREFERS_REDUCED_MOTION;\r\n\r\n    const items = Array.from(root.querySelectorAll(\".accordion-item\"));\r\n    if (!items.length) return;\r\n\r\n    // برای نگه‌داری هندلرهای transitionend بدون دست‌کاری DOM\r\n    /** @type {WeakMap<HTMLElement, (e: TransitionEvent) => void>} */\r\n    const transitionEndHandlers = new WeakMap();\r\n\r\n    // --- First pass: setup ARIA / state ---\r\n    items.forEach((item, index) => {\r\n      const header = /** @type {HTMLElement|null} */ (\r\n        item.querySelector(\".accordion-header\")\r\n      );\r\n      const panel = /** @type {HTMLElement|null} */ (\r\n        item.querySelector(\".accordion-content\")\r\n      );\r\n\r\n      if (!header || !panel) return;\r\n\r\n      const headerId = header.id || `accordion-header-${accordionId}-${index}`;\r\n      const panelId = panel.id || `accordion-panel-${accordionId}-${index}`;\r\n\r\n      header.id = headerId;\r\n      panel.id = panelId;\r\n\r\n      const initiallyOpen =\r\n        item.classList.contains(\"is-open\") || item.hasAttribute(\"data-open\");\r\n\r\n      // ARIA wiring\r\n      header.setAttribute(\"role\", \"button\");\r\n      header.setAttribute(\"aria-controls\", panelId);\r\n      header.setAttribute(\"aria-expanded\", initiallyOpen ? \"true\" : \"false\");\r\n      header.setAttribute(\"tabindex\", \"0\");\r\n\r\n      panel.setAttribute(\"role\", \"region\");\r\n      panel.setAttribute(\"aria-labelledby\", headerId);\r\n      panel.setAttribute(\"aria-hidden\", initiallyOpen ? \"false\" : \"true\");\r\n      panel.hidden = !initiallyOpen;\r\n\r\n      if (initiallyOpen) {\r\n        item.classList.add(\"is-open\");\r\n        panel.style.maxHeight = \"none\";\r\n        panel.style.opacity = \"1\";\r\n      } else {\r\n        item.classList.remove(\"is-open\");\r\n        panel.style.maxHeight = null;\r\n        panel.style.opacity = \"0\";\r\n      }\r\n\r\n      headers.push(header);\r\n      itemRefs.push({ item, header, panel });\r\n    });\r\n\r\n    if (!itemRefs.length) return;\r\n\r\n    // اگر اجازه‌ی toggle نداریم، مطمئن شو حداقل یک آیتم از ابتدا باز است\r\n    if (!allowToggle) {\r\n      const hasOpen = itemRefs.some((ref) =>\r\n        ref.header.getAttribute(\"aria-expanded\") === \"true\"\r\n      );\r\n      if (!hasOpen && itemRefs[0]) {\r\n        const { item, header, panel } = itemRefs[0];\r\n        header.setAttribute(\"aria-expanded\", \"true\");\r\n        item.classList.add(\"is-open\");\r\n        panel.setAttribute(\"aria-hidden\", \"false\");\r\n        panel.hidden = false;\r\n        panel.style.maxHeight = \"none\";\r\n        panel.style.opacity = \"1\";\r\n      }\r\n    }\r\n\r\n    // --- Helpers ---\r\n\r\n    /**\r\n     * Dispatch a custom event from an item.\r\n     * @param {HTMLElement} item\r\n     * @param {string} type\r\n     * @param {string} accordionId\r\n     */\r\n    function dispatchAccordionEvent(item, type, accordionId) {\r\n      if (!item) return;\r\n      item.dispatchEvent(\r\n        new CustomEvent(type, {\r\n          bubbles: true,\r\n          detail: { item, accordionId },\r\n        })\r\n      );\r\n    }\r\n\r\n    /**\r\n     * Check if an item is expanded.\r\n     * @param {AccordionItemRefs} ref\r\n     * @returns {boolean}\r\n     */\r\n    function isItemExpanded(ref) {\r\n      return ref.header.getAttribute(\"aria-expanded\") === \"true\";\r\n    }\r\n\r\n    /**\r\n     * Collapse a single item.\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function collapseItem(ref) {\r\n      const { item, header, panel } = ref;\r\n      if (!header || !panel) return;\r\n\r\n      header.setAttribute(\"aria-expanded\", \"false\");\r\n      item.classList.remove(\"is-open\");\r\n      panel.setAttribute(\"aria-hidden\", \"true\");\r\n      panel.hidden = true;\r\n\r\n      if (reduceMotion) {\r\n        panel.style.maxHeight = null;\r\n        panel.style.opacity = \"0\";\r\n      } else {\r\n        // اگر max-height = \"none\" بود، اول height فعلی را تنظیم می‌کنیم برای transition\r\n        if (panel.style.maxHeight === \"none\") {\r\n          panel.style.maxHeight = panel.scrollHeight + \"px\";\r\n          // Force reflow\r\n          void panel.offsetHeight;\r\n        }\r\n\r\n        requestAnimationFrame(() => {\r\n          panel.style.maxHeight = null;\r\n          panel.style.opacity = \"0\";\r\n        });\r\n      }\r\n\r\n      dispatchAccordionEvent(item, \"accordion:collapse\", accordionId);\r\n    }\r\n\r\n    /**\r\n     * Expand a single item.\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function expandItem(ref) {\r\n      const { item, header, panel } = ref;\r\n      if (!header || !panel) return;\r\n\r\n      header.setAttribute(\"aria-expanded\", \"true\");\r\n      item.classList.add(\"is-open\");\r\n      panel.setAttribute(\"aria-hidden\", \"false\");\r\n      panel.hidden = false;\r\n\r\n      if (reduceMotion) {\r\n        panel.style.maxHeight = \"none\";\r\n        panel.style.opacity = \"1\";\r\n      } else {\r\n        // ابتدا max-height را به ارتفاع واقعی تنظیم می‌کنیم\r\n        panel.style.maxHeight = panel.scrollHeight + \"px\";\r\n        panel.style.opacity = \"1\";\r\n\r\n        // جلوگیری از چند بار اضافه شدن لیسنر transitionend\r\n        const existingHandler = transitionEndHandlers.get(panel);\r\n        if (existingHandler) {\r\n          panel.removeEventListener(\"transitionend\", existingHandler);\r\n        }\r\n\r\n        const onTransitionEnd = (e) => {\r\n          if (e.propertyName === \"max-height\") {\r\n            // برای اینکه بعداً با تغییر محتوا به‌راحتی ریسایز شود\r\n            panel.style.maxHeight = \"none\";\r\n            panel.removeEventListener(\"transitionend\", onTransitionEnd);\r\n            transitionEndHandlers.delete(panel);\r\n          }\r\n        };\r\n\r\n        transitionEndHandlers.set(panel, onTransitionEnd);\r\n        panel.addEventListener(\"transitionend\", onTransitionEnd);\r\n      }\r\n\r\n      dispatchAccordionEvent(item, \"accordion:expand\", accordionId);\r\n    }\r\n\r\n    /**\r\n     * Toggle one accordion item\r\n     * @param {AccordionItemRefs} ref\r\n     */\r\n    function toggleItem(ref) {\r\n      const { item } = ref;\r\n      const currentlyExpanded = isItemExpanded(ref);\r\n\r\n      // اگر اجازه‌ی toggle نداریم و این تنها آیتم باز است، نبندش\r\n      if (!allowToggle && currentlyExpanded) {\r\n        const expandedCount = itemRefs.reduce(\r\n          (count, r) => (isItemExpanded(r) ? count + 1 : count),\r\n          0\r\n        );\r\n        if (expandedCount <= 1) {\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (!allowMultiple) {\r\n        itemRefs.forEach((otherRef) => {\r\n          if (otherRef.item === item) return;\r\n          if (isItemExpanded(otherRef)) {\r\n            collapseItem(otherRef);\r\n          }\r\n        });\r\n      }\r\n\r\n      if (currentlyExpanded) {\r\n        collapseItem(ref);\r\n      } else {\r\n        expandItem(ref);\r\n      }\r\n    }\r\n\r\n    // --- Events: click + keyboard ---\r\n\r\n    itemRefs.forEach((ref) => {\r\n      const { header } = ref;\r\n\r\n      // Click handler\r\n      header.addEventListener(\"click\", () => {\r\n        if (header.hasAttribute(\"aria-disabled\")) return;\r\n        toggleItem(ref);\r\n      });\r\n\r\n      // Keyboard handler\r\n      header.addEventListener(\"keydown\", (e) => {\r\n        const key = e.key;\r\n\r\n        if (header.hasAttribute(\"aria-disabled\")) return;\r\n\r\n        if (key === \"Enter\" || key === \" \") {\r\n          e.preventDefault();\r\n          toggleItem(ref);\r\n          return;\r\n        }\r\n\r\n        const currentIndex = headers.indexOf(header);\r\n        if (currentIndex === -1) return;\r\n\r\n        if (key === \"ArrowDown\") {\r\n          e.preventDefault();\r\n          const next = headers[currentIndex + 1] || headers[0];\r\n          next.focus();\r\n        } else if (key === \"ArrowUp\") {\r\n          e.preventDefault();\r\n          const prev = headers[currentIndex - 1] || headers[headers.length - 1];\r\n          prev.focus();\r\n        } else if (key === \"Home\") {\r\n          e.preventDefault();\r\n          headers[0].focus();\r\n        } else if (key === \"End\") {\r\n          e.preventDefault();\r\n          headers[headers.length - 1].focus();\r\n        }\r\n      });\r\n    });\r\n\r\n    // ثبت در رجیستری برای استفاده‌ی API بیرونی\r\n    ACCORDION_REGISTRY.set(accordionId, {\r\n      root,\r\n      itemRefs,\r\n      allowMultiple,\r\n      allowToggle,\r\n      expandItem,\r\n      collapseItem,\r\n      toggleItem,\r\n      isItemExpanded,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Resolve registry record by id or element.\r\n   * @param {string | HTMLElement} accordionIdOrElement\r\n   */\r\n  function resolveRecord(accordionIdOrElement) {\r\n    if (!accordionIdOrElement) return null;\r\n\r\n    if (typeof accordionIdOrElement === \"string\") {\r\n      return ACCORDION_REGISTRY.get(accordionIdOrElement) || null;\r\n    }\r\n\r\n    if (accordionIdOrElement instanceof HTMLElement) {\r\n      const id = accordionIdOrElement.dataset\r\n        ? accordionIdOrElement.dataset.accordionId\r\n        : null;\r\n      if (!id) return null;\r\n      return ACCORDION_REGISTRY.get(id) || null;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Resolve item ref by index or id.\r\n   * @param {ReturnType<typeof resolveRecord>} record\r\n   * @param {number | string} target\r\n   * @returns {AccordionItemRefs | null}\r\n   */\r\n  function resolveItemRef(record, target) {\r\n    if (!record || target == null) return null;\r\n    const { itemRefs } = record;\r\n\r\n    if (typeof target === \"number\") {\r\n      return itemRefs[target] || null;\r\n    }\r\n\r\n    if (typeof target === \"string\") {\r\n      return (\r\n        itemRefs.find(\r\n          (ref) =>\r\n            ref.item.id === target ||\r\n            ref.header.id === target ||\r\n            ref.panel.id === target\r\n        ) || null\r\n      );\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  // Auto-init on DOMContentLoaded\r\n  document.addEventListener(\"DOMContentLoaded\", () => {\r\n    const accordions = document.querySelectorAll(\".accordion\");\r\n    accordions.forEach((acc, index) => {\r\n      if (!acc.dataset.accordionId) {\r\n        acc.dataset.accordionId = String(index + 1);\r\n      }\r\n      initAccordion(acc);\r\n    });\r\n  });\r\n\r\n  // --- Global API ---\r\n  window.Accordion = window.Accordion || {};\r\n\r\n  /**\r\n   * باز کردن یک آیتم\r\n   * @param {string | HTMLElement} accordionIdOrElement\r\n   * @param {number | string} target\r\n   */\r\n  window.Accordion.open = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return;\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) return;\r\n    record.expandItem(ref);\r\n  };\r\n\r\n  /**\r\n   * بستن یک آیتم\r\n   * @param {string | HTMLElement} accordionIdOrElement\r\n   * @param {number | string} target\r\n   */\r\n  window.Accordion.close = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return;\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) return;\r\n    record.collapseItem(ref);\r\n  };\r\n\r\n  /**\r\n   * تغییر وضعیت یک آیتم\r\n   * @param {string | HTMLElement} accordionIdOrElement\r\n   * @param {number | string} target\r\n   */\r\n  window.Accordion.toggle = function (accordionIdOrElement, target) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return;\r\n    const ref = resolveItemRef(record, target);\r\n    if (!ref) return;\r\n    record.toggleItem(ref);\r\n  };\r\n\r\n  /**\r\n   * باز کردن همه آیتم‌ها (فقط اگر allowMultiple = true باشد)\r\n   * @param {string | HTMLElement} accordionIdOrElement\r\n   */\r\n  window.Accordion.openAll = function (accordionIdOrElement) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return;\r\n    const { allowMultiple, itemRefs, expandItem } = record;\r\n    if (!allowMultiple) {\r\n      // اگر اجازه‌ی چندتایی نداریم، فقط اولین آیتم را باز می‌کنیم\r\n      if (itemRefs[0]) expandItem(itemRefs[0]);\r\n      return;\r\n    }\r\n    itemRefs.forEach((ref) => expandItem(ref));\r\n  };\r\n\r\n  /**\r\n   * بستن همه آیتم‌ها (اگر allowToggle=false، یکی را باز نگه می‌داریم)\r\n   * @param {string | HTMLElement} accordionIdOrElement\r\n   */\r\n  window.Accordion.closeAll = function (accordionIdOrElement) {\r\n    const record = resolveRecord(accordionIdOrElement);\r\n    if (!record) return;\r\n    const { allowToggle, itemRefs, collapseItem, isItemExpanded } = record;\r\n\r\n    if (!allowToggle) {\r\n      // حداقل یک آیتم باید باز بماند\r\n      let firstOpen = itemRefs.find((ref) => isItemExpanded(ref));\r\n      if (!firstOpen && itemRefs[0]) {\r\n        firstOpen = itemRefs[0];\r\n      }\r\n      itemRefs.forEach((ref) => {\r\n        if (ref === firstOpen) return;\r\n        collapseItem(ref);\r\n      });\r\n      return;\r\n    }\r\n\r\n    itemRefs.forEach((ref) => collapseItem(ref));\r\n  };\r\n})();\r\n"]}