{"version":3,"file":"main-script-base.min.js","names":["window","langStrings","storage","testKey","localStorage","setItem","removeItem","err","getSafeStorage","darkMediaQuery","matchMedia","prefersDark","matches","savedTheme","getItem","createToast","message","toast","document","createElement","setAttribute","className","textContent","String","existingToasts","querySelectorAll","length","forEach","t","index","remove","body","appendChild","requestAnimationFrame","classList","add","setTimeout","parentNode","applyTheme","theme","showToast","isDark","toggle","documentElement","getElementById","checked","themeChanged","msg","handleThemeSystemChange","e","addEventListener","addListener","initThemeToggle","themeToggleInput","newTheme","event","key","preventDefault","endOfPageShown","lastScrollY","ticking","checkPageEnd","scrollPosition","innerHeight","docHeight","Math","max","scrollHeight","offsetHeight","endOfPage","scrollY","pageYOffset","passive","yearEl","Date","getFullYear"],"sources":["main-script-base.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  // Ensure language strings object exists\r\n  if (!window.langStrings) {\r\n    console.warn(\"No language strings loaded\");\r\n    window.langStrings = {};\r\n  }\r\n\r\n  /**\r\n   * Safe localStorage accessor with feature / privacy mode detection\r\n   */\r\n  function getSafeStorage() {\r\n    const testKey = \"__theme_pref__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch (err) {\r\n      // e.g. Safari private mode or blocked storage\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\r\n\r\n  // Reuse a single MediaQueryList if available\r\n  const darkMediaQuery = window.matchMedia\r\n    ? window.matchMedia(\"(prefers-color-scheme: dark)\")\r\n    : null;\r\n  const prefersDark = !!(darkMediaQuery && darkMediaQuery.matches);\r\n  const savedTheme = storage?.getItem(\"theme\") || null;\r\n\r\n  /**\r\n   * Basic toast helper (string-only API to stay compatible)\r\n   * Other scripts can call window.createToast(\"message\").\r\n   */\r\n  function createToast(message) {\r\n    if (!message) {return;}\r\n\r\n    const toast = document.createElement(\"div\");\r\n    toast.setAttribute(\"role\", \"status\");\r\n    toast.setAttribute(\"aria-live\", \"polite\");\r\n    toast.className = \"dynamic-toast\";\r\n    toast.textContent = String(message);\r\n\r\n    // Optional: prevent infinite stacking by removing old non-visible toasts\r\n    const existingToasts = document.querySelectorAll(\".dynamic-toast\");\r\n    if (existingToasts.length > 3) {\r\n      existingToasts.forEach((t, index) => {\r\n        if (index === 0) {t.remove();}\r\n      });\r\n    }\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    // Trigger CSS transition\r\n    requestAnimationFrame(() => toast.classList.add(\"show\"));\r\n\r\n    // Auto-hide\r\n    setTimeout(() => {\r\n      toast.classList.remove(\"show\");\r\n      // Wait for CSS transition to finish if any\r\n      setTimeout(() => {\r\n        if (toast.parentNode) {toast.remove();}\r\n      }, 300);\r\n    }, 3000);\r\n  }\r\n\r\n  // Expose toast helper globally if not already defined\r\n  if (typeof window.createToast !== \"function\") {\r\n    window.createToast = createToast;\r\n  }\r\n\r\n  /**\r\n   * Apply theme and sync toggle + a11y attributes.\r\n   * @param {\"dark\"|\"light\"} theme\r\n   * @param {boolean} [showToast=false]\r\n   */\r\n  function applyTheme(theme, showToast) {\r\n    const isDark = theme === \"dark\";\r\n\r\n    document.body.classList.toggle(\"dark-mode\", isDark);\r\n    document.body.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    // Optional: expose theme on <html> for CSS theming\r\n    document.documentElement.setAttribute(\"data-theme\", theme);\r\n\r\n    const toggle = document.getElementById(\"theme-toggle\");\r\n    if (toggle) {\r\n      toggle.checked = isDark;\r\n      toggle.setAttribute(\"aria-checked\", String(isDark));\r\n    }\r\n\r\n    if (showToast && typeof window.langStrings.themeChanged === \"function\") {\r\n      // themeChanged(theme) â†’ localized message\r\n      const msg = window.langStrings.themeChanged(theme);\r\n      if (msg) {createToast(msg);}\r\n    }\r\n  }\r\n\r\n  // Initial theme: stored preference > system preference\r\n  if (savedTheme === \"dark\" || savedTheme === \"light\") {\r\n    applyTheme(savedTheme);\r\n  } else {\r\n    applyTheme(prefersDark ? \"dark\" : \"light\");\r\n  }\r\n\r\n  // React to OS theme changes only if user has not explicitly chosen a theme\r\n  if (darkMediaQuery) {\r\n    const handleThemeSystemChange = function (e) {\r\n      // If user later sets a theme, this check prevents overriding it\r\n      if (!storage?.getItem(\"theme\")) {\r\n        applyTheme(e.matches ? \"dark\" : \"light\");\r\n      }\r\n    };\r\n\r\n    if (typeof darkMediaQuery.addEventListener === \"function\") {\r\n      darkMediaQuery.addEventListener(\"change\", handleThemeSystemChange);\r\n    } else if (typeof darkMediaQuery.addListener === \"function\") {\r\n      // Older browsers\r\n      darkMediaQuery.addListener(handleThemeSystemChange);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize theme toggle (can be called multiple times safely).\r\n   */\r\n  function initThemeToggle() {\r\n    const themeToggleInput = document.getElementById(\"theme-toggle\");\r\n    if (!themeToggleInput) {return;}\r\n\r\n    // Sync ARIA\r\n    themeToggleInput.setAttribute(\r\n      \"aria-checked\",\r\n      String(!!themeToggleInput.checked)\r\n    );\r\n    themeToggleInput.setAttribute(\"role\", \"switch\");\r\n\r\n    // Change by click\r\n    themeToggleInput.addEventListener(\"change\", () => {\r\n      const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\r\n      applyTheme(newTheme, true);\r\n      try {\r\n        storage?.setItem(\"theme\", newTheme);\r\n      } catch (err) {\r\n        // Ignore storage failures (e.g., private mode)\r\n      }\r\n    });\r\n\r\n    // Keyboard accessibility (Space / Enter)\r\n    themeToggleInput.addEventListener(\"keydown\", (event) => {\r\n      if (event.key === \" \" || event.key === \"Enter\") {\r\n        event.preventDefault();\r\n        themeToggleInput.checked = !themeToggleInput.checked;\r\n        const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\r\n        applyTheme(newTheme, true);\r\n        try {\r\n          storage?.setItem(\"theme\", newTheme);\r\n        } catch (err) {}\r\n      }\r\n    });\r\n  }\r\n\r\n  // Init theme toggle on first load\r\n  initThemeToggle();\r\n  // Re-init if header/footer includes loaded dynamically\r\n  document.addEventListener(\"includesLoaded\", initThemeToggle, false);\r\n\r\n  // ---- End-of-page toast logic ----\r\n\r\n  let endOfPageShown = false;\r\n  let lastScrollY = 0;\r\n  let ticking = false;\r\n\r\n  function checkPageEnd() {\r\n    const scrollPosition = window.innerHeight + lastScrollY;\r\n    const docHeight =\r\n      Math.max(\r\n        document.body.scrollHeight,\r\n        document.documentElement.scrollHeight,\r\n        document.body.offsetHeight,\r\n        document.documentElement.offsetHeight\r\n      ) || 0;\r\n\r\n    // Reset flag if user scrolls back up (more than 100px from bottom)\r\n    if (scrollPosition < docHeight - 100) {\r\n      endOfPageShown = false;\r\n    }\r\n\r\n    if (!endOfPageShown && scrollPosition >= docHeight - 50 && docHeight > 0) {\r\n      endOfPageShown = true;\r\n      if (typeof window.langStrings.endOfPage === \"string\") {\r\n        createToast(window.langStrings.endOfPage);\r\n      } else if (typeof window.langStrings.endOfPage === \"function\") {\r\n        const msg = window.langStrings.endOfPage();\r\n        if (msg) {createToast(msg);}\r\n      }\r\n    }\r\n    ticking = false;\r\n  }\r\n\r\n  window.addEventListener(\r\n    \"scroll\",\r\n    () => {\r\n      lastScrollY = window.scrollY || window.pageYOffset || 0;\r\n      if (!ticking) {\r\n        window.requestAnimationFrame(checkPageEnd);\r\n        ticking = true;\r\n      }\r\n    },\r\n    { passive: true }\r\n  );\r\n\r\n  // Footer year\r\n  const yearEl =\r\n    document.getElementById(\"current-year\") ||\r\n    document.getElementById(\"footer-year\");\r\n  if (yearEl) {\r\n    yearEl.textContent = new Date().getFullYear();\r\n  }\r\n})();\r\n"]}