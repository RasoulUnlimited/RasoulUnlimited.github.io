{"version":3,"file":"main-script-base.min.js","names":["window","langStrings","storage","testKey","localStorage","setItem","removeItem","err","getSafeStorage","ASSET_FALLBACK_FAILED_CLASS","NETWORK_EVENT_NAME","assetFallbackAttempts","Set","lastNetworkToastAt","darkMediaQuery","matchMedia","prefersDark","matches","THEME_STORAGE_KEY","LEGACY_THEME_STORAGE_KEY","isValidTheme","value","readStoredTheme","storedTheme","getItem","legacyTheme","savedTheme","reduceMotionQuery","prefersReducedMotion","TOAST_EXIT_FALLBACK_MS","TOAST_KIND_ICONS","success","error","info","default","toastRegistry","Map","toastState","top","position","viewport","visible","queue","bottom","normalizeToastOptions","optionsOrType","input","kind","safeKind","String","toLowerCase","normalizeToastKind","type","durationRaw","Number","duration","isFinite","Math","round","id","trim","customClass","iconClass","iconColor","closeButton","role","ariaLive","getToastState","ensureToastViewport","state","isConnected","selector","existing","document","querySelector","HTMLElement","body","createElement","className","dataset","toastPosition","setAttribute","appendChild","removeEntry","collection","entry","index","indexOf","splice","pruneToastState","filter","toast","mounted","stopToastTimers","dismissing","settings","get","delete","timer","clearTimeout","progressAnimation","cancel","applyToastContent","classes","push","join","toastKind","tabIndex","removeAttribute","fragment","createDocumentFragment","icon","text","textContent","message","isFaLocale","documentElement","lang","startsWith","closeBtn","innerHTML","addEventListener","dismissToastEntry","once","progress","replaceChildren","startToastLifecycle","hidden","animate","transform","easing","fill","startToastProgress","setTimeout","mountToastEntry","requestAnimationFrame","classList","add","__ruToastFeedback","flushToastQueue","length","next","shift","remove","finalized","finalize","event","target","createToastEntry","console","warn","has","refreshVisibleToast","targetState","set","createToast","updateNetworkState","online","notify","isOnline","toggle","detail","timestamp","Date","now","dispatchEvent","CustomEvent","createEvent","initCustomEvent","emitNetworkStatusEvent","strings","keyOrder","key","result","getNetworkMessage","resolveAssetFallback","rawUrl","parsed","URL","location","href","origin","toSameOriginUrl","toString","path","pathname","test","replace","markAssetFallbackAttempt","originalUrl","fallbackUrl","currentCount","assetFallbackCount","applyTheme","theme","showToast","isDark","shouldShowToast","getElementById","checked","themeChanged","msg","navigator","onLine","HTMLScriptElement","src","script","defer","async","crossOrigin","referrerPolicy","nonce","insertAdjacentElement","injectScriptFallback","HTMLLinkElement","rel","link","media","injectStylesheetFallback","handleThemeSystemChange","e","addListener","initThemeToggle","themeToggleInput","themeToggleInit","currentTheme","getAttribute","newTheme","preventDefault","endOfPageShown","lastScrollY","ticking","scrollY","pageYOffset","scrollPosition","innerHeight","docHeight","max","scrollHeight","offsetHeight","endOfPage","checkPageEnd","progressBar","scrollTop","clientHeight","style","width","scrollPercent","clamped","min","updateProgressBar","passive","yearEl","getFullYear","backToTopBtn","resolveCopyToastMessage","subject","keys","unsupported","isFa","fallback","resolveShareToastMessage","copyText","options","allowExecCommand","clipboard","writeText","ok","mode","probe","left","select","execCommand","copyWithExecCommand","emitToast","bindCopyButton","btn","HTMLButtonElement","toastCopyBound","stopPropagation","textToCopy","includes","originalIcon","showCopySuccessState","failedKind","scrollTo","behavior","querySelectorAll","forEach","toastShareBound","shareUrl","share","title","url","name","bindShareButton","Element","closest","rect","getBoundingClientRect","x","clientX","y","clientY","ripple","triggerSuccess","element"],"sources":["main-script-base.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  // Ensure language strings object exists\r\n  if (!window.langStrings) {\r\n    window.langStrings = {};\r\n  }\r\n\r\n  /**\r\n   * Safe localStorage accessor with feature / privacy mode detection\r\n   */\r\n  function getSafeStorage() {\r\n    const testKey = \"__theme_pref__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch (err) {\r\n      // e.g. Safari private mode or blocked storage\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\n  const ASSET_FALLBACK_CLASS = \"asset-fallback-active\";\n  const ASSET_FALLBACK_FAILED_CLASS = \"asset-fallback-failed\";\n  const NETWORK_EVENT_NAME = \"ru:network-status\";\n  const assetFallbackAttempts = new Set();\n  let lastNetworkToastAt = 0;\n\r\n  // Reuse a single MediaQueryList if available\r\n  const darkMediaQuery = window.matchMedia\n    ? window.matchMedia(\"(prefers-color-scheme: dark)\")\n    : null;\n  const prefersDark = !!(darkMediaQuery && darkMediaQuery.matches);\n  const THEME_STORAGE_KEY = \"theme\";\n  const LEGACY_THEME_STORAGE_KEY = \"app:theme\";\n\n  function isValidTheme(value) {\n    return value === \"dark\" || value === \"light\";\n  }\n\n  function readStoredTheme() {\n    if (!storage) {return null;}\n\n    const storedTheme = storage.getItem(THEME_STORAGE_KEY);\n    if (isValidTheme(storedTheme)) {\n      return storedTheme;\n    }\n\n    const legacyTheme = storage.getItem(LEGACY_THEME_STORAGE_KEY);\n    if (!isValidTheme(legacyTheme)) {\n      return null;\n    }\n\n    // One-time migration from legacy key to canonical key.\n    try {\n      storage.setItem(THEME_STORAGE_KEY, legacyTheme);\n      storage.removeItem(LEGACY_THEME_STORAGE_KEY);\n    } catch (err) {\n      // Ignore storage failures in restricted environments.\n    }\n\n    return legacyTheme;\n  }\n\n  const savedTheme = readStoredTheme();\n\r\n  // Motion preference (for smooth scroll, etc.)\r\n  const reduceMotionQuery = window.matchMedia\r\n    ? window.matchMedia(\"(prefers-reduced-motion: reduce)\")\r\n    : null;\r\n  const prefersReducedMotion = !!(reduceMotionQuery && reduceMotionQuery.matches);\r\n\r\n  const TOAST_LIMIT_PER_POSITION = 3;\n  const TOAST_DEFAULT_DURATION = 2800;\n  const TOAST_EXIT_FALLBACK_MS = prefersReducedMotion ? 60 : 260;\n  const TOAST_KIND_ICONS = {\n    success: \"fas fa-check-circle\",\n    error: \"fas fa-exclamation-circle\",\n    info: \"fas fa-circle-info\",\n    default: \"fas fa-bell\",\n  };\n  const toastRegistry = new Map();\n  const toastState = {\n    top: {\n      position: \"top\",\n      viewport: null,\n      visible: [],\n      queue: [],\n    },\n    bottom: {\n      position: \"bottom\",\n      viewport: null,\n      visible: [],\n      queue: [],\n    },\n  };\n\n  function normalizeToastKind(kind) {\n    const safeKind = String(kind || \"default\").toLowerCase();\n    if (safeKind === \"success\" || safeKind === \"error\" || safeKind === \"info\") {\n      return safeKind;\n    }\n    return \"default\";\n  }\n\n  function normalizeToastOptions(optionsOrType) {\n    const input =\n      typeof optionsOrType === \"string\"\n        ? { kind: optionsOrType }\n        : optionsOrType && typeof optionsOrType === \"object\"\n          ? optionsOrType\n          : {};\n\n    const kind = normalizeToastKind(input.kind || input.type);\n    const durationRaw = Number(input.duration);\n    const duration =\n      Number.isFinite(durationRaw) && durationRaw >= 0\n        ? Math.round(durationRaw)\n        : TOAST_DEFAULT_DURATION;\n    const id = typeof input.id === \"string\" ? input.id.trim() : \"\";\n    const position = input.position === \"top\" ? \"top\" : \"bottom\";\n    const customClass =\n      typeof input.customClass === \"string\" ? input.customClass.trim() : \"\";\n    const iconClass =\n      typeof input.iconClass === \"string\" && input.iconClass.trim()\n        ? input.iconClass.trim()\n        : TOAST_KIND_ICONS[kind];\n    const iconColor =\n      typeof input.iconColor === \"string\" ? input.iconColor.trim() : \"\";\n    const closeButton = !!input.closeButton;\n    const role =\n      typeof input.role === \"string\" && input.role.trim()\n        ? input.role.trim()\n        : kind === \"error\"\n          ? \"alert\"\n          : \"status\";\n    const ariaLive =\n      typeof input.ariaLive === \"string\" && input.ariaLive.trim()\n        ? input.ariaLive.trim()\n        : kind === \"error\"\n          ? \"assertive\"\n          : \"polite\";\n\n    return {\n      id,\n      kind,\n      duration,\n      position,\n      customClass,\n      iconClass,\n      iconColor,\n      closeButton,\n      role,\n      ariaLive,\n    };\n  }\n\n  function getToastState(position) {\n    return position === \"top\" ? toastState.top : toastState.bottom;\n  }\n\n  function ensureToastViewport(position) {\n    const state = getToastState(position);\n    if (state.viewport && state.viewport.isConnected) {\n      return state.viewport;\n    }\n\n    const selector = `.toast-viewport[data-toast-position=\"${position}\"]`;\n    const existing = document.querySelector(selector);\n    if (existing instanceof HTMLElement) {\n      state.viewport = existing;\n      return state.viewport;\n    }\n\n    if (!document.body) {\n      return null;\n    }\n\n    const viewport = document.createElement(\"div\");\n    viewport.className = \"toast-viewport\";\n    viewport.dataset.toastPosition = position;\n    viewport.setAttribute(\"aria-live\", \"off\");\n    document.body.appendChild(viewport);\n    state.viewport = viewport;\n    return viewport;\n  }\n\n  function removeEntry(collection, entry) {\n    const index = collection.indexOf(entry);\n    if (index >= 0) {\n      collection.splice(index, 1);\n    }\n  }\n\n  function pruneToastState(state) {\n    state.visible = state.visible.filter((entry) => {\n      if (!entry || !(entry.toast instanceof HTMLElement)) {\n        return false;\n      }\n      if (entry.toast.isConnected && entry.mounted) {\n        return true;\n      }\n\n      stopToastTimers(entry);\n      entry.mounted = false;\n      entry.dismissing = false;\n      if (entry.settings.id && toastRegistry.get(entry.settings.id) === entry) {\n        toastRegistry.delete(entry.settings.id);\n      }\n      return false;\n    });\n\n    state.queue = state.queue.filter((entry) => !!entry && !entry.dismissing);\n  }\n\n  function stopToastTimers(entry) {\n    if (entry.timer) {\n      clearTimeout(entry.timer);\n      entry.timer = null;\n    }\n    if (entry.progressAnimation) {\n      try {\n        entry.progressAnimation.cancel();\n      } catch {}\n      entry.progressAnimation = null;\n    }\n  }\n\n  function applyToastContent(entry) {\n    const { settings, toast } = entry;\n    const classes = [\"dynamic-toast\", `toast-kind-${settings.kind}`];\n    if (settings.customClass) {\n      classes.push(settings.customClass);\n    }\n    toast.className = classes.join(\" \");\n    toast.dataset.toastKind = settings.kind;\n    toast.dataset.toastPosition = settings.position;\n    toast.setAttribute(\"role\", settings.role);\n    toast.setAttribute(\"aria-live\", settings.ariaLive);\n    toast.setAttribute(\"aria-atomic\", \"true\");\n    toast.tabIndex = -1;\n    if (settings.id) {\n      toast.id = settings.id;\n    } else {\n      toast.removeAttribute(\"id\");\n    }\n\n    const fragment = document.createDocumentFragment();\n    if (settings.iconClass) {\n      const icon = document.createElement(\"i\");\n      icon.className = `${settings.iconClass} toast-icon`.trim();\n      if (settings.iconColor) {\n        icon.dataset.iconColor = settings.iconColor;\n      }\n      icon.setAttribute(\"aria-hidden\", \"true\");\n      fragment.appendChild(icon);\n    }\n\n    const text = document.createElement(\"span\");\n    text.className = \"toast-message\";\n    text.textContent = entry.message;\n    fragment.appendChild(text);\n\n    if (settings.closeButton) {\n      const isFaLocale = (document.documentElement.lang || \"\")\n        .toLowerCase()\n        .startsWith(\"fa\");\n      const closeBtn = document.createElement(\"button\");\n      closeBtn.type = \"button\";\n      closeBtn.className = \"toast-close\";\n      closeBtn.setAttribute(\n        \"aria-label\",\n        isFaLocale ? \"بستن پیام\" : \"Close message\"\n      );\n      closeBtn.innerHTML = '<i class=\"fas fa-times\" aria-hidden=\"true\"></i>';\n      closeBtn.addEventListener(\n        \"click\",\n        () => dismissToastEntry(entry),\n        { once: true }\n      );\n      fragment.appendChild(closeBtn);\n    }\n\n    const progress = document.createElement(\"span\");\n    progress.className = \"toast-progress\";\n    progress.setAttribute(\"aria-hidden\", \"true\");\n    fragment.appendChild(progress);\n\n    toast.replaceChildren(fragment);\n  }\n\n  function startToastProgress(entry) {\n    const progress = entry.toast.querySelector(\".toast-progress\");\n    if (!(progress instanceof HTMLElement)) {\n      return;\n    }\n\n    progress.hidden = entry.settings.duration <= 0;\n    if (prefersReducedMotion || entry.settings.duration <= 0) {\n      return;\n    }\n\n    if (typeof progress.animate !== \"function\") {\n      return;\n    }\n\n    try {\n      entry.progressAnimation = progress.animate(\n        [\n          { transform: \"scaleX(1)\" },\n          { transform: \"scaleX(0)\" },\n        ],\n        {\n          duration: entry.settings.duration,\n          easing: \"linear\",\n          fill: \"forwards\",\n        }\n      );\n    } catch {}\n  }\n\n  function startToastLifecycle(entry) {\n    stopToastTimers(entry);\n    startToastProgress(entry);\n\n    if (entry.settings.duration > 0) {\n      entry.timer = setTimeout(() => {\n        dismissToastEntry(entry);\n      }, entry.settings.duration);\n    }\n  }\n\n  function refreshVisibleToast(entry) {\n    if (!entry.mounted || !entry.toast) {\n      return;\n    }\n\n    entry.dismissing = false;\n    applyToastContent(entry);\n    entry.toast.classList.add(\"show\");\n    entry.toast.classList.remove(\"is-closing\");\n    startToastLifecycle(entry);\n  }\n\n  function mountToastEntry(entry) {\n    const state = entry.state || getToastState(entry.settings.position);\n    const viewport = ensureToastViewport(state.position);\n    if (!viewport) {\n      return;\n    }\n\n    entry.state = state;\n    entry.mounted = true;\n    entry.dismissing = false;\n    applyToastContent(entry);\n    viewport.appendChild(entry.toast);\n    state.visible.push(entry);\n\n    requestAnimationFrame(() => {\n      if (!entry.mounted) {\n        return;\n      }\n\n      entry.toast.classList.add(\"show\");\n      startToastLifecycle(entry);\n\n      if (typeof window.__ruToastFeedback === \"function\") {\n        try {\n          window.__ruToastFeedback();\n        } catch {}\n      }\n    });\n  }\n\n  function flushToastQueue(position) {\n    const state = getToastState(position);\n    ensureToastViewport(position);\n    pruneToastState(state);\n\n    while (\n      state.visible.length < TOAST_LIMIT_PER_POSITION &&\n      state.queue.length > 0\n    ) {\n      const next = state.queue.shift();\n      if (!next) {\n        continue;\n      }\n\n      if (next.dismissing) {\n        continue;\n      }\n\n      mountToastEntry(next);\n    }\n  }\n\n  function dismissToastEntry(entry) {\n    if (!entry || entry.dismissing) {\n      return;\n    }\n\n    entry.dismissing = true;\n    stopToastTimers(entry);\n\n    if (!entry.mounted || !(entry.toast instanceof HTMLElement)) {\n      const queuedState = entry.state || getToastState(entry.settings.position);\n      removeEntry(queuedState.queue, entry);\n      if (entry.settings.id && toastRegistry.get(entry.settings.id) === entry) {\n        toastRegistry.delete(entry.settings.id);\n      }\n      entry.dismissing = false;\n      return;\n    }\n\n    const { toast } = entry;\n    toast.classList.remove(\"show\");\n    toast.classList.add(\"is-closing\");\n\n    let finalized = false;\n    const finalize = () => {\n      if (finalized) {\n        return;\n      }\n      finalized = true;\n\n      const state = entry.state || getToastState(entry.settings.position);\n      removeEntry(state.visible, entry);\n      removeEntry(state.queue, entry);\n      if (entry.settings.id && toastRegistry.get(entry.settings.id) === entry) {\n        toastRegistry.delete(entry.settings.id);\n      }\n      toast.remove();\n      entry.mounted = false;\n      entry.dismissing = false;\n      flushToastQueue(state.position);\n    };\n\n    toast.addEventListener(\n      \"transitionend\",\n      (event) => {\n        if (event.target === toast) {\n          finalize();\n        }\n      },\n      { once: true }\n    );\n    setTimeout(finalize, TOAST_EXIT_FALLBACK_MS);\n  }\n\n  function createToastEntry(message, optionsOrType) {\n    if (!message && message !== 0) {\n      return null;\n    }\n    if (!document.body) {\n      console.warn(\"Cannot show toast: document.body not ready\");\n      return null;\n    }\n\n    const settings = normalizeToastOptions(optionsOrType);\n    const text = String(message);\n\n    pruneToastState(toastState.top);\n    pruneToastState(toastState.bottom);\n\n    if (settings.id && toastRegistry.has(settings.id)) {\n      const entry = toastRegistry.get(settings.id);\n      entry.message = text;\n      entry.settings = {\n        ...entry.settings,\n        ...settings,\n        position: entry.mounted ? entry.settings.position : settings.position,\n      };\n\n      if (entry.mounted) {\n        refreshVisibleToast(entry);\n        return entry;\n      }\n\n      const targetState = getToastState(entry.settings.position);\n      removeEntry(toastState.top.queue, entry);\n      removeEntry(toastState.bottom.queue, entry);\n      entry.state = targetState;\n      targetState.queue.push(entry);\n      flushToastQueue(targetState.position);\n      return entry;\n    }\n\n    const entry = {\n      message: text,\n      settings,\n      state: getToastState(settings.position),\n      toast: document.createElement(\"div\"),\n      timer: null,\n      progressAnimation: null,\n      dismissing: false,\n      mounted: false,\n    };\n\n    if (settings.id) {\n      toastRegistry.set(settings.id, entry);\n    }\n\n    entry.state.queue.push(entry);\n    flushToastQueue(entry.state.position);\n    return entry;\n  }\n\n  /**\n   * Unified toast API.\n   * Backward compatible signatures:\n   *  - createToast(message, \"success\"|\"error\"|\"info\"|\"default\")\n   *  - createToast(message, options)\n   */\n  function createToast(message, optionsOrType) {\n    const entry = createToastEntry(message, optionsOrType);\n    return entry ? entry.toast : null;\n  }\n\n  // Expose the unified toast API globally.\n  window.createToast = createToast;\n\n  function getNetworkMessage(online) {\n    const strings = window.langStrings || {};\n    const keyOrder = online\n      ? [\"backOnline\", \"online\", \"connectionRestored\"]\n      : [\"offline\", \"connectionLost\"];\n\n    for (const key of keyOrder) {\n      const value = strings[key];\n      if (typeof value === \"function\") {\n        const result = value();\n        if (typeof result === \"string\" && result.trim()) {\n          return result;\n        }\n      } else if (typeof value === \"string\" && value.trim()) {\n        return value;\n      }\n    }\n\n    return online\n      ? \"Connection restored.\"\n      : \"You are offline. Some features may be unavailable.\";\n  }\n\n  function emitNetworkStatusEvent(online) {\n    const detail = { online, timestamp: Date.now() };\n    try {\n      window.dispatchEvent(\n        new CustomEvent(NETWORK_EVENT_NAME, {\n          detail,\n        })\n      );\n    } catch (err) {\n      // CustomEvent fallback for old browsers.\n      try {\n        const event = document.createEvent(\"CustomEvent\");\n        event.initCustomEvent(NETWORK_EVENT_NAME, false, false, detail);\n        window.dispatchEvent(event);\n      } catch {}\n    }\n  }\n\n  function updateNetworkState(online, notify) {\n    const isOnline = !!online;\n\n    document.documentElement.classList.toggle(\"online\", isOnline);\n    document.documentElement.classList.toggle(\"offline\", !isOnline);\n    document.documentElement.setAttribute(\"data-network-status\", isOnline ? \"online\" : \"offline\");\n\n    if (document.body) {\n      document.body.classList.toggle(\"online\", isOnline);\n      document.body.classList.toggle(\"offline\", !isOnline);\n    }\n\n    emitNetworkStatusEvent(isOnline);\n\n    if (!notify || typeof window.createToast !== \"function\") {\n      return;\n    }\n\n    const now = Date.now();\n    if (now - lastNetworkToastAt < 1200) {\n      return;\n    }\n    lastNetworkToastAt = now;\n    window.createToast(getNetworkMessage(isOnline), {\n      id: \"network-status-toast\",\n      kind: isOnline ? \"success\" : \"info\",\n      duration: 2600,\n    });\n  }\n\n  function installNetworkResilience() {\n    const initialOnline = navigator.onLine !== false;\n    updateNetworkState(initialOnline, false);\n    window.addEventListener(\"online\", () => updateNetworkState(true, true));\n    window.addEventListener(\"offline\", () => updateNetworkState(false, true));\n  }\n\n  function toSameOriginUrl(rawUrl) {\n    if (!rawUrl) {\n      return null;\n    }\n\n    try {\n      const parsed = new URL(rawUrl, window.location.href);\n      if (parsed.origin !== window.location.origin) {\n        return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function resolveAssetFallback(rawUrl) {\n    const parsed = toSameOriginUrl(rawUrl);\n    if (!parsed) {\n      return null;\n    }\n\n    const next = new URL(parsed.toString());\n    const path = next.pathname;\n\n    if (/\\.min\\.js$/i.test(path)) {\n      next.pathname = path.replace(/\\.min\\.js$/i, \".js\");\n      return next.toString();\n    }\n\n    if (/\\.min\\.css$/i.test(path)) {\n      next.pathname = path.replace(/\\.min\\.css$/i, \".css\");\n      return next.toString();\n    }\n\n    return null;\n  }\n\n  function markAssetFallbackAttempt(target, originalUrl, fallbackUrl) {\n    const key = `${originalUrl}::${fallbackUrl}`;\n    if (assetFallbackAttempts.has(key)) {\n      return false;\n    }\n\n    assetFallbackAttempts.add(key);\n    target.setAttribute(\"data-asset-failed\", \"true\");\n    document.documentElement.classList.add(ASSET_FALLBACK_CLASS);\n    const currentCount = Number(document.documentElement.dataset.assetFallbackCount || \"0\");\n    document.documentElement.dataset.assetFallbackCount = String(currentCount + 1);\n    return true;\n  }\n\n  function injectScriptFallback(target, fallbackUrl) {\n    const script = document.createElement(\"script\");\n    script.src = fallbackUrl;\n    script.defer = !!target.defer;\n    script.async = !!target.async;\n    if (target.type) {\n      script.type = target.type;\n    }\n    if (target.crossOrigin) {\n      script.crossOrigin = target.crossOrigin;\n    }\n    if (target.referrerPolicy) {\n      script.referrerPolicy = target.referrerPolicy;\n    }\n    if (target.nonce) {\n      script.nonce = target.nonce;\n    }\n    script.setAttribute(\"data-asset-fallback\", \"true\");\n    script.setAttribute(\"data-asset-fallback-from\", target.src || \"\");\n    script.addEventListener(\n      \"error\",\n      () => {\n        document.documentElement.classList.add(ASSET_FALLBACK_FAILED_CLASS);\n      },\n      { once: true }\n    );\n    target.insertAdjacentElement(\"afterend\", script);\n  }\n\n  function injectStylesheetFallback(target, fallbackUrl) {\n    if ((target.rel || \"\").toLowerCase() !== \"stylesheet\") {\n      return;\n    }\n\n    const link = document.createElement(\"link\");\n    link.rel = \"stylesheet\";\n    link.href = fallbackUrl;\n    if (target.media) {\n      link.media = target.media;\n    }\n    if (target.crossOrigin) {\n      link.crossOrigin = target.crossOrigin;\n    }\n    if (target.referrerPolicy) {\n      link.referrerPolicy = target.referrerPolicy;\n    }\n    if (target.nonce) {\n      link.nonce = target.nonce;\n    }\n    link.setAttribute(\"data-asset-fallback\", \"true\");\n    link.setAttribute(\"data-asset-fallback-from\", target.href || \"\");\n    link.addEventListener(\n      \"error\",\n      () => {\n        document.documentElement.classList.add(ASSET_FALLBACK_FAILED_CLASS);\n      },\n      { once: true }\n    );\n    target.insertAdjacentElement(\"afterend\", link);\n  }\n\n  function installAssetFallbackResilience() {\n    window.addEventListener(\n      \"error\",\n      (event) => {\n        const target = event.target;\n        if (!target || target === window) {\n          return;\n        }\n\n        if (\n          typeof HTMLScriptElement !== \"undefined\" &&\n          target instanceof HTMLScriptElement\n        ) {\n          const originalUrl = target.src || \"\";\n          const fallbackUrl = resolveAssetFallback(originalUrl);\n          if (!fallbackUrl) {\n            return;\n          }\n\n          if (!markAssetFallbackAttempt(target, originalUrl, fallbackUrl)) {\n            return;\n          }\n\n          injectScriptFallback(target, fallbackUrl);\n          return;\n        }\n\n        if (\n          typeof HTMLLinkElement !== \"undefined\" &&\n          target instanceof HTMLLinkElement\n        ) {\n          const originalUrl = target.href || \"\";\n          const fallbackUrl = resolveAssetFallback(originalUrl);\n          if (!fallbackUrl) {\n            return;\n          }\n\n          if (!markAssetFallbackAttempt(target, originalUrl, fallbackUrl)) {\n            return;\n          }\n\n          injectStylesheetFallback(target, fallbackUrl);\n        }\n      },\n      true\n    );\n  }\n\n  installNetworkResilience();\n  installAssetFallbackResilience();\n\r\n  /**\r\n   * Apply theme and sync toggle + a11y attributes.\r\n   * @param {\"dark\"|\"light\"} theme\r\n   * @param {boolean} [showToast=false]\r\n   */\r\n  function applyTheme(theme, showToast) {\r\n    const isDark = theme === \"dark\";\r\n    const shouldShowToast = !!showToast;\r\n\r\n    document.body.classList.toggle(\"dark-mode\", isDark);\r\n    document.body.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    // Optional: expose theme on <html> for CSS theming\r\n    document.documentElement.setAttribute(\"data-theme\", theme);\r\n\r\n    const toggle = document.getElementById(\"theme-toggle\");\r\n    if (toggle) {\r\n      toggle.checked = isDark;\r\n      toggle.setAttribute(\"aria-checked\", String(isDark));\r\n    }\r\n\r\n    if (\r\n      shouldShowToast &&\r\n      typeof window.langStrings.themeChanged === \"function\"\r\n    ) {\r\n      // themeChanged(theme) → localized message\r\n      const msg = window.langStrings.themeChanged(theme);\n      if (msg) {\n        createToast(msg, {\n          id: \"theme-toast\",\n          kind: \"info\",\n          customClass: \"theme-toast\",\n          duration: 1800,\n          position: \"top\",\n        });\n      }\n    }\r\n  }\r\n\r\n  // Initial theme: stored preference > system preference\r\n  if (savedTheme === \"dark\" || savedTheme === \"light\") {\r\n    applyTheme(savedTheme);\r\n  } else {\r\n    applyTheme(prefersDark ? \"dark\" : \"light\");\r\n  }\r\n\r\n  // React to OS theme changes only if user has not explicitly chosen a theme\r\n  if (darkMediaQuery) {\n    const handleThemeSystemChange = function (e) {\n      // If user later sets a theme, this check prevents overriding it\n      if (!readStoredTheme()) {\n        applyTheme(e.matches ? \"dark\" : \"light\");\n      }\n    };\n\r\n    if (typeof darkMediaQuery.addEventListener === \"function\") {\r\n      darkMediaQuery.addEventListener(\"change\", handleThemeSystemChange);\r\n    } else if (typeof darkMediaQuery.addListener === \"function\") {\r\n      // Older browsers\r\n      darkMediaQuery.addListener(handleThemeSystemChange);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize theme toggle (can be called multiple times safely).\r\n   */\r\n  function initThemeToggle() {\n    const themeToggleInput = document.getElementById(\"theme-toggle\");\n    if (!themeToggleInput) {return;}\n\r\n    // Avoid attaching listeners multiple times on dynamic includes\r\n    if (themeToggleInput.dataset.themeToggleInit === \"true\") {\r\n      return;\r\n    }\r\n    themeToggleInput.dataset.themeToggleInit = \"true\";\n\n    const currentTheme = document.documentElement.getAttribute(\"data-theme\");\n    if (currentTheme === \"dark\" || currentTheme === \"light\") {\n      themeToggleInput.checked = currentTheme === \"dark\";\n    }\n\n    // Sync ARIA\n    themeToggleInput.setAttribute(\n      \"aria-checked\",\n      String(!!themeToggleInput.checked)\n    );\n    themeToggleInput.setAttribute(\"role\", \"switch\");\r\n\r\n    // Change by click\r\n    themeToggleInput.addEventListener(\"change\", () => {\n      const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\n      applyTheme(newTheme, true);\n      try {\n        storage?.setItem(THEME_STORAGE_KEY, newTheme);\n      } catch (err) {\n        // Ignore storage failures (e.g., private mode)\n      }\n    });\r\n\r\n    // Keyboard accessibility (Space / Enter)\r\n    themeToggleInput.addEventListener(\"keydown\", (event) => {\r\n      if (event.key === \" \" || event.key === \"Enter\") {\r\n        event.preventDefault();\r\n        themeToggleInput.checked = !themeToggleInput.checked;\n        const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\n        applyTheme(newTheme, true);\n        try {\n          storage?.setItem(THEME_STORAGE_KEY, newTheme);\n        } catch (err) {}\n      }\n    });\n  }\r\n\r\n  // Init theme toggle on first load\r\n  initThemeToggle();\r\n  // Re-init if header/footer includes loaded dynamically\r\n  document.addEventListener(\"includesLoaded\", initThemeToggle, false);\r\n\r\n  // ---- End-of-page toast logic ----\r\n\r\n  let endOfPageShown = false;\r\n  let lastScrollY = 0;\r\n  let ticking = false;\r\n\r\n  function checkPageEnd() {\r\n    const scrollPosition = window.innerHeight + lastScrollY;\r\n    const docHeight =\r\n      Math.max(\r\n        document.body.scrollHeight,\r\n        document.documentElement.scrollHeight,\r\n        document.body.offsetHeight,\r\n        document.documentElement.offsetHeight\r\n      ) || 0;\r\n\r\n    // Reset flag if user scrolls back up (more than 100px from bottom)\r\n    if (scrollPosition < docHeight - 100) {\r\n      endOfPageShown = false;\r\n    }\r\n\r\n    if (!endOfPageShown && scrollPosition >= docHeight - 50 && docHeight > 0) {\r\n      endOfPageShown = true;\r\n      if (typeof window.langStrings.endOfPage === \"string\") {\n        createToast(window.langStrings.endOfPage, {\n          id: \"end-of-page-toast\",\n          kind: \"info\",\n          customClass: \"end-of-page-toast\",\n          duration: 3200,\n        });\n      } else if (typeof window.langStrings.endOfPage === \"function\") {\n        const msg = window.langStrings.endOfPage();\n        if (msg) {\n          createToast(msg, {\n            id: \"end-of-page-toast\",\n            kind: \"info\",\n            customClass: \"end-of-page-toast\",\n            duration: 3200,\n          });\n        }\n      }\n    }\r\n    ticking = false;\r\n  }\r\n\r\n  function updateProgressBar() {\r\n    const progressBar = document.getElementById(\"scroll-progress-bar\");\r\n    if (!progressBar) {return;}\r\n\r\n    const scrollTop =\r\n      window.scrollY || document.documentElement.scrollTop || 0;\r\n    const docHeight =\r\n      document.documentElement.scrollHeight -\r\n      document.documentElement.clientHeight;\r\n\r\n    if (docHeight <= 0) {\r\n      progressBar.style.width = \"0%\";\r\n      progressBar.setAttribute(\"aria-valuenow\", \"0\");\r\n      return;\r\n    }\r\n\r\n    const scrollPercent = (scrollTop / docHeight) * 100;\r\n    const clamped = Math.max(0, Math.min(100, scrollPercent));\r\n\r\n    progressBar.style.width = clamped + \"%\";\r\n    progressBar.setAttribute(\"aria-valuenow\", Math.round(clamped));\r\n  }\r\n\r\n  window.addEventListener(\r\n    \"scroll\",\r\n    () => {\r\n      lastScrollY = window.scrollY || window.pageYOffset || 0;\r\n      if (!ticking) {\r\n        window.requestAnimationFrame(() => {\r\n          checkPageEnd();\r\n          updateProgressBar();\r\n        });\r\n        ticking = true;\r\n      }\r\n    },\r\n    { passive: true }\r\n  );\r\n\r\n  // Footer year\r\n  const yearEl =\r\n    document.getElementById(\"current-year\") ||\r\n    document.getElementById(\"footer-year\");\r\n  if (yearEl) {\r\n    yearEl.textContent = new Date().getFullYear();\r\n  }\r\n\r\n  // Back to Top Button Logic\r\n  const backToTopBtn = document.getElementById(\"back-to-top\");\r\n  if (backToTopBtn) {\r\n    window.addEventListener(\r\n      \"scroll\",\r\n      () => {\r\n        if (window.scrollY > 300) {\r\n          backToTopBtn.classList.add(\"show\");\r\n        } else {\r\n          backToTopBtn.classList.remove(\"show\");\r\n        }\r\n      },\r\n      { passive: true }\r\n    );\r\n\r\n    backToTopBtn.addEventListener(\"click\", () => {\r\n      window.scrollTo({\r\n        top: 0,\r\n        behavior: prefersReducedMotion ? \"auto\" : \"smooth\",\r\n      });\r\n    });\r\n  }\r\n\r\n  function resolveCopyToastMessage(kind, subject = \"email\") {\n    const strings = window.langStrings || {};\n    const keyOrder = {\n      success:\n        subject === \"link\"\n          ? [\"linkCopied\", \"copySuccess\"]\n          : [\"copySuccess\", \"emailCopied\"],\n      error: [\"copyError\", \"emailCopyError\"],\n      unsupported: [\"copyUnsupported\", \"clipboardUnsupported\"],\n    };\n\r\n    const keys = keyOrder[kind] || [];\r\n    for (const key of keys) {\r\n      const value = strings[key];\r\n      if (typeof value === \"function\") {\r\n        const message = value();\r\n        if (typeof message === \"string\" && message.trim()) {return message;}\r\n      } else if (typeof value === \"string\" && value.trim()) {\r\n        return value;\r\n      }\r\n    }\r\n\r\n    const isFa = (document.documentElement.lang || \"\")\r\n      .toLowerCase()\r\n      .startsWith(\"fa\");\r\n\r\n    const fallback = {\n      success: isFa\n        ? subject === \"link\"\n          ? \"\\u0644\\u06cc\\u0646\\u06a9 \\u06a9\\u067e\\u06cc \\u0634\\u062f.\"\n          : \"\\u0627\\u06cc\\u0645\\u06cc\\u0644 \\u06a9\\u067e\\u06cc \\u0634\\u062f.\"\n        : subject === \"link\"\n          ? \"Link copied.\"\n          : \"Email copied.\",\n      error: isFa\n        ? \"\\u06a9\\u067e\\u06cc \\u0628\\u0627 \\u0645\\u0634\\u06a9\\u0644 \\u0645\\u0648\\u0627\\u062c\\u0647 \\u0634\\u062f.\"\n        : \"Copy failed.\",\n      unsupported: isFa\r\n        ? \"\\u0645\\u0631\\u0648\\u0631\\u06af\\u0631 \\u0634\\u0645\\u0627 \\u0627\\u0632 \\u06a9\\u067e\\u06cc \\u062e\\u0648\\u062f\\u06a9\\u0627\\u0631 \\u067e\\u0634\\u062a\\u06cc\\u0628\\u0627\\u0646\\u06cc \\u0646\\u0645\\u06cc\\u200c\\u06a9\\u0646\\u062f.\"\r\n        : \"Your browser does not support automatic copy.\",\r\n    };\r\n\r\n    return fallback[kind] || fallback.error;\n  }\n\n  function resolveShareToastMessage(kind) {\n    const strings = window.langStrings || {};\n    const keyOrder = {\n      success: [\"shareOk\", \"shareSuccess\"],\n      error: [\"shareErr\", \"shareError\"],\n    };\n    const keys = keyOrder[kind] || [];\n\n    for (const key of keys) {\n      const value = strings[key];\n      if (typeof value === \"function\") {\n        const message = value();\n        if (typeof message === \"string\" && message.trim()) {\n          return message;\n        }\n      } else if (typeof value === \"string\" && value.trim()) {\n        return value;\n      }\n    }\n\n    const isFa = (document.documentElement.lang || \"\")\n      .toLowerCase()\n      .startsWith(\"fa\");\n    const fallback = {\n      success: isFa\n        ? \"\\u0627\\u0634\\u062a\\u0631\\u0627\\u06a9\\u200c\\u06af\\u0630\\u0627\\u0631\\u06cc \\u0645\\u0648\\u0641\\u0642 \\u0628\\u0648\\u062f.\"\n        : \"Shared successfully.\",\n      error: isFa\n        ? \"\\u0627\\u0634\\u062a\\u0631\\u0627\\u06a9\\u200c\\u06af\\u0630\\u0627\\u0631\\u06cc \\u0628\\u0627 \\u0645\\u0634\\u06a9\\u0644 \\u0645\\u0648\\u0627\\u062c\\u0647 \\u0634\\u062f.\"\n        : \"Sharing failed.\",\n    };\n\n    return fallback[kind] || fallback.error;\n  }\n\n  function copyWithExecCommand(text) {\n    if (!document.body) {\n      return false;\n    }\n\n    const probe = document.createElement(\"textarea\");\n    probe.value = text;\n    probe.setAttribute(\"readonly\", \"\");\n    probe.setAttribute(\"aria-hidden\", \"true\");\n    probe.style.position = \"absolute\";\n    probe.style.left = \"-9999px\";\n    probe.style.top = \"0\";\n    document.body.appendChild(probe);\n    probe.select();\n\n    try {\n      return !!document.execCommand(\"copy\");\n    } catch {\n      return false;\n    } finally {\n      probe.remove();\n    }\n  }\n\n  async function copyText(text, options = {}) {\n    const allowExecCommand = options.allowExecCommand === true;\n\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n      try {\n        await navigator.clipboard.writeText(text);\n        return { ok: true, mode: \"clipboard\" };\n      } catch {}\n    }\n\n    if (allowExecCommand && copyWithExecCommand(text)) {\n      return { ok: true, mode: \"exec-command\" };\n    }\n\n    return {\n      ok: false,\n      mode:\n        navigator.clipboard && navigator.clipboard.writeText\n          ? \"clipboard-failed\"\n          : \"unsupported\",\n    };\n  }\n\n  function emitToast(message, options) {\n    if (!message || typeof window.createToast !== \"function\") {\n      return;\n    }\n    window.createToast(message, options);\n  }\n\n  function showCopySuccessState(btn) {\n    const originalIcon = btn.innerHTML;\n    btn.innerHTML =\n      '<i class=\"fas fa-check\" aria-hidden=\"true\"></i>';\n    btn.classList.add(\"copied\");\n\n    setTimeout(() => {\n      btn.innerHTML = originalIcon;\n      btn.classList.remove(\"copied\");\n    }, 2000);\n  }\n\n  function bindCopyButton(btn) {\n    if (!(btn instanceof HTMLButtonElement)) {\n      return;\n    }\n    if (btn.dataset.toastCopyBound === \"true\") {\n      return;\n    }\n    btn.dataset.toastCopyBound = \"true\";\n\n    btn.addEventListener(\"click\", async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const textToCopy = btn.getAttribute(\"data-copy\");\n      if (!textToCopy) {\n        console.warn(\"No data-copy attribute found on .copy-btn\");\n        return;\n      }\n      const subject = textToCopy.includes(\"@\") ? \"email\" : \"link\";\n\n      const result = await copyText(textToCopy, {\n        allowExecCommand: false,\n      });\n      if (result.ok) {\n        showCopySuccessState(btn);\n        emitToast(resolveCopyToastMessage(\"success\", subject), {\n          id: \"copy-success-toast\",\n          kind: \"success\",\n          duration: 1800,\n        });\n        return;\n      }\n\n      const failedKind =\n        result.mode === \"unsupported\"\n          ? \"unsupported\"\n          : \"error\";\n      emitToast(resolveCopyToastMessage(failedKind), {\n        id:\n          failedKind === \"unsupported\"\n            ? \"copy-unsupported-toast\"\n            : \"copy-error-toast\",\n        kind: failedKind === \"unsupported\" ? \"info\" : \"error\",\n        duration: failedKind === \"unsupported\" ? 3000 : 2600,\n      });\n    });\n  }\n\n  function bindShareButton(btn) {\n    if (!(btn instanceof HTMLButtonElement)) {\n      return;\n    }\n    if (btn.dataset.toastShareBound === \"true\") {\n      return;\n    }\n    btn.dataset.toastShareBound = \"true\";\n\n    btn.addEventListener(\"click\", async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const shareUrl = btn.getAttribute(\"data-share\") || window.location.href;\n      if (!shareUrl) {\n        return;\n      }\n\n      if (typeof navigator.share === \"function\") {\n        try {\n          await navigator.share({\n            title: document.title,\n            url: shareUrl,\n          });\n          emitToast(resolveShareToastMessage(\"success\"), {\n            id: \"share-success-toast\",\n            kind: \"success\",\n            duration: 1800,\n          });\n          return;\n        } catch (err) {\n          if (err && err.name === \"AbortError\") {\n            return;\n          }\n        }\n      }\n\n      const copied = await copyText(shareUrl, {\n        allowExecCommand: true,\n      });\n      if (copied.ok) {\n        emitToast(resolveCopyToastMessage(\"success\", \"link\"), {\n          id: \"share-copy-toast\",\n          kind: \"success\",\n          duration: 2000,\n        });\n        return;\n      }\n\n      emitToast(resolveShareToastMessage(\"error\"), {\n        id: \"share-error-toast\",\n        kind: \"error\",\n        duration: 2800,\n      });\n    });\n  }\n\n  // Copy/share interactions (global + proof cards)\n  document.querySelectorAll(\".copy-btn\").forEach((btn) => {\n    bindCopyButton(btn);\n  });\n  document.querySelectorAll(\".share-btn\").forEach((btn) => {\n    bindShareButton(btn);\n  });\n\r\n  // ---- Neurodesign Enhancements Initialization ----\r\n\r\n  // 1. Scroll Progress Bar Logic is handled by updateProgressBar() and existing HTML\r\n\r\n  // 2. Ripple Effect for Buttons\n  document.addEventListener(\"click\", function (e) {\n    const origin = e.target;\n    if (!(origin instanceof Element)) {\n      return;\n    }\n\n    const target = origin.closest(\".btn, button, .cta-button, .hero-btn\");\n    if (target) {\n      const rect = target.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n\r\n      const ripple = document.createElement(\"span\");\r\n      ripple.className = \"ripple\";\r\n      ripple.style.left = `${x}px`;\r\n      ripple.style.top = `${y}px`;\r\n\r\n      target.appendChild(ripple);\r\n\r\n      setTimeout(() => {\r\n        ripple.remove();\r\n      }, 600);\r\n    }\r\n  });\r\n\r\n  // 3. Success Trigger Helper\r\n  window.triggerSuccess = function (element) {\r\n    if (!element) {return;}\r\n    element.classList.add(\"success-trigger\");\r\n    setTimeout(() => {\r\n      element.classList.remove(\"success-trigger\");\r\n    }, 300);\r\n  };\r\n\r\n})();\r\n"]}