{"version":3,"file":"main-script-base.min.js","names":["window","langStrings","storage","testKey","localStorage","setItem","removeItem","err","getSafeStorage","ASSET_FALLBACK_FAILED_CLASS","NETWORK_EVENT_NAME","assetFallbackAttempts","Set","lastNetworkToastAt","darkMediaQuery","matchMedia","prefersDark","matches","THEME_STORAGE_KEY","LEGACY_THEME_STORAGE_KEY","isValidTheme","value","readStoredTheme","storedTheme","getItem","legacyTheme","savedTheme","reduceMotionQuery","prefersReducedMotion","TOAST_EXIT_FALLBACK_MS","TOAST_STACK_SHIFTS_BOTTOM","TOAST_STACK_SHIFTS_TOP","TOAST_STACK_SCALE_LOSS","TOAST_KIND_ICONS","success","error","info","default","toastRegistry","Map","toastState","top","position","viewport","visible","queue","bottom","toastKeyboardShortcutsInstalled","normalizeToastOptions","optionsOrType","input","kind","safeKind","String","toLowerCase","normalizeToastKind","type","durationRaw","Number","duration","isFinite","Math","round","id","trim","customClass","iconClass","iconColor","closeButton","role","ariaLive","swipeDismiss","getToastState","ensureToastViewport","state","isConnected","selector","existing","document","querySelector","HTMLElement","body","createElement","className","dataset","toastPosition","setAttribute","appendChild","isSwipeEnabled","entry","setting","settings","touchCapable","navigator","maxTouchPoints","canUseToastSwipe","parseCssTimeToMs","token","endsWith","parseFloat","syncToastStack","Array","isArray","length","shifts","slice","reverse","forEach","index","toast","shift","min","scaleLoss","maxDepthIndex","max","TOAST_LIMIT_PER_POSITION","depth","style","setProperty","toFixed","removeEntry","collection","indexOf","splice","pruneToastState","filter","mounted","stopToastTimers","releaseToastInteractions","dismissing","get","delete","timer","clearTimeout","progressAnimation","cancel","lifecycleStartedAt","getEntryRemainingDuration","remainingDuration","pauseToastLifecycle","lifecyclePaused","baseDuration","elapsed","Date","now","resumeToastLifecycle","startToastLifecycle","useRemaining","installToastInteractions","interactionsInstalled","onPointerEnter","onPointerLeave","onFocusIn","onFocusOut","event","next","relatedTarget","Node","contains","onKeyDown","key","stopPropagation","dismissToastEntry","addEventListener","interactionsCleanup","removeEventListener","stopSwipeRebound","swipe","reboundTimer","resetSwipeState","classList","remove","releaseToastSwipe","cleanup","applyToastContent","classes","push","join","toastKind","tabIndex","removeAttribute","fragment","createDocumentFragment","icon","text","textContent","message","isFaLocale","documentElement","lang","startsWith","closeBtn","innerHTML","once","progress","replaceChildren","options","durationOverride","hidden","animate","transform","easing","fill","startToastProgress","setTimeout","mountToastEntry","lastMountedAt","pointerId","active","startX","startY","startAt","lastX","lastY","lastAt","onPointerDown","isPrimary","button","target","Element","closest","clientX","clientY","add","setPointerCapture","onPointerMove","dx","dy","abs","completeSwipe","velocity","absDx","absDy","direction","targetOffset","innerWidth","onPointerCancel","installToastSwipe","requestAnimationFrame","__ruToastFeedback","flushToastQueue","finalized","finalize","getComputedStyle","durations","transitionDuration","split","delays","transitionDelay","totalTokens","longest","durationToken","delayToken","total","getToastExitFallbackMs","createToastEntry","console","warn","has","refreshVisibleToast","targetState","set","createToast","updateNetworkState","online","notify","isOnline","toggle","detail","timestamp","dispatchEvent","CustomEvent","createEvent","initCustomEvent","emitNetworkStatusEvent","strings","keyOrder","result","getNetworkMessage","resolveAssetFallback","rawUrl","parsed","URL","location","href","origin","toSameOriginUrl","toString","path","pathname","test","replace","markAssetFallbackAttempt","originalUrl","fallbackUrl","currentCount","assetFallbackCount","applyTheme","theme","showToast","isDark","shouldShowToast","getElementById","checked","themeChanged","msg","isContentEditable","tagName","topEntry","sort","a","b","onLine","HTMLScriptElement","src","script","defer","async","crossOrigin","referrerPolicy","nonce","insertAdjacentElement","injectScriptFallback","HTMLLinkElement","rel","link","media","injectStylesheetFallback","handleThemeSystemChange","e","addListener","initThemeToggle","themeToggleInput","themeToggleInit","currentTheme","getAttribute","newTheme","preventDefault","endOfPageShown","lastScrollY","ticking","scrollY","pageYOffset","scrollPosition","innerHeight","docHeight","scrollHeight","offsetHeight","endOfPage","checkPageEnd","progressBar","scrollTop","clientHeight","width","scrollPercent","clamped","updateProgressBar","passive","yearEl","getFullYear","backToTopBtn","resolveCopyToastMessage","subject","keys","unsupported","isFa","fallback","resolveShareToastMessage","copyText","allowExecCommand","clipboard","writeText","ok","mode","probe","left","select","execCommand","copyWithExecCommand","emitToast","bindCopyButton","btn","HTMLButtonElement","toastCopyBound","textToCopy","includes","originalIcon","showCopySuccessState","failedKind","scrollTo","behavior","querySelectorAll","toastShareBound","shareUrl","share","title","url","name","bindShareButton","rect","getBoundingClientRect","x","y","ripple","triggerSuccess","element"],"sources":["main-script-base.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  // Ensure language strings object exists\r\n  if (!window.langStrings) {\r\n    window.langStrings = {};\r\n  }\r\n\r\n  /**\r\n   * Safe localStorage accessor with feature / privacy mode detection\r\n   */\r\n  function getSafeStorage() {\r\n    const testKey = \"__theme_pref__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch (err) {\r\n      // e.g. Safari private mode or blocked storage\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\n  const ASSET_FALLBACK_CLASS = \"asset-fallback-active\";\n  const ASSET_FALLBACK_FAILED_CLASS = \"asset-fallback-failed\";\n  const NETWORK_EVENT_NAME = \"ru:network-status\";\n  const assetFallbackAttempts = new Set();\n  let lastNetworkToastAt = 0;\n\r\n  // Reuse a single MediaQueryList if available\r\n  const darkMediaQuery = window.matchMedia\n    ? window.matchMedia(\"(prefers-color-scheme: dark)\")\n    : null;\n  const prefersDark = !!(darkMediaQuery && darkMediaQuery.matches);\n  const THEME_STORAGE_KEY = \"theme\";\n  const LEGACY_THEME_STORAGE_KEY = \"app:theme\";\n\n  function isValidTheme(value) {\n    return value === \"dark\" || value === \"light\";\n  }\n\n  function readStoredTheme() {\n    if (!storage) {return null;}\n\n    const storedTheme = storage.getItem(THEME_STORAGE_KEY);\n    if (isValidTheme(storedTheme)) {\n      return storedTheme;\n    }\n\n    const legacyTheme = storage.getItem(LEGACY_THEME_STORAGE_KEY);\n    if (!isValidTheme(legacyTheme)) {\n      return null;\n    }\n\n    // One-time migration from legacy key to canonical key.\n    try {\n      storage.setItem(THEME_STORAGE_KEY, legacyTheme);\n      storage.removeItem(LEGACY_THEME_STORAGE_KEY);\n    } catch (err) {\n      // Ignore storage failures in restricted environments.\n    }\n\n    return legacyTheme;\n  }\n\n  const savedTheme = readStoredTheme();\n\r\n  // Motion preference (for smooth scroll, etc.)\r\n  const reduceMotionQuery = window.matchMedia\r\n    ? window.matchMedia(\"(prefers-reduced-motion: reduce)\")\r\n    : null;\r\n  const prefersReducedMotion = !!(reduceMotionQuery && reduceMotionQuery.matches);\r\n\r\n  const TOAST_LIMIT_PER_POSITION = 3;\n  const TOAST_DEFAULT_DURATION = 2800;\n  const TOAST_EXIT_FALLBACK_MS = prefersReducedMotion ? 60 : 220;\n  const TOAST_EXIT_EXTRA_BUFFER_MS = 90;\n  const TOAST_STACK_SHIFTS_BOTTOM = [0, -3, -6];\n  const TOAST_STACK_SHIFTS_TOP = [0, 3, 6];\n  const TOAST_STACK_SCALE_LOSS = [0, 0.005, 0.01];\n  const TOAST_SWIPE_MIN_DISTANCE = 56;\n  const TOAST_SWIPE_MAX_CROSS_AXIS = 24;\n  const TOAST_SWIPE_MIN_VELOCITY = 0.35;\n  const TOAST_SWIPE_DISMISS_OFFSET_VW = 72;\n  const TOAST_KIND_ICONS = {\n    success: \"fas fa-check-circle\",\n    error: \"fas fa-exclamation-circle\",\n    info: \"fas fa-circle-info\",\n    default: \"fas fa-bell\",\n  };\n  const toastRegistry = new Map();\n  const toastState = {\n    top: {\n      position: \"top\",\n      viewport: null,\n      visible: [],\n      queue: [],\n    },\n    bottom: {\n      position: \"bottom\",\n      viewport: null,\n      visible: [],\n      queue: [],\n    },\n  };\n  let toastKeyboardShortcutsInstalled = false;\n\n  function normalizeToastKind(kind) {\n    const safeKind = String(kind || \"default\").toLowerCase();\n    if (safeKind === \"success\" || safeKind === \"error\" || safeKind === \"info\") {\n      return safeKind;\n    }\n    return \"default\";\n  }\n\n  function normalizeToastOptions(optionsOrType) {\n    const input =\n      typeof optionsOrType === \"string\"\n        ? { kind: optionsOrType }\n        : optionsOrType && typeof optionsOrType === \"object\"\n          ? optionsOrType\n          : {};\n\n    const kind = normalizeToastKind(input.kind || input.type);\n    const durationRaw = Number(input.duration);\n    const duration =\n      Number.isFinite(durationRaw) && durationRaw >= 0\n        ? Math.round(durationRaw)\n        : TOAST_DEFAULT_DURATION;\n    const id = typeof input.id === \"string\" ? input.id.trim() : \"\";\n    const position = input.position === \"top\" ? \"top\" : \"bottom\";\n    const customClass =\n      typeof input.customClass === \"string\" ? input.customClass.trim() : \"\";\n    const iconClass =\n      typeof input.iconClass === \"string\" && input.iconClass.trim()\n        ? input.iconClass.trim()\n        : TOAST_KIND_ICONS[kind];\n    const iconColor =\n      typeof input.iconColor === \"string\" ? input.iconColor.trim() : \"\";\n    const closeButton = !!input.closeButton;\n    const role =\n      typeof input.role === \"string\" && input.role.trim()\n        ? input.role.trim()\n        : kind === \"error\"\n          ? \"alert\"\n          : \"status\";\n    const ariaLive =\n      typeof input.ariaLive === \"string\" && input.ariaLive.trim()\n        ? input.ariaLive.trim()\n        : kind === \"error\"\n          ? \"assertive\"\n          : \"polite\";\n    const swipeDismiss =\n      input.swipeDismiss === true\n        ? true\n        : input.swipeDismiss === false\n          ? false\n          : \"auto\";\n\n    return {\n      id,\n      kind,\n      duration,\n      position,\n      customClass,\n      iconClass,\n      iconColor,\n      closeButton,\n      role,\n      ariaLive,\n      swipeDismiss,\n    };\n  }\n\n  function getToastState(position) {\n    return position === \"top\" ? toastState.top : toastState.bottom;\n  }\n\n  function ensureToastViewport(position) {\n    const state = getToastState(position);\n    if (state.viewport && state.viewport.isConnected) {\n      return state.viewport;\n    }\n\n    const selector = `.toast-viewport[data-toast-position=\"${position}\"]`;\n    const existing = document.querySelector(selector);\n    if (existing instanceof HTMLElement) {\n      state.viewport = existing;\n      return state.viewport;\n    }\n\n    if (!document.body) {\n      return null;\n    }\n\n    const viewport = document.createElement(\"div\");\n    viewport.className = \"toast-viewport\";\n    viewport.dataset.toastPosition = position;\n    viewport.setAttribute(\"aria-live\", \"off\");\n    document.body.appendChild(viewport);\n    state.viewport = viewport;\n    return viewport;\n  }\n\n  function canUseToastSwipe() {\n    const touchCapable =\n      (typeof navigator.maxTouchPoints === \"number\" && navigator.maxTouchPoints > 0) ||\n      \"ontouchstart\" in window;\n\n    if (typeof window.matchMedia !== \"function\") {\n      return touchCapable;\n    }\n    try {\n      return window.matchMedia(\"(pointer: coarse)\").matches || touchCapable;\n    } catch {\n      return touchCapable;\n    }\n  }\n\n  function isSwipeEnabled(entry) {\n    const setting = entry && entry.settings ? entry.settings.swipeDismiss : \"auto\";\n    if (setting === false) {\n      return false;\n    }\n    if (setting === true) {\n      return true;\n    }\n    return canUseToastSwipe();\n  }\n\n  function parseCssTimeToMs(value) {\n    const token = String(value || \"\").trim();\n    if (!token) {\n      return 0;\n    }\n    if (token.endsWith(\"ms\")) {\n      return Number.parseFloat(token) || 0;\n    }\n    if (token.endsWith(\"s\")) {\n      return (Number.parseFloat(token) || 0) * 1000;\n    }\n    return Number.parseFloat(token) || 0;\n  }\n\n  function getToastExitFallbackMs(toast) {\n    if (prefersReducedMotion) {\n      return TOAST_EXIT_FALLBACK_MS;\n    }\n    if (!(toast instanceof HTMLElement) || typeof window.getComputedStyle !== \"function\") {\n      return TOAST_EXIT_FALLBACK_MS;\n    }\n\n    const style = window.getComputedStyle(toast);\n    const durations = String(style.transitionDuration || \"0s\").split(\",\");\n    const delays = String(style.transitionDelay || \"0s\").split(\",\");\n    const totalTokens = Math.max(durations.length, delays.length);\n    let longest = 0;\n\n    for (let index = 0; index < totalTokens; index += 1) {\n      const durationToken = durations[index] || durations[durations.length - 1] || \"0s\";\n      const delayToken = delays[index] || delays[delays.length - 1] || \"0s\";\n      const total = parseCssTimeToMs(durationToken) + parseCssTimeToMs(delayToken);\n      if (total > longest) {\n        longest = total;\n      }\n    }\n\n    if (longest <= 0) {\n      return TOAST_EXIT_FALLBACK_MS;\n    }\n    return Math.max(TOAST_EXIT_FALLBACK_MS, Math.round(longest + TOAST_EXIT_EXTRA_BUFFER_MS));\n  }\n\n  function syncToastStack(state) {\n    if (!state || !Array.isArray(state.visible) || state.visible.length === 0) {\n      return;\n    }\n\n    const shifts =\n      state.position === \"top\" ? TOAST_STACK_SHIFTS_TOP : TOAST_STACK_SHIFTS_BOTTOM;\n\n    // The newest visible toast gets the front-most stack values.\n    const ordered = state.visible.slice().reverse();\n    ordered.forEach((entry, index) => {\n      if (!entry || !(entry.toast instanceof HTMLElement)) {\n        return;\n      }\n\n      const shift = shifts[Math.min(index, shifts.length - 1)];\n      const scaleLoss =\n        TOAST_STACK_SCALE_LOSS[Math.min(index, TOAST_STACK_SCALE_LOSS.length - 1)];\n      const maxDepthIndex = Math.max(1, TOAST_LIMIT_PER_POSITION - 1);\n      const depth = Math.min(1, index / maxDepthIndex);\n      entry.toast.style.setProperty(\"--toast-stack-shift\", `${shift}px`);\n      entry.toast.style.setProperty(\"--toast-stack-scale-loss\", String(scaleLoss));\n      entry.toast.style.setProperty(\"--toast-depth\", depth.toFixed(3));\n      entry.toast.style.setProperty(\"--toast-z\", String(300 - index));\n    });\n  }\n\n  function removeEntry(collection, entry) {\n    const index = collection.indexOf(entry);\n    if (index >= 0) {\n      collection.splice(index, 1);\n    }\n  }\n\n  function pruneToastState(state) {\n    state.visible = state.visible.filter((entry) => {\n      if (!entry || !(entry.toast instanceof HTMLElement)) {\n        return false;\n      }\n      if (entry.toast.isConnected && entry.mounted) {\n        return true;\n      }\n\n      stopToastTimers(entry);\n      releaseToastInteractions(entry);\n      entry.mounted = false;\n      entry.dismissing = false;\n      if (entry.settings.id && toastRegistry.get(entry.settings.id) === entry) {\n        toastRegistry.delete(entry.settings.id);\n      }\n      return false;\n    });\n\n    state.queue = state.queue.filter((entry) => !!entry && !entry.dismissing);\n  }\n\n  function stopToastTimers(entry) {\n    if (entry.timer) {\n      clearTimeout(entry.timer);\n      entry.timer = null;\n    }\n    if (entry.progressAnimation) {\n      try {\n        entry.progressAnimation.cancel();\n      } catch {}\n      entry.progressAnimation = null;\n    }\n    entry.lifecycleStartedAt = 0;\n  }\n\n  function getEntryRemainingDuration(entry) {\n    if (!entry || !entry.settings || entry.settings.duration <= 0) {\n      return 0;\n    }\n    if (!Number.isFinite(entry.remainingDuration)) {\n      return entry.settings.duration;\n    }\n    return Math.max(0, Math.round(entry.remainingDuration));\n  }\n\n  function pauseToastLifecycle(entry) {\n    if (\n      !entry ||\n      !entry.settings ||\n      entry.settings.duration <= 0 ||\n      entry.lifecyclePaused\n    ) {\n      return;\n    }\n\n    const baseDuration = getEntryRemainingDuration(entry);\n    if (entry.lifecycleStartedAt > 0) {\n      const elapsed = Math.max(0, Date.now() - entry.lifecycleStartedAt);\n      entry.remainingDuration = Math.max(0, baseDuration - elapsed);\n    } else {\n      entry.remainingDuration = baseDuration;\n    }\n\n    entry.lifecyclePaused = true;\n    stopToastTimers(entry);\n  }\n\n  function resumeToastLifecycle(entry) {\n    if (\n      !entry ||\n      !entry.settings ||\n      entry.settings.duration <= 0 ||\n      !entry.lifecyclePaused\n    ) {\n      return;\n    }\n\n    entry.lifecyclePaused = false;\n    startToastLifecycle(entry, { useRemaining: true });\n  }\n\n  function installToastInteractions(entry) {\n    if (\n      !entry ||\n      !(entry.toast instanceof HTMLElement) ||\n      entry.interactionsInstalled\n    ) {\n      return;\n    }\n\n    const toast = entry.toast;\n    const onPointerEnter = () => {\n      pauseToastLifecycle(entry);\n    };\n    const onPointerLeave = () => {\n      resumeToastLifecycle(entry);\n    };\n    const onFocusIn = () => {\n      pauseToastLifecycle(entry);\n    };\n    const onFocusOut = (event) => {\n      const next = event.relatedTarget;\n      if (next instanceof Node && toast.contains(next)) {\n        return;\n      }\n      resumeToastLifecycle(entry);\n    };\n    const onKeyDown = (event) => {\n      if (event.key !== \"Escape\") {\n        return;\n      }\n      event.stopPropagation();\n      dismissToastEntry(entry);\n    };\n\n    toast.addEventListener(\"pointerenter\", onPointerEnter);\n    toast.addEventListener(\"pointerleave\", onPointerLeave);\n    toast.addEventListener(\"focusin\", onFocusIn);\n    toast.addEventListener(\"focusout\", onFocusOut);\n    toast.addEventListener(\"keydown\", onKeyDown);\n\n    entry.interactionsInstalled = true;\n    entry.interactionsCleanup = () => {\n      toast.removeEventListener(\"pointerenter\", onPointerEnter);\n      toast.removeEventListener(\"pointerleave\", onPointerLeave);\n      toast.removeEventListener(\"focusin\", onFocusIn);\n      toast.removeEventListener(\"focusout\", onFocusOut);\n      toast.removeEventListener(\"keydown\", onKeyDown);\n      entry.interactionsInstalled = false;\n    };\n  }\n\n  function releaseToastInteractions(entry) {\n    if (!entry || typeof entry.interactionsCleanup !== \"function\") {\n      if (entry) {\n        entry.interactionsInstalled = false;\n      }\n      return;\n    }\n    entry.interactionsCleanup();\n    entry.interactionsCleanup = null;\n    entry.interactionsInstalled = false;\n  }\n\n  function getMostRecentVisibleToastEntry() {\n    const visible = [...toastState.top.visible, ...toastState.bottom.visible]\n      .filter(\n        (entry) =>\n          !!entry &&\n          !!entry.mounted &&\n          !!entry.toast &&\n          entry.toast.isConnected &&\n          !entry.dismissing\n      )\n      .sort((a, b) => (b.lastMountedAt || 0) - (a.lastMountedAt || 0));\n\n    return visible[0] || null;\n  }\n\n  function installToastKeyboardShortcuts() {\n    if (toastKeyboardShortcutsInstalled || !document) {\n      return;\n    }\n    toastKeyboardShortcutsInstalled = true;\n\n    document.addEventListener(\"keydown\", (event) => {\n      if (event.key !== \"Escape\") {\n        return;\n      }\n\n      const target = event.target;\n      if (\n        target instanceof HTMLElement &&\n        (target.isContentEditable ||\n          target.tagName === \"INPUT\" ||\n          target.tagName === \"TEXTAREA\" ||\n          target.tagName === \"SELECT\")\n      ) {\n        return;\n      }\n\n      const topEntry = getMostRecentVisibleToastEntry();\n      if (!topEntry) {\n        return;\n      }\n\n      event.stopPropagation();\n      dismissToastEntry(topEntry);\n    });\n  }\n\n  function stopSwipeRebound(entry) {\n    if (entry && entry.swipe && entry.swipe.reboundTimer) {\n      clearTimeout(entry.swipe.reboundTimer);\n      entry.swipe.reboundTimer = null;\n    }\n  }\n\n  function resetSwipeState(entry) {\n    if (!entry || !(entry.toast instanceof HTMLElement)) {\n      return;\n    }\n\n    stopSwipeRebound(entry);\n    entry.toast.style.setProperty(\"--toast-swipe-x\", \"0px\");\n    entry.toast.classList.remove(\"is-swiping\", \"swipe-dismiss\", \"swipe-rebound\");\n  }\n\n  function releaseToastSwipe(entry) {\n    if (!entry || !entry.swipe || typeof entry.swipe.cleanup !== \"function\") {\n      return;\n    }\n    entry.swipe.cleanup();\n    entry.swipe.cleanup = null;\n  }\n\n  function installToastSwipe(entry) {\n    if (\n      !entry ||\n      !(entry.toast instanceof HTMLElement) ||\n      !isSwipeEnabled(entry) ||\n      (entry.swipe && typeof entry.swipe.cleanup === \"function\")\n    ) {\n      return;\n    }\n\n    const toast = entry.toast;\n    const state = {\n      pointerId: null,\n      active: false,\n      startX: 0,\n      startY: 0,\n      startAt: 0,\n      lastX: 0,\n      lastY: 0,\n      lastAt: 0,\n      reboundTimer: null,\n      cleanup: null,\n    };\n    entry.swipe = state;\n\n    const onPointerDown = (event) => {\n      if (entry.dismissing || event.isPrimary === false || event.button > 0) {\n        return;\n      }\n      if (event.target instanceof Element && event.target.closest(\".toast-close\")) {\n        return;\n      }\n\n      state.pointerId = event.pointerId;\n      state.active = true;\n      state.startX = event.clientX;\n      state.startY = event.clientY;\n      state.startAt = Date.now();\n      state.lastX = event.clientX;\n      state.lastY = event.clientY;\n      state.lastAt = state.startAt;\n      stopSwipeRebound(entry);\n      toast.classList.add(\"is-swiping\");\n      toast.classList.remove(\"swipe-rebound\", \"swipe-dismiss\");\n      pauseToastLifecycle(entry);\n\n      if (typeof toast.setPointerCapture === \"function\") {\n        try {\n          toast.setPointerCapture(event.pointerId);\n        } catch {}\n      }\n    };\n\n    const onPointerMove = (event) => {\n      if (!state.active || event.pointerId !== state.pointerId) {\n        return;\n      }\n\n      const dx = event.clientX - state.startX;\n      const dy = event.clientY - state.startY;\n      state.lastX = event.clientX;\n      state.lastY = event.clientY;\n      state.lastAt = Date.now();\n\n      if (Math.abs(dy) > TOAST_SWIPE_MAX_CROSS_AXIS * 1.6) {\n        return;\n      }\n\n      toast.style.setProperty(\"--toast-swipe-x\", `${dx}px`);\n    };\n\n    const completeSwipe = (event) => {\n      if (!state.active || event.pointerId !== state.pointerId) {\n        return;\n      }\n\n      state.active = false;\n      const dx = state.lastX - state.startX;\n      const dy = state.lastY - state.startY;\n      const elapsed = Math.max(1, state.lastAt - state.startAt);\n      const velocity = Math.abs(dx) / elapsed;\n      const absDx = Math.abs(dx);\n      const absDy = Math.abs(dy);\n      const validSwipe =\n        absDx >= TOAST_SWIPE_MIN_DISTANCE &&\n        absDy <= TOAST_SWIPE_MAX_CROSS_AXIS &&\n        velocity >= TOAST_SWIPE_MIN_VELOCITY;\n\n      if (validSwipe) {\n        toast.classList.remove(\"is-swiping\", \"swipe-rebound\");\n        toast.classList.add(\"swipe-dismiss\");\n        const direction = dx >= 0 ? 1 : -1;\n        const targetOffset = Math.round((window.innerWidth * TOAST_SWIPE_DISMISS_OFFSET_VW) / 100);\n        toast.style.setProperty(\"--toast-swipe-x\", `${direction * targetOffset}px`);\n\n        if (prefersReducedMotion) {\n          dismissToastEntry(entry);\n          return;\n        }\n\n        setTimeout(() => {\n          dismissToastEntry(entry);\n        }, 110);\n        return;\n      }\n\n      toast.classList.remove(\"is-swiping\", \"swipe-dismiss\");\n      toast.classList.add(\"swipe-rebound\");\n      toast.style.setProperty(\"--toast-swipe-x\", \"0px\");\n      state.reboundTimer = setTimeout(() => {\n        toast.classList.remove(\"swipe-rebound\");\n        state.reboundTimer = null;\n      }, prefersReducedMotion ? 1 : 220);\n      resumeToastLifecycle(entry);\n    };\n\n    const onPointerCancel = (event) => {\n      if (!state.active || event.pointerId !== state.pointerId) {\n        return;\n      }\n      state.active = false;\n      toast.classList.remove(\"is-swiping\", \"swipe-dismiss\");\n      toast.classList.add(\"swipe-rebound\");\n      toast.style.setProperty(\"--toast-swipe-x\", \"0px\");\n      state.reboundTimer = setTimeout(() => {\n        toast.classList.remove(\"swipe-rebound\");\n        state.reboundTimer = null;\n      }, prefersReducedMotion ? 1 : 220);\n      resumeToastLifecycle(entry);\n    };\n\n    toast.addEventListener(\"pointerdown\", onPointerDown);\n    toast.addEventListener(\"pointermove\", onPointerMove);\n    toast.addEventListener(\"pointerup\", completeSwipe);\n    toast.addEventListener(\"pointercancel\", onPointerCancel);\n    toast.addEventListener(\"lostpointercapture\", onPointerCancel);\n\n    state.cleanup = () => {\n      toast.removeEventListener(\"pointerdown\", onPointerDown);\n      toast.removeEventListener(\"pointermove\", onPointerMove);\n      toast.removeEventListener(\"pointerup\", completeSwipe);\n      toast.removeEventListener(\"pointercancel\", onPointerCancel);\n      toast.removeEventListener(\"lostpointercapture\", onPointerCancel);\n      stopSwipeRebound(entry);\n      if (entry && entry.swipe) {\n        entry.swipe.active = false;\n      }\n    };\n  }\n\n  function applyToastContent(entry) {\n    const { settings, toast } = entry;\n    const classes = [\"dynamic-toast\", `toast-kind-${settings.kind}`];\n    if (settings.customClass) {\n      classes.push(settings.customClass);\n    }\n    toast.className = classes.join(\" \");\n    toast.dataset.toastKind = settings.kind;\n    toast.dataset.toastPosition = settings.position;\n    toast.setAttribute(\"role\", settings.role);\n    toast.setAttribute(\"aria-live\", settings.ariaLive);\n    toast.setAttribute(\"aria-atomic\", \"true\");\n    toast.tabIndex = -1;\n    if (settings.id) {\n      toast.id = settings.id;\n    } else {\n      toast.removeAttribute(\"id\");\n    }\n\n    const fragment = document.createDocumentFragment();\n    if (settings.iconClass) {\n      const icon = document.createElement(\"i\");\n      icon.className = `${settings.iconClass} toast-icon`.trim();\n      if (settings.iconColor) {\n        icon.dataset.iconColor = settings.iconColor;\n      }\n      icon.setAttribute(\"aria-hidden\", \"true\");\n      fragment.appendChild(icon);\n    }\n\n    const text = document.createElement(\"span\");\n    text.className = \"toast-message\";\n    text.textContent = entry.message;\n    fragment.appendChild(text);\n\n    if (settings.closeButton) {\n      const isFaLocale = (document.documentElement.lang || \"\")\n        .toLowerCase()\n        .startsWith(\"fa\");\n      const closeBtn = document.createElement(\"button\");\n      closeBtn.type = \"button\";\n      closeBtn.className = \"toast-close\";\n      closeBtn.setAttribute(\n        \"aria-label\",\n        isFaLocale ? \" \" : \"Close message\"\n      );\n      closeBtn.innerHTML = '<i class=\"fas fa-times\" aria-hidden=\"true\"></i>';\n      closeBtn.addEventListener(\n        \"click\",\n        () => dismissToastEntry(entry),\n        { once: true }\n      );\n      fragment.appendChild(closeBtn);\n    }\n\n    const progress = document.createElement(\"span\");\n    progress.className = \"toast-progress\";\n    progress.setAttribute(\"aria-hidden\", \"true\");\n    fragment.appendChild(progress);\n\n    toast.replaceChildren(fragment);\n  }\n\n  function startToastProgress(entry, durationOverride) {\n    const progress = entry.toast.querySelector(\".toast-progress\");\n    if (!(progress instanceof HTMLElement)) {\n      return;\n    }\n\n    const duration =\n      Number.isFinite(durationOverride) && durationOverride >= 0\n        ? Math.round(durationOverride)\n        : entry.settings.duration;\n    progress.hidden = duration <= 0;\n    if (prefersReducedMotion || duration <= 0) {\n      return;\n    }\n\n    if (typeof progress.animate !== \"function\") {\n      return;\n    }\n\n    try {\n      entry.progressAnimation = progress.animate(\n        [\n          { transform: \"scaleX(1)\" },\n          { transform: \"scaleX(0)\" },\n        ],\n        {\n          duration,\n          easing: \"linear\",\n          fill: \"forwards\",\n        }\n      );\n    } catch {}\n  }\n\n  function startToastLifecycle(entry, options = {}) {\n    const useRemaining = !!options.useRemaining;\n    stopToastTimers(entry);\n    const duration =\n      entry.settings.duration > 0\n        ? useRemaining\n          ? getEntryRemainingDuration(entry)\n          : entry.settings.duration\n        : 0;\n    entry.remainingDuration = duration;\n    entry.lifecycleStartedAt = duration > 0 ? Date.now() : 0;\n    startToastProgress(entry, duration);\n\n    if (duration > 0) {\n      entry.timer = setTimeout(() => {\n        dismissToastEntry(entry);\n      }, duration);\n    }\n  }\n\n  function refreshVisibleToast(entry) {\n    if (!entry.mounted || !entry.toast) {\n      return;\n    }\n\n    entry.dismissing = false;\n    entry.lifecyclePaused = false;\n    entry.remainingDuration = entry.settings.duration;\n    entry.lifecycleStartedAt = 0;\n    entry.lastMountedAt = Date.now();\n    resetSwipeState(entry);\n    applyToastContent(entry);\n    entry.toast.classList.add(\"show\");\n    entry.toast.classList.remove(\"is-closing\");\n    installToastInteractions(entry);\n    startToastLifecycle(entry);\n    syncToastStack(entry.state || getToastState(entry.settings.position));\n  }\n\n  function mountToastEntry(entry) {\n    const state = entry.state || getToastState(entry.settings.position);\n    const viewport = ensureToastViewport(state.position);\n    if (!viewport) {\n      return;\n    }\n\n    entry.state = state;\n    entry.mounted = true;\n    entry.dismissing = false;\n    entry.lifecyclePaused = false;\n    entry.remainingDuration = entry.settings.duration;\n    entry.lifecycleStartedAt = 0;\n    entry.lastMountedAt = Date.now();\n    resetSwipeState(entry);\n    applyToastContent(entry);\n    viewport.appendChild(entry.toast);\n    state.visible.push(entry);\n    syncToastStack(state);\n    installToastSwipe(entry);\n    installToastInteractions(entry);\n\n    requestAnimationFrame(() => {\n      if (!entry.mounted) {\n        return;\n      }\n\n      entry.toast.classList.add(\"show\");\n      startToastLifecycle(entry);\n\n      if (typeof window.__ruToastFeedback === \"function\") {\n        try {\n          window.__ruToastFeedback();\n        } catch {}\n      }\n    });\n  }\n\n  function flushToastQueue(position) {\n    const state = getToastState(position);\n    ensureToastViewport(position);\n    pruneToastState(state);\n\n    while (\n      state.visible.length < TOAST_LIMIT_PER_POSITION &&\n      state.queue.length > 0\n    ) {\n      const next = state.queue.shift();\n      if (!next) {\n        continue;\n      }\n\n      if (next.dismissing) {\n        continue;\n      }\n\n      mountToastEntry(next);\n    }\n    syncToastStack(state);\n  }\n\n  function dismissToastEntry(entry) {\n    if (!entry || entry.dismissing) {\n      return;\n    }\n\n    entry.dismissing = true;\n    stopToastTimers(entry);\n    stopSwipeRebound(entry);\n\n    if (!entry.mounted || !(entry.toast instanceof HTMLElement)) {\n      const queuedState = entry.state || getToastState(entry.settings.position);\n      removeEntry(queuedState.queue, entry);\n      if (entry.settings.id && toastRegistry.get(entry.settings.id) === entry) {\n        toastRegistry.delete(entry.settings.id);\n      }\n      releaseToastSwipe(entry);\n      releaseToastInteractions(entry);\n      entry.dismissing = false;\n      return;\n    }\n\n    const { toast } = entry;\n    toast.classList.remove(\"show\");\n    toast.classList.add(\"is-closing\");\n\n    let finalized = false;\n    const finalize = () => {\n      if (finalized) {\n        return;\n      }\n      finalized = true;\n\n      const state = entry.state || getToastState(entry.settings.position);\n      removeEntry(state.visible, entry);\n      removeEntry(state.queue, entry);\n      if (entry.settings.id && toastRegistry.get(entry.settings.id) === entry) {\n        toastRegistry.delete(entry.settings.id);\n      }\n      releaseToastSwipe(entry);\n      releaseToastInteractions(entry);\n      toast.remove();\n      entry.mounted = false;\n      entry.dismissing = false;\n      flushToastQueue(state.position);\n      syncToastStack(state);\n    };\n\n    toast.addEventListener(\n      \"transitionend\",\n      (event) => {\n        if (event.target === toast) {\n          finalize();\n        }\n      },\n      { once: true }\n    );\n    setTimeout(finalize, getToastExitFallbackMs(toast));\n  }\n\n  function createToastEntry(message, optionsOrType) {\n    if (!message && message !== 0) {\n      return null;\n    }\n    if (!document.body) {\n      console.warn(\"Cannot show toast: document.body not ready\");\n      return null;\n    }\n\n    const settings = normalizeToastOptions(optionsOrType);\n    const text = String(message);\n\n    pruneToastState(toastState.top);\n    pruneToastState(toastState.bottom);\n\n    if (settings.id && toastRegistry.has(settings.id)) {\n      const entry = toastRegistry.get(settings.id);\n      entry.message = text;\n      entry.settings = {\n        ...entry.settings,\n        ...settings,\n        position: entry.mounted ? entry.settings.position : settings.position,\n      };\n\n      if (entry.mounted) {\n        refreshVisibleToast(entry);\n        return entry;\n      }\n\n      const targetState = getToastState(entry.settings.position);\n      removeEntry(toastState.top.queue, entry);\n      removeEntry(toastState.bottom.queue, entry);\n      entry.state = targetState;\n      targetState.queue.push(entry);\n      flushToastQueue(targetState.position);\n      return entry;\n    }\n\n    const entry = {\n      message: text,\n      settings,\n      state: getToastState(settings.position),\n      toast: document.createElement(\"div\"),\n      timer: null,\n      progressAnimation: null,\n      dismissing: false,\n      mounted: false,\n      swipe: null,\n      remainingDuration: settings.duration,\n      lifecycleStartedAt: 0,\n      lifecyclePaused: false,\n      interactionsInstalled: false,\n      interactionsCleanup: null,\n      lastMountedAt: 0,\n    };\n\n    if (settings.id) {\n      toastRegistry.set(settings.id, entry);\n    }\n\n    entry.state.queue.push(entry);\n    flushToastQueue(entry.state.position);\n    return entry;\n  }\n\n  /**\n   * Unified toast API.\n   * Backward compatible signatures:\n   *  - createToast(message, \"success\"|\"error\"|\"info\"|\"default\")\n   *  - createToast(message, options)\n   */\n  function createToast(message, optionsOrType) {\n    const entry = createToastEntry(message, optionsOrType);\n    return entry ? entry.toast : null;\n  }\n\n  // Expose the unified toast API globally.\n  window.createToast = createToast;\n  installToastKeyboardShortcuts();\n\n  function getNetworkMessage(online) {\n    const strings = window.langStrings || {};\n    const keyOrder = online\n      ? [\"backOnline\", \"online\", \"connectionRestored\"]\n      : [\"offline\", \"connectionLost\"];\n\n    for (const key of keyOrder) {\n      const value = strings[key];\n      if (typeof value === \"function\") {\n        const result = value();\n        if (typeof result === \"string\" && result.trim()) {\n          return result;\n        }\n      } else if (typeof value === \"string\" && value.trim()) {\n        return value;\n      }\n    }\n\n    return online\n      ? \"Connection restored.\"\n      : \"You are offline. Some features may be unavailable.\";\n  }\n\n  function emitNetworkStatusEvent(online) {\n    const detail = { online, timestamp: Date.now() };\n    try {\n      window.dispatchEvent(\n        new CustomEvent(NETWORK_EVENT_NAME, {\n          detail,\n        })\n      );\n    } catch (err) {\n      // CustomEvent fallback for old browsers.\n      try {\n        const event = document.createEvent(\"CustomEvent\");\n        event.initCustomEvent(NETWORK_EVENT_NAME, false, false, detail);\n        window.dispatchEvent(event);\n      } catch {}\n    }\n  }\n\n  function updateNetworkState(online, notify) {\n    const isOnline = !!online;\n\n    document.documentElement.classList.toggle(\"online\", isOnline);\n    document.documentElement.classList.toggle(\"offline\", !isOnline);\n    document.documentElement.setAttribute(\"data-network-status\", isOnline ? \"online\" : \"offline\");\n\n    if (document.body) {\n      document.body.classList.toggle(\"online\", isOnline);\n      document.body.classList.toggle(\"offline\", !isOnline);\n    }\n\n    emitNetworkStatusEvent(isOnline);\n\n    if (!notify || typeof window.createToast !== \"function\") {\n      return;\n    }\n\n    const now = Date.now();\n    if (now - lastNetworkToastAt < 1200) {\n      return;\n    }\n    lastNetworkToastAt = now;\n    window.createToast(getNetworkMessage(isOnline), {\n      id: \"network-status-toast\",\n      kind: isOnline ? \"success\" : \"info\",\n      duration: 2600,\n    });\n  }\n\n  function installNetworkResilience() {\n    const initialOnline = navigator.onLine !== false;\n    updateNetworkState(initialOnline, false);\n    window.addEventListener(\"online\", () => updateNetworkState(true, true));\n    window.addEventListener(\"offline\", () => updateNetworkState(false, true));\n  }\n\n  function toSameOriginUrl(rawUrl) {\n    if (!rawUrl) {\n      return null;\n    }\n\n    try {\n      const parsed = new URL(rawUrl, window.location.href);\n      if (parsed.origin !== window.location.origin) {\n        return null;\n      }\n      return parsed;\n    } catch {\n      return null;\n    }\n  }\n\n  function resolveAssetFallback(rawUrl) {\n    const parsed = toSameOriginUrl(rawUrl);\n    if (!parsed) {\n      return null;\n    }\n\n    const next = new URL(parsed.toString());\n    const path = next.pathname;\n\n    if (/\\.min\\.js$/i.test(path)) {\n      next.pathname = path.replace(/\\.min\\.js$/i, \".js\");\n      return next.toString();\n    }\n\n    if (/\\.min\\.css$/i.test(path)) {\n      next.pathname = path.replace(/\\.min\\.css$/i, \".css\");\n      return next.toString();\n    }\n\n    return null;\n  }\n\n  function markAssetFallbackAttempt(target, originalUrl, fallbackUrl) {\n    const key = `${originalUrl}::${fallbackUrl}`;\n    if (assetFallbackAttempts.has(key)) {\n      return false;\n    }\n\n    assetFallbackAttempts.add(key);\n    target.setAttribute(\"data-asset-failed\", \"true\");\n    document.documentElement.classList.add(ASSET_FALLBACK_CLASS);\n    const currentCount = Number(document.documentElement.dataset.assetFallbackCount || \"0\");\n    document.documentElement.dataset.assetFallbackCount = String(currentCount + 1);\n    return true;\n  }\n\n  function injectScriptFallback(target, fallbackUrl) {\n    const script = document.createElement(\"script\");\n    script.src = fallbackUrl;\n    script.defer = !!target.defer;\n    script.async = !!target.async;\n    if (target.type) {\n      script.type = target.type;\n    }\n    if (target.crossOrigin) {\n      script.crossOrigin = target.crossOrigin;\n    }\n    if (target.referrerPolicy) {\n      script.referrerPolicy = target.referrerPolicy;\n    }\n    if (target.nonce) {\n      script.nonce = target.nonce;\n    }\n    script.setAttribute(\"data-asset-fallback\", \"true\");\n    script.setAttribute(\"data-asset-fallback-from\", target.src || \"\");\n    script.addEventListener(\n      \"error\",\n      () => {\n        document.documentElement.classList.add(ASSET_FALLBACK_FAILED_CLASS);\n      },\n      { once: true }\n    );\n    target.insertAdjacentElement(\"afterend\", script);\n  }\n\n  function injectStylesheetFallback(target, fallbackUrl) {\n    if ((target.rel || \"\").toLowerCase() !== \"stylesheet\") {\n      return;\n    }\n\n    const link = document.createElement(\"link\");\n    link.rel = \"stylesheet\";\n    link.href = fallbackUrl;\n    if (target.media) {\n      link.media = target.media;\n    }\n    if (target.crossOrigin) {\n      link.crossOrigin = target.crossOrigin;\n    }\n    if (target.referrerPolicy) {\n      link.referrerPolicy = target.referrerPolicy;\n    }\n    if (target.nonce) {\n      link.nonce = target.nonce;\n    }\n    link.setAttribute(\"data-asset-fallback\", \"true\");\n    link.setAttribute(\"data-asset-fallback-from\", target.href || \"\");\n    link.addEventListener(\n      \"error\",\n      () => {\n        document.documentElement.classList.add(ASSET_FALLBACK_FAILED_CLASS);\n      },\n      { once: true }\n    );\n    target.insertAdjacentElement(\"afterend\", link);\n  }\n\n  function installAssetFallbackResilience() {\n    window.addEventListener(\n      \"error\",\n      (event) => {\n        const target = event.target;\n        if (!target || target === window) {\n          return;\n        }\n\n        if (\n          typeof HTMLScriptElement !== \"undefined\" &&\n          target instanceof HTMLScriptElement\n        ) {\n          const originalUrl = target.src || \"\";\n          const fallbackUrl = resolveAssetFallback(originalUrl);\n          if (!fallbackUrl) {\n            return;\n          }\n\n          if (!markAssetFallbackAttempt(target, originalUrl, fallbackUrl)) {\n            return;\n          }\n\n          injectScriptFallback(target, fallbackUrl);\n          return;\n        }\n\n        if (\n          typeof HTMLLinkElement !== \"undefined\" &&\n          target instanceof HTMLLinkElement\n        ) {\n          const originalUrl = target.href || \"\";\n          const fallbackUrl = resolveAssetFallback(originalUrl);\n          if (!fallbackUrl) {\n            return;\n          }\n\n          if (!markAssetFallbackAttempt(target, originalUrl, fallbackUrl)) {\n            return;\n          }\n\n          injectStylesheetFallback(target, fallbackUrl);\n        }\n      },\n      true\n    );\n  }\n\n  installNetworkResilience();\n  installAssetFallbackResilience();\n\r\n  /**\r\n   * Apply theme and sync toggle + a11y attributes.\r\n   * @param {\"dark\"|\"light\"} theme\r\n   * @param {boolean} [showToast=false]\r\n   */\r\n  function applyTheme(theme, showToast) {\r\n    const isDark = theme === \"dark\";\r\n    const shouldShowToast = !!showToast;\r\n\r\n    document.body.classList.toggle(\"dark-mode\", isDark);\r\n    document.body.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    // Optional: expose theme on <html> for CSS theming\r\n    document.documentElement.setAttribute(\"data-theme\", theme);\r\n\r\n    const toggle = document.getElementById(\"theme-toggle\");\r\n    if (toggle) {\r\n      toggle.checked = isDark;\r\n      toggle.setAttribute(\"aria-checked\", String(isDark));\r\n    }\r\n\r\n    if (\r\n      shouldShowToast &&\r\n      typeof window.langStrings.themeChanged === \"function\"\r\n    ) {\r\n      // themeChanged(theme)  localized message\r\n      const msg = window.langStrings.themeChanged(theme);\n      if (msg) {\n        createToast(msg, {\n          id: \"theme-change-toast\",\n          kind: \"info\",\n          customClass: \"theme-toast\",\n          duration: 1800,\n          position: \"top\",\n        });\n      }\n    }\r\n  }\r\n\r\n  // Initial theme: stored preference > system preference\r\n  if (savedTheme === \"dark\" || savedTheme === \"light\") {\r\n    applyTheme(savedTheme);\r\n  } else {\r\n    applyTheme(prefersDark ? \"dark\" : \"light\");\r\n  }\r\n\r\n  // React to OS theme changes only if user has not explicitly chosen a theme\r\n  if (darkMediaQuery) {\n    const handleThemeSystemChange = function (e) {\n      // If user later sets a theme, this check prevents overriding it\n      if (!readStoredTheme()) {\n        applyTheme(e.matches ? \"dark\" : \"light\");\n      }\n    };\n\r\n    if (typeof darkMediaQuery.addEventListener === \"function\") {\r\n      darkMediaQuery.addEventListener(\"change\", handleThemeSystemChange);\r\n    } else if (typeof darkMediaQuery.addListener === \"function\") {\r\n      // Older browsers\r\n      darkMediaQuery.addListener(handleThemeSystemChange);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize theme toggle (can be called multiple times safely).\r\n   */\r\n  function initThemeToggle() {\n    const themeToggleInput = document.getElementById(\"theme-toggle\");\n    if (!themeToggleInput) {return;}\n\r\n    // Avoid attaching listeners multiple times on dynamic includes\r\n    if (themeToggleInput.dataset.themeToggleInit === \"true\") {\r\n      return;\r\n    }\r\n    themeToggleInput.dataset.themeToggleInit = \"true\";\n\n    const currentTheme = document.documentElement.getAttribute(\"data-theme\");\n    if (currentTheme === \"dark\" || currentTheme === \"light\") {\n      themeToggleInput.checked = currentTheme === \"dark\";\n    }\n\n    // Sync ARIA\n    themeToggleInput.setAttribute(\n      \"aria-checked\",\n      String(!!themeToggleInput.checked)\n    );\n    themeToggleInput.setAttribute(\"role\", \"switch\");\r\n\r\n    // Change by click\r\n    themeToggleInput.addEventListener(\"change\", () => {\n      const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\n      applyTheme(newTheme, true);\n      try {\n        storage?.setItem(THEME_STORAGE_KEY, newTheme);\n      } catch (err) {\n        // Ignore storage failures (e.g., private mode)\n      }\n    });\r\n\r\n    // Keyboard accessibility (Space / Enter)\r\n    themeToggleInput.addEventListener(\"keydown\", (event) => {\r\n      if (event.key === \" \" || event.key === \"Enter\") {\r\n        event.preventDefault();\r\n        themeToggleInput.checked = !themeToggleInput.checked;\n        const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\n        applyTheme(newTheme, true);\n        try {\n          storage?.setItem(THEME_STORAGE_KEY, newTheme);\n        } catch (err) {}\n      }\n    });\n  }\r\n\r\n  // Init theme toggle on first load\r\n  initThemeToggle();\r\n  // Re-init if header/footer includes loaded dynamically\r\n  document.addEventListener(\"includesLoaded\", initThemeToggle, false);\r\n\r\n  // ---- End-of-page toast logic ----\r\n\r\n  let endOfPageShown = false;\r\n  let lastScrollY = 0;\r\n  let ticking = false;\r\n\r\n  function checkPageEnd() {\r\n    const scrollPosition = window.innerHeight + lastScrollY;\r\n    const docHeight =\r\n      Math.max(\r\n        document.body.scrollHeight,\r\n        document.documentElement.scrollHeight,\r\n        document.body.offsetHeight,\r\n        document.documentElement.offsetHeight\r\n      ) || 0;\r\n\r\n    // Reset flag if user scrolls back up (more than 100px from bottom)\r\n    if (scrollPosition < docHeight - 100) {\r\n      endOfPageShown = false;\r\n    }\r\n\r\n    if (!endOfPageShown && scrollPosition >= docHeight - 50 && docHeight > 0) {\r\n      endOfPageShown = true;\r\n      if (typeof window.langStrings.endOfPage === \"string\") {\n        createToast(window.langStrings.endOfPage, {\n          id: \"end-of-page-toast\",\n          kind: \"info\",\n          customClass: \"end-of-page-toast\",\n          duration: 3200,\n        });\n      } else if (typeof window.langStrings.endOfPage === \"function\") {\n        const msg = window.langStrings.endOfPage();\n        if (msg) {\n          createToast(msg, {\n            id: \"end-of-page-toast\",\n            kind: \"info\",\n            customClass: \"end-of-page-toast\",\n            duration: 3200,\n          });\n        }\n      }\n    }\r\n    ticking = false;\r\n  }\r\n\r\n  function updateProgressBar() {\r\n    const progressBar = document.getElementById(\"scroll-progress-bar\");\r\n    if (!progressBar) {return;}\r\n\r\n    const scrollTop =\r\n      window.scrollY || document.documentElement.scrollTop || 0;\r\n    const docHeight =\r\n      document.documentElement.scrollHeight -\r\n      document.documentElement.clientHeight;\r\n\r\n    if (docHeight <= 0) {\r\n      progressBar.style.width = \"0%\";\r\n      progressBar.setAttribute(\"aria-valuenow\", \"0\");\r\n      return;\r\n    }\r\n\r\n    const scrollPercent = (scrollTop / docHeight) * 100;\r\n    const clamped = Math.max(0, Math.min(100, scrollPercent));\r\n\r\n    progressBar.style.width = clamped + \"%\";\r\n    progressBar.setAttribute(\"aria-valuenow\", Math.round(clamped));\r\n  }\r\n\r\n  window.addEventListener(\r\n    \"scroll\",\r\n    () => {\r\n      lastScrollY = window.scrollY || window.pageYOffset || 0;\r\n      if (!ticking) {\r\n        window.requestAnimationFrame(() => {\r\n          checkPageEnd();\r\n          updateProgressBar();\r\n        });\r\n        ticking = true;\r\n      }\r\n    },\r\n    { passive: true }\r\n  );\r\n\r\n  // Footer year\r\n  const yearEl =\r\n    document.getElementById(\"current-year\") ||\r\n    document.getElementById(\"footer-year\");\r\n  if (yearEl) {\r\n    yearEl.textContent = new Date().getFullYear();\r\n  }\r\n\r\n  // Back to Top Button Logic\r\n  const backToTopBtn = document.getElementById(\"back-to-top\");\r\n  if (backToTopBtn) {\r\n    window.addEventListener(\r\n      \"scroll\",\r\n      () => {\r\n        if (window.scrollY > 300) {\r\n          backToTopBtn.classList.add(\"show\");\r\n        } else {\r\n          backToTopBtn.classList.remove(\"show\");\r\n        }\r\n      },\r\n      { passive: true }\r\n    );\r\n\r\n    backToTopBtn.addEventListener(\"click\", () => {\r\n      window.scrollTo({\r\n        top: 0,\r\n        behavior: prefersReducedMotion ? \"auto\" : \"smooth\",\r\n      });\r\n    });\r\n  }\r\n\r\n  function resolveCopyToastMessage(kind, subject = \"email\") {\n    const strings = window.langStrings || {};\n    const keyOrder = {\n      success:\n        subject === \"link\"\n          ? [\"linkCopied\", \"copySuccess\"]\n          : [\"copySuccess\", \"emailCopied\"],\n      error: [\"copyError\", \"emailCopyError\"],\n      unsupported: [\"copyUnsupported\", \"clipboardUnsupported\"],\n    };\n\r\n    const keys = keyOrder[kind] || [];\r\n    for (const key of keys) {\r\n      const value = strings[key];\r\n      if (typeof value === \"function\") {\r\n        const message = value();\r\n        if (typeof message === \"string\" && message.trim()) {return message;}\r\n      } else if (typeof value === \"string\" && value.trim()) {\r\n        return value;\r\n      }\r\n    }\r\n\r\n    const isFa = (document.documentElement.lang || \"\")\r\n      .toLowerCase()\r\n      .startsWith(\"fa\");\r\n\r\n    const fallback = {\n      success: isFa\n        ? subject === \"link\"\n          ? \"\\u0644\\u06cc\\u0646\\u06a9 \\u06a9\\u067e\\u06cc \\u0634\\u062f.\"\n          : \"\\u0627\\u06cc\\u0645\\u06cc\\u0644 \\u06a9\\u067e\\u06cc \\u0634\\u062f.\"\n        : subject === \"link\"\n          ? \"Link copied.\"\n          : \"Email copied.\",\n      error: isFa\n        ? \"\\u06a9\\u067e\\u06cc \\u0628\\u0627 \\u0645\\u0634\\u06a9\\u0644 \\u0645\\u0648\\u0627\\u062c\\u0647 \\u0634\\u062f.\"\n        : \"Copy failed.\",\n      unsupported: isFa\r\n        ? \"\\u0645\\u0631\\u0648\\u0631\\u06af\\u0631 \\u0634\\u0645\\u0627 \\u0627\\u0632 \\u06a9\\u067e\\u06cc \\u062e\\u0648\\u062f\\u06a9\\u0627\\u0631 \\u067e\\u0634\\u062a\\u06cc\\u0628\\u0627\\u0646\\u06cc \\u0646\\u0645\\u06cc\\u200c\\u06a9\\u0646\\u062f.\"\r\n        : \"Your browser does not support automatic copy.\",\r\n    };\r\n\r\n    return fallback[kind] || fallback.error;\n  }\n\n  function resolveShareToastMessage(kind) {\n    const strings = window.langStrings || {};\n    const keyOrder = {\n      success: [\"shareOk\", \"shareSuccess\"],\n      error: [\"shareErr\", \"shareError\"],\n    };\n    const keys = keyOrder[kind] || [];\n\n    for (const key of keys) {\n      const value = strings[key];\n      if (typeof value === \"function\") {\n        const message = value();\n        if (typeof message === \"string\" && message.trim()) {\n          return message;\n        }\n      } else if (typeof value === \"string\" && value.trim()) {\n        return value;\n      }\n    }\n\n    const isFa = (document.documentElement.lang || \"\")\n      .toLowerCase()\n      .startsWith(\"fa\");\n    const fallback = {\n      success: isFa\n        ? \"\\u0627\\u0634\\u062a\\u0631\\u0627\\u06a9\\u200c\\u06af\\u0630\\u0627\\u0631\\u06cc \\u0645\\u0648\\u0641\\u0642 \\u0628\\u0648\\u062f.\"\n        : \"Shared successfully.\",\n      error: isFa\n        ? \"\\u0627\\u0634\\u062a\\u0631\\u0627\\u06a9\\u200c\\u06af\\u0630\\u0627\\u0631\\u06cc \\u0628\\u0627 \\u0645\\u0634\\u06a9\\u0644 \\u0645\\u0648\\u0627\\u062c\\u0647 \\u0634\\u062f.\"\n        : \"Sharing failed.\",\n    };\n\n    return fallback[kind] || fallback.error;\n  }\n\n  function copyWithExecCommand(text) {\n    if (!document.body) {\n      return false;\n    }\n\n    const probe = document.createElement(\"textarea\");\n    probe.value = text;\n    probe.setAttribute(\"readonly\", \"\");\n    probe.setAttribute(\"aria-hidden\", \"true\");\n    probe.style.position = \"absolute\";\n    probe.style.left = \"-9999px\";\n    probe.style.top = \"0\";\n    document.body.appendChild(probe);\n    probe.select();\n\n    try {\n      return !!document.execCommand(\"copy\");\n    } catch {\n      return false;\n    } finally {\n      probe.remove();\n    }\n  }\n\n  async function copyText(text, options = {}) {\n    const allowExecCommand = options.allowExecCommand === true;\n\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n      try {\n        await navigator.clipboard.writeText(text);\n        return { ok: true, mode: \"clipboard\" };\n      } catch {}\n    }\n\n    if (allowExecCommand && copyWithExecCommand(text)) {\n      return { ok: true, mode: \"exec-command\" };\n    }\n\n    return {\n      ok: false,\n      mode:\n        navigator.clipboard && navigator.clipboard.writeText\n          ? \"clipboard-failed\"\n          : \"unsupported\",\n    };\n  }\n\n  function emitToast(message, options) {\n    if (!message || typeof window.createToast !== \"function\") {\n      return;\n    }\n    window.createToast(message, options);\n  }\n\n  function showCopySuccessState(btn) {\n    const originalIcon = btn.innerHTML;\n    btn.innerHTML =\n      '<i class=\"fas fa-check\" aria-hidden=\"true\"></i>';\n    btn.classList.add(\"copied\");\n\n    setTimeout(() => {\n      btn.innerHTML = originalIcon;\n      btn.classList.remove(\"copied\");\n    }, 2000);\n  }\n\n  function bindCopyButton(btn) {\n    if (!(btn instanceof HTMLButtonElement)) {\n      return;\n    }\n    if (btn.dataset.toastCopyBound === \"true\") {\n      return;\n    }\n    btn.dataset.toastCopyBound = \"true\";\n\n    btn.addEventListener(\"click\", async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const textToCopy = btn.getAttribute(\"data-copy\");\n      if (!textToCopy) {\n        console.warn(\"No data-copy attribute found on .copy-btn\");\n        return;\n      }\n      const subject = textToCopy.includes(\"@\") ? \"email\" : \"link\";\n\n      const result = await copyText(textToCopy, {\n        allowExecCommand: false,\n      });\n      if (result.ok) {\n        showCopySuccessState(btn);\n        emitToast(resolveCopyToastMessage(\"success\", subject), {\n          id: \"copy-success-toast\",\n          kind: \"success\",\n          duration: 1800,\n        });\n        return;\n      }\n\n      const failedKind =\n        result.mode === \"unsupported\"\n          ? \"unsupported\"\n          : \"error\";\n      emitToast(resolveCopyToastMessage(failedKind), {\n        id:\n          failedKind === \"unsupported\"\n            ? \"copy-unsupported-toast\"\n            : \"copy-error-toast\",\n        kind: failedKind === \"unsupported\" ? \"info\" : \"error\",\n        duration: failedKind === \"unsupported\" ? 3000 : 2600,\n      });\n    });\n  }\n\n  function bindShareButton(btn) {\n    if (!(btn instanceof HTMLButtonElement)) {\n      return;\n    }\n    if (btn.dataset.toastShareBound === \"true\") {\n      return;\n    }\n    btn.dataset.toastShareBound = \"true\";\n\n    btn.addEventListener(\"click\", async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const shareUrl = btn.getAttribute(\"data-share\") || window.location.href;\n      if (!shareUrl) {\n        return;\n      }\n\n      if (typeof navigator.share === \"function\") {\n        try {\n          await navigator.share({\n            title: document.title,\n            url: shareUrl,\n          });\n          emitToast(resolveShareToastMessage(\"success\"), {\n            id: \"share-success-toast\",\n            kind: \"success\",\n            duration: 1800,\n          });\n          return;\n        } catch (err) {\n          if (err && err.name === \"AbortError\") {\n            return;\n          }\n        }\n      }\n\n      const copied = await copyText(shareUrl, {\n        allowExecCommand: true,\n      });\n      if (copied.ok) {\n        emitToast(resolveCopyToastMessage(\"success\", \"link\"), {\n          id: \"share-copy-toast\",\n          kind: \"success\",\n          duration: 2000,\n        });\n        return;\n      }\n\n      emitToast(resolveShareToastMessage(\"error\"), {\n        id: \"share-error-toast\",\n        kind: \"error\",\n        duration: 2800,\n      });\n    });\n  }\n\n  // Copy/share interactions (global + proof cards)\n  document.querySelectorAll(\".copy-btn\").forEach((btn) => {\n    bindCopyButton(btn);\n  });\n  document.querySelectorAll(\".share-btn\").forEach((btn) => {\n    bindShareButton(btn);\n  });\n\r\n  // ---- Neurodesign Enhancements Initialization ----\r\n\r\n  // 1. Scroll Progress Bar Logic is handled by updateProgressBar() and existing HTML\r\n\r\n  // 2. Ripple Effect for Buttons\n  document.addEventListener(\"click\", function (e) {\n    const origin = e.target;\n    if (!(origin instanceof Element)) {\n      return;\n    }\n\n    const target = origin.closest(\".btn, button, .cta-button, .hero-btn\");\n    if (target) {\n      const rect = target.getBoundingClientRect();\n      const x = e.clientX - rect.left;\n      const y = e.clientY - rect.top;\n\r\n      const ripple = document.createElement(\"span\");\r\n      ripple.className = \"ripple\";\r\n      ripple.style.left = `${x}px`;\r\n      ripple.style.top = `${y}px`;\r\n\r\n      target.appendChild(ripple);\r\n\r\n      setTimeout(() => {\r\n        ripple.remove();\r\n      }, 600);\r\n    }\r\n  });\r\n\r\n  // 3. Success Trigger Helper\r\n  window.triggerSuccess = function (element) {\r\n    if (!element) {return;}\r\n    element.classList.add(\"success-trigger\");\r\n    setTimeout(() => {\r\n      element.classList.remove(\"success-trigger\");\r\n    }, 300);\r\n  };\r\n\r\n})();\r\n"]}