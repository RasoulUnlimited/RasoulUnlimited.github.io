{"version":3,"file":"main-script-base.min.js","names":["window","langStrings","storage","testKey","localStorage","setItem","removeItem","err","getSafeStorage","darkMediaQuery","matchMedia","prefersDark","matches","THEME_STORAGE_KEY","LEGACY_THEME_STORAGE_KEY","isValidTheme","value","readStoredTheme","storedTheme","getItem","legacyTheme","savedTheme","reduceMotionQuery","prefersReducedMotion","createToast","message","type","document","body","console","warn","toast","createElement","setAttribute","className","iconHtml","innerHTML","String","existingToasts","querySelectorAll","length","forEach","t","index","parentNode","remove","appendChild","requestAnimationFrame","classList","add","setTimeout","applyTheme","theme","showToast","isDark","shouldShowToast","toggle","documentElement","getElementById","checked","themeChanged","msg","handleThemeSystemChange","e","addEventListener","addListener","initThemeToggle","themeToggleInput","dataset","themeToggleInit","currentTheme","getAttribute","newTheme","event","key","preventDefault","endOfPageShown","lastScrollY","ticking","scrollY","pageYOffset","scrollPosition","innerHeight","docHeight","Math","max","scrollHeight","offsetHeight","endOfPage","checkPageEnd","progressBar","scrollTop","clientHeight","style","width","scrollPercent","clamped","min","round","updateProgressBar","passive","yearEl","textContent","Date","getFullYear","backToTopBtn","resolveCopyToastMessage","kind","strings","keys","success","error","unsupported","trim","isFa","lang","toLowerCase","startsWith","fallback","scrollTo","top","behavior","btn","stopPropagation","textToCopy","navigator","clipboard","writeText","then","originalIcon","catch","target","closest","rect","getBoundingClientRect","x","clientX","left","y","clientY","ripple","triggerSuccess","element"],"sources":["main-script-base.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  // Ensure language strings object exists\r\n  if (!window.langStrings) {\r\n    window.langStrings = {};\r\n  }\r\n\r\n  /**\r\n   * Safe localStorage accessor with feature / privacy mode detection\r\n   */\r\n  function getSafeStorage() {\r\n    const testKey = \"__theme_pref__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch (err) {\r\n      // e.g. Safari private mode or blocked storage\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\r\n\r\n  // Reuse a single MediaQueryList if available\r\n  const darkMediaQuery = window.matchMedia\n    ? window.matchMedia(\"(prefers-color-scheme: dark)\")\n    : null;\n  const prefersDark = !!(darkMediaQuery && darkMediaQuery.matches);\n  const THEME_STORAGE_KEY = \"theme\";\n  const LEGACY_THEME_STORAGE_KEY = \"app:theme\";\n\n  function isValidTheme(value) {\n    return value === \"dark\" || value === \"light\";\n  }\n\n  function readStoredTheme() {\n    if (!storage) {return null;}\n\n    const storedTheme = storage.getItem(THEME_STORAGE_KEY);\n    if (isValidTheme(storedTheme)) {\n      return storedTheme;\n    }\n\n    const legacyTheme = storage.getItem(LEGACY_THEME_STORAGE_KEY);\n    if (!isValidTheme(legacyTheme)) {\n      return null;\n    }\n\n    // One-time migration from legacy key to canonical key.\n    try {\n      storage.setItem(THEME_STORAGE_KEY, legacyTheme);\n      storage.removeItem(LEGACY_THEME_STORAGE_KEY);\n    } catch (err) {\n      // Ignore storage failures in restricted environments.\n    }\n\n    return legacyTheme;\n  }\n\n  const savedTheme = readStoredTheme();\n\r\n  // Motion preference (for smooth scroll, etc.)\r\n  const reduceMotionQuery = window.matchMedia\r\n    ? window.matchMedia(\"(prefers-reduced-motion: reduce)\")\r\n    : null;\r\n  const prefersReducedMotion = !!(reduceMotionQuery && reduceMotionQuery.matches);\r\n\r\n  /**\r\n   * Enhanced toast helper with types and icons\r\n   * @param {string} message\r\n   * @param {\"success\"|\"error\"|\"info\"|\"default\"} [type=\"default\"]\r\n   */\r\n  function createToast(message, type = \"default\") {\r\n    if (!message) {return;}\r\n    if (!document.body) {\r\n      console.warn(\"Cannot show toast: document.body not ready\");\r\n      return;\r\n    }\r\n\r\n    const toast = document.createElement(\"div\");\r\n    toast.setAttribute(\"role\", \"status\");\r\n    toast.setAttribute(\"aria-live\", \"polite\");\r\n    toast.className = `dynamic-toast ${type}`;\r\n\r\n    // Add icon based on type\r\n    let iconHtml = \"\";\r\n    if (type === \"success\") {\r\n      iconHtml = '<i class=\"fas fa-check-circle\" aria-hidden=\"true\"></i> ';\r\n    } else if (type === \"error\") {\r\n      iconHtml = '<i class=\"fas fa-exclamation-circle\" aria-hidden=\"true\"></i> ';\r\n    } else if (type === \"info\") {\r\n      iconHtml = '<i class=\"fas fa-info-circle\" aria-hidden=\"true\"></i> ';\r\n    }\r\n\r\n    toast.innerHTML = `${iconHtml}<span>${String(message)}</span>`;\r\n\r\n    // Optional: prevent infinite stacking by removing oldest toast if too many\r\n    const existingToasts = document.querySelectorAll(\".dynamic-toast\");\r\n    if (existingToasts.length > 3) {\r\n      existingToasts.forEach((t, index) => {\r\n        if (index === 0 && t.parentNode) {t.remove();}\r\n      });\r\n    }\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    // Trigger CSS transition\r\n    requestAnimationFrame(() => toast.classList.add(\"show\"));\r\n\r\n    // Auto-hide\r\n    setTimeout(() => {\r\n      toast.classList.remove(\"show\");\r\n      // Wait for CSS transition to finish if any\r\n      setTimeout(() => {\r\n        if (toast.parentNode) {toast.remove();}\r\n      }, 300);\r\n    }, 3000);\r\n  }\r\n\r\n  // Expose toast helper globally if not already defined\r\n  if (typeof window.createToast !== \"function\") {\r\n    window.createToast = createToast;\r\n  }\r\n\r\n  /**\r\n   * Apply theme and sync toggle + a11y attributes.\r\n   * @param {\"dark\"|\"light\"} theme\r\n   * @param {boolean} [showToast=false]\r\n   */\r\n  function applyTheme(theme, showToast) {\r\n    const isDark = theme === \"dark\";\r\n    const shouldShowToast = !!showToast;\r\n\r\n    document.body.classList.toggle(\"dark-mode\", isDark);\r\n    document.body.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    // Optional: expose theme on <html> for CSS theming\r\n    document.documentElement.setAttribute(\"data-theme\", theme);\r\n\r\n    const toggle = document.getElementById(\"theme-toggle\");\r\n    if (toggle) {\r\n      toggle.checked = isDark;\r\n      toggle.setAttribute(\"aria-checked\", String(isDark));\r\n    }\r\n\r\n    if (\r\n      shouldShowToast &&\r\n      typeof window.langStrings.themeChanged === \"function\"\r\n    ) {\r\n      // themeChanged(theme) â†’ localized message\r\n      const msg = window.langStrings.themeChanged(theme);\r\n      if (msg) {createToast(msg);}\r\n    }\r\n  }\r\n\r\n  // Initial theme: stored preference > system preference\r\n  if (savedTheme === \"dark\" || savedTheme === \"light\") {\r\n    applyTheme(savedTheme);\r\n  } else {\r\n    applyTheme(prefersDark ? \"dark\" : \"light\");\r\n  }\r\n\r\n  // React to OS theme changes only if user has not explicitly chosen a theme\r\n  if (darkMediaQuery) {\n    const handleThemeSystemChange = function (e) {\n      // If user later sets a theme, this check prevents overriding it\n      if (!readStoredTheme()) {\n        applyTheme(e.matches ? \"dark\" : \"light\");\n      }\n    };\n\r\n    if (typeof darkMediaQuery.addEventListener === \"function\") {\r\n      darkMediaQuery.addEventListener(\"change\", handleThemeSystemChange);\r\n    } else if (typeof darkMediaQuery.addListener === \"function\") {\r\n      // Older browsers\r\n      darkMediaQuery.addListener(handleThemeSystemChange);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize theme toggle (can be called multiple times safely).\r\n   */\r\n  function initThemeToggle() {\n    const themeToggleInput = document.getElementById(\"theme-toggle\");\n    if (!themeToggleInput) {return;}\n\r\n    // Avoid attaching listeners multiple times on dynamic includes\r\n    if (themeToggleInput.dataset.themeToggleInit === \"true\") {\r\n      return;\r\n    }\r\n    themeToggleInput.dataset.themeToggleInit = \"true\";\n\n    const currentTheme = document.documentElement.getAttribute(\"data-theme\");\n    if (currentTheme === \"dark\" || currentTheme === \"light\") {\n      themeToggleInput.checked = currentTheme === \"dark\";\n    }\n\n    // Sync ARIA\n    themeToggleInput.setAttribute(\n      \"aria-checked\",\n      String(!!themeToggleInput.checked)\n    );\n    themeToggleInput.setAttribute(\"role\", \"switch\");\r\n\r\n    // Change by click\r\n    themeToggleInput.addEventListener(\"change\", () => {\n      const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\n      applyTheme(newTheme, true);\n      try {\n        storage?.setItem(THEME_STORAGE_KEY, newTheme);\n      } catch (err) {\n        // Ignore storage failures (e.g., private mode)\n      }\n    });\r\n\r\n    // Keyboard accessibility (Space / Enter)\r\n    themeToggleInput.addEventListener(\"keydown\", (event) => {\r\n      if (event.key === \" \" || event.key === \"Enter\") {\r\n        event.preventDefault();\r\n        themeToggleInput.checked = !themeToggleInput.checked;\n        const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\n        applyTheme(newTheme, true);\n        try {\n          storage?.setItem(THEME_STORAGE_KEY, newTheme);\n        } catch (err) {}\n      }\n    });\n  }\r\n\r\n  // Init theme toggle on first load\r\n  initThemeToggle();\r\n  // Re-init if header/footer includes loaded dynamically\r\n  document.addEventListener(\"includesLoaded\", initThemeToggle, false);\r\n\r\n  // ---- End-of-page toast logic ----\r\n\r\n  let endOfPageShown = false;\r\n  let lastScrollY = 0;\r\n  let ticking = false;\r\n\r\n  function checkPageEnd() {\r\n    const scrollPosition = window.innerHeight + lastScrollY;\r\n    const docHeight =\r\n      Math.max(\r\n        document.body.scrollHeight,\r\n        document.documentElement.scrollHeight,\r\n        document.body.offsetHeight,\r\n        document.documentElement.offsetHeight\r\n      ) || 0;\r\n\r\n    // Reset flag if user scrolls back up (more than 100px from bottom)\r\n    if (scrollPosition < docHeight - 100) {\r\n      endOfPageShown = false;\r\n    }\r\n\r\n    if (!endOfPageShown && scrollPosition >= docHeight - 50 && docHeight > 0) {\r\n      endOfPageShown = true;\r\n      if (typeof window.langStrings.endOfPage === \"string\") {\r\n        createToast(window.langStrings.endOfPage);\r\n      } else if (typeof window.langStrings.endOfPage === \"function\") {\r\n        const msg = window.langStrings.endOfPage();\r\n        if (msg) {createToast(msg);}\r\n      }\r\n    }\r\n    ticking = false;\r\n  }\r\n\r\n  function updateProgressBar() {\r\n    const progressBar = document.getElementById(\"scroll-progress-bar\");\r\n    if (!progressBar) {return;}\r\n\r\n    const scrollTop =\r\n      window.scrollY || document.documentElement.scrollTop || 0;\r\n    const docHeight =\r\n      document.documentElement.scrollHeight -\r\n      document.documentElement.clientHeight;\r\n\r\n    if (docHeight <= 0) {\r\n      progressBar.style.width = \"0%\";\r\n      progressBar.setAttribute(\"aria-valuenow\", \"0\");\r\n      return;\r\n    }\r\n\r\n    const scrollPercent = (scrollTop / docHeight) * 100;\r\n    const clamped = Math.max(0, Math.min(100, scrollPercent));\r\n\r\n    progressBar.style.width = clamped + \"%\";\r\n    progressBar.setAttribute(\"aria-valuenow\", Math.round(clamped));\r\n  }\r\n\r\n  window.addEventListener(\r\n    \"scroll\",\r\n    () => {\r\n      lastScrollY = window.scrollY || window.pageYOffset || 0;\r\n      if (!ticking) {\r\n        window.requestAnimationFrame(() => {\r\n          checkPageEnd();\r\n          updateProgressBar();\r\n        });\r\n        ticking = true;\r\n      }\r\n    },\r\n    { passive: true }\r\n  );\r\n\r\n  // Footer year\r\n  const yearEl =\r\n    document.getElementById(\"current-year\") ||\r\n    document.getElementById(\"footer-year\");\r\n  if (yearEl) {\r\n    yearEl.textContent = new Date().getFullYear();\r\n  }\r\n\r\n  // Back to Top Button Logic\r\n  const backToTopBtn = document.getElementById(\"back-to-top\");\r\n  if (backToTopBtn) {\r\n    window.addEventListener(\r\n      \"scroll\",\r\n      () => {\r\n        if (window.scrollY > 300) {\r\n          backToTopBtn.classList.add(\"show\");\r\n        } else {\r\n          backToTopBtn.classList.remove(\"show\");\r\n        }\r\n      },\r\n      { passive: true }\r\n    );\r\n\r\n    backToTopBtn.addEventListener(\"click\", () => {\r\n      window.scrollTo({\r\n        top: 0,\r\n        behavior: prefersReducedMotion ? \"auto\" : \"smooth\",\r\n      });\r\n    });\r\n  }\r\n\r\n  function resolveCopyToastMessage(kind) {\r\n    const strings = window.langStrings || {};\r\n    const keyOrder = {\r\n      success: [\"copySuccess\", \"emailCopied\"],\r\n      error: [\"copyError\", \"emailCopyError\"],\r\n      unsupported: [\"copyUnsupported\", \"clipboardUnsupported\"],\r\n    };\r\n\r\n    const keys = keyOrder[kind] || [];\r\n    for (const key of keys) {\r\n      const value = strings[key];\r\n      if (typeof value === \"function\") {\r\n        const message = value();\r\n        if (typeof message === \"string\" && message.trim()) {return message;}\r\n      } else if (typeof value === \"string\" && value.trim()) {\r\n        return value;\r\n      }\r\n    }\r\n\r\n    const isFa = (document.documentElement.lang || \"\")\r\n      .toLowerCase()\r\n      .startsWith(\"fa\");\r\n\r\n    const fallback = {\r\n      success: isFa\r\n        ? \"\\u0627\\u06cc\\u0645\\u06cc\\u0644 \\u06a9\\u067e\\u06cc \\u0634\\u062f.\"\r\n        : \"Email copied.\",\r\n      error: isFa\r\n        ? \"\\u06a9\\u067e\\u06cc \\u0628\\u0627 \\u0645\\u0634\\u06a9\\u0644 \\u0645\\u0648\\u0627\\u062c\\u0647 \\u0634\\u062f.\"\r\n        : \"Copy failed.\",\r\n      unsupported: isFa\r\n        ? \"\\u0645\\u0631\\u0648\\u0631\\u06af\\u0631 \\u0634\\u0645\\u0627 \\u0627\\u0632 \\u06a9\\u067e\\u06cc \\u062e\\u0648\\u062f\\u06a9\\u0627\\u0631 \\u067e\\u0634\\u062a\\u06cc\\u0628\\u0627\\u0646\\u06cc \\u0646\\u0645\\u06cc\\u200c\\u06a9\\u0646\\u062f.\"\r\n        : \"Your browser does not support automatic copy.\",\r\n    };\r\n\r\n    return fallback[kind] || fallback.error;\r\n  }\r\n\r\n  // Copy to Clipboard Logic\r\n  const copyBtns = document.querySelectorAll(\".copy-btn\");\r\n  copyBtns.forEach((btn) => {\r\n    btn.addEventListener(\"click\", (event) => {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n\r\n      const textToCopy = btn.getAttribute(\"data-copy\");\r\n      if (!textToCopy) {\r\n        console.warn(\"No data-copy attribute found on .copy-btn\");\r\n        return;\r\n      }\r\n\r\n      if (!navigator.clipboard || !navigator.clipboard.writeText) {\r\n        console.warn(\"Clipboard API not available\");\r\n        if (window.createToast) {\r\n          window.createToast(resolveCopyToastMessage(\"unsupported\"));\r\n        }\r\n        return;\r\n      }\r\n\r\n      navigator.clipboard\r\n        .writeText(textToCopy)\r\n        .then(() => {\r\n          const originalIcon = btn.innerHTML;\r\n          btn.innerHTML =\r\n            '<i class=\"fas fa-check\" aria-hidden=\"true\"></i>';\r\n          btn.classList.add(\"copied\");\r\n\r\n          if (window.createToast) {\r\n            window.createToast(resolveCopyToastMessage(\"success\"));\r\n          }\r\n\r\n          setTimeout(() => {\r\n            btn.innerHTML = originalIcon;\r\n            btn.classList.remove(\"copied\");\r\n          }, 2000);\r\n        })\r\n        .catch((err) => {\r\n          console.error(\"Failed to copy: \", err);\r\n          if (window.createToast) {\r\n            window.createToast(resolveCopyToastMessage(\"error\"));\r\n          }\r\n        });\r\n    });\r\n  });\r\n\r\n  // ---- Neurodesign Enhancements Initialization ----\r\n\r\n  // 1. Scroll Progress Bar Logic is handled by updateProgressBar() and existing HTML\r\n\r\n  // 2. Ripple Effect for Buttons\r\n  document.addEventListener(\"click\", function (e) {\r\n    const target = e.target.closest(\".btn, button, .cta-button, .hero-btn\");\r\n    if (target) {\r\n      const rect = target.getBoundingClientRect();\r\n      const x = e.clientX - rect.left;\r\n      const y = e.clientY - rect.top;\r\n\r\n      const ripple = document.createElement(\"span\");\r\n      ripple.className = \"ripple\";\r\n      ripple.style.left = `${x}px`;\r\n      ripple.style.top = `${y}px`;\r\n\r\n      target.appendChild(ripple);\r\n\r\n      setTimeout(() => {\r\n        ripple.remove();\r\n      }, 600);\r\n    }\r\n  });\r\n\r\n  // 3. Success Trigger Helper\r\n  window.triggerSuccess = function (element) {\r\n    if (!element) {return;}\r\n    element.classList.add(\"success-trigger\");\r\n    setTimeout(() => {\r\n      element.classList.remove(\"success-trigger\");\r\n    }, 300);\r\n  };\r\n\r\n})();\r\n"]}