{"version":3,"file":"main-script-base.min.js","names":["window","langStrings","console","warn","storage","testKey","localStorage","setItem","removeItem","err","getSafeStorage","darkMediaQuery","matchMedia","prefersDark","matches","savedTheme","getItem","reduceMotionQuery","prefersReducedMotion","createToast","message","document","body","toast","createElement","setAttribute","className","textContent","String","existingToasts","querySelectorAll","length","forEach","t","index","parentNode","remove","appendChild","requestAnimationFrame","classList","add","setTimeout","applyTheme","theme","showToast","isDark","shouldShowToast","toggle","documentElement","getElementById","checked","themeChanged","msg","handleThemeSystemChange","e","addEventListener","addListener","initThemeToggle","themeToggleInput","dataset","themeToggleInit","newTheme","event","key","preventDefault","endOfPageShown","lastScrollY","ticking","scrollY","pageYOffset","scrollPosition","innerHeight","docHeight","Math","max","scrollHeight","offsetHeight","endOfPage","checkPageEnd","progressBar","scrollTop","clientHeight","style","width","scrollPercent","clamped","min","round","updateProgressBar","passive","yearEl","Date","getFullYear","backToTopBtn","scrollTo","top","behavior","btn","textToCopy","getAttribute","navigator","clipboard","writeText","then","originalIcon","innerHTML","catch","error"],"sources":["main-script-base.js"],"mappings":"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","ignoreList":[],"sourcesContent":["(function () {\r\n  \"use strict\";\r\n\r\n  // Ensure language strings object exists\r\n  if (!window.langStrings) {\r\n    console.warn(\"No language strings loaded\");\r\n    window.langStrings = {};\r\n  }\r\n\r\n  /**\r\n   * Safe localStorage accessor with feature / privacy mode detection\r\n   */\r\n  function getSafeStorage() {\r\n    const testKey = \"__theme_pref__\";\r\n    try {\r\n      localStorage.setItem(testKey, testKey);\r\n      localStorage.removeItem(testKey);\r\n      return localStorage;\r\n    } catch (err) {\r\n      // e.g. Safari private mode or blocked storage\r\n      return null;\r\n    }\r\n  }\r\n\r\n  const storage = getSafeStorage();\r\n\r\n  // Reuse a single MediaQueryList if available\r\n  const darkMediaQuery = window.matchMedia\r\n    ? window.matchMedia(\"(prefers-color-scheme: dark)\")\r\n    : null;\r\n  const prefersDark = !!(darkMediaQuery && darkMediaQuery.matches);\r\n  const savedTheme = storage?.getItem(\"theme\") || null;\r\n\r\n  // Motion preference (for smooth scroll, etc.)\r\n  const reduceMotionQuery = window.matchMedia\r\n    ? window.matchMedia(\"(prefers-reduced-motion: reduce)\")\r\n    : null;\r\n  const prefersReducedMotion = !!(reduceMotionQuery && reduceMotionQuery.matches);\r\n\r\n  /**\r\n   * Basic toast helper (string-only API to stay compatible)\r\n   * Other scripts can call window.createToast(\"message\").\r\n   */\r\n  function createToast(message) {\r\n    if (!message) {return;}\r\n    if (!document.body) {\r\n      console.warn(\"Cannot show toast: document.body not ready\");\r\n      return;\r\n    }\r\n\r\n    const toast = document.createElement(\"div\");\r\n    toast.setAttribute(\"role\", \"status\");\r\n    toast.setAttribute(\"aria-live\", \"polite\");\r\n    toast.className = \"dynamic-toast\";\r\n    toast.textContent = String(message);\r\n\r\n    // Optional: prevent infinite stacking by removing oldest toast if too many\r\n    const existingToasts = document.querySelectorAll(\".dynamic-toast\");\r\n    if (existingToasts.length > 3) {\r\n      existingToasts.forEach((t, index) => {\r\n        if (index === 0 && t.parentNode) {t.remove();}\r\n      });\r\n    }\r\n\r\n    document.body.appendChild(toast);\r\n\r\n    // Trigger CSS transition\r\n    requestAnimationFrame(() => toast.classList.add(\"show\"));\r\n\r\n    // Auto-hide\r\n    setTimeout(() => {\r\n      toast.classList.remove(\"show\");\r\n      // Wait for CSS transition to finish if any\r\n      setTimeout(() => {\r\n        if (toast.parentNode) {toast.remove();}\r\n      }, 300);\r\n    }, 3000);\r\n  }\r\n\r\n  // Expose toast helper globally if not already defined\r\n  if (typeof window.createToast !== \"function\") {\r\n    window.createToast = createToast;\r\n  }\r\n\r\n  /**\r\n   * Apply theme and sync toggle + a11y attributes.\r\n   * @param {\"dark\"|\"light\"} theme\r\n   * @param {boolean} [showToast=false]\r\n   */\r\n  function applyTheme(theme, showToast) {\r\n    const isDark = theme === \"dark\";\r\n    const shouldShowToast = !!showToast;\r\n\r\n    document.body.classList.toggle(\"dark-mode\", isDark);\r\n    document.body.classList.toggle(\"light-mode\", !isDark);\r\n\r\n    // Optional: expose theme on <html> for CSS theming\r\n    document.documentElement.setAttribute(\"data-theme\", theme);\r\n\r\n    const toggle = document.getElementById(\"theme-toggle\");\r\n    if (toggle) {\r\n      toggle.checked = isDark;\r\n      toggle.setAttribute(\"aria-checked\", String(isDark));\r\n    }\r\n\r\n    if (\r\n      shouldShowToast &&\r\n      typeof window.langStrings.themeChanged === \"function\"\r\n    ) {\r\n      // themeChanged(theme) → localized message\r\n      const msg = window.langStrings.themeChanged(theme);\r\n      if (msg) {createToast(msg);}\r\n    }\r\n  }\r\n\r\n  // Initial theme: stored preference > system preference\r\n  if (savedTheme === \"dark\" || savedTheme === \"light\") {\r\n    applyTheme(savedTheme);\r\n  } else {\r\n    applyTheme(prefersDark ? \"dark\" : \"light\");\r\n  }\r\n\r\n  // React to OS theme changes only if user has not explicitly chosen a theme\r\n  if (darkMediaQuery) {\r\n    const handleThemeSystemChange = function (e) {\r\n      // If user later sets a theme, this check prevents overriding it\r\n      if (!storage?.getItem(\"theme\")) {\r\n        applyTheme(e.matches ? \"dark\" : \"light\");\r\n      }\r\n    };\r\n\r\n    if (typeof darkMediaQuery.addEventListener === \"function\") {\r\n      darkMediaQuery.addEventListener(\"change\", handleThemeSystemChange);\r\n    } else if (typeof darkMediaQuery.addListener === \"function\") {\r\n      // Older browsers\r\n      darkMediaQuery.addListener(handleThemeSystemChange);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize theme toggle (can be called multiple times safely).\r\n   */\r\n  function initThemeToggle() {\r\n    const themeToggleInput = document.getElementById(\"theme-toggle\");\r\n    if (!themeToggleInput) {return;}\r\n\r\n    // Avoid attaching listeners multiple times on dynamic includes\r\n    if (themeToggleInput.dataset.themeToggleInit === \"true\") {\r\n      return;\r\n    }\r\n    themeToggleInput.dataset.themeToggleInit = \"true\";\r\n\r\n    // Sync ARIA\r\n    themeToggleInput.setAttribute(\r\n      \"aria-checked\",\r\n      String(!!themeToggleInput.checked)\r\n    );\r\n    themeToggleInput.setAttribute(\"role\", \"switch\");\r\n\r\n    // Change by click\r\n    themeToggleInput.addEventListener(\"change\", () => {\r\n      const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\r\n      applyTheme(newTheme, true);\r\n      try {\r\n        storage?.setItem(\"theme\", newTheme);\r\n      } catch (err) {\r\n        // Ignore storage failures (e.g., private mode)\r\n      }\r\n    });\r\n\r\n    // Keyboard accessibility (Space / Enter)\r\n    themeToggleInput.addEventListener(\"keydown\", (event) => {\r\n      if (event.key === \" \" || event.key === \"Enter\") {\r\n        event.preventDefault();\r\n        themeToggleInput.checked = !themeToggleInput.checked;\r\n        const newTheme = themeToggleInput.checked ? \"dark\" : \"light\";\r\n        applyTheme(newTheme, true);\r\n        try {\r\n          storage?.setItem(\"theme\", newTheme);\r\n        } catch (err) {}\r\n      }\r\n    });\r\n  }\r\n\r\n  // Init theme toggle on first load\r\n  initThemeToggle();\r\n  // Re-init if header/footer includes loaded dynamically\r\n  document.addEventListener(\"includesLoaded\", initThemeToggle, false);\r\n\r\n  // ---- End-of-page toast logic ----\r\n\r\n  let endOfPageShown = false;\r\n  let lastScrollY = 0;\r\n  let ticking = false;\r\n\r\n  function checkPageEnd() {\r\n    const scrollPosition = window.innerHeight + lastScrollY;\r\n    const docHeight =\r\n      Math.max(\r\n        document.body.scrollHeight,\r\n        document.documentElement.scrollHeight,\r\n        document.body.offsetHeight,\r\n        document.documentElement.offsetHeight\r\n      ) || 0;\r\n\r\n    // Reset flag if user scrolls back up (more than 100px from bottom)\r\n    if (scrollPosition < docHeight - 100) {\r\n      endOfPageShown = false;\r\n    }\r\n\r\n    if (!endOfPageShown && scrollPosition >= docHeight - 50 && docHeight > 0) {\r\n      endOfPageShown = true;\r\n      if (typeof window.langStrings.endOfPage === \"string\") {\r\n        createToast(window.langStrings.endOfPage);\r\n      } else if (typeof window.langStrings.endOfPage === \"function\") {\r\n        const msg = window.langStrings.endOfPage();\r\n        if (msg) {createToast(msg);}\r\n      }\r\n    }\r\n    ticking = false;\r\n  }\r\n\r\n  function updateProgressBar() {\r\n    const progressBar = document.getElementById(\"scroll-progress-bar\");\r\n    if (!progressBar) return;\r\n\r\n    const scrollTop =\r\n      window.scrollY || document.documentElement.scrollTop || 0;\r\n    const docHeight =\r\n      document.documentElement.scrollHeight -\r\n      document.documentElement.clientHeight;\r\n\r\n    if (docHeight <= 0) {\r\n      progressBar.style.width = \"0%\";\r\n      progressBar.setAttribute(\"aria-valuenow\", \"0\");\r\n      return;\r\n    }\r\n\r\n    const scrollPercent = (scrollTop / docHeight) * 100;\r\n    const clamped = Math.max(0, Math.min(100, scrollPercent));\r\n\r\n    progressBar.style.width = clamped + \"%\";\r\n    progressBar.setAttribute(\"aria-valuenow\", Math.round(clamped));\r\n  }\r\n\r\n  window.addEventListener(\r\n    \"scroll\",\r\n    () => {\r\n      lastScrollY = window.scrollY || window.pageYOffset || 0;\r\n      if (!ticking) {\r\n        window.requestAnimationFrame(() => {\r\n          checkPageEnd();\r\n          updateProgressBar();\r\n        });\r\n        ticking = true;\r\n      }\r\n    },\r\n    { passive: true }\r\n  );\r\n\r\n  // Footer year\r\n  const yearEl =\r\n    document.getElementById(\"current-year\") ||\r\n    document.getElementById(\"footer-year\");\r\n  if (yearEl) {\r\n    yearEl.textContent = new Date().getFullYear();\r\n  }\r\n\r\n  // Back to Top Button Logic\r\n  const backToTopBtn = document.getElementById(\"back-to-top\");\r\n  if (backToTopBtn) {\r\n    window.addEventListener(\r\n      \"scroll\",\r\n      () => {\r\n        if (window.scrollY > 300) {\r\n          backToTopBtn.classList.add(\"show\");\r\n        } else {\r\n          backToTopBtn.classList.remove(\"show\");\r\n        }\r\n      },\r\n      { passive: true }\r\n    );\r\n\r\n    backToTopBtn.addEventListener(\"click\", () => {\r\n      window.scrollTo({\r\n        top: 0,\r\n        behavior: prefersReducedMotion ? \"auto\" : \"smooth\",\r\n      });\r\n    });\r\n  }\r\n\r\n  // Copy to Clipboard Logic\r\n  const copyBtns = document.querySelectorAll(\".copy-btn\");\r\n  copyBtns.forEach((btn) => {\r\n    btn.addEventListener(\"click\", () => {\r\n      const textToCopy = btn.getAttribute(\"data-copy\");\r\n      if (!textToCopy) {\r\n        console.warn(\"No data-copy attribute found on .copy-btn\");\r\n        return;\r\n      }\r\n\r\n      if (!navigator.clipboard || !navigator.clipboard.writeText) {\r\n        console.warn(\"Clipboard API not available\");\r\n        if (window.createToast) {\r\n          window.createToast(\"مرورگر شما از کپی خودکار پشتیبانی نمی‌کند.\");\r\n        }\r\n        return;\r\n      }\r\n\r\n      navigator.clipboard\r\n        .writeText(textToCopy)\r\n        .then(() => {\r\n          // Show feedback\r\n          const originalIcon = btn.innerHTML;\r\n          btn.innerHTML =\r\n            '<i class=\"fas fa-check\" aria-hidden=\"true\"></i>';\r\n          btn.classList.add(\"copied\");\r\n\r\n          if (window.createToast) {\r\n            // این پیام را می‌توانی بعداً با langStrings هم محلی‌سازی کنی\r\n            window.createToast(\"ایمیل کپی شد!\");\r\n          }\r\n\r\n          setTimeout(() => {\r\n            btn.innerHTML = originalIcon;\r\n            btn.classList.remove(\"copied\");\r\n          }, 2000);\r\n        })\r\n        .catch((err) => {\r\n          console.error(\"Failed to copy: \", err);\r\n          if (window.createToast) {\r\n            window.createToast(\"کپی کردن با مشکل مواجه شد.\");\r\n          }\r\n        });\r\n    });\r\n  });\r\n})();\r\n"]}