document.addEventListener("DOMContentLoaded",function(){let r=document.getElementById("credential-search"),o=document.getElementById("clear-credential-search"),s=document.getElementById("voice-search-btn"),m=document.getElementById("results-info"),u=document.querySelectorAll(".credential-card"),y=m?.dataset.lang||document.documentElement.lang||"en";if(r&&o){let t="credentialSearchTerm";var e=localStorage.getItem(t)||"";e&&(r.value=e,o.style.display="block");let a,c=e=>(e||"").normalize("NFC").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").replace(/[\u064B-\u065F\u0670]/g,"").replace(/‌/g,""),l=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=(u.forEach(e=>{var t=e.querySelector("h3"),e=e.querySelector(".credential-summary");t&&(t.dataset.original=t.textContent),e&&(e.dataset.original=e.textContent)}),(e,t)=>{e&&e.dataset.original&&(t?(t=new RegExp(`(${l(t)})`,"gi"),e.innerHTML=e.dataset.original.replace(t,"<mark>$1</mark>")):e.innerHTML=e.dataset.original)}),n=e=>{let o=void 0!==e?e:r.value.trim(),s=c(o).toLowerCase(),i=0;var t;u.forEach(e=>{var t=e.querySelector("h3"),a=e.querySelector(".credential-summary"),l=c(e.dataset.keywords||"").toLowerCase(),n=t?c(t.dataset.original).toLowerCase():"",r=a?c(a.dataset.original).toLowerCase():"";n.includes(s)||r.includes(s)||l.includes(s)?(e.style.display="grid",d(t,o),d(a,o),i++):(e.style.display="none",d(t,""),d(a,""))}),e=i,m&&(y.startsWith("fa")?m.textContent=0===e?"موردی یافت نشد":e+" نتیجه یافت شد":(t=1===e?"result":"results",m.textContent=0===e?"No results found":e+` ${t} found`))};if(r.addEventListener("input",()=>{let e=r.value.trim();o.style.display=e?"block":"none",e?localStorage.setItem(t,e):localStorage.removeItem(t),clearTimeout(a),a=setTimeout(()=>n(e),200)}),o.addEventListener("click",()=>{r.value="",o.style.display="none",localStorage.removeItem(t),clearTimeout(a),n("")}),r.addEventListener("keydown",e=>{"Escape"===e.key?(r.value="",o.style.display="none",localStorage.removeItem(t),clearTimeout(a),n("")):(e.ctrlKey||e.metaKey)&&"l"===e.key.toLowerCase()&&(e.preventDefault(),r.value="",o.style.display="none",localStorage.removeItem(t),clearTimeout(a),n(""))}),s){var i=window.SpeechRecognition||window.webkitSpeechRecognition;if(i){let e=new i;e.lang=y.startsWith("fa")?"fa-IR":"en-US",e.interimResults=!1,s.addEventListener("click",()=>e.start()),e.addEventListener("start",()=>{s.classList.add("listening")}),e.addEventListener("end",()=>{s.classList.remove("listening")}),e.addEventListener("result",e=>{e=e.results[0][0].transcript.trim();r.value=e,o.style.display=e?"block":"none",e?localStorage.setItem(t,e):localStorage.removeItem(t),n(e)})}else s.style.display="none"}document.addEventListener("keydown",e=>{("/"===e.key||"k"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))&&document.activeElement!==r?(e.preventDefault(),r.focus()):"Escape"===e.key&&document.activeElement===r?(r.value="",o.style.display="none",localStorage.removeItem(t),n("")):(e.ctrlKey||e.metaKey)&&"l"===e.key.toLowerCase()&&(e.preventDefault(),r.value="",o.style.display="none",localStorage.removeItem(t),n(""))}),n(e)}});