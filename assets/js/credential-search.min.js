document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("credential-search"),t=document.getElementById("clear-credential-search"),n=document.getElementById("voice-search-btn"),a=document.getElementById("results-info"),r=document.querySelectorAll(".credential-card"),o=a&&a.dataset.lang||document.documentElement.lang||"en";if(!e||!t||!r.length)return;a&&(a.setAttribute("aria-live","polite"),a.setAttribute("aria-atomic","true"));const i="credentialSearchTerm";function s(){const e="__credential_search__";try{return localStorage.setItem(e,e),localStorage.removeItem(e),localStorage}catch(e){return null}}const c=s();function l(e,t){if("function"==typeof window.createToast)try{return window.createToast(e,t)}catch{try{return window.createToast(e)}catch{}}}const d=c?.getItem(i)||"";let u;d&&(e.value=d,t.style.display="block");const m=e=>(e||"").normalize("NFC").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").replace(/[\u064B-\u065F\u0670]/g,"").replace(/‌/g,""),y=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");r.forEach(e=>{const t=e.querySelector("h3"),n=e.querySelector(".credential-summary");t&&!t.dataset.original&&(t.dataset.original=t.textContent||""),n&&!n.dataset.original&&(n.dataset.original=n.textContent||"")});const f=(e,t)=>{if(!e||!e.dataset.original)return;if(!t)return void(e.textContent=e.dataset.original);const n=new RegExp(`(${y(t)})`,"gi"),a=e.dataset.original.split(n);e.innerHTML="",a.forEach((t,n)=>{if(n%2==1){const n=document.createElement("mark");n.textContent=t,e.appendChild(n)}else t&&e.appendChild(document.createTextNode(t))})},g=e=>{if(a)if(o.startsWith("fa"))a.textContent=0===e?"موردی یافت نشد":`${e} نتیجه یافت شد`;else{const t=1===e?"result":"results";a.textContent=0===e?"No results found":`${e} ${t} found`}},p=t=>{const n=void 0!==t?t:e.value.trim(),a=m(n).toLowerCase();let o=0;r.forEach(e=>{const t=e.querySelector("h3"),r=e.querySelector(".credential-summary"),i=m(e.dataset.keywords||"").toLowerCase(),s=t?m(t.dataset.original).toLowerCase():"",c=r?m(r.dataset.original).toLowerCase():"";!a||s.includes(a)||c.includes(a)||i.includes(a)?(e.style.display="grid",f(t,n),f(r,n),o++):(e.style.display="none",f(t,""),f(r,""))}),g(o)};function v(e){if(c)try{e?c.setItem(i,e):c.removeItem(i)}catch{}}function E(){e.value="",t.style.display="none",clearTimeout(u),v(""),p(""),e.focus()}if(e.addEventListener("input",()=>{const n=e.value.trim();t.style.display=n?"block":"none",v(n),clearTimeout(u),u=setTimeout(()=>p(n),200)}),t.addEventListener("click",E),e.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),E())}),n){const a=window.SpeechRecognition||window.webkitSpeechRecognition;if(a){const r=new a;r.lang=o.startsWith("fa")?"fa-IR":"en-US",r.interimResults=!1,n.addEventListener("click",()=>r.start()),r.addEventListener("start",()=>{n.classList.add("listening"),n.setAttribute("aria-pressed","true")}),r.addEventListener("end",()=>{n.classList.remove("listening"),n.setAttribute("aria-pressed","false")}),r.addEventListener("result",n=>{const a=(n.results[0][0].transcript||"").trim();e.value=a,t.style.display=a?"block":"none",v(a),p(a)}),r.addEventListener("error",e=>{(!e||"no-speech"!==e.error&&"aborted"!==e.error)&&l(o.startsWith("fa")?"امکان دریافت صدا نیست.":"Voice recognition unavailable.")})}else n.style.display="none",l(o.startsWith("fa")?"مرورگر شما از جستجوی صوتی پشتیبانی نمی‌کند.":"Voice search isn't supported.")}document.addEventListener("keydown",t=>{const n=document.activeElement,a=n&&n.tagName,r=n&&("INPUT"===a||"TEXTAREA"===a||!0===n.isContentEditable);if(("/"===t.key||"k"===t.key.toLowerCase()&&(t.ctrlKey||t.metaKey))&&!r&&n!==e)return t.preventDefault(),void e.focus();"Escape"===t.key&&n===e&&(t.preventDefault(),E())}),p(d),window.addEventListener("beforeunload",()=>{clearTimeout(u)})});