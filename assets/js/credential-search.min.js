function initCredentialSearch(){const e=document.getElementById("credential-search"),t=document.getElementById("clear-credential-search"),n=document.getElementById("voice-search-btn"),r=document.getElementById("results-info"),a=document.querySelectorAll(".credential-card"),o=r&&r.dataset.lang||document.documentElement.lang||"en";if(!e||!t||!a.length)return;e._searchAbortController&&e._searchAbortController.abort();const i=new AbortController;e._searchAbortController=i;i.signal;r&&(r.setAttribute("aria-live","polite"),r.setAttribute("aria-atomic","true"));const s="credentialSearchTerm";const l=function(){const e="__credential_search__";try{return localStorage.setItem(e,e),localStorage.removeItem(e),localStorage}catch(e){return null}}();function c(e,t){if("function"==typeof window.createToast)try{return window.createToast(e,t)}catch{try{return window.createToast(e)}catch{}}}const d=l?.getItem(s)||"";let u;d&&(e.value=d,t.style.display="block");const m=e=>(e||"").normalize("NFC").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").replace(/[\u064B-\u065F\u0670]/g,"").replace(/‌/g,"").toLowerCase();a.forEach(e=>{const t=e.querySelector("h3"),n=e.querySelector(".credential-summary");t&&!t.dataset.original&&(t.dataset.original=t.textContent||"",t.dataset.originalHtml=t.innerHTML||""),n&&!n.dataset.original&&(n.dataset.original=n.textContent||"",n.dataset.originalHtml=n.innerHTML||"")});const g=(e,t)=>{if(!e)return;if(e.querySelectorAll("mark.search-highlight").forEach(e=>{const t=e.parentNode;t.replaceChild(document.createTextNode(e.textContent),e),t.normalize()}),!t)return;const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1),r=[],a=m(t).split("").map(e=>{const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return"ی"===e?"[یي]":"ک"===e?"[کك]":t}).join("[\\u064B-\\u065F\\u0670\\u200c\\u200d]*"),o=new RegExp(`(${a})`,"i");for(;n.nextNode();){const e=n.currentNode;e.parentNode.classList.contains("search-highlight")||e.nodeValue&&o.test(e.nodeValue)&&r.push(e)}r.forEach(e=>{const t=document.createDocumentFragment();e.nodeValue.split(o).forEach((e,n)=>{if(n%2==1){const n=document.createElement("mark");n.className="search-highlight",n.textContent=e,t.appendChild(n)}else e&&t.appendChild(document.createTextNode(e))}),e.parentNode.replaceChild(t,e)})},h=t=>{const n=void 0!==t?t:e.value.trim(),i=m(n).toLowerCase();let s=0;a.forEach(e=>{const t=e.querySelector("h3"),r=e.querySelector(".credential-summary"),a=t&&t.dataset.original?m(t.dataset.original).toLowerCase():"",o=r&&r.dataset.original?m(r.dataset.original).toLowerCase():"",l=m(e.dataset.keywords||"").toLowerCase();!i||a.includes(i)||o.includes(i)||l.includes(i)?(e.style.display="grid",g(t,n),g(r,n),s++):(e.style.display="none",g(t,""),g(r,""))}),(e=>{if(r)if(o.startsWith("fa"))r.textContent=0===e?"موردی یافت نشد":`${e} نتیجه یافت شد`;else{const t=1===e?"result":"results";r.textContent=0===e?"No results found":`${e} ${t} found`}})(s)};function p(e){if(l)try{e?l.setItem(s,e):l.removeItem(s)}catch{}}function y(){e.value="",t.style.display="none",clearTimeout(u),p(""),h(""),e.focus()}if(e.addEventListener("input",()=>{const n=e.value.trim();t.style.display=n?"block":"none",p(n),clearTimeout(u),u=setTimeout(()=>h(n),200)},{signal:i.signal}),t.addEventListener("click",y,{signal:i.signal}),e.addEventListener("keydown",e=>{"Escape"===e.key&&(e.preventDefault(),y())},{signal:i.signal}),n){const r=window.SpeechRecognition||window.webkitSpeechRecognition;if(r){const a=new r;a.lang=o.startsWith("fa")?"fa-IR":"en-US",a.interimResults=!1;const s=()=>a.start(),l=()=>{n.classList.add("listening"),n.setAttribute("aria-pressed","true")},d=()=>{n.classList.remove("listening"),n.setAttribute("aria-pressed","false")},m=n=>{const r=(n.results[0][0].transcript||"").trim();e.value=r,t.style.display=r?"block":"none",p(r),clearTimeout(u),h(r)},g=e=>{(!e||"no-speech"!==e.error&&"aborted"!==e.error)&&c(o.startsWith("fa")?"امکان دریافت صدا نیست.":"Voice recognition unavailable.")};n.addEventListener("click",s,{signal:i.signal}),a.addEventListener("start",l),a.addEventListener("end",d),a.addEventListener("result",m),a.addEventListener("error",g);const y=()=>{try{a.abort()}catch(e){}a.removeEventListener("start",l),a.removeEventListener("end",d),a.removeEventListener("result",m),a.removeEventListener("error",g)};i.signal.addEventListener("abort",y),window.addEventListener("beforeunload",y,{signal:i.signal})}else n.style.display="none",c(o.startsWith("fa")?"مرورگر شما از جستجوی صوتی پشتیبانی نمی‌کند.":"Voice search isn't supported.")}document.addEventListener("keydown",t=>{const n=document.activeElement,r=n&&n.tagName,a=n&&("INPUT"===r||"TEXTAREA"===r||!0===n.isContentEditable);if(("/"===t.key||"k"===t.key.toLowerCase()&&(t.ctrlKey||t.metaKey))&&!a&&n!==e)return t.preventDefault(),void e.focus();"Escape"===t.key&&n===e&&(t.preventDefault(),y())},{signal:i.signal}),h(d),window.addEventListener("beforeunload",()=>{clearTimeout(u)},{signal:i.signal})}document.addEventListener("DOMContentLoaded",initCredentialSearch),document.addEventListener("includesLoaded",initCredentialSearch);
//# sourceMappingURL=credential-search.min.js.map
