document.addEventListener("DOMContentLoaded",function(){let o=document.getElementById("credential-search"),r=document.getElementById("clear-credential-search"),i=document.getElementById("voice-search-btn"),u=document.getElementById("results-info"),m=document.querySelectorAll(".credential-card"),y=u?.dataset.lang||document.documentElement.lang||"en";if(o&&r){let t="credentialSearchTerm";var e=localStorage.getItem(t)||"";e&&(o.value=e,r.style.display="block");let a,c=e=>(e||"").normalize("NFC").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").replace(/[\u064B-\u065F\u0670]/g,"").replace(/‌/g,""),l=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=(m.forEach(e=>{var t=e.querySelector("h3"),e=e.querySelector(".credential-summary");t&&(t.dataset.original=t.textContent),e&&(e.dataset.original=e.textContent)}),(e,t)=>{e&&e.dataset.original&&(t?(t=new RegExp(`(${l(t)})`,"gi"),e.innerHTML=e.dataset.original.replace(t,"<mark>$1</mark>")):e.innerHTML=e.dataset.original)}),n=e=>{let r=void 0!==e?e:o.value.trim(),i=c(r).toLowerCase(),s=0;var t;m.forEach(e=>{var t=e.querySelector("h3"),a=e.querySelector(".credential-summary"),l=c(e.dataset.keywords||"").toLowerCase(),n=t?c(t.dataset.original).toLowerCase():"",o=a?c(a.dataset.original).toLowerCase():"";n.includes(i)||o.includes(i)||l.includes(i)?(e.style.display="grid",d(t,r),d(a,r),s++):(e.style.display="none",d(t,""),d(a,""))}),e=s,u&&(y.startsWith("fa")?u.textContent=0===e?"موردی یافت نشد":e+" نتیجه یافت شد":(t=1===e?"result":"results",u.textContent=0===e?"No results found":e+` ${t} found`))};if(o.addEventListener("input",()=>{let e=o.value.trim();r.style.display=e?"block":"none",e?localStorage.setItem(t,e):localStorage.removeItem(t),clearTimeout(a),a=setTimeout(()=>n(e),200)}),r.addEventListener("click",()=>{o.value="",r.style.display="none",localStorage.removeItem(t),clearTimeout(a),n("")}),o.addEventListener("keydown",e=>{"Escape"===e.key?(o.value="",r.style.display="none",localStorage.removeItem(t),clearTimeout(a),n("")):(e.ctrlKey||e.metaKey)&&"l"===e.key.toLowerCase()&&(e.preventDefault(),o.value="",r.style.display="none",localStorage.removeItem(t),clearTimeout(a),n(""))}),i){var s=window.SpeechRecognition||window.webkitSpeechRecognition;if(s){let e=new s;e.lang=y.startsWith("fa")?"fa-IR":"en-US",e.interimResults=!1,i.addEventListener("click",()=>e.start()),e.addEventListener("start",()=>{i.classList.add("listening")}),e.addEventListener("end",()=>{i.classList.remove("listening")}),e.addEventListener("result",e=>{e=e.results[0][0].transcript.trim();o.value=e,r.style.display=e?"block":"none",e?localStorage.setItem(t,e):localStorage.removeItem(t),n(e)}),e.addEventListener("error",()=>{window.createToast?.(y.startsWith("fa")?"امکان دریافت صدا نیست.":"Voice recognition unavailable.",{id:"voice-error-"+Date.now(),iconClass:"fas fa-exclamation-triangle",iconColor:"red",duration:3e3})})}else i.style.display="none",window.createToast?.(y.startsWith("fa")?"مرورگر شما از جستجوی صوتی پشتیبانی نمی‌کند.":"Voice search isn't supported.",{id:"voice-unsupported",iconClass:"fas fa-exclamation-triangle",iconColor:"red",duration:3e3})}document.addEventListener("keydown",e=>{("/"===e.key||"k"===e.key.toLowerCase()&&(e.ctrlKey||e.metaKey))&&document.activeElement!==o?(e.preventDefault(),o.focus()):"Escape"===e.key&&document.activeElement===o?(o.value="",r.style.display="none",localStorage.removeItem(t),n("")):(e.ctrlKey||e.metaKey)&&"l"===e.key.toLowerCase()&&(e.preventDefault(),o.value="",r.style.display="none",localStorage.removeItem(t),n(""))}),n(e)}});