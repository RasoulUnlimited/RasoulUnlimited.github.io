document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("credential-search"),t=document.getElementById("clear-credential-search"),a=document.getElementById("voice-search-btn"),n=document.getElementById("results-info"),o=document.querySelectorAll(".credential-card"),r=n?.dataset.lang||document.documentElement.lang||"en";if(!e||!t)return;const l="credentialSearchTerm",s=localStorage.getItem(l)||"";let i;s&&(e.value=s,t.style.display="block");const c=e=>(e||"").normalize("NFC").replace(/[ي]/g,"ی").replace(/[ك]/g,"ک").replace(/[\u064B-\u065F\u0670]/g,"").replace(/‌/g,""),d=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");o.forEach(e=>{const t=e.querySelector("h3"),a=e.querySelector(".credential-summary");t&&(t.dataset.original=t.textContent),a&&(a.dataset.original=a.textContent)});const u=(e,t)=>{if(!e||!e.dataset.original)return;if(!t)return void(e.innerHTML=e.dataset.original);const a=new RegExp(`(${d(t)})`,"gi");e.innerHTML=e.dataset.original.replace(a,"<mark>$1</mark>")},m=e=>{if(n)if(r.startsWith("fa"))n.textContent=0===e?"موردی یافت نشد":`${e} نتیجه یافت شد`;else{const t=1===e?"result":"results";n.textContent=0===e?"No results found":`${e} ${t} found`}},y=t=>{const a=void 0!==t?t:e.value.trim(),n=c(a).toLowerCase();let r=0;o.forEach(e=>{const t=e.querySelector("h3"),o=e.querySelector(".credential-summary"),l=c(e.dataset.keywords||"").toLowerCase(),s=t?c(t.dataset.original).toLowerCase():"",i=o?c(o.dataset.original).toLowerCase():"";s.includes(n)||i.includes(n)||l.includes(n)?(e.style.display="grid",u(t,a),u(o,a),r++):(e.style.display="none",u(t,""),u(o,""))}),m(r)};if(e.addEventListener("input",()=>{const a=e.value.trim();t.style.display=a?"block":"none",a?localStorage.setItem(l,a):localStorage.removeItem(l),clearTimeout(i),i=setTimeout(()=>y(a),200)}),t.addEventListener("click",()=>{e.value="",t.style.display="none",localStorage.removeItem(l),clearTimeout(i),y("")}),e.addEventListener("keydown",a=>{"Escape"===a.key?(e.value="",t.style.display="none",localStorage.removeItem(l),clearTimeout(i),y("")):(a.ctrlKey||a.metaKey)&&"l"===a.key.toLowerCase()&&(a.preventDefault(),e.value="",t.style.display="none",localStorage.removeItem(l),clearTimeout(i),y(""))}),a){const n=window.SpeechRecognition||window.webkitSpeechRecognition;if(n){const o=new n;o.lang=r.startsWith("fa")?"fa-IR":"en-US",o.interimResults=!1,a.addEventListener("click",()=>o.start()),o.addEventListener("start",()=>{a.classList.add("listening")}),o.addEventListener("end",()=>{a.classList.remove("listening")}),o.addEventListener("result",a=>{const n=a.results[0][0].transcript.trim();e.value=n,t.style.display=n?"block":"none",n?localStorage.setItem(l,n):localStorage.removeItem(l),y(n)}),o.addEventListener("error",()=>{window.createToast?.(r.startsWith("fa")?"امکان دریافت صدا نیست.":"Voice recognition unavailable.",{id:`voice-error-${Date.now()}`,iconClass:"fas fa-exclamation-triangle",iconColor:"red",duration:3e3})})}else a.style.display="none",window.createToast?.(r.startsWith("fa")?"مرورگر شما از جستجوی صوتی پشتیبانی نمی‌کند.":"Voice search isn't supported.",{id:"voice-unsupported",iconClass:"fas fa-exclamation-triangle",iconColor:"red",duration:3e3})}document.addEventListener("keydown",a=>{("/"===a.key||"k"===a.key.toLowerCase()&&(a.ctrlKey||a.metaKey))&&document.activeElement!==e?(a.preventDefault(),e.focus()):"Escape"===a.key&&document.activeElement===e?(e.value="",t.style.display="none",localStorage.removeItem(l),y("")):(a.ctrlKey||a.metaKey)&&"l"===a.key.toLowerCase()&&(a.preventDefault(),e.value="",t.style.display="none",localStorage.removeItem(l),y(""))}),y(s)});