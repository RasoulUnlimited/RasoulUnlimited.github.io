{"version":3,"file":"sw-register.min.js","names":["navigator","window","isSecureContext","isFa","document","documentElement","getAttribute","toLowerCase","indexOf","addEventListener","serviceWorker","register","then","handleRegistration","catch","err","console","error","warn","safeToast","message","createToast","notifyReady","notifyUpdate","reg","active","waiting","newWorker","installing","state","controller"],"sources":["sw-register.js"],"mappings":"CAGA,WACE,aAEA,GAAM,kBAAmBA,UAGzB,GAAKC,OAAOC,gBAAZ,CAOA,IAEIC,EAA8B,KAFvBC,SAASC,gBACHC,aAAa,SAAW,IAAIC,cAC7BC,QAAQ,MAoDxBP,OAAOQ,iBAAiB,OAAQ,WAC9BT,UAAUU,cACPC,SAAS,UACTC,KAAKC,GACLC,MAAM,SAAUC,GACfC,QAAQC,MAAM,0BAA2BF,EAC3C,EACJ,EA/DA,MAJEC,QAAQE,KACN,kEASJ,SAASC,EAAUC,GACiB,mBAAvBnB,OAAOoB,aAChBpB,OAAOoB,YAAYD,EAEvB,CAEA,SAASE,IACPH,EACEhB,EAAO,0BAA4B,0BAEvC,CAEA,SAASoB,IACPJ,EACEhB,EACI,6DACA,4CAER,CAEA,SAASU,EAAmBW,GAEtBA,EAAIC,QACNH,IAIEE,EAAIE,SACNH,IAIFC,EAAIf,iBAAiB,cAAe,WAClC,IAAIkB,EAAYH,EAAII,WACfD,GAELA,EAAUlB,iBAAiB,cAAe,WAChB,cAApBkB,EAAUE,QAGV7B,UAAUU,cAAcoB,WAC1BP,IAGAD,IAEJ,EACF,EACF,CAUD,CA3ED","ignoreList":[],"sourcesContent":["// js/sw-register.js\r\n// Safe, robust Service Worker registration with update notifications\r\n\r\n(function () {\r\n  'use strict';\r\n\r\n  if (!('serviceWorker' in navigator)) return;\r\n\r\n  // SW فقط روی HTTPS (یا localhost) کار می‌کند\r\n  if (!window.isSecureContext) {\r\n    console.warn(\r\n      'Service workers require a secure context (HTTPS or localhost).'\r\n    );\r\n    return;\r\n  }\r\n\r\n  var root = document.documentElement;\r\n  var lang = (root.getAttribute('lang') || '').toLowerCase();\r\n  var isFa = lang.indexOf('fa') === 0;\r\n\r\n  function safeToast(message) {\r\n    if (typeof window.createToast === 'function') {\r\n      window.createToast(message);\r\n    }\r\n  }\r\n\r\n  function notifyReady() {\r\n    safeToast(\r\n      isFa ? 'پشتیبانی آفلاین فعال شد' : 'Offline support enabled'\r\n    );\r\n  }\r\n\r\n  function notifyUpdate() {\r\n    safeToast(\r\n      isFa\r\n        ? 'نسخهٔ جدید در دسترس است. برای بروزرسانی صفحه را تازه کنید.'\r\n        : 'New version available. Refresh to update.'\r\n    );\r\n  }\r\n\r\n  function handleRegistration(reg) {\r\n    // اگر سرویس‌ورکر فعال است، یعنی می‌توانیم آفلاین کار کنیم\r\n    if (reg.active) {\r\n      notifyReady();\r\n    }\r\n\r\n    // اگر در لحظه‌ی رجیستر، worker در حالت waiting است، یعنی آپدیت آماده است\r\n    if (reg.waiting) {\r\n      notifyUpdate();\r\n    }\r\n\r\n    // لیسنر برای آپدیت‌های بعدی\r\n    reg.addEventListener('updatefound', function () {\r\n      var newWorker = reg.installing;\r\n      if (!newWorker) return;\r\n\r\n      newWorker.addEventListener('statechange', function () {\r\n        if (newWorker.state !== 'installed') return;\r\n\r\n        // اگر controller هست، یعنی این یک آپدیت است، نه اولین نصب\r\n        if (navigator.serviceWorker.controller) {\r\n          notifyUpdate();\r\n        } else {\r\n          // اولین نصب: آفلاین فعال شد\r\n          notifyReady();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  window.addEventListener('load', function () {\r\n    navigator.serviceWorker\r\n      .register('/sw.js')\r\n      .then(handleRegistration)\r\n      .catch(function (err) {\r\n        console.error('SW registration failed:', err);\r\n      });\r\n  });\r\n})();\r\n"]}