{"version":3,"file":"sw-register.min.js","names":["navigator","window","isSecureContext","console","warn","isFa","document","documentElement","getAttribute","toLowerCase","indexOf","safeToast","message","createToast","notifyReady","notifyUpdate","handleRegistration","reg","active","waiting","addEventListener","newWorker","installing","state","serviceWorker","controller","register","then","catch","err","error"],"sources":["sw-register.js"],"mappings":"CAGA,WACE,aAEA,KAAM,kBAAmBA,WACvB,OAIF,IAAKC,OAAOC,gBAIV,YAHAC,QAAQC,KACN,kEAKJ,MAEMC,EAA8B,KAFvBC,SAASC,gBACHC,aAAa,SAAW,IAAIC,cAC7BC,QAAQ,MAM1B,SAASC,EAAUC,GACiB,mBAAvBX,OAAOY,aAChBZ,OAAOY,YAAYD,EAEvB,CAEA,SAASE,IACPH,EACEN,EAAO,0BAA4B,0BAEvC,CAEA,SAASU,IACPJ,EACEN,EACI,6DACA,4CAER,CAMA,SAASW,EAAmBC,GAEtBA,EAAIC,QACNJ,IAIEG,EAAIE,SACNJ,IAIFE,EAAIG,iBAAiB,cAAe,WAClC,MAAMC,EAAYJ,EAAIK,WACjBD,GAILA,EAAUD,iBAAiB,cAAe,WAChB,cAApBC,EAAUE,QAKVvB,UAAUwB,cAAcC,WAC1BV,IAGAD,IAEJ,EACF,EACF,CAEAb,OAAOmB,iBAAiB,OAAQ,WAC9BpB,UAAUwB,cACPE,SAAS,UACTC,KAAKX,GACLY,MAAM,SAAUC,GACf1B,QAAQ2B,MAAM,sCAAuCD,EACvD,EACJ,EACD,CAzFD","ignoreList":[],"sourcesContent":["// js/sw-register.js\r\n// Safe, robust Service Worker registration with update notifications\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  if (!(\"serviceWorker\" in navigator)) {\r\n    return;\r\n  }\r\n\r\n  // SW only works on HTTPS (or localhost)\r\n  if (!window.isSecureContext) {\r\n    console.warn(\r\n      \"Service workers require a secure context (HTTPS or localhost).\"\r\n    );\r\n    return;\r\n  }\r\n\r\n  const root = document.documentElement;\r\n  const lang = (root.getAttribute(\"lang\") || \"\").toLowerCase();\r\n  const isFa = lang.indexOf(\"fa\") === 0;\r\n\r\n  /**\r\n   * Safely display toast notification\r\n   * @param {string} message - Message to display\r\n   */\r\n  function safeToast(message) {\r\n    if (typeof window.createToast === \"function\") {\r\n      window.createToast(message);\r\n    }\r\n  }\r\n\r\n  function notifyReady() {\r\n    safeToast(\r\n      isFa ? \"پشتیبانی آفلاین فعال شد\" : \"Offline support enabled\"\r\n    );\r\n  }\r\n\r\n  function notifyUpdate() {\r\n    safeToast(\r\n      isFa\r\n        ? \"نسخهٔ جدید در دسترس است. برای بروزرسانی صفحه را تازه کنید.\"\r\n        : \"New version available. Refresh to update.\"\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Handle Service Worker registration and updates\r\n   * @param {ServiceWorkerRegistration} reg - Registration object\r\n   */\r\n  function handleRegistration(reg) {\r\n    // If active worker exists, offline support is enabled\r\n    if (reg.active) {\r\n      notifyReady();\r\n    }\r\n\r\n    // If waiting worker exists, update is available\r\n    if (reg.waiting) {\r\n      notifyUpdate();\r\n    }\r\n\r\n    // Listen for future updates\r\n    reg.addEventListener(\"updatefound\", function () {\r\n      const newWorker = reg.installing;\r\n      if (!newWorker) {\r\n        return;\r\n      }\r\n\r\n      newWorker.addEventListener(\"statechange\", function () {\r\n        if (newWorker.state !== \"installed\") {\r\n          return;\r\n        }\r\n\r\n        // If controller exists, this is an update\r\n        if (navigator.serviceWorker.controller) {\r\n          notifyUpdate();\r\n        } else {\r\n          // First installation: offline support enabled\r\n          notifyReady();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  window.addEventListener(\"load\", function () {\r\n    navigator.serviceWorker\r\n      .register(\"/sw.js\")\r\n      .then(handleRegistration)\r\n      .catch(function (err) {\r\n        console.error(\"Service Worker registration failed:\", err);\r\n      });\r\n  });\r\n})();\r\n"]}