{"version":3,"file":"sw-register.min.js","names":["navigator","window","isSecureContext","console","warn","isFa","document","documentElement","getAttribute","toLowerCase","indexOf","safeToast","message","createToast","notifyReady","notifyUpdate","attachInstalledListener","worker","addEventListener","state","serviceWorker","controller","handleRegistration","reg","waiting","installing","ready","then","catch","register","err","error"],"sources":["sw-register.js"],"mappings":"CAGA,WACE,aAEA,KAAM,kBAAmBA,WACvB,OAIF,IAAKC,OAAOC,gBAIV,YAHAC,QAAQC,KACN,kEAKJ,MAEMC,EAA8B,KAFvBC,SAASC,gBACHC,aAAa,SAAW,IAAIC,cAC7BC,QAAQ,MAM1B,SAASC,EAAUC,GACiB,mBAAvBX,OAAOY,aAChBZ,OAAOY,YAAYD,EAEvB,CAEA,SAASE,IACPH,EACEN,EAAO,0BAA4B,0BAEvC,CAEA,SAASU,IACPJ,EACEN,EACI,6DACA,4CAER,CAMA,SAASW,EAAwBC,GAC1BA,GAELA,EAAOC,iBAAiB,cAAe,WAChB,cAAjBD,EAAOE,QAGPnB,UAAUoB,cAAcC,WAC1BN,IAGAD,IAEJ,EACF,CAMA,SAASQ,EAAmBC,GAEtBA,EAAIC,SACNT,IAIFC,EAAwBO,EAAIE,YAG5BF,EAAIL,iBAAiB,cAAe,WAClCF,EAAwBO,EAAIE,WAC9B,GAIKzB,UAAUoB,cAAcC,YAC3BrB,UAAUoB,cAAcM,MACrBC,KAAK,WAEC3B,UAAUoB,cAAcC,YAC3BP,GAEJ,GACCc,MAAM,WAEP,EAEN,CAEA3B,OAAOiB,iBAAiB,OAAQ,WAC9BlB,UAAUoB,cACPS,SAAS,UACTF,KAAKL,GACLM,MAAM,SAAUE,GACf3B,QAAQ4B,MAAM,sCAAuCD,EACvD,EACJ,EACD,CAzGD","ignoreList":[],"sourcesContent":["// js/sw-register.js\r\n// Safe, robust Service Worker registration with update notifications\r\n\r\n(function () {\r\n  \"use strict\";\r\n\r\n  if (!(\"serviceWorker\" in navigator)) {\r\n    return;\r\n  }\r\n\r\n  // SW only works on HTTPS (or localhost)\r\n  if (!window.isSecureContext) {\r\n    console.warn(\r\n      \"Service workers require a secure context (HTTPS or localhost).\"\r\n    );\r\n    return;\r\n  }\r\n\r\n  const root = document.documentElement;\r\n  const lang = (root.getAttribute(\"lang\") || \"\").toLowerCase();\r\n  const isFa = lang.indexOf(\"fa\") === 0;\r\n\r\n  /**\r\n   * Safely display toast notification\r\n   * @param {string} message - Message to display\r\n   */\r\n  function safeToast(message) {\r\n    if (typeof window.createToast === \"function\") {\r\n      window.createToast(message);\r\n    }\r\n  }\r\n\r\n  function notifyReady() {\r\n    safeToast(\r\n      isFa ? \"پشتیبانی آفلاین فعال شد\" : \"Offline support enabled\"\r\n    );\r\n  }\r\n\r\n  function notifyUpdate() {\r\n    safeToast(\r\n      isFa\r\n        ? \"نسخهٔ جدید در دسترس است. برای بروزرسانی صفحه را تازه کنید.\"\r\n        : \"New version available. Refresh to update.\"\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Attach \"installed\" listener to a worker (if present)\r\n   * @param {ServiceWorker} worker\r\n   */\r\n  function attachInstalledListener(worker) {\r\n    if (!worker) return;\r\n\r\n    worker.addEventListener(\"statechange\", function () {\r\n      if (worker.state !== \"installed\") return;\r\n\r\n      // If controller exists, this is an update\r\n      if (navigator.serviceWorker.controller) {\r\n        notifyUpdate();\r\n      } else {\r\n        // First installation: offline support enabled\r\n        notifyReady();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Handle Service Worker registration and updates\r\n   * @param {ServiceWorkerRegistration} reg - Registration object\r\n   */\r\n  function handleRegistration(reg) {\r\n    // If waiting worker exists, update is available (e.g. from previous visit)\r\n    if (reg.waiting) {\r\n      notifyUpdate();\r\n    }\r\n\r\n    // اگر همین الان در حال نصب باشد (before we attached 'updatefound')\r\n    attachInstalledListener(reg.installing);\r\n\r\n    // Listen for future updates\r\n    reg.addEventListener(\"updatefound\", function () {\r\n      attachInstalledListener(reg.installing);\r\n    });\r\n\r\n    // اگر سرویس‌ورکر فعال است ولی کنترلی نداریم (سناریوی لبه‌ای)\r\n    // می‌توانیم وقتی آماده شد، پیام ready بدهیم\r\n    if (!navigator.serviceWorker.controller) {\r\n      navigator.serviceWorker.ready\r\n        .then(function () {\r\n          // هنوز controller نداریم؟ یعنی این تب تازه تحت کنترل قرار گرفته\r\n          if (!navigator.serviceWorker.controller) {\r\n            notifyReady();\r\n          }\r\n        })\r\n        .catch(function () {\r\n          // ignore\r\n        });\r\n    }\r\n  }\r\n\r\n  window.addEventListener(\"load\", function () {\r\n    navigator.serviceWorker\r\n      .register(\"/sw.js\")\r\n      .then(handleRegistration)\r\n      .catch(function (err) {\r\n        console.error(\"Service Worker registration failed:\", err);\r\n      });\r\n  });\r\n})();\r\n"]}