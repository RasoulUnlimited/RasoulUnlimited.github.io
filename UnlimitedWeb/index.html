<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unlimited Web Proxy</title>
    <script nonce="RasoulCSP" src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f0f0; padding: 20px; text-align: center; }
        input { width: 80%; padding: 10px; margin: 10px 0; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        .proxy-link { margin: 10px; display: block; }
    </style>
</head>
<body>
    <h2>Unlimited Web Proxy</h2>
    
    <div style="margin: 20px 0;">
        <button onclick="setUrl('https://www.youtube.com')">ğŸ¬ ÛŒÙˆØªÛŒÙˆØ¨</button>
        <button onclick="setUrl('https://www.instagram.com')">ğŸ“¸ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</button>
        <button onclick="setUrl('https://www.google.com')">ğŸ” Ú¯ÙˆÚ¯Ù„</button>
        <button onclick="setUrl('https://www.tiktok.com')">ğŸµ ØªÛŒÚ©â€ŒØªØ§Ú©</button>
        <button onclick="setUrl('https://www.pinterest.com')">ğŸ“Œ Ù¾ÛŒÙ†ØªØ±Ø³Øª</button>
        <button onclick="setUrl('https://x.com')">ğŸ¦ ØªÙˆÛŒÛŒØªØ± / X</button>
    </div>

    <p>ÛŒØ§ Ù„ÛŒÙ†Ú© Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
    <input type="text" id="urlInput" placeholder="https://example.com">
    <button onclick="generateProxies()">Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© Ø¨Ø¯ÙˆÙ† ÙÛŒÙ„ØªØ±</button>

    <div id="result" style="margin-top: 30px;"></div>
    <script nonce="RasoulCSP">
        function setUrl(url) {
            document.getElementById('urlInput').value = url;
            generateProxies();
        }

        const PROXY_IPS = [
            "185.16.38.122", "185.16.38.230", "185.16.38.114",
            "95.214.53.28", "51.159.194.214", "51.159.111.51"
        ];

        // Ú¯Ø±ÙØªÙ† FIXED_S Ø§Ø² initData Ú©Ù‡ Ø¨Ø§Øª Ø§Ø±Ø³Ø§Ù„ Ú©Ø±Ø¯Ù‡
        let FIXED_S = "";

        // 1. Ø§ÙˆÙ„ query string Ø±Ø§ Ú†Ú© Ú©Ù† (Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯ Ùˆ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø³ØªÙ‚ÛŒÙ…)
        const urlParams = new URLSearchParams(window.location.search);
        FIXED_S = urlParams.get("s") || FIXED_S;

        // 2. Ø§Ú¯Ø± Ù‡Ù†ÙˆØ² Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ØŒ Ø§Ø² start_param ØªÙ„Ú¯Ø±Ø§Ù… Ø¨Ú¯ÛŒØ±
        if (!FIXED_S && Telegram.WebApp.initDataUnsafe?.start_param) {
            try {
                const params = new URLSearchParams(Telegram.WebApp.initDataUnsafe.start_param);
                FIXED_S = params.get("s") || "";
            } catch (e) {
                console.error("Error parsing start_param", e);
            }
        }

        if (!FIXED_S) {
            document.body.innerHTML = `
                <h2 style="color: red;">Ø®Ø·Ø§</h2>
                <p>Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ù…ØªØµÙ„ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø±Ø¨Ø§Øª Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.</p>
            `;
            console.error("FIXED_S is empty");
            // throw Ø±Ø§ Ø¨Ø±Ø¯Ø§Ø± ÛŒØ§ Ú©Ø§Ù…Ù†Øª Ú©Ù† ØªØ§ Ø¯ÛŒØ¨Ø§Ú¯ Ø±Ø§Ø­Øªâ€ŒØªØ± Ø¨Ø§Ø´Ø¯
        }

        function makeProxyLink(url, ip) {
            try {
                const r_bytes = btoa(url).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '') + '%3D';
                return `https://${ip}/__cpi.php?s=${FIXED_S}&r=${r_bytes}&__cpo=1`;
            } catch (e) {
                return url;
            }
        }

        function generateProxies() {
            let url = document.getElementById('urlInput').value.trim();
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            if (!url.match(/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/)) {
                alert('Ù„ÛŒÙ†Ú© Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>âš ï¸ Ù‡Ø± Ù„ÛŒÙ†Ú© ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ù†ÙØ± Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.</p>';
            PROXY_IPS.forEach((ip, index) => {
                const proxyUrl = makeProxyLink(url, ip);
                resultDiv.innerHTML += `<a href="${proxyUrl}" class="proxy-link">ğŸŒ Ø³Ø±ÙˆØ± Ø´Ù…Ø§Ø±Ù‡ ${index + 1}</a>`;
            });

            // Ø§Ø¯ØºØ§Ù… Ø¨Ø§ ØªÙ„Ú¯Ø±Ø§Ù…: Ù†Ù…Ø§ÛŒØ´ Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø³ØªÙ† Ø§Ù¾
            Telegram.WebApp.MainButton.setText('Ø¨Ø³ØªÙ†').show().onClick(() => Telegram.WebApp.close());
        }

        // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ØªÙ„Ú¯Ø±Ø§Ù… Mini App
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
    </script>
</body>
</html>
