<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unlimited Web Proxy</title>
    <script nonce="RasoulCSP" src="https://telegram.org/js/telegram-web-app.js"></script>
    <style nonce="RasoulCSP">
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
            text-align: center;
            margin: 0;
        }
        input {
            width: 80%;
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box;
        }
        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 6px;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .preset-buttons {
            margin: 20px 0;
        }
        .error-container h2 {
            color: red;
        }
        .error-container p {
            font-size: 1.1em;
            margin-top: 10px;
        }
        .proxy-link {
            display: block;
            margin: 12px auto;
            padding: 12px;
            background-color: #e6f3ff;
            border-radius: 8px;
            text-decoration: none;
            color: #0066cc;
            font-weight: bold;
            max-width: 320px;
        }
    </style>
</head>
<body>
    <h2>Unlimited Web Proxy</h2>
    
    <div class="preset-buttons">
        <button data-url="https://www.youtube.com">ğŸ¬ ÛŒÙˆØªÛŒÙˆØ¨</button>
        <button data-url="https://www.instagram.com">ğŸ“¸ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…</button>
        <button data-url="https://www.google.com">ğŸ” Ú¯ÙˆÚ¯Ù„</button>
        <button data-url="https://www.tiktok.com">ğŸµ ØªÛŒÚ©â€ŒØªØ§Ú©</button>
        <button data-url="https://www.pinterest.com">ğŸ“Œ Ù¾ÛŒÙ†ØªØ±Ø³Øª</button>
        <button data-url="https://x.com">ğŸ¦ ØªÙˆÛŒÛŒØªØ± / X</button>
    </div>

    <p>ÛŒØ§ Ù„ÛŒÙ†Ú© Ø¯Ù„Ø®ÙˆØ§Ù‡ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
    <input type="text" id="urlInput" placeholder="https://example.com">
    <button id="generateBtn">Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© Ø¨Ø¯ÙˆÙ† ÙÛŒÙ„ØªØ±</button>

    <div id="result"></div>

    <script nonce="RasoulCSP">
        // Ø§ØªØµØ§Ù„ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
        document.querySelectorAll('.preset-buttons button').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('urlInput').value = btn.dataset.url;
                generateProxies();
            });
        });

        document.getElementById('generateBtn').addEventListener('click', generateProxies);

        const PROXY_IPS = [
            "185.16.38.122", "185.16.38.230", "185.16.38.114",
            "95.214.53.28", "51.159.194.214", "51.159.111.51"
        ];

        let FIXED_S = "";

        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        const urlParams = new URLSearchParams(window.location.search);
        FIXED_S = urlParams.get("s") || FIXED_S;

        if (!FIXED_S && Telegram.WebApp.initDataUnsafe?.start_param) {
            try {
                const params = new URLSearchParams(Telegram.WebApp.initDataUnsafe.start_param);
                FIXED_S = params.get("s") || "";
            } catch (e) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† start_param:", e);
            }
        }

        if (!FIXED_S) {
            document.body.innerHTML = `
                <div class="error-container">
                    <h2>Ø®Ø·Ø§</h2>
                    <p>Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ Ù…ØªØµÙ„ Ø´Ø¯.<br>Ù„Ø·ÙØ§Ù‹ Ø±Ø¨Ø§Øª Ø±Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯.</p>
                </div>
            `;
            console.error("FIXED_S Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯");
        } else {
            console.log("FIXED_S Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯:", FIXED_S);
        }

        function makeProxyLink(url, ip) {
            try {
                const r_bytes = btoa(url).replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '') + '%3D';
                return `https://${ip}/__cpi.php?s=${FIXED_S}&r=${r_bytes}&__cpo=1`;
            } catch (e) {
                return url;
            }
        }

        function generateProxies() {
            let url = document.getElementById('urlInput').value.trim();
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }

            if (!url.match(/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)$/)) {
                alert('Ù„ÛŒÙ†Ú© Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯!');
                return;
            }

            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>âš ï¸ Ù‡Ø± Ù„ÛŒÙ†Ú© ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ù†ÙØ± Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª.</p>';

            PROXY_IPS.forEach((ip, index) => {
                const proxyUrl = makeProxyLink(url, ip);
                resultDiv.innerHTML += `<a href="${proxyUrl}" class="proxy-link" target="_blank">ğŸŒ Ø³Ø±ÙˆØ± Ø´Ù…Ø§Ø±Ù‡ ${index + 1}</a>`;
            });

            Telegram.WebApp.MainButton.setText('Ø¨Ø³ØªÙ†').show().onClick(() => Telegram.WebApp.close());
        }
    </script>
</body>
</html>
